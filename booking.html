<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html lang="en-US" class="js flexbox flexboxlegacy canvas canvastext webgl no-touch geolocation postmessage websqldatabase indexeddb hashchange history draganddrop websockets rgba hsla multiplebgs backgroundsize borderimage borderradius boxshadow textshadow opacity cssanimations csscolumns cssgradients cssreflections csstransforms csstransforms3d csstransitions fontface generatedcontent video audio localstorage sessionstorage webworkers no-applicationcache svg inlinesvg smil svgclippaths win win-10_0 webkit chrome chrome-92 chrome-92_0_4515_131 k-webkit k-webkit92 general logged"><head id="Head"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><style type="text/css">svg:not(:root).svg-inline--fa {
  overflow: visible;
}

.svg-inline--fa {
  display: inline-block;
  font-size: inherit;
  height: 1em;
  overflow: visible;
  vertical-align: -0.125em;
}
.svg-inline--fa.fa-lg {
  vertical-align: -0.225em;
}
.svg-inline--fa.fa-w-1 {
  width: 0.0625em;
}
.svg-inline--fa.fa-w-2 {
  width: 0.125em;
}
.svg-inline--fa.fa-w-3 {
  width: 0.1875em;
}
.svg-inline--fa.fa-w-4 {
  width: 0.25em;
}
.svg-inline--fa.fa-w-5 {
  width: 0.3125em;
}
.svg-inline--fa.fa-w-6 {
  width: 0.375em;
}
.svg-inline--fa.fa-w-7 {
  width: 0.4375em;
}
.svg-inline--fa.fa-w-8 {
  width: 0.5em;
}
.svg-inline--fa.fa-w-9 {
  width: 0.5625em;
}
.svg-inline--fa.fa-w-10 {
  width: 0.625em;
}
.svg-inline--fa.fa-w-11 {
  width: 0.6875em;
}
.svg-inline--fa.fa-w-12 {
  width: 0.75em;
}
.svg-inline--fa.fa-w-13 {
  width: 0.8125em;
}
.svg-inline--fa.fa-w-14 {
  width: 0.875em;
}
.svg-inline--fa.fa-w-15 {
  width: 0.9375em;
}
.svg-inline--fa.fa-w-16 {
  width: 1em;
}
.svg-inline--fa.fa-w-17 {
  width: 1.0625em;
}
.svg-inline--fa.fa-w-18 {
  width: 1.125em;
}
.svg-inline--fa.fa-w-19 {
  width: 1.1875em;
}
.svg-inline--fa.fa-w-20 {
  width: 1.25em;
}
.svg-inline--fa.fa-pull-left {
  margin-right: 0.3em;
  width: auto;
}
.svg-inline--fa.fa-pull-right {
  margin-left: 0.3em;
  width: auto;
}
.svg-inline--fa.fa-border {
  height: 1.5em;
}
.svg-inline--fa.fa-li {
  width: 2em;
}
.svg-inline--fa.fa-fw {
  width: 1.25em;
}

.fa-layers svg.svg-inline--fa {
  bottom: 0;
  left: 0;
  margin: auto;
  position: absolute;
  right: 0;
  top: 0;
}

.fa-layers {
  display: inline-block;
  height: 1em;
  position: relative;
  text-align: center;
  vertical-align: -0.125em;
  width: 1em;
}
.fa-layers svg.svg-inline--fa {
  -webkit-transform-origin: center center;
          transform-origin: center center;
}

.fa-layers-counter, .fa-layers-text {
  display: inline-block;
  position: absolute;
  text-align: center;
}

.fa-layers-text {
  left: 50%;
  top: 50%;
  -webkit-transform: translate(-50%, -50%);
          transform: translate(-50%, -50%);
  -webkit-transform-origin: center center;
          transform-origin: center center;
}

.fa-layers-counter {
  background-color: #ff253a;
  border-radius: 1em;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
  color: #fff;
  height: 1.5em;
  line-height: 1;
  max-width: 5em;
  min-width: 1.5em;
  overflow: hidden;
  padding: 0.25em;
  right: 0;
  text-overflow: ellipsis;
  top: 0;
  -webkit-transform: scale(0.25);
          transform: scale(0.25);
  -webkit-transform-origin: top right;
          transform-origin: top right;
}

.fa-layers-bottom-right {
  bottom: 0;
  right: 0;
  top: auto;
  -webkit-transform: scale(0.25);
          transform: scale(0.25);
  -webkit-transform-origin: bottom right;
          transform-origin: bottom right;
}

.fa-layers-bottom-left {
  bottom: 0;
  left: 0;
  right: auto;
  top: auto;
  -webkit-transform: scale(0.25);
          transform: scale(0.25);
  -webkit-transform-origin: bottom left;
          transform-origin: bottom left;
}

.fa-layers-top-right {
  right: 0;
  top: 0;
  -webkit-transform: scale(0.25);
          transform: scale(0.25);
  -webkit-transform-origin: top right;
          transform-origin: top right;
}

.fa-layers-top-left {
  left: 0;
  right: auto;
  top: 0;
  -webkit-transform: scale(0.25);
          transform: scale(0.25);
  -webkit-transform-origin: top left;
          transform-origin: top left;
}

.fa-lg {
  font-size: 1.3333333333em;
  line-height: 0.75em;
  vertical-align: -0.0667em;
}

.fa-xs {
  font-size: 0.75em;
}

.fa-sm {
  font-size: 0.875em;
}

.fa-1x {
  font-size: 1em;
}

.fa-2x {
  font-size: 2em;
}

.fa-3x {
  font-size: 3em;
}

.fa-4x {
  font-size: 4em;
}

.fa-5x {
  font-size: 5em;
}

.fa-6x {
  font-size: 6em;
}

.fa-7x {
  font-size: 7em;
}

.fa-8x {
  font-size: 8em;
}

.fa-9x {
  font-size: 9em;
}

.fa-10x {
  font-size: 10em;
}

.fa-fw {
  text-align: center;
  width: 1.25em;
}

.fa-ul {
  list-style-type: none;
  margin-left: 2.5em;
  padding-left: 0;
}
.fa-ul > li {
  position: relative;
}

.fa-li {
  left: -2em;
  position: absolute;
  text-align: center;
  width: 2em;
  line-height: inherit;
}

.fa-border {
  border: solid 0.08em #eee;
  border-radius: 0.1em;
  padding: 0.2em 0.25em 0.15em;
}

.fa-pull-left {
  float: left;
}

.fa-pull-right {
  float: right;
}

.fa.fa-pull-left,
.fas.fa-pull-left,
.far.fa-pull-left,
.fal.fa-pull-left,
.fab.fa-pull-left {
  margin-right: 0.3em;
}
.fa.fa-pull-right,
.fas.fa-pull-right,
.far.fa-pull-right,
.fal.fa-pull-right,
.fab.fa-pull-right {
  margin-left: 0.3em;
}

.fa-spin {
  -webkit-animation: fa-spin 2s infinite linear;
          animation: fa-spin 2s infinite linear;
}

.fa-pulse {
  -webkit-animation: fa-spin 1s infinite steps(8);
          animation: fa-spin 1s infinite steps(8);
}

@-webkit-keyframes fa-spin {
  0% {
    -webkit-transform: rotate(0deg);
            transform: rotate(0deg);
  }
  100% {
    -webkit-transform: rotate(360deg);
            transform: rotate(360deg);
  }
}

@keyframes fa-spin {
  0% {
    -webkit-transform: rotate(0deg);
            transform: rotate(0deg);
  }
  100% {
    -webkit-transform: rotate(360deg);
            transform: rotate(360deg);
  }
}
.fa-rotate-90 {
  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=1)";
  -webkit-transform: rotate(90deg);
          transform: rotate(90deg);
}

.fa-rotate-180 {
  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=2)";
  -webkit-transform: rotate(180deg);
          transform: rotate(180deg);
}

.fa-rotate-270 {
  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=3)";
  -webkit-transform: rotate(270deg);
          transform: rotate(270deg);
}

.fa-flip-horizontal {
  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=0, mirror=1)";
  -webkit-transform: scale(-1, 1);
          transform: scale(-1, 1);
}

.fa-flip-vertical {
  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=2, mirror=1)";
  -webkit-transform: scale(1, -1);
          transform: scale(1, -1);
}

.fa-flip-both, .fa-flip-horizontal.fa-flip-vertical {
  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=2, mirror=1)";
  -webkit-transform: scale(-1, -1);
          transform: scale(-1, -1);
}

:root .fa-rotate-90,
:root .fa-rotate-180,
:root .fa-rotate-270,
:root .fa-flip-horizontal,
:root .fa-flip-vertical,
:root .fa-flip-both {
  -webkit-filter: none;
          filter: none;
}

.fa-stack {
  display: inline-block;
  height: 2em;
  position: relative;
  width: 2.5em;
}

.fa-stack-1x,
.fa-stack-2x {
  bottom: 0;
  left: 0;
  margin: auto;
  position: absolute;
  right: 0;
  top: 0;
}

.svg-inline--fa.fa-stack-1x {
  height: 1em;
  width: 1.25em;
}
.svg-inline--fa.fa-stack-2x {
  height: 2em;
  width: 2.5em;
}

.fa-inverse {
  color: #fff;
}

.sr-only {
  border: 0;
  clip: rect(0, 0, 0, 0);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

.sr-only-focusable:active, .sr-only-focusable:focus {
  clip: auto;
  height: auto;
  margin: 0;
  overflow: visible;
  position: static;
  width: auto;
}

.svg-inline--fa .fa-primary {
  fill: var(--fa-primary-color, currentColor);
  opacity: 1;
  opacity: var(--fa-primary-opacity, 1);
}

.svg-inline--fa .fa-secondary {
  fill: var(--fa-secondary-color, currentColor);
  opacity: 0.4;
  opacity: var(--fa-secondary-opacity, 0.4);
}

.svg-inline--fa.fa-swap-opacity .fa-primary {
  opacity: 0.4;
  opacity: var(--fa-secondary-opacity, 0.4);
}

.svg-inline--fa.fa-swap-opacity .fa-secondary {
  opacity: 1;
  opacity: var(--fa-primary-opacity, 1);
}

.svg-inline--fa mask .fa-primary,
.svg-inline--fa mask .fa-secondary {
  fill: black;
}

.fad.fa-inverse {
  color: #fff;
}</style><style type="text/css">@charset "UTF-8";[ng\:cloak],[ng-cloak],[data-ng-cloak],[x-ng-cloak],.ng-cloak,.x-ng-cloak,.ng-hide{display:none !important;}ng\:form{display:block;}.ng-animate-block-transitions{transition:0s all!important;-webkit-transition:0s all!important;}.ng-hide-add-active,.ng-hide-remove{display:block!important;}</style>


<title>
	Track Shipment
</title><meta id="MetaKeywords" name="KEYWORDS" content=",DotNetNuke,DNN"><meta id="MetaGenerator" name="GENERATOR" content="DotNetNuke "><meta id="MetaRobots" name="ROBOTS" content="INDEX, FOLLOW"><link href="./css/default.css" type="text/css" rel="stylesheet"><link href="./css/module.css" type="text/css" rel="stylesheet"><link href="./css/skin.css" type="text/css" rel="stylesheet"><script async="" src="./js/analytics.js"></script><script src="./js/jquery.js" type="text/javascript"></script><script src="./js/jquery-ui.js" type="text/javascript"></script><meta name="viewport" content="width=device-width,initial-scale=1"><link href="./css/enUS.css" type="text/css" rel="stylesheet"></head>
<body id="Body">
    
<form method="post" action="#" id="Form" enctype="multipart/form-data">
<div class="aspNetHidden">
<input type="hidden" name="__EVENTTARGET" id="__EVENTTARGET" value="">
<input type="hidden" name="__EVENTARGUMENT" id="__EVENTARGUMENT" value="">
<input type="hidden" name="__VIEWSTATE" id="__VIEWSTATE" value="jMC8ux023nuhFgnNppIZhkdPhxfEi9/MhjULCPSUnnrpS2gm71pQuD5/Nl4MIyMlCsIBK0hCw5pqv9I0ai8DLIm/6HVkP3wsfhzP3FDxXUZdwNoju+PHuO1iJfAgKnWdYQPJDxTaiEBY1hf65gU70feVcxDFs4n0Ses+Xb+l9sIUlQSWCP2PU8BB1iA=">
</div>

<script type="text/javascript">
//<![CDATA[
var theForm = document.forms['Form'];
if (!theForm) {
    theForm = document.Form;
}
function __doPostBack(eventTarget, eventArgument) {
    if (!theForm.onsubmit || (theForm.onsubmit() != false)) {
        theForm.__EVENTTARGET.value = eventTarget;
        theForm.__EVENTARGUMENT.value = eventArgument;
        theForm.submit();
    }
}
//]]>
</script>

<div class="aspNetHidden">

	<input type="hidden" name="__VIEWSTATEGENERATOR" id="__VIEWSTATEGENERATOR" value="CA0B0334">
	<input type="hidden" name="__VIEWSTATEENCRYPTED" id="__VIEWSTATEENCRYPTED" value="">
	<input type="hidden" name="__PREVIOUSPAGE" id="__PREVIOUSPAGE" value="KNiZiHexPoVKOx2L-TZK6V1x7ZVDguk0-5FDsXrGBw3h5VgFljksJKLVrGo1">
	<input type="hidden" name="__EVENTVALIDATION" id="__EVENTVALIDATION" value="LJWSAruka68AjsB9WIPa6ylTrFEN9VyVFMgAnSPKo6znrlLMCEeX1yHE7LHrFe+dVmqkU7kMfeAOM5NOkCX+xXQtMK3PaLe9kst/B27Mzx18XUJEKBQg9zvQ/qSMAC/XmnBIoeZ9A7/ujpiXn4iijJM9oxLAoO7vm07+cN2UxUqfvOJeb6MLBvrDsjwYf+uxyOFz9W+7eRxl3h6mdzxl6Zw4z/RmQ1C3J0qu2zgSFZRbAr7WNlfdqkpbcWOMx8nQ3WNDEahNJWTO4IeDRgzeFV6Swoo=">
</div><script src="./js/dnn.modalpopup.js" type="text/javascript"></script><script src="./js/dnncore.js" type="text/javascript"></script>

<!--
<script src="./Track_Shipment_files/WebResource.axd" type="text/javascript"></script>
<script src="./Track_Shipment_files/ScriptResource.axd" type="text/javascript"></script>
<script src="./Track_Shipment_files/ScriptResource(1).axd" type="text/javascript"></script>
<script type="text/javascript">
//<![CDATA[
Sys.WebForms.PageRequestManager._initialize('ScriptManager', 'Form', [], [], [], 90, '');
//]]>
</script>-->

        
        
        

<link href="./css/app.menu.css" rel="stylesheet">
<!-- Google Analytics -->
<script src="./js/ga.js"></script>

<!-- JavaScript -->
<script src="./js/skin.js"></script>
<script src="./js/bootstrap.min.js"></script>
<script src="./js/bootstrap-toggle.min.js"></script>
<script src="./js/modernizr.js"></script>
<script src="./js/main.js"></script>
<script src="./js/angular_1.2.20_angular.min.js"></script>
<script src="./js/bootstrap-tagsinput.min.js"></script>
<script src="./js/bootstrap-tagsinput-angular.min.js"></script>
<script src="./js/bootstrap-select.min.js"></script>
<script src="./js/typeahead.bundle.js"></script>
<script src="./js/bootstrap-datepicker_1.9.0.js"></script>
<script src="./js/lodash.min_4.17.15.js"></script>
<script src="./js/i18next.min.js"></script>
<script src="./js/i18nextXHRBackend.min.js"></script>
<script src="./js/old_version_browser.js"></script>
<script src="./js/jquery-i18next.min.js"></script>
<script src="./js/jquery.bind-first-0.2.3.min.js"></script>
<script src="./js/jquery.signalR-2.2.1.min.js"></script>
<script src="./js/hubs.js"></script>

<!-- Styles -->
<link href="./css/bootstrap.min.css" rel="stylesheet">
<link href="./css/bootstrap-toggle.min.css" rel="stylesheet">
<link href="./css/jquery-ui.css" rel="stylesheet">
<link href="./css/toggle-switch.css" rel="stylesheet">
<link href="./css/bootstrap-select.min_1.12.4.css" rel="stylesheet">
<link href="./css/bootstrap-datepicker_1.9.0.css" rel="stylesheet">
<link href="./css/bootstrap-tagsinput.css" rel="stylesheet">
<link href="./css/typeaheadjs.css" rel="stylesheet">
<link href="./css/style.css" rel="stylesheet">
<link href="./css/skin.css" rel="stylesheet">
	
<!-- IE8 -->
<!--[if lt IE 9]>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->

<script>
var _currentCulture = 'en-US';

if (document.location.href.indexOf("/0/OldBrowser") == -1) {
var browser = BrowserDetect.browser ? BrowserDetect.browser.name : undefined;
var version = BrowserDetect.browser ? BrowserDetect.browser.value : undefined;

	if (browser && browser.toUpperCase() == "MSIE" && parseInt(version.substring(0,version.indexOf("."))) <= 10) {
		document.location.href = "/0/OldBrowser";
	}

	
}

<!-- i18n -->
jqueryI18next.init(i18next, $, {
	tName: 't',
	i18nName: 'i18n',
	handleName: 'localize',
	selectorAttr: 'data-i18n',
	targetAttr: 'i18n-target',
	optionsAttr: 'i18n-options',
	useOptionsAttr: false,
	parseDefaultValueFromContent: true
});

i18next.use(window.i18nextXHRBackend).init({
	fallbackLng: 'en-US',
	lng: _currentCulture,
	backend: {
	  loadPath: '/locales/{{ns}}_{{lng}}.json',
	  addPath: '/locales/add/{{ns}}_{{lng}}.json', // unused
	  allowMultiLoading: false
    }
}, function(err, t) {
	$("html").localize();
});

$(function() {
	i18nInitCore("20191219");
});

</script>

<!-- Error Message Template -->
<script id="error_main_template" type="text/x-template">
    <div class="error-box">
        <p class="error-message">$ERR_MESSAGE$</p>
        <div class="errorTable">
            <div class="errorTableBody">
                $ERR_ITEMS$
            </div>
        </div>
    </div>
</script>
<script id="error_item_template" type="text/x-template">
    <div class="errorTableRow">
        <div class="errorTableCell">$ERR_TITLE$</div>
        <div class="errorTableCell"><span class="awb">$ERR_DESCRIPTION$</span></div>
    </div>
</script>

<div class="d-off-canvas-wrapper d-example general_nav">
	<div class="general_nav_inner">	
			<div class="flex-box-container">
				<!-- Menu -->
				<div id="app" class="wrap"><div data-v-6b6bd2ad="" class="wrap" style=""><div data-v-6b6bd2ad="" id="mobile_logo" title="EzyCargo" class="header-wrapper__logo logo"></div><div data-v-6b6bd2ad="" id="logo" class="logo-container"><a data-v-6b6bd2ad="" class="closebtn" style="display: none;"><svg data-v-6b6bd2ad="" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="times" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 352 512" class="svg-inline--fa fa-times fa-w-11 fa-1x"><path data-v-6b6bd2ad="" fill="currentColor" d="M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z" class=""></path></svg></a></div><div data-v-6b6bd2ad="" id="hamburger"><span data-v-6b6bd2ad=""></span><span data-v-6b6bd2ad=""></span><span data-v-6b6bd2ad=""></span></div><div data-v-6b6bd2ad="" id="myNav"><nav data-v-496691e8="" data-v-6b6bd2ad="" id="menu" class="overlay-content" style="height: 10px;"><div data-v-496691e8="" id="nav_menu"><div data-v-496691e8="" class="menu-header-container"><a data-v-496691e8="" href="#" title="Ezycargo_UAT" oncontextmenu="return false;" class="header-wrapper__logo logo" style="width: 100px; height: 40px;"></a>
				
				<a data-v-496691e8="" href="./index.html" id="menudashboardlink" title="Dash board" oncontextmenu="return false;" class="menudashboardlink"><div data-v-496691e8="" class="menudashboard"> Dashboard </div></a>
				
				<a data-v-496691e8="" href="./booking.html" style="text-decoration: none" id="menulink" oncontextmenu="return false;" class="menulink"><p data-v-496691e8="" id="dropdownHeader_0" class="mainMenu"> Booking </p></a>
				
				<a data-v-496691e8="" href="./trackshipment.html" style="text-decoration: none" id="menulink" oncontextmenu="return false;" class="menulink"><p data-v-496691e8="" id="dropdownHeader_1" class="mainMenu"> Track Shipment </p></a>
				
				<!----></div></div><form data-v-496691e8="" id="form1" method="post" action="https://uat-ezycargo2017.ezbiz.com/en-US/1/Track-Shipment"><input data-v-496691e8="" type="hidden" id="CompanyID" name="CompanyID" value=""><br data-v-496691e8=""><input data-v-496691e8="" type="hidden" id="UserID" name="UserID" value=""><br data-v-496691e8=""><br data-v-496691e8=""><input data-v-496691e8="" type="hidden" id="SessionID" name="SessionID" value=""><br data-v-496691e8=""><input data-v-496691e8="" type="hidden" id="CompanyPIMA" name="CompanyPIMA" value=""><br data-v-496691e8=""><br data-v-496691e8=""><input data-v-496691e8="" type="hidden" id="COSACID" name="COSACID" value=""><br data-v-496691e8=""><input data-v-496691e8="" type="hidden" id="CompanyName" name="CompanyName" value=""><br data-v-496691e8=""><br data-v-496691e8=""><input data-v-496691e8="" type="hidden" id="TargetURL" name="TargetURL" value=""><br data-v-496691e8=""><br data-v-496691e8=""><input data-v-496691e8="" type="hidden" id="Lang" name="Lang" value=""><br data-v-496691e8=""><br data-v-496691e8=""><input data-v-496691e8="" type="hidden" id="ApiToken" name="ApiToken" value=""><br data-v-496691e8=""><br data-v-496691e8=""><input data-v-496691e8="" type="hidden" id="RefreshToken" name="RefreshToken" value=""><br data-v-496691e8=""><br data-v-496691e8=""><input data-v-496691e8="" type="hidden" id="ApiTokenExpiryTime" name="ApiTokenExpiryTime" value=""><br data-v-496691e8=""><br data-v-496691e8=""></form></nav></div></div></div>
				

<div class="navbar-form navbar-right">
    <div id="profile_blk" class="profile_blk">
	    <div class="notify">
		    <div class="notify_switch disabled" data-toggle="dropdown" id="dropdownMenu1"></div>
            <div id="profile_alert_cnt" class="disabled"><span>0</span></div>
		    <div aria-labelledby="dropdownMenu1" class="panel_news">			
		    </div>
	    </div>
        <span class="divider_v disabled"></span>
	    <div class="profile_txtblk">
		    <div aria-expanded="false" class="profile_switch" data-toggle="dropdown" id="dropdownMenu9">
			    <div class="profile_co">
				    <span id="profile_companyid">GLS</span>
			    </div>
			    <div class="profile_user">
				    <span id="profile_username">ADMIN</span>
			    </div>
		    </div>
		    <div aria-labelledby="dropdownMenu9" class="profile_panel">
				<a id="dnn_GLS_PROFILE_lnkLogout" data-i18n="common.Logout" href="#">Logout</a>
				
				
		    </div>
		    <div class="profile_close"></div>
	    </div>
    </div>
</div>
<script>
    setTimeout(function () {
	    $("html").addClass("logged");
    }, 1000);
</script>			
			</div>
	</div>
</div>


<!-- Page Content -->
<div class="pageContent">
<main role="main">
<div id="dnn_ContentPane" class="contentPane">
<div class="DnnModule DnnModule-TrackAndTrace DnnModule-385"><a name="385"></a>
<div class="DNNContainer_noTitle logged js flexbox flexboxlegacy canvas canvastext webgl no-touch geolocation postmessage websqldatabase indexeddb hashchange history draganddrop websockets rgba hsla multiplebgs backgroundsize borderimage borderradius boxshadow textshadow opacity cssanimations csscolumns cssgradients cssreflections csstransforms csstransforms3d csstransitions fontface generatedcontent video audio localstorage sessionstorage webworkers applicationcache svg inlinesvg smil svgclippaths">
<div id="dnn_ctr398_ContentPane"><!-- Start_Module_398 -->
<div id="dnn_ctr398_ModuleContent" class="DNNModuleContent ModBookingC">

<script src="./js/booking/bluebird-3.3.5.min.js"></script>
<script src="./js/booking/ConfigManager.js"></script>
<script src="./js/booking/InjectionManager.js"></script>
<link rel="stylesheet" href="./css/booking/all.css">


<script>
    function loadMainScript() {
        return Promise.all([
            InjectionManager.injectScripts(['formatCheck.js', 'format.js', 'constant.js', 'template_record.js']),
            InjectionManager.injectService(['AjaxRequest.js']),
            InjectionManager.injectService(['APIHandler.js'])
        ]);
    }
</script>

<script>
    var bookingHub = $.connection.bookingHub;
    var timeoutValue = 10000; //30000;
    var timeoutHandle = -1;
    var callback = null;

    var multiBookingSubmitCnt = 0;
    var multiBookingReceiveCnt = 0;
    var multiBookingAWBWaitingReply = [];

    var currentTabID = "45";
    var decimalRoundTo = 2;
    var decimalWeightRoundTo = 1;
	var decimalTemperatureRoundTo = 1;
    var decimalVolumeRoundToCX = 3;
    var defaultAddressBookCount = 50;
    var defaultChooseTemplateCount = 20;
    var defaultToolsBoxChooseTemplateCount = 30;
    var maxMultiAWB = 12;
    var intVad = /^\+?(0|[1-9]\d*)$/;
    var decVad = /^([1-9]\d*|0\.\d*[0-9]|[0-9]\d*\.\d*[0-9]|0)$/;
    var decVadWithNeg = /^-?([1-9]\d*|0\.\d*[1-9]|[1-9]\d*\.\d*[0-9]|0)$/;
    var lbToKgConstant = 0.453592;
	
	//20210730 For retrieving booking log data
	var wayToRetrieveBookingLog = 1;
	var RetrieveBookingHistoryAPIURL = "https://uat-apigateway.ezbiz.com/uat-ezycargoapi/booking/bookinghistory/";

    //20201207 For switch the way of retrieveing booking data
    var wayToRetrieve = 1; // 0 = bookinghub , 1 = booking API
    //DEV : " https://uat-apigateway.ezbiz.com/dev-ezycargoapi/booking/getbooking"
    //UAT: "https://uat-apigateway.ezbiz.com/uat-ezycargoapi/booking/getbooking"
    //UAT internal kong :"https://uat-intapigateway.ezbiz.com/uat-ezycargoapi/booking/getbooking"
    var RetrieveAPIURL = "https://uat-apigateway.ezbiz.com/uat-ezycargoapi/booking/getbooking";

    //20210208 For switch the way of submit booking data
    var wayToSubmit = 1; // 0 = bookinghub , 1 = booking API
     //DEV : " https://uat-apigateway.ezbiz.com/dev-ezycargoapi/booking/submitbooking"
     //UAT: "https://uat-apigateway.ezbiz.com/uat-ezycargoapi/booking/submitbooking"
    //UAT internal kong :"https://uat-intapigateway.ezbiz.com/uat-ezycargoapi/booking/submitbooking"
    var SubmitAPIURL = "https://uat-apigateway.ezbiz.com/uat-ezycargoapi/booking/submitbooking";

    var BookingAPIURL = "https://uat-apigateway.ezbiz.com/uat-ezycargoapi/booking/";

    String.prototype.replaceAll = function (search, replacement) {
        var target = this;
        return target.replace(new RegExp(search, 'g'), replacement);
    };

    Date.prototype.addDays = function (days) {
        var date = new Date(this.valueOf());
        date.setDate(date.getDate() + days);
        return date;
    }

    Date.prototype.dateDiff = function (interval, objDate) {
        var dtEnd = new Date(objDate);
        if (isNaN(dtEnd))
            return undefined;
        switch (interval) {
            case "s": return parseInt(Math.ceil((dtEnd - this) / 1000));
            case "n": return parseInt(Math.ceil((dtEnd - this) / 60000));
            case "h": return parseInt(Math.ceil((dtEnd - this) / 3600000));
            case "d": return parseInt(Math.ceil((dtEnd - this) / 86400000));
            case "w": return parseInt(Math.ceil((dtEnd - this) / (86400000 * 7)));
            case "m": return (dtEnd.getMonth() + 1) + ((dtEnd.getFullYear() - this.getFullYear()) * 12) - (this.getMonth() + 1);
            case "y": return dtEnd.getFullYear() - this.getFullYear();
        }
    }

    const AfterTemplateChange = {
        NoAction: 0,
        QuickAWBSearch: 1,
        FillTemplateData: 2,
        SetBookingData: 3,
        PasteFlightDetailData: 4
    };

    function isInt(value) {
        return !isNaN(value) && (function (x) { return (x | 0) === x; })(parseFloat(value))
    }

    function isJsonParsable(str) {
        try {
            JSON.parse(str);
        } catch (e) {
            return false;
        }
        return true;
    }

    //Airline setting
    //var airlineList = ["CX", "JL", "KA", "AA", "AF", "EY", "KE", "KK", "KL", "LD", "LH" ,"LX", "NH", "SA", "SK", "SQ", "SV", "UA"];
    var airlineList = [];
    var multiAirlineIgnoreList = ["SQ", "LH"];

    //CX Warehouse code
    var warehouseCX = ["", "BF", "CA", "CE", "CG", "CH", "CR", "CV", "CW", "CX", "DF"];
    var warehouseCXDesc = ["",
        "BF - Kaohsiung Air Cargo Terminal",
        "CA - Taiwan Air Cargo Terminal Ltd. - Export",
        "CE - Taiwan Air Cargo Terminal Ltd. - Express",
        "CG - Evergreen Air Cargo Services. Corp. - Export",
        "CH - Ever Terminal Co., Ltd. - Export",
        "CR - Evergreen Air Cargo Sevrices. Corp. - Express",
        "CV - Ever Terminal Co., Ltd. - Express",
        "CW - Far Glory Air Cargo Terminal Co., Ltd. - Export",
        "CX - Far Glory Air Cargo Terminal Co., Ltd. - Express",
        "DF - DF"
    ];

    //CX priority
    var cxPriority = [];
    var priObj = new Object();
    priObj.Value = "PR3";
    priObj.Text = "General LIFT";
    cxPriority.push(priObj);
    priObj = new Object();
    priObj.Value = "PR2";
    priObj.Text = "General LIFT Plus";
    cxPriority.push(priObj);
    priObj = new Object();
    priObj.Value = "PR1";
    priObj.Text = "Priority LIFT";
    cxPriority.push(priObj);
    priObj = new Object();
    priObj.Value = "PR4";
    priObj.Text = "Flexi LIFT";
    cxPriority.push(priObj);
    localStorage.setItem("CXPriorityType", JSON.stringify(cxPriority));

    //SQ
    const sqProductValue = {
        Empty: 0,
        SwiftRider: 1,
        ValueAddCool: 2,
    };
    var uldListSQ = ["", "AAF", "AAP", "AAU", "AKE", "AMA", "AMD", "AVE", "BUK", "CTR", "HMA", "KMA", "LDP", "MA1", "MA2", "MDB", "MDT", "MQ6", "MQ7", "PGA", "PLB", "PZA", "RAP", "RKN"];

    //BA
    /*
    var uldUnitListBA = ["", "AAF", "AAP", "AAU", "AKE", "ALF", "ALP", "ALU", "PAG", "PGA", "PLA", "PMC", "PMP", "PZA"];
    var uldContourListBA = ["", "A2", "H2", "H3", "W2", "Q6", "Q7", "ZA"];
    var arrBAULDUnit1 = ["PAG", "PMP", "PLA"];
    var arrBAULDUnit2 = ["PGA", "PZA"];
    var arrBAULDUnit3 = ["PMC"];
    var arrBAULDContour1 = ["", "A2", "H2", "H3", "W2"];	        //PAG, PMP, PLA
    var arrBAULDContour2 = ["", "Q6", "Q7"];						//PGA, PZA
    var arrBAULDContour3 = ["", "Q6", "Q7", "ZA"];				//PMC

    function getBAULDVol(str) {
        var tmpVol;
        if (str == 'PAG' || str == 'PMP' || str == 'AAP' || str == 'AAF' || str == 'AAU')
            tmpVol = 11.0;
        else if (str == 'PLA' || str == 'ALP' || str == 'ALF' || str == 'ALU')
            tmpVol = 7.0;
        else if (str == 'PGA' || str == 'PZA')
            tmpVol = 34.0;
        else if (str == 'PMC')
            tmpVol = 17.0;
        else if (str == 'AKE')
            tmpVol = 4.0;
        else
            tmpVol = 0.0;
        return tmpVol;
    }
    */

    //JL
    var uldListJL = ["", "M", "L", "C"];
    var uldListJLDesc = ["", "Main", "Lower", "LD3"];
    var prdListJL = ["", "JCA", "JCL", "JPR", "JSP", "JWH"];
    var prdListJLDesc = ["", "J-Care", "J-Cool", "J-Priority", "J-Speed", "J-Wheel"];

    function connectHub(doneFunction) {
        /*
        if ($.connection.hub.state != 4) {
            console.log("SignalR - Cancel Previous Action");
            $.connection.hub.stop();
        }


        if (timeoutHandle != -1) {
            clearInterval(timeoutHandle);
            timeoutHandle = -1;
        }
        */
        clearInterval(timeoutHandle);

        if ($.connection.hub.state != $.signalR.connectionState.connected) {
            $.connection.hub.start().done(doneFunction);
        } else {
            doneFunction();
        }

        return true;
    }

    function disconnectHub() {
        $.connection.hub.stop();
        return true;
    }

    function startAction(fullLoading, message, disableInput) {
        if (fullLoading) {
            ToggleLoading(true);
        }
        else {
            TogglePartialLoading(true, message, disableInput);
        }

        if (typeof disableCargoInfoAWBInput === 'function') {
            disableCargoInfoAWBInput();
        }

        startTimeout();
    }

    function stopAction() {
        if (timeoutHandle != -1) {
            clearTimeout(timeoutHandle);
            timeoutHandle = -1;
        }

        //disconnectHub();

        if (callback) {
            callback();
            callback = null;
        }

        if (typeof enableCargoInfoAWBInput === 'function') {
            enableCargoInfoAWBInput();
        }
        console.timeEnd("submitForm");
        ToggleLoading(false);
    }

    function startTimeout() {
        timeoutHandle = setTimeout(function () {
            bkdTimeout();
        }, timeoutValue);
    }

    function getData(moduleID, dataID) {
        var o = $("#" + moduleID)[0];
        if (o && $(o, 'events') && $._data(o, 'events').getData != null)
            return $(o).triggerHandler("getData", dataID);
        else
            return null;
    }

    function setData(moduleID, dataID, value) {
        var o = $("#" + moduleID)[0];
        if (o && $(o, 'events') && $._data(o, 'events').setData != null) {
            var extraPara = [];
            extraPara.push(dataID);
            extraPara.push(value);
            $(o).triggerHandler("setData", extraPara);
        }
    }

    bookingHub.client.ack = function (functionID) {
        console.log("Ack: " + functionID);
    }

    bookingHub.client.completed = function (functionID) {
        console.log("Completed: " + functionID);
        stopAction();
    }

    bookingHub.client.error = function (msg) {
        console.log("Error Message - " + msg);
        alert(msg);
        stopAction();
    }

    bookingHub.client.sessionTimeout = function (redirectTo) {
        console.log("Session Timeout");
        var redirect = function () {
            window.location.replace(redirectTo);
        }
        stopAction();
        DialogManager.alert(i18next.t('common.System'), i18next.t('common.SessionTimeout'), redirect, { backdrop: false });
    }

    function bkdTimeout() {
        debugger;
        bookingHub.client.error("Timeout");
        timeoutHandle = -1;
    }

    var linkBkdLanding = "https://uat-ezycargo2017.ezbiz.com/en-us/1/Booking";
    var linkBkdSingleAwb = "https://uat-ezycargo2017.ezbiz.com/en-us/1/Booking/SingleBooking";
    var linkBkdMultiAwb = "https://uat-ezycargo2017.ezbiz.com/en-us/1/Booking/MultiBooking";
    var linkBkdMultiAirline = "https://uat-ezycargo2017.ezbiz.com/en-us/1/Booking/MultiAirline";
    var linkBkdBookingLog = "https://uat-ezycargo2017.ezbiz.com/en-us/1/Booking/BookingLog";
    var linkBkdDetail = "https://uat-ezycargo2017.ezbiz.com/en-us/1/Booking/Detail";
    var linkBkdSpreadsheet = "https://uat-ezycargo2017.ezbiz.com/en-us/1/DashboardOld";

    var bkdQSSingle = "?Airline=$AIRLINE$&AWBPrefix=$AWBPREFIX$&AWBSuffix=$AWBSUFFIX$";
    var bkdQSBookingLogSearch = "?Orig=$ORIG$&Dest=$DEST$&DateRange=$DATERANGE$&DateType=$DATETYPE$&UserID=$USERID$";

    $(document).ready(function () {
        $(".btn-select").each(function (e) {
            var value = $(this).find("ul li.selected").html();
            if (value != undefined) {
                $(this).find(".btn-select-input").val(value);
                $(this).find(".btn-select-value").html(value);
            }
        });
    });

    $(document).on('click', '.btn-select', function (e) {
        e.preventDefault();
        var ul = $(this).find("ul");
        if ($(this).hasClass("active")) {
            if (ul.find("li").is(e.target)) {
                var target = $(e.target);
                target.addClass("selected").siblings().removeClass("selected");
                var value = target.data("val");
                var text = target.html();
                $(this).find(".btn-select-input").val(value).trigger('change');
                $(this).find(".btn-select-value").html(text);
            }
            ul.hide();
            $(this).removeClass("active");
        }
        else {
            $('.btn-select').not(this).each(function () {
                $(this).removeClass("active").find("ul").hide();
            });
            ul.slideDown(300);
            $(this).addClass("active");
        }
    });

    $(document).on('click', function (e) {
        var target = $(e.target).closest(".btn-select");
        if (!target.length) {
            $(".btn-select").removeClass("active").find("ul").hide();
        }
    });

    function bkdAWBPrefixToAirline(awbPrefix) {
        switch (awbPrefix) {
            case "001":
                return "AA";
            case "016":
                return "UA";
            case "020":
                return "LH";
            case "043":
                return "KA";
            case "057":
                return "AF";
            case "065":
                return "SV";
            case "074":
                return "KL";			
            case "083":
                return "SA";
            case "117":
                return "SK";
            case "125":
                return "BA";
            case "128":
                return "UO";
            case "131":
                return "JL";
            case "144":
                return "7T";
            case "155":
                return "ES";
            case "160":
                return "CX";
            case "180":
                return "KE";
            case "189":
                return "JX";
            case "205":
                return "NH";
            case "278":
                return "3S";
            case "288":
                return "LD";
            case "607":
                return "EY";
            case "610":
                return "KK";
            case "615":
                return "QY";
            case "618":
                return "SQ";
            case "724":
                return "LX"
            case "810":
                return "M6";
            case "936":
                return "D0";
            case "946":
                return "V4";
            case "947":
                return "L3";
            case "992":
                return "D5";
            case "580":
                return "RU";
			// ad-hoc on JL, 16082021
			case "047":
				return "TP";
			case "064":
				return "OK";
			case "183":
				return "LC";
			case "230":
				return "CM";
			case "289":
				return "OM";
			case "355":
				return "E7";
			case "577":
				return "AD";
			case "657":
				return "BT";
			case "873":
				return "6R";
			case "996":
				return "UX";
			case "077":
				return "MS";
			case "805":
				return "4X";
			case "643":
				return "KM";
			case "244":
				return "TN";
			// ad-hoc on JL end
			// ad-hoc on JL, 18082021
			case "656":
				return "PX";
			case "575":
				return "7C";
			case "114":
				return "LY";
			case "202":
				return "TA";
			case "319":
				return "8D";
			// ad-hoc on JL end
            default:
                if (sessionStorage.getItem("OtherBookingPrefixPflList")) {
                    var otherBookingPrefixPflList = JSON.parse(sessionStorage.getItem("OtherBookingPrefixPflList"));
                    var convertPrefix = _.find(otherBookingPrefixPflList, function (o) { return o.AllowedPrefix == awbPrefix; })

                    if (convertPrefix) {
                        return bkdAWBPrefixToAirline(convertPrefix.AirlinePrefix)
                    }
                }
                return "";
        }
    }

    function bkdAirlineDefaultAWBPrefix(airline) {
        switch (airline) {
            case "AA":
                return "001";
            case "UA":
                return "016";
            case "LH":
                return "020";
            case "KA":
                return "043";
            case "AF":
                return "057";
            case "SV":
                return "065";
            case "KL":
                return "074";
            case "SA":
                return "083";
            case "SK":
                return "117";
            case "BA":
                return "125";
            case "UO":
                return "128";
            case "JL":
                return "131"
            case "7T":
                return "144"
            case "ES":
                return "155"
            case "CX":
                return "160";
            case "KE":
                return "180";
            case "JX":
                return "189";
            case "NH":
                return "205";
            case "3S":
                return "278"
            case "LD":
                return "288";
            case "EY":
                return "607";
            case "KK":
                return "610";
            case "QY":
                return "615"
            case "SQ":
                return "618";
            case "LX":
                return "724";
            //case "M6":
            //    return "810";
            case "D0":
                return "936"
            case "V4":
                return "946"
            case "L3":
                return "947"
            case "D5":
                return "992"
            default:
                return "";
        }
    }

    function bkdCheckAirlineCodeAndPrefix(code, prefix) {
        if (!code || !code.trim())
            return true;

        if (sessionStorage.getItem("OtherBookingPrefixPflList")) {
            if (code.toUpperCase() == bkdAWBPrefixToAirline(prefix)) {
                return true;
            }
            else {
                var otherBookingPrefixPflList = JSON.parse(sessionStorage.getItem("OtherBookingPrefixPflList"));
                var inputAirlinePrefix = bkdAirlineDefaultAWBPrefix(code.toUpperCase());

                if (_.find(otherBookingPrefixPflList, function (o) {
                    return o.AirlinePrefix == inputAirlinePrefix && o.AllowedPrefix == prefix;
                }))
                    return true
                else
                    return false;
            }
        }
        else {
            return true;
        }
    }

    function bkdConvertAirlineToMaster(airline) {
        airline = airline.toUpperCase();
        switch (airline) {
            case "AA":
            case "AF":
            case "EY":
            case "KE":
            case "KK":
            case "NH":
            case "SA":
            case "SK":
            case "SV":
            case "UA":
            case "JX":
            case "7T":
            case "ES":
            case "3S":
            case "QY":
            case "D0":
            case "V4":
            case "L3":
            case "D5":
            case "M6":
                return "AA";
            case "CX":
            case "KA":
            case "LD":
            case "UO":
                return "CX";
            case "JL":
                return "JL";
            case "KL":
                return "KL";
            case "LH":
                return "LH";
            case "LX":
                return "LX";
            case "SQ":
                return "SQ";
        }
    }

    function bkdStatusToGeneralType(status) {
        switch (status) {
            case 0:
            case 1:
                return "Draft";
            case 2:
            case 15:
                return "Pending";
            case 3:
            case 5:
            case 6:
            case 7:
            case 8:
            case 9:
            case 13:
                return "Replied";
            case 4:
            case 11:
            case 13:
            case 10:
            case 12:
            case 14:
            case 99:
            default:
                return "Error";
        }
    }

    function bkdStatusToText(status) {
        statusText = "";
        isError = false;

        switch (status) {
            case 0:
                statusText = "New";
                break;
            case 1:
                statusText = "Saved";
                break;
            case 2:
                statusText = "Submitted";
                break;
            case 3:
                statusText = "Acknowledged";
                break;
            case 4:
            case 11:
                statusText = "Flight Not Exists";
                isError = true;
                break;
            case 5:
                statusText = "Confirmed";
                break;
            case 6:
                statusText = "Partially Confirmed";
                break;
            case 7:
                statusText = "Partially Confirmed";
                break;
            case 8:
                statusText = "Partially Confirmed Split";
                break;
            case 9:
            case 13:
                statusText = "Cancelled";
                break;
            case 10:
                statusText = "Rejected";
                isError = true;
                break;
            case 12:
                statusText = "Waiting List";
                isError = true;
                break;
            case 14:
                statusText = "Holding";
                isError = true;
                break;
            case 15:
                statusText = "Awaiting Reply";
                break;
            case 16:
                statusText = "Saved";
                break;
            case 99:
            default:
                statusText = "Error";
                isError = true;
        }

        return {
            StatusText: statusText,
            Error: isError
        };
    }

    function selectSHCFromAutoComplete(event, ui) {
        console.log(ui.item.label);

        setTimeout(function () {
            $("#sc_special_code_focus").focus();
        }, 200);

        setTimeout(function () {
            $(".SHCodeAC input.form-control.autocomplete.ui-autocomplete-input").focus();
        }, 300);

    }

    function selectSHCFromAutoCompleteDG(event, ui) {
        console.log(ui.item.label);

        setTimeout(function () {
            $("#sc_special_code_dg_focus").focus();
        }, 200);

        setTimeout(function () {
            $(".SHCodeDG input.form-control.autocomplete.ui-autocomplete-input").focus();
        }, 300);

    }

    function checkSHCShowTemperatureInput(shc) {
        var shcList = [];
        var rtn = false;

        if (shc != "") {
            shcList = shc.split(",");
        }

        if (shcList.length > 0) {
            if (shcList.indexOf("ACT") > -1) {
                rtn = true;
            } else if (shcList.indexOf("PIL") > -1 && shcList.indexOf("COL") > -1) {
                rtn = true;
            } else if (shcList.indexOf("PIL") > -1 && shcList.indexOf("FRO") > -1) {
                rtn = true;
            } else if (shcList.indexOf("PIL") > -1 && shcList.indexOf("ICE") > -1) {
                rtn = true;
            }
        }

        return rtn;
    }

    function checkSHCPromptShipperConsigneeInput(shc) {
        var shcList = [];
        var rtn = false;

        if (shc != "") {
            shcList = shc.split(",");
        }

        if (shcList.length > 0) {
            if (shcList.indexOf("AVI") > -1 || shcList.indexOf("HUM") > -1 || shcList.indexOf("AVC") > -1 || shcList.indexOf("AVP") > -1 || shcList.indexOf("RRY") > -1) {
                rtn = true;
            }
        }

        return rtn;
    }

	function checkSHCPromptNGTTInput(shc)
    {
        var shcList = [];
        var rtn = false;

        if (shc != "") {
            shcList = shc.split(",");
        }

        if (shcList.length > 0) {
            if (shcList.indexOf(ngtt_shc) > -1) {
                rtn = true;

                var isexist = false;

                for (var i = 0; i < shcList.length; i++) {

                    $('#ngtt_product option').each(function () {

                        if (this.value == shcList[i])
                        {
                            $('#ngtt_product').val(this.value).change();
                            isexist = true;
                            return false;
                        }
                    });

                    if (isexist) {
                        break;
                    }

                }

            }
        }

        return rtn;
    }

    function bkdPortQueryLimitToChar() {
        $(".port_query").unbind("keypress").keypress(function (e) {
            console.log(e.which);
            if ((e.which >= 65 && e.which <= 90) || (e.which >= 97 && e.which <= 122)) {
            } else {
                return false;
            }
        });
    }

    // Key shipper
    function getAirlineKeyShipper(airline) {
        connectHub(function () {
            localStorage.removeItem("AirlineKeyShipper");
            bookingHub.server.getAirlineKeyShipper(airline);
        });
    }

    bookingHub.client.setAirlineKeyShipper = function (ksd) {
        console.log("setAirlineKeyShipper: " + ksd);
        localStorage.setItem("AirlineKeyShipper", ksd);
        if (typeof SetVirtualFlightKeyShipper == "function") {
            SetVirtualFlightKeyShipper();
        }
    }

    function getAirlineAdvBookDay(airline) {
        if (sessionStorage.getItem("AirlineAdvBookDay") != null) {
            var advDay = JSON.parse(sessionStorage.getItem("AirlineAdvBookDay"));
            var obj = advDay.filter(function (x) {
                return x.Airline == airline;
            });
            console.log(obj);

            if (typeof obj !== 'undefined' && obj != null) {
                if (obj.length > 0) {
                    return obj[0].AdvBookDay;
                }
            }
        }

        return 0;
    }

    function validateJPCity(strCity) {
        var strCityList = ["FUK", "NGO", "OKA", "OSA", "SPK", "TYO", "YOK"];
        if (strCity != "") {
            if (strCityList.indexOf(strCity) > -1) {
                return true;
            } else {
                return false;
            }
        }
        return false;
    }

    /*
    function CHF_String_IsFormat(strInputData, strDataType, strSyntax) {
        var isFormat = false;
        var strFormat, strFormatChar;
        var strChar;
        var strRepeat;
        var strMandatory;

        switch (strDataType) {
            case "C":
                //convert strSyntax statement to strFormat statement
                strFormat = ""
                for (var i = 1; i <= strSyntax.length; i++) {
                    if (strSyntax.substr(i, 1)) {
                        strChar = strSyntax.substr(i - 1, 1);
                        i = i + 1;
                        strRepeat = "";
                        while (isNumeric(strSyntax.substr(i, 1))) {
                            strRepeat = strRepeat + strSyntax.substr(i, 1);
                            i = i + 1;
                        }
                        i = i - 1;
                        strFormat = strFormat + String(parseInt(strRepeat) - 1, strChar)
                    } else {
                        strFormat = strFormat + strSyntax.substr(i, 1);
                    }
                }

                //check strInputData & strFormat length
                if (strInputData.length > strFormat.length) {
                    return false;
                }

                if (typeof strInputData !== 'undefined' && strInputData != null) {
                    if (strInputData.length == 0) {
                        //check if mandatory or not
                        if (strFormat != strFormat.toLowerCase()) {
                            return false;
                        }
                    }
                } else {
                    //check if mandatory or not
                    if (strFormat != strFormat.toLowerCase()) {
                        return false;
                    }
                }

                //check strInputData format
                for (var i = 1; i <= strFormat.length; i++) {
                    strChar = strInputData.substr(i, 1);
                    strFormatChar = strFormat.substr(i, 1);
                    if (strChar == "" && strFormatChar >= "A" && strFormatChar <= "Z") {
                        console.log("mandatory char not present, exit with error");
                        return false; //mandatory char not present, exit with error
                    } else if (strChar == "" && strFormatChar >= "a" && strFormatChar <= "z") {
                        //optional char not present, continue with next
                        console.log("optional char not present, continue with next");
                    } else {
                        switch (strFormatChar) {
                            case "A", "a":
                                if ((strChar < "A" || strChar > "Z") && (strChar < "a" || strChar > "z")) {
                                    return false;
                                }
                                break;
                            case "N", "n":
                                if (!isNumeric(strChar)) {
                                    return false;
                                }
                                break;
                            case "M", "m":
                                if ((strChar < "A" || strChar > "Z") && (strChar < "a" || strChar > "z")) {
                                    if (!isNumeric(strChar)) {
                                        return false;
                                    }
                                }
                                break;
                            case "T", "t":
                                if ((strChar < "A" || strChar > "Z") && (strChar < "a" || strChar > "z")) {
                                    if (!isNumeric(strChar)) {
                                        var srcStr = "-. ";
                                        if (srcStr.indexOf(strChar) < -1) {
                                            return false;
                                        }
                                    }
                                }
                                break;
                            case "U", "u":
                                //#21440
                                if ((strChar < "A" || strChar > "Z") && (strChar < "a" || strChar > "z")) {
                                    if (!isNumeric(strChar)) {
                                        var srcStr = "-./ ";
                                        if (srcStr.indexOf(strChar) < -1) {
                                            return false;
                                        }
                                    }
                                }
                                break;
                            case "F", "f":
                                if ((strChar < "A" || strChar > "Z") && (strChar < "a" || strChar > "z")) {
                                    if (!isNumeric(strChar)) {
                                        var srcStr = "-. ,/():;&'";
                                        if (srcStr.indexOf(strChar) < -1) {
                                            return false;
                                        }
                                    }
                                }
                                break;
                            case "X", "x": //all printable characters
                                if ((strChar.charCodeAt(0) < 32 || strChar.charCodeAt(0) > 126) && strChar !== "\r" && strChar !== "\n") {
                                    return false;
                                }
                                break;
                            default:
                                return false;
                        }
                    }
                }

                isFormat = true;
                break;

            case "I", "F":

                break;
        }

        return isFormat;
    }
    */

    function isNumeric(n) {
        return !isNaN(parseFloat(n)) && isFinite(n);
    }

    function checkPort(text) {
        var portList = JSON.parse(sessionStorage.getItem("PortList"));
        return portList.filter(function (el) { return el.data == text.toUpperCase() }).length > 0;
    }

    function getWeightUnitTextByCode(code) {

        switch (parseInt(code)) {
            case 1:
                return i18next.t("cargoInfo.LB");
                break;
            default:
                return i18next.t("cargoInfo.KG");
        }
    }

    function getVolUnitTextByCode(code) {

        switch (parseInt(code)) {
            case 1:
                return i18next.t("cargoInfo.CF");
                break;
            case 2:
                return i18next.t("cargoInfo.CC");
                break;
            case 3:
                return i18next.t("cargoInfo.CI");
                break;
            default:
                return i18next.t("cargoInfo.MC");
        }
    }

    function getDimUnitTextBoCode(code) {

        switch (parseInt(code)) {
            case 3:
                return i18next.t("dimension.IN");
                break;
            default:
                return i18next.t("dimension.CM");
        }
    }

    function autoScroll() {
        var errEl = $('.error_or, .error_tag, .invalid_input_field, .cx_awb_validate_invalid').toArray();

        if (errEl.length > 0) {
            $('html, body').animate({
                scrollTop: $(errEl).offset().top - 100
            }, 400);
        }
        else {
            $('html, body').animate({ scrollTop: 0 }, 400);
        }
    }

    function assignElsOnEnterFunc(els, func) {
        if (els.length > 0 && typeof func === "function") {

            for (var i = 0; i < els.length; i++) {
                $(els[i]).keypress(function (e) {
                    if (e.keyCode == 13)
                        func();
                });
            }
        }
    }

    //Issue #27684, Temp fix for csp reply - consignee and shipper addr "null" value
    function HandleContactAddrNullVal(streetAddrs) {
        var addrs = [];

        _.forEach(streetAddrs, function (sa) {
            if (sa.toUpperCase() == "NULL")
                addrs.push('');
            else
                addrs.push(sa);
        });

        return addrs;
    }

    function getDatePickerOpt(opt) {
        var def = {
            format: DateTimeFormat.YearMonthDate2,
            updateViewDate: false,
            todayHighlight: true,
            autoclose: true,
            //startDate: new Date(), hide this row to allow user select any date
            clearBtn: true
        };

        return _.merge(def, opt);
    }

    function refreshModuleTranslation() {
        i18nInit("MVC/Booking", "20210715");
        for (var i = 1; i <= 3; i++) {

            $("#tab" + i + " > .bkd_block").each(function (i, o) {
                if ($._data(o, 'events') && $._data(o, 'events').refreshPlaceHolder != null)
                    $(o).triggerHandler("refreshPlaceHolder");
            });
        };
        stopAction();
    }

    $(function () {
        enableClassicLink("/");
    });

</script>


<div id="mvcContainer-398">
    


<script src="./js/booking/defiant.min.js"></script>
<script src="./js/booking/jquery.autocomplete.min.js"></script>
<script src="./js/booking/lity.min.js"></script>

<link rel="stylesheet" href="./css/booking/lity.min.css">

<style>
	.flex-container {
	  display: flex;
	  justify-content: center;
	}
	.margin-right {
	  margin-right: 10px;
	}

	.bootstrap-tagsinput {
        height: 36px;
    }

    .bootstrap-tagsinput .tag {
        line-height: 18px;
        float: left;
    }

    .error_or label {
        color: #FF8715 !important;
    }

    .error_or input {
        background-color: #ffffcc !important;
    }

    .SHCodeAC input.form-control.autocomplete.ui-autocomplete-input {
        text-transform: uppercase !important;
    }

    #singlebook_choose_temp .flight_location {
        text-align: center;
        width: 85px;
        white-space: nowrap;
    }

	#sc_special_code_wrapper{
        vertical-align: top;
    }

    #sc_special_code_wrapper .form-control.autocomplete.ui-autocomplete-input {
        border: none;
        background-color: transparent;
        padding: 0 6px;
        width: 60px;
        line-height: inherit;
    }

    #sc_special_code_wrapper .bootstrap-tagsinput {
        width: 100%;
    }

	#sc_special_code_wrapper.error_or .bootstrap-tagsinput {
        background-color: #FFFFCC ;
    }

    #sc_special_code_wrapper .category-container.SHCodeAC {
        width: 100%;
    }

    #priority_type_wrapper {
        vertical-align: top;
    }

    #sc_extra_shc {
        color: black;
        font-weight: 500;
    }

    .act_temp_blk {
        float: right;
        display: inline-block;
        position: inherit;
        margin-top: 48px;
    }
    @media screen and (max-width:991px) {
        .act_temp_blk {
            margin-right: 25px;
        }
    }
    @media screen and (max-width:761px) {
        .act_temp_blk {
            margin-right: 70px;
        }
    }
    #flt_order_list li .cnt_inline {
        vertical-align: top !important;
    }

    #flight_virtual_wrapper .cnt_inline {
        vertical-align: top !important;
    }

    #bkd_def_cargoinfo .consign_info.cx {
        border-bottom: none;
        margin-bottom: 0px;
    }

    .category-container.SHCodeAC {
        margin-bottom: 0px;
    }

    .consign_info.cx .add_flights li .cnt_inline label {
        display: block;
    }

    #flt_order_list .flight_weight_unit {
        display: inline-block;
    }

    #flt_order_list .flight_vol_unit {
        display: inline-block;
    }

    .flight_weight_unit {
        margin-right: 5px;
    }

    .flight_vol_unit {
        margin-right: 5px;
    }

    #btnAddSegment {
        margin-bottom: 20px;
    }

    #split_book_error_wrapper ul li {
        display: block;
        list-style-type: none;
        margin-bottom: 10px;
        padding-left: 20px;
    }

    .act_bu.act_add_col.btnCheckAvail.cnt_inline {
        padding-top: 0px;
    }

    #ngtt_info .toggle.btn {
        margin-left: 10px;
        width: 75px !important;
    }

    #ngtt_info .toggle-on.btn {
        padding-right: 35px
    }

    #ngtt_info .toggle-off.btn {
        padding-left: 35px
    }

    #ngtt_info .toggle-handle {
        height: 75%;
        width: 18%;
        box-shadow: 1px 1px 0px 0px rgba(10%,10%,20%,0.5);
    }

    #ngtt_info .btn-primary .toggle-handle {
        margin: 4px 21px 4px -15px
    }

    #ngtt_info .btn-default .toggle-handle {
        margin: 4px -15px 4px 21px
    }

    #ngtt_info .btn-primary {
        border: none;
        background: -webkit-linear-gradient(270deg, rgba(2, 183, 238, 1) 0%, rgba(2, 183, 238, 1) 0%, rgba(2, 114, 180, 1) 29%, rgba(2, 114, 180, 1) 100%);
        background: linear-gradient(180deg, rgba(2, 183, 238, 1) 0%, rgba(2, 183, 238, 1) 0%, rgba(2, 114, 180, 1) 29%, rgba(2, 114, 180, 1) 100%)
    }

    #ngtt_ctTemperature{
        margin-top: 15px;
    }

    #ngtt_ctTemperature_label {
        color: #3f48cc;
        font-weight: bold;
		width: 230px;
    }

    .cx_shopping_box {
        position: fixed;
        top:193px;
        right: 0;
        cursor: hand;
        float: right;
        text-align: center;
        z-index: 1005;
    }

    .btn_or_shopping {
        font-weight: 700;
        background: url(/img/icon_flight_cx.png) center 12px no-repeat #FFF;
        width: 70px;
        height: 73px;
        text-align: center;
        padding: 30px 5px 5px;
        -webkit-box-shadow: 0 4px 34px -5px rgb(0 0 0 / 38%);
        -moz-box-shadow: 0 4px 34px -5px rgba(0,0,0,.38);
        box-shadow: 0 4px 34px -5px rgb(0 0 0 / 38%);
        position: absolute;
        right: 0;
    }

        .btn_or_shopping:hover, .btn_or_shopping:focus {
            text-decoration: none
        }

    @media screen and (max-width:991px) {
        .cx_shopping_box {
            top: 114px;
        }
    }
    @media screen and (min-width: 1800px) {
        .cx_shopping_box {
            right: 300px;
        }
    }
</style>
<style>
    #awb_lookup_dialog{
        overflow-x: auto;
    }

    #awb_lookup_dialog .modal-header h4 {
        margin: 0px;
    }

    #awb_lookup_dialog .modal-dialog {
        width: 1000px;
    }

    #awb_lookup_dialog .modal-body {
        overflow-y: auto;
        height: calc(80% - 56px - 67px);
        min-height: 346px;
    }

    #cargoInfo_lookup_btn_select_wrapper {
        background-color: #FF8715;
        border-radius: 15px;
        padding: 0px;
    }

    #cargoInfo_lookup_disp {
        padding: 8px 12px 8px 0px;
    }

    .btn-select-arrow {
        margin: 0px;
        padding: 19px 12px !important;
    }

    .btn-select ul li {
        padding: 8px 12px;
    }

    #awb_lookup_dialog #cargoInfo_lookup_btn_select_wrapper.active {
        border-bottom-left-radius: 0px;
        border-bottom-right-radius: 0px;
    }

    #awb_lookup_dialog #cargoInfo_awbstock_range {
        padding-top: 0px;
        margin-top: 22px;
    }

    #blk_filter {
        margin-bottom: 15px;
    }

    #cargoInfo_awb_result:hover {
        background-color: white;
    }

    #awb_lookup_dialog .bill_num {
        text-align: center;
    }

    #awb_lookup_dialog .bill_num label {
        margin: 0px;
        cursor: pointer;
    }

    #awb_lookup_dialog .selected_awb_number {
        background-color: #337ab7;
    }

    #awb_lookup_dialog .selected_awb_number .awb_link {
        color: white;
    }

    .stock_lookup_list {
        margin: 0px !important;
    }

    #selected_count_display {
        margin: 10px 10px 0px 0px;
    }

    #awb_lookup_btn_close {
        position: absolute;
        top: 17px;
        right: 21px;
        font-size: 1.5em;
        cursor: pointer;
    }

    #awb_lookup_dialog .btn {
        background: #FF5E2A;
    }

    .btn_lookup_edit {
        font-size: 1.3em;
        width: 0px;
        cursor: pointer;
    }

    #cargoInfo_awb_result .fa-check {
        font-size: 1.7em;
        position: absolute;
        color: white;
        padding-left: 13px;
        padding-top: 2px;
    }

    #awb_no_list{
        margin-left: 0px;
    }

    #awb_no_list > div {
        margin: 10px 10px 0px 0px;
    }

    #btn_check_awb_no_wrapper {
        padding: 0px;
        margin-bottom: 15px;
    }

    .awb_number_wrapper {
        display: inline-block;
        margin-right: 10px;
    }

    @media screen and (max-width: 767px){
        #cargoInfo_awb_result .tcell.col1.cellnp{
            height: auto;
        }
    }

    .check_icon_container{
        float: left;
    }
</style>

<div id="awb_lookup_dialog" class="modal bootstrap_modal fade" role="dialog" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title"></h4>
                <i id="awb_lookup_btn_close" class="fas fa-times" onclick="AwbLookupDialog.close()"></i>
            </div>
            <div class="modal-body">
                <div id="blk_filter">
                    <div class="blkl">
                        <div class="bu_txt w48 mr35">
                            <input type="text" value="" class="code_01" id="cargoInfo_lookup_awb_prefix" maxlength="3" autofocus="" autocomplete="off"> - <input type="text" value="" class="code_02" id="cargoInfo_lookup_awb_suffix" maxlength="8" autocomplete="off">
                            <input id="cargoInfo_btn_awbstock_src" class="btn_search" type="button" onclick="AwbLookupDialog.getAWBStockLookUp()">
                        </div>
                    </div>
                    <div class="blkl">
                        <div id="selected_count_display"></div>
                    </div>
                    <div class="blkr">
                        <a id="cargoInfo_lookup_btn_select_wrapper" class="btn btn-default btn-select">
                            <input type="hidden" class="btn-select-input" id="cargoInfo_lookup_btn_select" name="" value="">
                            <span id="cargoInfo_lookup_disp" class="" data-i18n="cargoInfo.ShowAllAWBStock">Show all AWB stock</span>
                            <span class="btn-select-arrow glyphicon glyphicon-chevron-down"></span>
                            <ul id="cargoInfo_awbstock_range" style="display: none;">
                                <li onclick="AwbLookupDialog.filterAWBStockResult(1, $(this).text())" data-i18n="cargoInfo.ShowAllAWBStock">Show all AWB stock</li>
                            </ul>
                        </a>
                    </div>
                    <div class="blkc"></div>
                </div>

                <div id="blk_check_awb_no">
                    <div id="btn_check_awb_no_wrapper" class="col-xs-2">
                        <button id="btn_check_awb_no" type="button" class="btn btn-default" onclick="AwbLookupDialog.onCickCheckAwbNo()" data-i18n="common.Check">Check</button>
                    </div>
                    <ul id="awb_no_list" class="col-xs-9">
                    </ul>
                </div>

                <div id="cargoInfo_awb_result_wrapper" class="ts_table w_flight">
                    <div class="trow theader" style="display: table-row;">
                        <div class="tcell col1" data-i18n="cargoInfo.AWB">Air Waybill</div>
                    </div>

                    <div id="cargoInfo_awb_result" class="rowwrapper">
                    </div>

                </div>
                <div id="awbStockResultStatusWrapper" class="">
                    <div class="error-box disabled">
                        <p class="error-message" style="text-align: left;" data-i18n="cargoInfo.RecordNotFound">Records not found</p>
                        <div class="errorTable">
                            <div class="errorTableBody">

                            </div>
                        </div>
                    </div>
                    <div class="loading-main disabled">
                        <span id="loading_message" data-i18n="common.Loading">Loading</span>
                    </div>
                </div>
                <center>
                    <a href="javascript:void(0)" class="btn_showmore" id="cargoInfo_awbstock_load_more" onclick="AwbLookupDialog.getAWBStockResultMore()" data-i18n="cargoInfo.ShowMore">Show More</a>
                    <span id="cargoInfo_show_result"></span>
                </center>
            </div>
            <div class="modal-footer">
                <button id="awb_lookup_btn_confirm" type="button" class="btn btn-default" onclick="AwbLookupDialog.onCickConfirm()" data-i18n="dialog.Confirm" disabled="">Confirm</button>
            </div>
        </div>

    </div>
</div>

<input type="hidden" id="cargoInfo_awbstock_count" value="0">

<script id="cargoInfo_awbstock_lookup_temp" type="text/x-template">
    <li class="selected_awb_number">
        <span class="check_icon_container"><i class="fas fa-check"></i></span>
        <div class="bill_num">
            <label class="awb_link" onclick="AwbLookupDialog.cargoInfoSetQuickSearchAWB(this)" prefix="%AWBPrefix%" suffix="%AWBSuffix%">%AWBPrefix%-%AWBSuffixPre%
                <span class="addspace"></span>%AWBSuffixPost%
            </label>
        </div>
    </li>
</script>

<script id="awb_no_list_item" type="text/x-template">
    <div prefix="%awbPrefix%" suffix="%awbSuffix%">
        <div class="awb_number_wrapper">%awbPrefix% - %awbSuffix%</div>
        <button type="button" class="btn btn-default" onclick="AwbLookupDialog.onCickCheckConfirm(this)" data-i18n="dialog.Confirm" disabled>Confirm</button>
        <div class="awb_icon inline_block"></div>
        <div class="awb_loading_msg" style="display: none;"></div>
    </div>
</script>

<script>

    function awbLookupDialog() {
        var awbStockLookupTimeoutValue = 30000;
        var awbStockLookupTimeoutHandle = -1;
        var defElementPerCol = 5;
        var defElementPerPage = 20;
        var awbList = [];
        var awbListStaging = [];
        var selectedAwbList = [];
        var mergedOpt = getDefaultOpts();

        function getDefaultOpts() {
            return {
                scope: undefined,
                confirm: false,
                footer: true,
                isMulti: false,
                rowId: undefined,
                airline: undefined,
                maxMultiAwbNumber: 12,
                singleAwbAutoSwitch: false,
                checkAwb: false,
                msgId: undefined,
                title: i18next.t('cargoInfo.AWBStockLookup')
            }
        }

        function startAWBStockLookupAction() {
            hideAWBStockError();
            showAWBStockLoading();
            startAWBStockLookupTimeout();
        }

        function showAWBStockLoading() {
            $("#awbStockResultStatusWrapper .loading-main").removeClass("disabled");
        }

        function hideAWBStockLoading() {
            $("#awbStockResultStatusWrapper .loading-main").addClass("disabled");
        }

        function startAWBStockLookupTimeout() {
            clearTimeout(awbStockLookupTimeoutHandle);
            awbStockLookupTimeoutHandle = setTimeout(function () {
                awbStockLookupTimeout();
            }, awbStockLookupTimeoutValue);
        }

        function awbStockLookupTimeout() {
            stopAWBStockLookupAction();
            showAWBStockError("Load AWB stock failed");
            awbStockLookupTimeoutHandle = -1;
            hideAWBStockLoading();
        }

        function hideAWBStockError() {
            $("#awbStockResultStatusWrapper .error-box").addClass("disabled");
            $("#awbStockResultStatusWrapper .error-box .error-message").text("");
        }

        function stopAWBStockLookupAction() {
            hideAWBStockLoading();
            if (awbStockLookupTimeoutHandle != -1) {
                clearTimeout(awbStockLookupTimeoutHandle);
                awbStockLookupTimeoutHandle = -1;
            }
            //disconnectHub();
        }

        function cargoInfoResetLookupFilterBtn() {
            $("#cargoInfo_lookup_disp").text($("#cargoInfo_awbstock_range li:first-child").text());
            $("#cargoInfo_awbstock_range .awbstock_extra_row").remove();
        }

        function getAWBStockResultSlot(pageNum) {
            var elementPerCol;
            //if (isMobileView())
            //    elementPerCol = 10;
            //else
                elementPerCol = defElementPerCol;

            var start = (pageNum - 1) * defElementPerPage;

            var rtn = "";
            var awbStockTemp = $("#cargoInfo_awbstock_lookup_temp").html();
            if (awbListStaging.length > 0) {
                rtn = "<div class='trow'><div class='tcell col1 cellnp'>"
                for (var i = 1; i <= defElementPerPage; i++) {
                    if (typeof awbListStaging[i + start - 1] !== 'undefined' && awbListStaging[i + start - 1] != null) {

                        if (i % elementPerCol == 1) {
                            rtn += "<ul class='stock_lookup_list'>";
                        }

                        var currentPrefix = awbListStaging[i + start - 1].AWBPrefix;
                        var currentSuffix = awbListStaging[i + start - 1].AWBSuffix;
                        var currentTemp = awbStockTemp;

                        if (_.findIndex(selectedAwbList, function (awb) { return awb.prefix == currentPrefix && awb.suffix == currentSuffix }) < 0)
                            currentTemp = currentTemp.replace('selected_awb_number', '');

                        //rtn += "<li><div class='bill_num'><a href='javascript:void(0)' class='awb_link'>"+awbListStaging[i+start-1].AWBPrefix+"-"+awbListStaging[i+start-1].AWBSuffix.substring(0, 4)+"<span class='addspace'></span>"+awbListStaging[i+start-1].AWBSuffix.substring(4, 8)+"</a></div></li>";
                        rtn += currentTemp.replaceAll("%AWBPrefix%", currentPrefix)
                            .replace("%AWBSuffix%", currentSuffix)
                            .replace("%AWBSuffixPre%", currentSuffix.substring(0, 4))
                            .replace("%AWBSuffixPost%", currentSuffix.substring(4, 8));

                        if (i % elementPerCol == 0) {
                            rtn += "</ul>";
                        }

                    } else {
                        if (i != 1 && i % elementPerCol != 1) {
                            rtn += "</ul>";
                        }
                        break;
                    }
                    /*
                    if (i == defElementPerPage - 1) {
                        rtn += "</ul>";
                    }
                    */
                }

                rtn += "</div></div>";
            }

            return rtn;
        }

        function refreshResultsText(num, total) {
            $("#cargoInfo_show_result").text(num + ' ' + i18next.t('BookingLog.ResultsSeperator') + ' ' + total + ' ' + i18next.t('BookingLog.Results'));
        }

        function bindAWBStockLookUpResult() {

            $("#cargoInfo_awb_result").empty();
            cargoInfoResetLookupFilterBtn();

            localStorage.setItem("AWBStockPageNum", 1);

            if (awbList.length > 0) {
                $("#cargoInfo_awbstock_count").val(awbList.length);
                $("#cargoInfo_lookup_btn_select_wrapper").show()
            } else {
                $("#cargoInfo_awbstock_count").val(0);
                $("#cargoInfo_lookup_btn_select_wrapper").hide()
            }

            var j = 1;
            for (var i = 0; i < awbList.length - 1; i = i + defElementPerPage) {
                //console.log(awbList[i].AWBSuffix);
                var page = j;
                var itemHtml = "<li class='awbstock_extra_row' onclick='AwbLookupDialog.filterAWBStockResult(" + page + ", $(this).text())'>" + i18next.t("awbLookup.From") + " " + awbList[i].AWBPrefix + "-" + awbList[i].AWBSuffix.substring(0, 4) + " " + awbList[i].AWBSuffix.substring(4, 8) + "</li>"
                $("#cargoInfo_awbstock_range").append(itemHtml);
                j++;
            }

            if (awbList.length == 0) {
                $("#cargoInfo_show_result").text(i18next.t('common.noRecordFound'));
                $("#cargoInfo_awbstock_load_more").hide();
            } else if (awbList.length > defElementPerPage) {
                $("#cargoInfo_awbstock_load_more").show();
                refreshResultsText(defElementPerPage, awbList.length);
            } else {
                $("#cargoInfo_awbstock_load_more").hide();
                refreshResultsText(awbList.length, awbList.length);
            }

            awbListStaging = awbList;

            content = getAWBStockResultSlot(1);

            $("#cargoInfo_awb_result").append(content);
        }

        function resetAwbLookupDialog() {
            awbList = [];
            awbListStaging = [];
            selectedAwbList = [];
            refreshSelectedCountAndConfirmButton();

            $("#cargoInfo_lookup_awb_prefix").val("");
            $("#cargoInfo_lookup_awb_suffix").val("");

            $("#cargoInfo_awb_result").empty();
            $("#awbStockResultStatusWrapper .error-box").addClass("disabled");
            $('#awb_lookup_dialog .modal-footer').show();
            $('#selected_count_display').show();
            $("#cargoInfo_awbstock_load_more").hide();
            $("#cargoInfo_show_result").text("");

            hideAWBStockLoading();
            hideAWBStockError();

            cargoInfoResetLookupFilterBtn();

            $('#blk_check_awb_no').hide();
            $('#awb_no_list').empty();

            mergedOpt = getDefaultOpts();
        }

        function refreshSelectedCountAndConfirmButton() {
            $('#selected_count_display').text(i18next.t("awbLookup.NumberSelected").replace('%count%', selectedAwbList.length));

            if (selectedAwbList.length > 0) {
                $("#awb_lookup_btn_confirm").prop("disabled", false);
            }
            else {
                $("#awb_lookup_btn_confirm").prop("disabled", true);
            }
        }

        function getAWB(airline, awbPrefix, awbSuffix) {
            connectHub(function () {
                bookingHub.server.getBooking(airline, awbPrefix, awbSuffix);
            });
        }

        function removeAwbIcon(el) {
            el.find('.awb_icon').removeClass("cx_awb_validate_loading cx_awb_validate_valid cx_awb_validate_invalid cx_awb_china_shipment_warning");
            el.find('.awb_loading_msg').text("");
            el.find('.awb_loading_msg').hide();
        }

        function removeSelectedAwb(el) {
            var awb = {
                'prefix': $(el).attr('prefix'),
                'suffix': $(el).attr('suffix')
            }

            $(el.parentElement.parentElement).removeClass('selected_awb_number');
            selectedAwbList = _.filter(selectedAwbList, function (o) {
                return o.prefix != awb.prefix || o.suffix != awb.suffix;
            });
        }

        function refreshAwbNoCheckList() {
            $('#awb_no_list').html('');

            _.forEach(selectedAwbList, function (awb) {
                var html = $('#awb_no_list_item').html()
                    .replaceAll('%awbPrefix%', awb.prefix)
                    .replaceAll('%awbSuffix%', awb.suffix);
                $("#awb_no_list").append(html);
            });
        }

        //for awb already used
        bookingHub.client.loadBookingData = function (bkd) {
            
            var awbEl = $('#awb_no_list div[prefix="' + bkd.AwbPrefix + '"][suffix="' + bkd.AwbSuffix + '"]');
            if (awbEl) {
                removeAwbIcon(awbEl);
                if (bkd.Cx && bkd.Cx.Revision > 0) {
                    awbEl.find('.awb_icon').addClass("cx_awb_validate_invalid");
                    awbEl.find('.awb_loading_msg').text(i18next.t("cargoInfo.AWBAlreadyUsed"));
                    awbEl.find('.awb_loading_msg').show();
                }
                else {
                    awbEl.find('.awb_icon').addClass("cx_awb_validate_valid");
                    awbEl.find('button').attr("disabled", false);
                }
            }
        }

        //for China Shipment Warning
        bookingHub.client.displayWarningMessage = function (warning, awbPrefix, awbSuffix) {
            switch (warning) {
                case "WARN_CHINA":
                    var awbEl = $('#awb_no_list div[prefix="' + awbPrefix + '"][suffix="' + awbSuffix + '"]');
                    if (awbEl) {
                        removeAwbIcon(awbEl);
                        awbEl.find('.awb_icon').addClass("cx_awb_china_shipment_warning");
                        awbEl.find('button').attr("disabled", false);
                        awbEl.find('.awb_loading_msg').text(i18next.t("cargoInfo.ChinaShipmentMsg"));
                        awbEl.find('.awb_loading_msg').show();
                    }
                    break;
            }
        }

        this.getAWBStockLookUp = function () {
            var awbPrefix = $("#cargoInfo_lookup_awb_prefix").val() || "";
            var awbSuffix = $("#cargoInfo_lookup_awb_suffix").val() || "";

            connectHub(function () {
                startAWBStockLookupAction();
                bookingHub.server.getAWBStockList(awbPrefix, awbSuffix);
            });
        }

        this.getAWBStockResultMore = function () {

            var pageNum = parseInt(localStorage.getItem("AWBStockPageNum")) + 1;
            //var queryRecordNo = pageNum * defElementPerPage;
            var content = getAWBStockResultSlot(pageNum);

            $("#cargoInfo_awb_result").append(content);

            console.log("awb stock pageNum: " + pageNum);
            var totalResult = $("#cargoInfo_awbstock_count").val() || 0;
            var maxPageNum = Math.ceil(totalResult / defElementPerPage);

            if (pageNum >= maxPageNum) {
                $("#cargoInfo_awbstock_load_more").hide();
                if (totalResult % defElementPerPage == 0) {
                    refreshResultsText((pageNum) * defElementPerPage, totalResult);
                } else {
                    refreshResultsText((pageNum - 1) * defElementPerPage + totalResult % defElementPerPage, totalResult);
                }

            } else {
                $("#cargoInfo_awbstock_load_more").show();
                refreshResultsText((pageNum) * defElementPerPage, totalResult);
            }

            localStorage.setItem("AWBStockPageNum", pageNum);
        }

        this.filterAWBStockResult = function (page, text) {
            if (awbList.length == 0) {
                return false;
            }

            var start = (page - 1) * defElementPerPage;
            var resultArr = [];
            var recordCount = 0;

            for (var i = start; i < awbList.length - 1; i++) {
                var obj = new Object();
                obj.AWBPrefix = awbList[i].AWBPrefix;
                obj.AWBSuffix = awbList[i].AWBSuffix;
                resultArr.push(obj);
            }
            recordCount = resultArr.length;
            awbListStaging = resultArr;

            localStorage.setItem("AWBStockPageNum", 1);
            $("#cargoInfo_awbstock_count").val(recordCount);
            $("#cargoInfo_awb_result").empty();

            content = getAWBStockResultSlot(1);
            $("#cargoInfo_awb_result").append(content);

            if (defElementPerPage < recordCount) {
                $("#cargoInfo_awbstock_load_more").show();
                refreshResultsText(defElementPerPage, recordCount);
            } else {
                $("#cargoInfo_awbstock_load_more").hide();
                refreshResultsText(recordCount, recordCount);
            }

            $("#cargoInfo_lookup_disp").text(text);
        }

        this.cargoInfoSetQuickSearchAWB = function (el) {
            var awb = {
                'prefix': $(el).attr('prefix'),
                'suffix': $(el).attr('suffix')
            }

            if ($(el.parentElement.parentElement).hasClass('selected_awb_number')) {
                removeSelectedAwb(el);
                refreshSelectedCountAndConfirmButton();
            }
            else if (!mergedOpt.isMulti) {
                selectedAwbList.push(awb);
                this.onCickConfirm();
            }
            else if (selectedAwbList.length < mergedOpt.maxMultiAwbNumber) {
                $(el.parentElement.parentElement).addClass('selected_awb_number');
                selectedAwbList.push(awb);
                refreshSelectedCountAndConfirmButton();
            }
            else if (mergedOpt.singleAwbAutoSwitch) {
                if (mergedOpt.maxMultiAwbNumber == 1) {
                    var selectedEl = $('#cargoInfo_awb_result .selected_awb_number .awb_link');
                    if (selectedEl.length > 0) {
                        removeSelectedAwb(selectedEl[0]);
                    }

                    selectedAwbList = [];

                    $(el.parentElement.parentElement).addClass('selected_awb_number');
                    selectedAwbList.push(awb);
                    refreshSelectedCountAndConfirmButton();
                }
            }

            if (mergedOpt.checkAwb) {
                refreshAwbNoCheckList();
            }
        }

        this.getSelectedAwbList = function () {
            return selectedAwbList;
        }

        this.open = function (opts) {
            resetAwbLookupDialog();

            mergedOpt = _.merge(getDefaultOpts(), opts);

            if (!mergedOpt.isMulti) {
                $('#awb_lookup_dialog .modal-footer').hide();
                $('#selected_count_display').hide();
            }

            if (mergedOpt.airline) {
                $('#cargoInfo_lookup_awb_prefix').val(bkdAirlineDefaultAWBPrefix(mergedOpt.airline));
            }

            if (mergedOpt.checkAwb) {
                $('#blk_check_awb_no').show();
            }

            if (!mergedOpt.footer) {
                $('#awb_lookup_dialog .modal-footer').hide();
            }

            $("#awb_lookup_dialog .modal-title").text(mergedOpt.title);
            $("#cargoInfo_lookup_btn_select_wrapper").hide();
            $('#awb_lookup_dialog').modal('show');
            this.getAWBStockLookUp();
        }

        this.onCickConfirm = function () {
            if (typeof mergedOpt.confirm === "function")
                mergedOpt.confirm();

            this.resetAndClose();
        }

        this.onCickCheckAwbNo = function () {
            _.forEach($('#awb_no_list div[prefix][suffix]'), function (item) {
                var prefix = $(item).attr('prefix');
                var suffix = $(item).attr('suffix');
                getAWB("CX", prefix, suffix);

                removeAwbIcon($(item));
                $(item).find('.awb_icon').addClass("cx_awb_validate_loading");
            });
            
        }

        this.onCickCheckConfirm = function (el) {
            this.onCickConfirm();
        }

        this.close = function () {
            this.resetAndClose();
        }

        this.resetAndClose = function () {
            resetAwbLookupDialog();
            $('#awb_lookup_dialog').modal('hide');
        }

        this.registerElementsOnEnter = function() {
            var els = [$("#cargoInfo_lookup_awb_prefix"), $("#cargoInfo_lookup_awb_suffix")];
            assignElsOnEnterFunc(els, AwbLookupDialog.getAWBStockLookUp);
        }

        bookingHub.client.loadAWBStockLookupResult = function (res) {

            if (typeof res !== 'undefined' && res != null) {
                awbList = JSON.parse(res);
            }

            stopAWBStockLookupAction();

            bindAWBStockLookUpResult();
        }
    }

    var AwbLookupDialog = new awbLookupDialog();

    $(function () {
        AwbLookupDialog.registerElementsOnEnter();
    })
</script>
<div class="jumbotron">
    <div class="container">
        <div>
            <h1 class="h_style01" data-i18n="cargoInfo.CreateBooking" style="display: inline-block;">Create Booking</h1>
            <div class="act_temp_blk">
                <div class="act_temp">
                    <a href="javascript:void(0)" class="wt_link_blk" onclick="openTemplateRecordSearch(event)">
                        <div class="subtit_temp"></div>
                        <div class="inline_block" data-i18n="singleBooking.ChooseTemplate">Choose Template</div>
                    </a>
                    <span></span>
                    <a href="javascript:void(0)" class="wt_link_blk" onclick="openTemplateRecordSave(event)" data-i18n="cargoInfo.SaveAsTemplate">Save As Template</a>
                </div>
            </div>
            <!--CX shopping button use in UAT only-->
            <div id="CXASPShopping" class="cx_shopping_box" style="display:none;">
                <a href="javascript:void(0)" target="CXASPShoppingWindowName" onclick="openShoppingPage(); return false;" class="btn_or_shopping txt13 blk" title="Shopping Page" data-i18n="fa.Shopping">Shopping Page</a>
            </div>

        </div>
    </div>
    <div class="blkc"></div>
    <div id="bkd_single_booking">
        <div class="tab_top">
            <div class="cd-tabs is-ended">
                

                <ul class="cd-tabs-content" style="height: auto;">
                    <div class="wbg" style="">
                        <div class="container wbg" style="">
                            <div id="errorWrapper" class="disabled">
                                <div class="error-box">
                                    <p class="error-message" style="text-align: left; font-size: 13px;"></p>
                                    <ul id="blk_errorLt" class="blk_list">
                                        
                                    </ul>
                                </div>
                            </div>
                            <div id="errorWrapper_air" class="disabled">
                                <div class="error-box">
                                    <p class="error-message" style="text-align: left; font-size: 13px;"></p>
                                    <ul id="blk_errorLt_air" class="blk_list">
                                        
                                    </ul>
                                </div>
                            </div>
                            <li id="tab1" data-content="tab1" class="bkdtabs selected" style=""><div id="bkd_def_cargoinfo" class="bkd_block">
	<h3 class="col-xs-12 col-sm-5" data-i18n="cargoInfo.CargoInfo">Cargo Information</h3>

	<div class="col-sm-7 header_inline_right short_line_height">
		<a href="javascript:void(0)" tabindex="-1">
			<button id="cargoInfo_btn_multiawb" onclick="bkdGotoMultiAWB(event)" class="act_bu act_multi_bills" data-i18n="cargoInfo.MultiAWB" tabindex="-1">Multiple Air Waybills</button>
		</a>
		<a href="javascript:void(0)" tabindex="-1">
			<button class="act_bu act_multi_airlines" data-i18n="cargoInfo.MultiAirline" onclick="bkdGotoMultiAirline(event)" tabindex="-1">Multiple Airlines</button>
		</a>
	</div>

	<div class="head_hr"></div>
	<div class="consign_info cx">
		<div class="blkr lbl_lgy">*<span data-i18n="cargoInfo.RequiredFields">Required fields</span></div>
		<div class="cnt_inline bu_txt w48 mr35">
			<label for="cargoInfo_airline"><span data-i18n="cargoInfo.Airline">Airline</span>*</label>
			<div class="btn-group bootstrap-select"><button type="button" class="btn dropdown-toggle btn-default" data-toggle="dropdown" role="button" data-id="cargoInfo_airline" title="CX"><span class="filter-option pull-left">CX</span>&nbsp;<span class="bs-caret"><span class="caret"></span></span></button><div class="dropdown-menu open" role="combobox"><div class="bs-searchbox"><input type="text" class="form-control" autocomplete="off" role="textbox" aria-label="Search"></div><ul class="dropdown-menu inner" role="listbox" aria-expanded="false"><li data-original-index="0" class=""><a tabindex="0" class="" data-tokens="3S" role="option" aria-disabled="false" aria-selected="false"><span class="text">3S</span><span class="glyphicon glyphicon-ok check-mark"></span></a></li><li data-original-index="1"><a tabindex="0" class="" data-tokens="7T" role="option" aria-disabled="false" aria-selected="false"><span class="text">7T</span><span class="glyphicon glyphicon-ok check-mark"></span></a></li><li data-original-index="2" class="selected"><a tabindex="0" class="" data-tokens="CX" role="option" aria-disabled="false" aria-selected="true"><span class="text">CX</span><span class="glyphicon glyphicon-ok check-mark"></span></a></li><li data-original-index="3"><a tabindex="0" class="" data-tokens="D0" role="option" aria-disabled="false" aria-selected="false"><span class="text">D0</span><span class="glyphicon glyphicon-ok check-mark"></span></a></li><li data-original-index="4"><a tabindex="0" class="" data-tokens="D5" role="option" aria-disabled="false" aria-selected="false"><span class="text">D5</span><span class="glyphicon glyphicon-ok check-mark"></span></a></li><li data-original-index="5"><a tabindex="0" class="" data-tokens="ES" role="option" aria-disabled="false" aria-selected="false"><span class="text">ES</span><span class="glyphicon glyphicon-ok check-mark"></span></a></li><li data-original-index="6"><a tabindex="0" class="" data-tokens="JL" role="option" aria-disabled="false" aria-selected="false"><span class="text">JL</span><span class="glyphicon glyphicon-ok check-mark"></span></a></li><li data-original-index="7"><a tabindex="0" class="" data-tokens="JX" role="option" aria-disabled="false" aria-selected="false"><span class="text">JX</span><span class="glyphicon glyphicon-ok check-mark"></span></a></li><li data-original-index="8"><a tabindex="0" class="" data-tokens="L3" role="option" aria-disabled="false" aria-selected="false"><span class="text">L3</span><span class="glyphicon glyphicon-ok check-mark"></span></a></li><li data-original-index="9"><a tabindex="0" class="" data-tokens="QY" role="option" aria-disabled="false" aria-selected="false"><span class="text">QY</span><span class="glyphicon glyphicon-ok check-mark"></span></a></li><li data-original-index="10"><a tabindex="0" class="" data-tokens="UO" role="option" aria-disabled="false" aria-selected="false"><span class="text">UO</span><span class="glyphicon glyphicon-ok check-mark"></span></a></li><li data-original-index="11"><a tabindex="0" class="" data-tokens="V4" role="option" aria-disabled="false" aria-selected="false"><span class="text">V4</span><span class="glyphicon glyphicon-ok check-mark"></span></a></li><li data-original-index="12"><a tabindex="0" class="" data-tokens="AA" role="option" aria-disabled="false" aria-selected="false"><span class="text">AA</span><span class="glyphicon glyphicon-ok check-mark"></span></a></li><li data-original-index="13"><a tabindex="0" class="" data-tokens="AF" role="option" aria-disabled="false" aria-selected="false"><span class="text">AF</span><span class="glyphicon glyphicon-ok check-mark"></span></a></li><li data-original-index="14"><a tabindex="0" class="" data-tokens="EY" role="option" aria-disabled="false" aria-selected="false"><span class="text">EY</span><span class="glyphicon glyphicon-ok check-mark"></span></a></li><li data-original-index="15"><a tabindex="0" class="" data-tokens="KE" role="option" aria-disabled="false" aria-selected="false"><span class="text">KE</span><span class="glyphicon glyphicon-ok check-mark"></span></a></li><li data-original-index="16"><a tabindex="0" class="" data-tokens="KK" role="option" aria-disabled="false" aria-selected="false"><span class="text">KK</span><span class="glyphicon glyphicon-ok check-mark"></span></a></li><li data-original-index="17"><a tabindex="0" class="" data-tokens="KL" role="option" aria-disabled="false" aria-selected="false"><span class="text">KL</span><span class="glyphicon glyphicon-ok check-mark"></span></a></li><li data-original-index="18"><a tabindex="0" class="" data-tokens="LD" role="option" aria-disabled="false" aria-selected="false"><span class="text">LD</span><span class="glyphicon glyphicon-ok check-mark"></span></a></li><li data-original-index="19"><a tabindex="0" class="" data-tokens="LH" role="option" aria-disabled="false" aria-selected="false"><span class="text">LH</span><span class="glyphicon glyphicon-ok check-mark"></span></a></li><li data-original-index="20"><a tabindex="0" class="" data-tokens="LX" role="option" aria-disabled="false" aria-selected="false"><span class="text">LX</span><span class="glyphicon glyphicon-ok check-mark"></span></a></li><li data-original-index="21"><a tabindex="0" class="" data-tokens="NH" role="option" aria-disabled="false" aria-selected="false"><span class="text">NH</span><span class="glyphicon glyphicon-ok check-mark"></span></a></li><li data-original-index="22"><a tabindex="0" class="" data-tokens="SA" role="option" aria-disabled="false" aria-selected="false"><span class="text">SA</span><span class="glyphicon glyphicon-ok check-mark"></span></a></li><li data-original-index="23"><a tabindex="0" class="" data-tokens="SK" role="option" aria-disabled="false" aria-selected="false"><span class="text">SK</span><span class="glyphicon glyphicon-ok check-mark"></span></a></li><li data-original-index="24"><a tabindex="0" class="" data-tokens="SQ" role="option" aria-disabled="false" aria-selected="false"><span class="text">SQ</span><span class="glyphicon glyphicon-ok check-mark"></span></a></li><li data-original-index="25"><a tabindex="0" class="" data-tokens="SV" role="option" aria-disabled="false" aria-selected="false"><span class="text">SV</span><span class="glyphicon glyphicon-ok check-mark"></span></a></li><li data-original-index="26"><a tabindex="0" class="" data-tokens="UA" role="option" aria-disabled="false" aria-selected="false"><span class="text">UA</span><span class="glyphicon glyphicon-ok check-mark"></span></a></li></ul></div></div>
			<div class="error_or_msg" style="display: none;" data-i18n="cargoInfo.InvalidAirline">Invalid Airline</div>
		</div>
		<div class="cnt_inline bu_txt mr35">
			<label for="cargoInfo_awb_prefix">
				<span data-i18n="cargoInfo.AWB">Air Waybill</span>* 
				<!--<a href="javascript:void(0)" class="act_bu act_stock_loopup" data-i18n="cargoInfo.StockLookup" onclick="openCargoInfoAWBLookup(event)">Stock lookup</a>-->
				<a href="javascript:void(0)" class="act_bu act_stock_loopup" data-i18n="cargoInfo.StockLookup" tabindex="-1" onclick="onClickAwbLookup()">Stock lookup</a>
			</label>
			<input type="text" value="" class="code_01 cargoinfo_int_input" id="cargoInfo_awb_prefix" maxlength="3"> - <input type="text" value="" class="code_02 cargoinfo_int_input" id="cargoInfo_awb_suffix" maxlength="8">
			<div class="error_or_msg" style="display: none;" data-i18n="cargoInfo.InvalidAWB">Invalid Air Waybill no</div>
		</div>
		<div class="cnt_inline bu_txt w175 mr35">
			<label for="cargoInfo_contact"><span data-i18n="cargoInfo.Contact">Contact</span>*</label>
			<input type="text" value="" id="cargoInfo_contact" readonly="">
			<div class="error_or_msg" style="display: none;" data-i18n="cargoInfo.InvalidContact">Invalid Contact</div>
		</div>
		<div class="blkc"></div>
		<div class="cnt_inline bu_txt mr35">
			<label for="cargoInfo_pcs"><span data-i18n="cargoInfo.Pieces">Pieces</span>*</label>
			<input type="text" value="" id="cargoInfo_pcs" class="cargoinfo_int_input bkd_num_input" maxlength="4">
			<div class="error_or_msg" style="display: none;" data-i18n="cargoInfo.InvalidPieces">Invalid Pieces</div>
		</div>
		<div class="cnt_inline bu_txt mr35">
			<label for="cargoInfo_weight"><span data-i18n="cargoInfo.Weight">Weight</span>*</label>
			<input type="text" value="" id="cargoInfo_weight" class="cargoinfo_dec_input_weight bkd_num_input" maxlength="7">
			<fieldset class="switch-toggle-set">
				<div class="switch-toggle switch-candy">
					<input id="cargoInfo_kg" name="weight-unit" type="radio" value="0" checked="" onclick="weightUnitOnClick(this.value)">
					<label for="cargoInfo_kg" data-i18n="cargoInfo.KG">KG</label>
					<input id="cargoInfo_lb" name="weight-unit" type="radio" value="1" onclick="weightUnitOnClick(this.value)">
					<label for="cargoInfo_lb" data-i18n="cargoInfo.LB">LB</label>
					<a></a>
				</div>
			</fieldset>
			<div class="error_or_msg" style="display: none;" data-i18n="cargoInfo.InvalidWeight">Invalid Weight</div>
		</div>
		<div class="cnt_inline bu_txt mr35">
			<label for="cargoInfo_vol"><span data-i18n="cargoInfo.Volume">Volume</span>*</label>
			<input type="text" value="" id="cargoInfo_vol" class="cargoinfo_dec_input_volume bkd_num_input" maxlength="9">
			<fieldset class="switch-toggle-set">
				<div class="switch-toggle switch-candy">
					<input id="cargoInfo_mc" name="vol-unit" type="radio" value="0" checked="" onclick="volUnitOnClick(this.value)">
					<label for="cargoInfo_mc" data-i18n="cargoInfo.MC">MC</label>
					<!--<input id="cargoInfo_cc" name="vol-unit" type="radio" value="2">
					<label for="cargoInfo_cc" onclick="" data-i18n="cargoInfo.CC">CC</label>-->
					<input id="cargoInfo_cf" name="vol-unit" type="radio" value="1" onclick="volUnitOnClick(this.value)">
					<label for="cargoInfo_cf" data-i18n="cargoInfo.CF">CF</label>
					<!--<input id="cargoInfo_ci" name="vol-unit" type="radio" value="3">
					<label for="cargoInfo_ci" onclick="" data-i18n="cargoInfo.CI">CI</label>-->
					<a></a>
				</div>
			</fieldset>
			<div class="error_or_msg" style="display: none;" data-i18n="cargoInfo.InvalidVolume">Invalid Volume</div>
		</div>
		<div class="cnt_inline bu_txt w175 mr35 b878">
			<label for="cargoInfo_good_des"><span data-i18n="cargoInfo.GoodDesc">Goods Description</span>*</label>
			<select class="select_bu" id="cargoInfo_good_des">
				
			<option value="OTH">Others</option><option value="AC Sparepart">AC Sparepart</option><option value="Advertising Mat">Advertising Mat</option><option value="Aircraft Engine">Aircraft Engine</option><option value="Auto Parts">Auto Parts</option><option value="Bags">Bags</option><option value="Blades">Blades</option><option value="Blood">Blood</option><option value="Books">Books</option><option value="Calculators">Calculators</option><option value="Calendar">Calendar</option><option value="Camera">Camera</option><option value="Capsicum">Capsicum</option><option value="Car">Car</option><option value="Carpets">Carpets</option><option value="Cheese">Cheese</option><option value="Chemicals">Chemicals</option><option value="Cloths">Cloths</option><option value="Coffin">Coffin</option><option value="Comp Parts">Comp Parts</option><option value="Consolidated">Consolidated</option><option value="Cosmetic">Cosmetic</option><option value="Costumes">Costumes</option><option value="Cut Flower">Cut Flower</option><option value="Cut Foliage ">Cut Foliage </option><option value="Day Old Chicken">Day Old Chicken</option><option value="Diplomatic Mail">Diplomatic Mail</option><option value="Documents">Documents</option><option value="Edible Fish">Edible Fish</option><option value="Egg Plants">Egg Plants</option><option value="Elect Component">Elect Component</option><option value="Essential Oil">Essential Oil</option><option value="Exhibit Goods">Exhibit Goods</option><option value="Fabrics">Fabrics</option><option value="Films">Films</option><option value="Flowers">Flowers</option><option value="Foodstuffs">Foodstuffs</option><option value="Foot Ball">Foot Ball</option><option value="Foot Wear">Foot Wear</option><option value="Fresh Fruits">Fresh Fruits</option><option value="Frozen Fish">Frozen Fish</option><option value="Garment">Garment</option><option value="Glassware">Glassware</option><option value="Gold">Gold</option><option value="Hair">Hair</option><option value="Handicrafts">Handicrafts</option><option value="Hanging Garmt">Hanging Garmt</option><option value="Hard Disk">Hard Disk</option><option value="Hatching Eggs">Hatching Eggs</option><option value="Imitated Jewel">Imitated Jewel</option><option value="Jewelry">Jewelry</option><option value="Knitted Goods">Knitted Goods</option><option value="Leather">Leather</option><option value="Live Animals">Live Animals</option><option value="Live Bird">Live Bird</option><option value="Live Fish">Live Fish</option><option value="Live Plants">Live Plants</option><option value="LV Trop Fish">LV Trop Fish</option><option value="Machinery Part">Machinery Part</option><option value="Magazines">Magazines</option><option value="Meat">Meat</option><option value="Medical Equip">Medical Equip</option><option value="Medicines">Medicines</option><option value="Metal Goods">Metal Goods</option><option value="Microchip">Microchip</option><option value="Motor Cycles">Motor Cycles</option><option value="MP3">MP3</option><option value="Mushroom">Mushroom</option><option value="Musical Instru">Musical Instru</option><option value="Newspaper">Newspaper</option><option value="Opital Material">Opital Material</option><option value="Orchids">Orchids</option><option value="Paper Bags">Paper Bags</option><option value="Perfumery Prod">Perfumery Prod</option><option value="Personal Eff">Personal Eff</option><option value="Pharmaceutical">Pharmaceutical</option><option value="Pin &amp; Bolt">Pin &amp; Bolt</option><option value="Plastic Mat">Plastic Mat</option><option value="Printed Mat">Printed Mat</option><option value="Radio">Radio</option><option value="Samples">Samples</option><option value="screw">screw</option><option value="Serum">Serum</option><option value="Ship parts">Ship parts</option><option value="Shoes">Shoes</option><option value="Silk">Silk</option><option value="Skins">Skins</option><option value="Solar Panels">Solar Panels</option><option value="Spare Parts">Spare Parts</option><option value="Speaker">Speaker</option><option value="Sporting Goods">Sporting Goods</option><option value="Stainless Prod">Stainless Prod</option><option value="Tape Recorder">Tape Recorder</option><option value="Telecom Equip">Telecom Equip</option><option value="Textiles">Textiles</option><option value="Tools">Tools</option><option value="Toys">Toys</option><option value="Transformer">Transformer</option><option value="Trinkets">Trinkets</option><option value="Tuna Fish">Tuna Fish</option><option value="Tyres">Tyres</option><option value="Vegetables">Vegetables</option><option value="Watches">Watches</option><option value="Wearing Appea">Wearing Appea</option></select>
			<input type="text" value="" placeholder="Details" id="cargoInfo_good_detail" style="" maxlength="15">
			<div class="error_or_msg" style="display: none;" data-i18n="cargoInfo.InvalidGoodDesc">Invalid Goods Description</div>
		</div>
		<div class="blkc"></div>
		<div id="priority_type_wrapper" class="cnt_inline bu_txt w175 mr35 b977">
			<label for="cargoInfo_priority" data-i18n="cargoInfo.PriorityType">Priority Type</label>
			<select class="select_bu" id="cargoInfo_priority">
				
				
				
				
			<option value="PR3">General LIFT</option><option value="PR1">Priority LIFT</option></select>
			<div class="error_or_msg" style="display: none;" data-i18n="cargoInfo.InvalidPriority">Invalid Priority</div>
		</div>
		<div id="sc_special_code_wrapper" class="cnt_inline mr35 b977">
			<label for="sc_special_code">
            	<span data-i18n="specialCargo.SHC">Special Handling Code</span>
            	<span class="reminder">(<span data-i18n="SHC.EnterWordReminder">Enter keyword or code</span>)</span>
            </label>
            <div class="category-container SHCodeAC">
                <div class="bootstrap-tagsinput"><span class="tag label label-info">TRK<span data-role="remove"></span></span> <span class="tag label label-info">PIL<span data-role="remove"></span></span> <span class="tag label label-info">COL<span data-role="remove"></span></span> <input type="text" class="form-control autocomplete ui-autocomplete-input" placeholder="" autocomplete="off" size="2"></div>
				<div id="sc_special_code_err" class="error_or_msg" style="display: none;" data-i18n="cargoInfo.InvalidSHRSegregation"> is not allow for  booking</div>
            </div>
            <div id="sc_temp_range_wrapper" class="cnt_inline bu_txt w64 mr35" style="">
                <label for="sc_temp_range_start"><span data-i18n="specialCargo.ProductTempRange">Product Temperature Range</span>*</label>
                <input type="text" value="" id="sc_temp_range_start" class="sc_dec_input"> - <input type="text" value="" id="sc_temp_range_end" class="sc_dec_input">
                <fieldset class="switch-toggle-set">
                    <div class="switch-toggle switch-candy">
                        <input id="sc_temp_range_c" name="product-temp" type="radio" value="0" checked="">
                        <label for="sc_temp_range_c" onclick="">C</label>
                        <input id="sc_temp_range_f" name="product-temp" type="radio" value="1">
                        <label for="sc_temp_range_f" onclick="">F</label>
                        <a></a>
                    </div>
                </fieldset>
                <div class="error_or_msg" style="display: none;" data-i18n="cargoInfo.InvalidTemp">Invalid temperature</div>
            </div>
            <div id="sc_storage_temp_range_wrapper" class="cnt_inline bu_txt w64 mr35" style="">
                <label for="sc_store_temp_start"><span data-i18n="specialCargo.StorageTempRange">Storage Temperature Range</span>*</label>
                <input type="text" value="" id="sc_store_temp_start" class="sc_dec_input"> - <input type="text" value="" id="sc_store_temp_end" class="sc_dec_input">
                <fieldset class="switch-toggle-set">
                    <div class="switch-toggle switch-candy">
                        <input id="sc_store_temp_c" name="store-temp" type="radio" value="0" checked="">
                        <label for="sc_store_temp_c" onclick="">C</label>
                        <input id="sc_store_temp_f" name="store-temp" type="radio" value="1">
                        <label for="sc_store_temp_f" onclick="">F</label>
                        <a></a>
                    </div>
                </fieldset>
                <div class="error_or_msg" style="display: none;" data-i18n="cargoInfo.InvalidTemp">Invalid temperature</div>
            </div>

            <div id="sc_emergency_tel_wrapper" class="cnt_inline bu_txt w145" style="">
                <label for="sc_emergency_tel"><span data-i18n="specialCargo.EmergencyTel">Emergency Tel</span>*</label>
                <input type="text" value="" class="sc_int_input" id="sc_emergency_tel" maxlength="17">
                <div class="error_or_msg" style="display: none;" data-i18n="cargoInfo.InvalidTel">Invalid Tel No</div>
            </div>
            <div class="blkc"></div>
            <div id="sc_shipper_prompt" class="error_or_msg" style="display:none;" data-i18n="specialCargo.InputShipper">Please provide shipper and consignee information</div>

            <div id="sc_special_code_focus" tabindex="-1"></div>
		</div>
		<div id="deal_code_wrapper" class="cnt_inline bu_txt mr35">
			<label for="cargoInfo_deal_code"><span data-i18n="cargoInfo.DealCode">Deal Code</span></label>
			<input type="text" value="" id="cargoInfo_deal_code" class="" maxlength="12">
			<div class="error_or_msg" style="display: none;" data-i18n="cargoInfo.InvalidDealCode">Invalid Deal Code</div>
		</div>
		<div class="blkc"></div>
		<!-- <div class="mb25">
			<label class="bu_txt" for="cargoInfo_special_cargo" data-i18n="cargoInfo.SpecialCargo">Special cargo?</label>
			<input id="cargoInfo_special_cargo" type="checkbox" data-toggle="toggle" data-on="Yes" data-off="No" data-style="bu_toggle">
		</div>
		<div class="blkc"></div> -->
		<div id="cargoInfo_dgmask_wrapper" class="mb25" style="display: none;">
			<div><span class="filterPanelBtn" data-i18n="cargoInfo.DGMask">DG Mask</span><span id="dgmask_filter_arrow" class="filter_arrow_close"></span></div>
			<div id="dgMaskPanel" class="" style="margin-top: 0px; padding: 10px; display: none;">
				<div id="sc_special_code_dg_focus" tabindex="-1"></div>
                <div class="w175 mr35">
					<label for="cargoInfo_dg_cargo_aircraft" data-i18n="cargoInfo.CargoAircraftOnly">Cargo Aircraft only</label>
					<div class="toggle btn btn-default off bu_toggle" data-toggle="toggle" style="width: 9px; height: 0px;"><input type="checkbox" data-toggle="toggle" data-on="Yes" data-off="No" data-style="bu_toggle" id="cargoInfo_dg_cargo_aircraft"><div class="toggle-group"><label class="btn btn-primary toggle-on">Yes</label><label class="btn btn-default active toggle-off">No</label><span class="toggle-handle btn btn-default"></span></div></div>
					<div class="error_or_msg" style="display: none;" data-i18n="cargoInfo.Invalid">Invalid</div>
				</div>
				<div class="blkc"></div>
				<div class="" style="margin-top: 10px;">
					<label for="cargoInfo_dg_special_code"><span data-i18n="cargoInfo.SHC">Special Handling Code</span>*</label>
					<div class="category-container SHCodeDG">
						<div class="bootstrap-tagsinput"><input type="text" class="form-control autocomplete ui-autocomplete-input" placeholder="" autocomplete="off"></div><input type="text" id="cargoInfo_dg_special_code" placeholder="" class="autocomplete ui-autocomplete-input" data-role="tagsinput" style="display: none;" autocomplete="off">
						<div class="error_or_msg" style="display: none;" data-i18n="cargoInfo.Invalid">Invalid</div>
					</div>
				</div>
				<div class="blkc"></div>
				<div class="cnt_inline bu_txt mr35">
					<label for="cargoInfo_un_no"><span data-i18n="cargoInfo.UNNo">UN number</span>*</label>
					<input type="text" value="" id="cargoInfo_un_no" class="" maxlength="6">
					<div class="error_or_msg" style="display: none;" data-i18n="cargoInfo.Invalid">Invalid</div>
				</div>
				<div class="cnt_inline bu_txt mr35">
					<label for="cargoInfo_class_division"><span data-i18n="cargoInfo.ClassDivision">Class or Division</span>*</label>
					<input type="text" value="" id="cargoInfo_class_division" class="" maxlength="4">
					<div class="error_or_msg" style="display: none;" data-i18n="cargoInfo.Invalid">Invalid</div>
				</div>
				<div class="cnt_inline bu_txt mr35">
					<label for="cargoInfo_sub_risk" data-i18n="cargoInfo.SubRisk">Subsidiary Risk</label>
					<input type="text" value="" id="cargoInfo_sub_risk" class="" maxlength="3">
					<div class="error_or_msg" style="display: none;" data-i18n="cargoInfo.Invalid">Invalid</div>
				</div>
				<div class="cnt_inline bu_txt w175 mr35 b878">
					<label for="cargoInfo_packing_grp"><span data-i18n="cargoInfo.PackGrp">Packing Group</span>*</label>
					<select class="select_bu" id="cargoInfo_packing_grp">
						<option value="">&nbsp;</option>
						<option value="I">I</option>
						<option value="II">II</option>
						<option value="III">III</option>
					</select>
					<div class="error_or_msg" style="display: none;" data-i18n="cargoInfo.Invalid">Invalid</div>
				</div>
				<div class="blkc"></div>
				<div class="cnt_inline bu_txt mr35">
					<label for="cargoInfo_packing_instr"><span data-i18n="cargoInfo.PackingInstruction">Packing Instruction</span>*</label>
					<input type="text" value="" id="cargoInfo_packing_instr" class="" maxlength="4">
					<div class="error_or_msg" style="display: none;" data-i18n="cargoInfo.Invalid">Invalid</div>
				</div>
				<div class="cnt_inline bu_txt mr35">
					<label for="cargoInfo_quantity"><span data-i18n="cargoInfo.Quantity">Quantity</span>*</label>
					<input type="text" value="" id="cargoInfo_quantity" class="cargoinfo_int_input bkd_num_input" maxlength="10">
					<div class="error_or_msg" style="display: none;" data-i18n="cargoInfo.Invalid">Invalid</div>
				</div>
				<div class="blkc"></div>
				<h3 data-i18n="cargoInfo.ShipperInfo">Shipper Info</h3>
				<div class="blkc"></div>
				<div class="cnt_inline bu_txt mr35">
					<label for="cargoInfo_dg_shipper_contact_name"><span data-i18n="cargoInfo.ShipperContactName">Shipper contact name</span>*</label>
					<input type="text" value="" id="cargoInfo_dg_shipper_contact_name" class="" maxlength="20">
					<div class="error_or_msg" style="display: none;" data-i18n="cargoInfo.Invalid">Invalid</div>
				</div>
				<div class="cnt_inline bu_txt mr35">
					<label for="cargoInfo_dg_shipper_contact_no"><span data-i18n="cargoInfo.ShipperContactNo">Shipper contact no</span>*</label>
					<input type="text" value="" id="cargoInfo_dg_shipper_contact_no" class="" maxlength="11">
					<div class="error_or_msg" style="display: none;" data-i18n="cargoInfo.Invalid">Invalid</div>
				</div>
				<div class="blkc"></div>
				<!--<div class="cnt_inline bu_txt mr35">
					<label for="cargoInfo_dg_shipper_remark" data-i18n="cargoInfo.Remarks">Remarks</label>
					<input type="text" value="" id="cargoInfo_dg_shipper_remark" class="" maxlength="20">
					<div class="error_or_msg" style="display: none;" data-i18n="cargoInfo.Invalid">Invalid</div>
				</div>-->
            </div>
		</div>
	</div>
	
	<input type="hidden" id="cargoInfo_revision" value="">

	<script>
		
		$(function() {
			var id = "#bkd_def_cargoinfo";
			var blockID = "bkd_def_cargoinfo";
			var cargoLity;
			var shcLengthLimitDG = 4;
			var shcLengthLimit = 5;
			var showDealCodeWarning = false;
			var dealCodeWarningdisplayed = false;
			//for demo init data
			$("#cargoInfo_awb_prefix").val("160");
			$("#cargoInfo_awb_suffix").val("10039654");
			$("#cargoInfo_pcs").val("1");
			$("#cargoInfo_weight").val("1.0");
			$("#cargoInfo_vol").val("1.000");
			$("#cargoInfo_good_detail").hide();
			$("#cargoInfo_good_des").val("Blades");
			$("#sc_temp_range_start").val("-2.0");
			$("#sc_temp_range_end").val("10.0");
			$("#sc_store_temp_start").val("10.0");
			$("#sc_store_temp_end").val("20.0");
			$("#sc_emergency_tel").val("789332");
			$("#routing_route_from_1").val("HKG");
			$("#routing_route_to_1").val("AMS");
			$("#routing_route_airline_1").val("CX");
			$("#flight_flt_no_1").val("CX271");
			$("#flight_flt_date_1").val("2021-09-24");
			$("#flight_flt_from_1").val("HKG");
			$("#flight_flt_to_1").val("AMS");
			$("#flight_pcs_1").val("1");
			$("#flight_weight_1").val("1");
			$("#flight_vol_1").val("1");
			$("#remark_ssi").val("TEMPERATURE -2C10C  ");
			$("#remark_ssi2").val("STORAGE 10C20CCTC 789332");
			$("#ngtt_deviceid_1").val("300492");
			$("#ngtt_deviceid_2").val("300495");
			$("#ngtt_deviceid_3").val("300508");
			//$("#").val("");
			//end
			setCargoInfoAirlineOption();
			cargoInfoCheckUserCity();
			
			$(id).on("clear", function(event) {
				//console.log(data);
				
				//debugger;
				setGoodsDescDropdownBox();
				//$('#cargoInfo_airline').selectpicker();
				//$('#cargoInfo_airline').selectpicker('val', data.CargoInfo.Airline);
				//$("#cargoInfo_awb_prefix").val("");
				//$("#cargoInfo_awb_suffix").val("");
				//$("#cargoInfo_contact").val("");
				$("#cargoInfo_pcs").val("");
				$("#cargoInfo_weight").val("");
				$("#cargoInfo_kg").prop("checked", true);
				$("#cargoInfo_vol").val("");
				$("#cargoInfo_mc").prop("checked", true);
				$("#cargoInfo_deal_code").val("");
				
				var goodDescArr = [];
				var goodDescValueArr = [];
				if (typeof sessionStorage.getItem("GoodDescList") !== 'undefined' && sessionStorage.getItem("GoodDescList") != null) {
					goodDescArr = JSON.parse(sessionStorage.getItem("GoodDescList"));
					for (var i = 0; i < goodDescArr.length; i++) {
						goodDescValueArr.push(goodDescArr[i].Value);
					}
					console.log(goodDescValueArr);
				}
				
				$("#cargoInfo_good_detail").show();
				$("#cargoInfo_good_des").val("OTH");
				$("#cargoInfo_good_detail").val("");
				
				$("#cargoInfo_priority").val($("#cargoInfo_priority option:first").val());
				$('#cargoInfo_special_cargo').bootstrapToggle();
				$('#cargoInfo_special_cargo').bootstrapToggle('off');
				$("#cargoInfo_revision").val("");

				//From old specialCargo.cshtml
				$('#sc_special_code').tagsinput('removeAll');
				$("#sc_temp_range_start").val("");
				$("#sc_temp_range_end").val("");
				$("#sc_temp_range_c").prop("checked", true);
				$("#sc_store_temp_start").val("");
				$("#sc_store_temp_end").val("");
				$("#sc_store_temp_c").prop("checked", true);
				$('#sc_emergency_tel').val("");
				$("#sc_temp_range_wrapper").hide();
				$("#sc_storage_temp_range_wrapper").hide();
				$("#sc_emergency_tel_wrapper").hide();
				//remove shc and enable osi
				remarkEnableOSI();
				//End from old specialCargo.cshtml
				
				// dg mask info
				$('#cargoInfo_dg_cargo_aircraft').bootstrapToggle();
				$('#cargoInfo_dg_cargo_aircraft').bootstrapToggle('off');
				$('#cargoInfo_dg_special_code').tagsinput('removeAll');
				$("#cargoInfo_un_no").val("");
				$("#cargoInfo_class_division").val("");
				$("#cargoInfo_sub_risk").val("");
				$("#cargoInfo_packing_grp").val("");
				$("#cargoInfo_packing_instr").val("");
				$("#cargoInfo_quantity").val("");
				$("#cargoInfo_dg_shipper_contact_name").val("");
				$("#cargoInfo_dg_shipper_contact_no").val("");
				//$("#cargoInfo_dg_shipper_remark").val("");
				
				
				$(id+" .error_or_msg").hide();
				$(id+" .error_or").removeClass("error_or");
				
			});
			
			$(id).on("init", function(event, data) {
				console.log(data);
				setGoodsDescDropdownBox();
				resetDGMaskFilterPanel();

				if (typeof data.CargoInfo !== 'undefined' && data.CargoInfo != null) {
					//debugger;
					$('#cargoInfo_airline').selectpicker();
                    console.log("init data.CargoInfo.Airline:", data.CargoInfo.Airline);
					$('#cargoInfo_airline').selectpicker('val', data.CargoInfo.Airline);
					$("#cargoInfo_awb_prefix").val(data.CargoInfo.AWBPrefix);
					$("#cargoInfo_awb_suffix").val(data.CargoInfo.AWBSuffix);
					//$("#cargoInfo_contact").val(data.CargoInfo.Contact);
					if (localStorage.getItem("currentUserID") != null) {
						$("#cargoInfo_contact").val(localStorage.getItem("currentUserID"));
					}
					$("#cargoInfo_pcs").val(data.CargoInfo.Pieces);
					if (!isNaN(parseFloat(data.CargoInfo.Weight).toFixed(decimalWeightRoundTo))) {
						$("#cargoInfo_weight").val(parseFloat(data.CargoInfo.Weight).toFixed(decimalWeightRoundTo));
					} else {
						$("#cargoInfo_weight").val(data.CargoInfo.Weight);
					}
					if (data.CargoInfo.WeightUnit == 0 || typeof data.CargoInfo.WeightUnit === 'undefined') {
						$("#cargoInfo_kg").prop("checked", true);
					} else {
						$("#cargoInfo_lb").prop("checked", true);
					}
					if (!isNaN(parseFloat(data.CargoInfo.Volume).toFixed(decimalVolumeRoundToCX))) {
						$("#cargoInfo_vol").val(parseFloat(data.CargoInfo.Volume).toFixed(decimalVolumeRoundToCX));
					} else {
						$("#cargoInfo_vol").val(data.CargoInfo.Volume);
					}
					switch (data.CargoInfo.VolumeUnit) {
					  case 1:
					    $("#cargoInfo_cf").prop("checked", true);
					    break;
					  case 2:
					    $("#cargoInfo_cc").prop("checked", true);
					    break;
					  case 3:
					    $("#cargoInfo_ci").prop("checked", true);
					    break;
					  default:
					  	$("#cargoInfo_mc").prop("checked", true);
					}
					var goodDescArr = [];
					var goodDescValueArr = [];
					if (typeof sessionStorage.getItem("GoodDescList") !== 'undefined' && sessionStorage.getItem("GoodDescList") != null) {
						goodDescArr = JSON.parse(sessionStorage.getItem("GoodDescList"));
						for (var i = 0; i < goodDescArr.length; i++) {
							goodDescValueArr.push(goodDescArr[i].Value);
						}
						console.log(goodDescValueArr);
					}
					if (typeof data.CargoInfo.CargoDesc !== 'undefined' && data.CargoInfo.CargoDesc != null) {
						if (goodDescValueArr.length > 0) {
							if (goodDescValueArr.indexOf(data.CargoInfo.CargoDesc) > -1){
								$("#cargoInfo_good_detail").hide();
								$("#cargoInfo_good_des").val(data.CargoInfo.CargoDesc);
							} else {
								$("#cargoInfo_good_detail").show();
								$("#cargoInfo_good_des").val("OTH");
								$("#cargoInfo_good_detail").val(data.CargoInfo.CargoDesc);
							}
						} else {
							alert("Error occured when preparing Goods Description options");
						}
					}

					$("#cargoInfo_priority").val(data.CargoInfo.PriorityType);
					$('#cargoInfo_special_cargo').bootstrapToggle();
					if (data.CargoInfo.IsSpecialCargo) {
						$('#cargoInfo_special_cargo').bootstrapToggle('on')
					} else {
						$('#cargoInfo_special_cargo').bootstrapToggle('off')
					}
					//$("#cargoInfo_special_cargo").prop("checked", data.CargoInfo.IsSpecialCargo);

					$("#cargoInfo_deal_code").val(data.CargoInfo.DealCode);

					$("#cargoInfo_revision").val(data.CargoInfo.Revision);
				}
				
				//dg mask info
				$('#cargoInfo_dg_cargo_aircraft').bootstrapToggle();
				$("#cargoInfo_dg_special_code").tagsinput();
				setTimeout(function () { 
					$(".SHCodeDG .autocomplete").autocomplete({
						source: availableSHCDesc,
						select: selectSHCFromAutoCompleteDG
					}); 
				}, 300);

				handleAirlineCodeAndPreffixErr();

				//From old specialCargo.cshtml
				//$("input[data-role=tagsinput]").tagsinput();
				$("#sc_special_code").tagsinput();
				//setTimeout(function () { regSHCodeAutoComplete(); }, 300);
				setTimeout(function () { 
					$(".SHCodeAC .autocomplete").autocomplete({
						source: availableSHCDesc,
						select: selectSHCFromAutoComplete
					}); 
				}, 300);

				if (typeof data.SpecialCargo !== 'undefined' && data.SpecialCargo != null) {
					
					
					if (typeof data.SpecialCargo.SHC !== 'undefined' && data.SpecialCargo.SHC != null) {
						for (var i = 0; i < data.SpecialCargo.SHC.length; i++) {
							$('#sc_special_code').tagsinput('add', data.SpecialCargo.SHC[i]);
						}	
					}
					
					//$('input[name=product-temp]').bootstrapSwitch();
					
					$("#sc_temp_range_start").val(data.SpecialCargo.PTempStart);
					$("#sc_temp_range_end").val(data.SpecialCargo.PTempEnd);
					if (data.SpecialCargo.PTempUnit == 0 || typeof data.SpecialCargo.PTempUnit === 'undefined') {
						$("#sc_temp_range_c").prop("checked", true);
					} else {
						$("#sc_temp_range_f").prop("checked", true);
					}
					$("#sc_store_temp_start").val(data.SpecialCargo.STempStart);
					$("#sc_store_temp_end").val(data.SpecialCargo.STempEnd);
					if (data.SpecialCargo.STempUnit == 0 || typeof data.SpecialCargo.STempUnit === 'undefined') {
						$("#sc_store_temp_c").prop("checked", true);
					} else {
						$("#sc_store_temp_f").prop("checked", true);
					}
					$('#sc_emergency_tel').val(data.SpecialCargo.EmergencyTel);
				}
				//End from old specialCargo.cshtml
			});

			$(id).on("setSHC", function(event, data) {
				console.log(data);
				console.log("setSHC");
				
				/*
				availableSHCTags = JSON.parse(data);
				$(".SHCodeAC .autocomplete").autocomplete({
					source: availableSHCTags
				});
				*/
				/*
				for (var i = 0; i < tempArr.length; i++) {
					console.log(tempArr[i]);
				}
				*/
				//debugger;
				
			});
			
			$(id).on("validate", function() {
				console.log("OK");
				
				//var intVad = /^\+?(0|[1-9]\d*)$/;
				//var decVad = /^([1-9]\d*|0\.\d*[1-9]|[1-9]\d*\.\d*[0-9]|0)$/;
				
				var airline = $("#cargoInfo_airline").val();
				var awbPrefix = $("#cargoInfo_awb_prefix").val();
				var awbSuffix = $("#cargoInfo_awb_suffix").val();
				var cargoContact = $("#cargoInfo_contact").val();
				var cargoPcs = $("#cargoInfo_pcs").val();
				var cargoWeight = $("#cargoInfo_weight").val();
				var cargoWeightUnit = $('input[name=weight-unit]:checked').val();
				var cargoVolume = $("#cargoInfo_vol").val();
				var cargoVolumeUnit = $('input[name=vol-unit]:checked').val();
				var cargoDescType = $("#cargoInfo_good_des").val();
				var cargoDescDetail = $("#cargoInfo_good_detail").val();
				var cargoPT = $("#cargoInfo_priority").val();
				var spCargo = $("#cargoInfo_special_cargo").is(':checked');
				var dealCode = $("#cargoInfo_deal_code").val();
				
				//dg mask
				var dgAircraftOnly = $("#cargoInfo_dg_cargo_aircraft").is(':checked');
				var dgShc = $("#cargoInfo_dg_special_code").val().toUpperCase();
				var dgShcList = [];
				if (dgShc != "") {
					dgShcList = dgShc.split(",");
				}
				var dgUNNo = $("#cargoInfo_un_no").val();
				var dgClassDivision = $("#cargoInfo_class_division").val();
				var dgSubRisk = $("#cargoInfo_sub_risk").val();
				var dgPackGroup = $("#cargoInfo_packing_grp").val();
				var dgPackInstr = $("#cargoInfo_packing_instr").val();
				var dgQuantity = $("#cargoInfo_quantity").val();
				var dgShipperName = $("#cargoInfo_dg_shipper_contact_name").val();
				var dgShipperContactNo = $("#cargoInfo_dg_shipper_contact_no").val();
				
				var isValid = true;
				
				//check AWB
				if (awbPrefix == "" || awbSuffix == "") {
					$("#cargoInfo_awb_prefix ~ .error_or_msg").show();
					$("#cargoInfo_awb_prefix").parent().addClass("error_or");
					isValid = false;
				} else if (awbPrefix.length != 3 || awbSuffix.length != 8) {
					$("#cargoInfo_awb_prefix ~ .error_or_msg").show();
					$("#cargoInfo_awb_prefix").parent().addClass("error_or");
					isValid = false;
				} else if (!validateAWBInputField(awbSuffix)) {
					$("#cargoInfo_awb_prefix ~ .error_or_msg").show();
					$("#cargoInfo_awb_prefix").parent().addClass("error_or");
					isValid = false;
				} else {
					$("#cargoInfo_awb_prefix ~ .error_or_msg").hide();
					$("#cargoInfo_awb_prefix").parent().removeClass("error_or");
				}

                //contact
                if (cargoContact == "") {
                    $("#cargoInfo_contact ~ .error_or_msg").show();
                    $("#cargoInfo_contact").parent().addClass("error_or");
                    isValid = false;
                } else {
                    $("#cargoInfo_contact ~ .error_or_msg").hide();
                    $("#cargoInfo_contact").parent().removeClass("error_or");
                }

                //pieces
                if (cargoPcs == "") {
                    $("#cargoInfo_pcs ~ .error_or_msg").show();
                    $("#cargoInfo_pcs").parent().addClass("error_or");
                    isValid = false;
                } else if (!intVad.test(cargoPcs) && cargoPcs != "") {
                    $("#cargoInfo_pcs ~ .error_or_msg").show();
                    $("#cargoInfo_pcs").parent().addClass("error_or");
                    isValid = false;
                } else if (intVad.test(cargoPcs) && cargoPcs == 0) {
                    $("#cargoInfo_pcs ~ .error_or_msg").show();
                    $("#cargoInfo_pcs").parent().addClass("error_or");
                    isValid = false;
                } else {
                    $("#cargoInfo_pcs ~ .error_or_msg").hide();
                    $("#cargoInfo_pcs").parent().removeClass("error_or");

                }

                //weight
                if (cargoWeight == "") {
                    $("#cargoInfo_weight ~ .error_or_msg").show();
                    $("#cargoInfo_weight").parent().addClass("error_or");
                    isValid = false;
                } else if (!decVad.test(cargoWeight) && cargoWeight != "") {
                    $("#cargoInfo_weight ~ .error_or_msg").show();
                    $("#cargoInfo_weight").parent().addClass("error_or");
                    isValid = false;
                } else if (decVad.test(cargoWeight) && cargoWeight == 0) {
                    $("#cargoInfo_weight ~ .error_or_msg").show();
                    $("#cargoInfo_weight").parent().addClass("error_or");
                    isValid = false;
                } else {
                    $("#cargoInfo_weight ~ .error_or_msg").hide();
                    $("#cargoInfo_weight").parent().removeClass("error_or");
                }

                //volume
                if (cargoVolume == "") {
                    $("#cargoInfo_vol ~ .error_or_msg").show();
                    $("#cargoInfo_vol").parent().addClass("error_or");
                    isValid = false;
                } else if (!decVad.test(cargoVolume) && cargoVolume != "") {
                    $("#cargoInfo_vol ~ .error_or_msg").show();
                    $("#cargoInfo_vol").parent().addClass("error_or");
                    isValid = false;
                } else if (decVad.test(cargoVolume) && cargoVolume == 0) {
                    $("#cargoInfo_vol ~ .error_or_msg").show();
                    $("#cargoInfo_vol").parent().addClass("error_or");
                    isValid = false;
                } else {
                    $("#cargoInfo_vol ~ .error_or_msg").hide();
                    $("#cargoInfo_vol").parent().removeClass("error_or");
                }
				
				//good desc
				if (cargoDescType == "OTH" && !StringFormatChecker.checkFormatX2(cargoDescDetail, 1, 15)) {
					$("#cargoInfo_good_detail ~ .error_or_msg").show();
					$("#cargoInfo_good_detail").parent().addClass("error_or");
					isValid = false;
				} else {
					$("#cargoInfo_good_detail ~ .error_or_msg").hide();
					$("#cargoInfo_good_detail").parent().removeClass("error_or");
				}
				
				if (localStorage.getItem("getAWBSuccess") != 1) {
					isValid = false;
                    alert(i18next.t("cargoInfo.VerifyAirWaybillAlert"));
					$("#cargoInfo_awb_prefix ~ .error_or_msg").show();
					$("#cargoInfo_awb_prefix").parent().addClass("error_or");
				}

				//deal code
				if(!StringFormatChecker.checkDealCodeFormat(dealCode)){
					isValid = false;
					$("#cargoInfo_deal_code ~ .error_or_msg").show();
					$("#cargoInfo_deal_code").parent().addClass("error_or");
				}
				else{
					$("#cargoInfo_deal_code ~ .error_or_msg").hide();
					$("#cargoInfo_deal_code").parent().removeClass("error_or");
				}
				
				//check dg mask
				var dgMaskHasInfo = false;
				if (dgAircraftOnly == true || dgShc != "" || dgUNNo != "" || dgClassDivision != "" || dgSubRisk != "" 
				|| dgPackGroup != "" || dgPackInstr != "" || dgQuantity != "" || dgShipperName != "" || dgShipperContactNo != "") {
					
					dgMaskHasInfo = true;
					
					if (dgShcList.length == 0) {
						$("#cargoInfo_dg_special_code ~ .error_or_msg").show();
						isValid = false;
					} else {
						$("#cargoInfo_dg_special_code ~ .error_or_msg").hide();
					}
					
					if (dgUNNo == "") {
						$("#cargoInfo_un_no ~ .error_or_msg").show();
						$("#cargoInfo_un_no").parent().addClass("error_or");
						isValid = false;
					} else if (dgUNNo.length != 6) {
						$("#cargoInfo_un_no ~ .error_or_msg").show();
						$("#cargoInfo_un_no").parent().addClass("error_or");
						isValid = false;
					} else {
						var airline = dgUNNo.substr(0,2);
						var flightNum = dgUNNo.substr(2);
						var reg = new RegExp(/^\d{4}$/);
						
						if (!isNaN(airline) || !reg.test(flightNum)) {
							$("#cargoInfo_un_no ~ .error_or_msg").show();
							$("#cargoInfo_un_no").parent().addClass("error_or");
							isValid = false;
						} else {
							$("#cargoInfo_un_no ~ .error_or_msg").hide();
							$("#cargoInfo_un_no").parent().removeClass("error_or");
						}
					}
					
					if (dgClassDivision == "") {
						$("#cargoInfo_class_division ~ .error_or_msg").show();
						$("#cargoInfo_class_division").parent().addClass("error_or");
						isValid = false;
					} else {
						$("#cargoInfo_class_division ~ .error_or_msg").hide();
						$("#cargoInfo_class_division").parent().removeClass("error_or");
					}
					
					if (dgSubRisk != "") {
						if (!decVad.test(dgSubRisk)) {
							$("#cargoInfo_sub_risk ~ .error_or_msg").show();
							$("#cargoInfo_sub_risk").parent().addClass("error_or");
							isValid = false;
						}
					} else {
						$("#cargoInfo_sub_risk ~ .error_or_msg").hide();
						$("#cargoInfo_sub_risk").parent().removeClass("error_or");
					}
					
					if (dgPackGroup == "") {
						$("#cargoInfo_packing_grp ~ .error_or_msg").show();
						$("#cargoInfo_packing_grp").parent().addClass("error_or");
						isValid = false;
					} else {
						$("#cargoInfo_packing_grp ~ .error_or_msg").hide();
						$("#cargoInfo_packing_grp").parent().removeClass("error_or");
					}
					
					if (dgPackInstr == "" || dgPackInstr.length < 3 || dgPackInstr.length > 4) {
						$("#cargoInfo_packing_instr ~ .error_or_msg").show();
						$("#cargoInfo_packing_instr").parent().addClass("error_or");
						isValid = false;
					} else {
					
						$("#cargoInfo_packing_instr ~ .error_or_msg").hide();
						$("#cargoInfo_packing_instr").parent().removeClass("error_or");
						
						if (dgPackInstr.length == 3) {
							var reg = new RegExp(/^\d{3}$/);
							if (!reg.test(dgPackInstr)) {
								$("#cargoInfo_packing_instr ~ .error_or_msg").show();
								$("#cargoInfo_packing_instr").parent().addClass("error_or");
								isValid = false;
							}
						} else if (dgPackInstr.length == 4) {
							var reg = new RegExp(/^[a-zA-Z]{1}\d{3}$/);
							if (!reg.test(dgPackInstr)) {
								$("#cargoInfo_packing_instr ~ .error_or_msg").show();
								$("#cargoInfo_packing_instr").parent().addClass("error_or");
								isValid = false;
							}
						}
					}
					
					if (dgShipperName == "") {
						$("#cargoInfo_dg_shipper_contact_name ~ .error_or_msg").show();
						$("#cargoInfo_dg_shipper_contact_name").parent().addClass("error_or");
						isValid = false;
					} else {
						$("#cargoInfo_dg_shipper_contact_name ~ .error_or_msg").hide();
						$("#cargoInfo_dg_shipper_contact_name").parent().removeClass("error_or");
					}
					
					if (dgShipperContactNo == "") {
						$("#cargoInfo_dg_shipper_contact_no ~ .error_or_msg").show();
						$("#cargoInfo_dg_shipper_contact_no").parent().addClass("error_or");
						isValid = false;
					} else {
						$("#cargoInfo_dg_shipper_contact_no ~ .error_or_msg").hide();
						$("#cargoInfo_dg_shipper_contact_no").parent().removeClass("error_or");
					}
					
				}
				
				if (dgMaskHasInfo && isValid) {
					if (dgAircraftOnly == true) {
						dgShc = "CAO" + "," + dgShc; 
					}
					//setData("bkd_def_shc", "SHC", dgShc);
					setData("bkd_def_cargoinfo", "SHC", dgShc);
				}
				
                console.log("cargoinfo isValid:" + isValid);

                if (isValid)
                    BkdDimCheck(decimalVolumeRoundToCX);

				//From old specialCargo.cshtml
				var shc = $("#sc_special_code").val() || "";
				var shcList = [];
				if (shc != "") {
					shcList = shc.split(",");
				}
				var tempStart = $("#sc_temp_range_start").val();
				var tempEnd = $("#sc_temp_range_end").val();
				var tempUnit = $('input[name=product-temp]:checked').val();
				var storeTempStart = $("#sc_store_temp_start").val();
				var storeTempEnd = $("#sc_store_temp_end").val();
				var storeTempUnit = $('input[name=store-temp]:checked').val();
				var emergencyTel = $('#sc_emergency_tel').val();
				var checkTemperature = false;
				
				checkTemperature = checkSHCShowTemperatureInput(shc);

				if (checkTemperature) {
					if (tempStart == "" || tempEnd == "") {
						$("#sc_temp_range_start ~ .error_or_msg").show();
						$("#sc_temp_range_start").parent().addClass("error_or");
						isValid = false;
					} else if (!decVadWithNeg.test(parseFloat(tempStart)) && tempStart != "") {
						$("#sc_temp_range_start ~ .error_or_msg").show();
						$("#sc_temp_range_start").parent().addClass("error_or");
						isValid = false;
					} else if (!decVadWithNeg.test(parseFloat(tempEnd)) && tempEnd != "") {
						$("#sc_temp_range_start ~ .error_or_msg").show();
						$("#sc_temp_range_start").parent().addClass("error_or");
						isValid = false;
					} else if (parseFloat(tempStart) >= parseFloat(tempEnd)) {
						$("#sc_temp_range_start ~ .error_or_msg").show();
						$("#sc_temp_range_start").parent().addClass("error_or");
						isValid = false;
					} else {
						$("#sc_temp_range_start ~ .error_or_msg").hide();
						$("#sc_temp_range_start").parent().removeClass("error_or");
					}
					
					if (parseFloat(tempStart) > 99.9 || parseFloat(tempStart) < -99.9) {
						$("#sc_temp_range_start ~ .error_or_msg").show();
						$("#sc_temp_range_start").parent().addClass("error_or");
						isValid = false;
					}
					
					if (parseFloat(tempEnd) > 99.9 || parseFloat(tempEnd) < -99.9) {
						$("#sc_temp_range_end ~ .error_or_msg").show();
						$("#sc_temp_range_end").parent().addClass("error_or");
						isValid = false;
					}
					
					if (storeTempStart == "" || storeTempEnd == "") {
						$("#sc_store_temp_start ~ .error_or_msg").show();
						$("#sc_store_temp_start").parent().addClass("error_or");
						isValid = false;
					} else if (!decVadWithNeg.test(parseFloat(storeTempStart)) && storeTempStart != "") {
						$("#sc_store_temp_start ~ .error_or_msg").show();
						$("#sc_store_temp_start").parent().addClass("error_or");
						isValid = false;
					} else if (!decVadWithNeg.test(parseFloat(storeTempEnd)) && storeTempEnd != "") {
						$("#sc_store_temp_start ~ .error_or_msg").show();
						$("#sc_store_temp_start").parent().addClass("error_or");
						isValid = false;
					} else if (parseFloat(storeTempStart) >= parseFloat(storeTempEnd)) {
						$("#sc_store_temp_start ~ .error_or_msg").show();
						$("#sc_store_temp_start").parent().addClass("error_or");
						isValid = false;
					} else {
						$("#sc_store_temp_start ~ .error_or_msg").hide();
						$("#sc_store_temp_start").parent().removeClass("error_or");
					}
					
					if (parseFloat(storeTempStart) > 99.9 || parseFloat(storeTempStart) < -99.9) {
						$("#sc_store_temp_start ~ .error_or_msg").show();
						$("#sc_store_temp_start").parent().addClass("error_or");
						isValid = false;
					}
					
					if (parseFloat(storeTempEnd) > 99.9 || parseFloat(storeTempEnd) < -99.9) {
						$("#sc_store_temp_end ~ .error_or_msg").show();
						$("#sc_store_temp_end").parent().addClass("error_or");
						isValid = false;
					}
					
					if (emergencyTel == "") {
						$("#sc_emergency_tel ~ .error_or_msg").show();
						$("#sc_emergency_tel").parent().addClass("error_or");
						isValid = false;
					} else {
						$("#sc_emergency_tel ~ .error_or_msg").hide();
						$("#sc_emergency_tel").parent().removeClass("error_or");
					}
					
				} else {
					$("#sc_temp_range_start ~ .error_or_msg").hide();
					$("#sc_temp_range_start").parent().removeClass("error_or");
					$("#sc_store_temp_start ~ .error_or_msg").hide();
					$("#sc_store_temp_start").parent().removeClass("error_or");
					$("#sc_emergency_tel ~ .error_or_msg").hide();
					$("#sc_emergency_tel").parent().removeClass("error_or");
				}
				//End from old specialCargo.cshtml

				return isValid;
				//return true;
			});
			
			$(id).on("apiValidate", function(e, tabId) {
				var isApiValid = true
				//SHC Segreation
				var shc = $("#sc_special_code").val() || "";
				var shcList = [];
				if (shc != "") {
					shcList = shc.split(",");
				}
				var airline = $("#cargoInfo_airline").val();
				var awbPrefix = $("#cargoInfo_awb_prefix").val();
				var awbSuffix = $("#cargoInfo_awb_suffix").val();
				var productCode = $('#ngtt_product').val();
				var tempCode = $('#ngtt_temperature').val();
				var tempShc = $('#ngtt_temperature :selected').attr('shc');


				var shrCheck = ApiHandler.ShrCheck(airline, shcList, awbPrefix, awbSuffix, productCode, tempCode, tempShc)
				.then(function(succResult){
					if (succResult === undefined){
						$("#sc_special_code ~ .error_or_msg").hide();
						$('#sc_special_code_wrapper').removeClass('error_or');
						isApiValid = true;
					}
					else {
						$("#sc_special_code_err").text(succResult.inValidMsg);
						$("#sc_special_code ~ .error_or_msg").show();
						$('#sc_special_code_wrapper').addClass('error_or')
						isApiValid = false;
					}

				})
				.catch(function(errResult){
					isApiValid = false ;
					AjaxRequest.displayAjaxErr(errResult.errors);
				})
				//End Of SHC segreation

				return Promise.all([shrCheck]).then(function() {
					return {
						isValid: isApiValid,
						tabId: tabId
					}
				});
			});

			$(id).on("submit", function() {
				var airline = $("#cargoInfo_airline").val();
				var awbPrefix = $("#cargoInfo_awb_prefix").val().toString();
				var awbSuffix = $("#cargoInfo_awb_suffix").val().toString();
				var cargoContact = $("#cargoInfo_contact").val();
				var cargoPcs = $("#cargoInfo_pcs").val().toString();
				var cargoWeight = $("#cargoInfo_weight").val().toString();
				var cargoWeightUnit = $('input[name=weight-unit]:checked').val();
				var cargoVolume = $("#cargoInfo_vol").val().toString();
				var cargoVolumeIsSpecified = false;
				if (cargoVolume != "") {
					cargoVolumeIsSpecified = true;
				}
				var cargoVolumeUnit = $('input[name=vol-unit]:checked').val();
				var cargoDescType = $("#cargoInfo_good_des").val();
				var cargoDescDetail = $("#cargoInfo_good_detail").val();
				var cargoDesc;
				if (cargoDescType == "OTH") {
					cargoDesc = cargoDescDetail;
				} else {
					cargoDesc = cargoDescType;
				}
				var cargoPT = $("#cargoInfo_priority").val();
				var spCargo = $("#cargoInfo_special_cargo").is(':checked');
				var dealCode = $("#cargoInfo_deal_code").val();
				var revision = $("#cargoInfo_revision").val();
				
				//dg mask
				var dgAircraftOnly = $("#cargoInfo_dg_cargo_aircraft").is(':checked');
				var dgShc = $("#cargoInfo_dg_special_code").val().toUpperCase();
				var dgShcList = [];
				if (dgShc != "") {
					dgShcList = dgShc.split(",");
				}
				var dgUNNo = $("#cargoInfo_un_no").val();
				var dgClassDivision = $("#cargoInfo_class_division").val();
				var dgSubRisk = $("#cargoInfo_sub_risk").val();
				var dgPackGroup = $("#cargoInfo_packing_grp").val();
				var dgPackInstr = $("#cargoInfo_packing_instr").val();
				var dgQuantity = $("#cargoInfo_quantity").val();
				var dgShipperName = $("#cargoInfo_dg_shipper_contact_name").val();
				var dgShipperContactNo = $("#cargoInfo_dg_shipper_contact_no").val();

				//From old specialCargo.cshtml
				var shc = $("#sc_special_code").val().toUpperCase();
				var shcList = [];
				var includeTemp = false;
				if (shc != "") {
					shcList = shc.split(",");
					includeTemp = checkSHCShowTemperatureInput(shc);
				}
				var tempStart = $("#sc_temp_range_start").val();
				var tempEnd = $("#sc_temp_range_end").val();
				var tempUnit = $('input[name=product-temp]:checked').val();
				var storeTempStart = $("#sc_store_temp_start").val();
				var storeTempEnd = $("#sc_store_temp_end").val();
				var storeTempUnit = $('input[name=store-temp]:checked').val();
				var emergencyTel = $('#sc_emergency_tel').val();
				//End from old specialCargo.cshtml

				var returnObj = {};
				if (includeTemp) {
					returnObj.SpecialCargo = {
						"SHC" : shcList,
							"PTempStart" : tempStart,
							"PTempEnd" : tempEnd,
							"PTempUnit" : tempUnit,
							"STempStart" : storeTempStart,
							"STempEnd" : storeTempEnd,
							"STempUnit" : storeTempUnit,
							"EmergencyTel" : emergencyTel
					}
				} else {
					returnObj.SpecialCargo = {
						"SHC" : shcList
					}
				}

				returnObj.CargoInfo = {
					"Airline": airline,
                        "AWBPrefix": awbPrefix,
                        "AWBSuffix": awbSuffix,
                        "Contact": cargoContact,
                        "Pieces": cargoPcs,
                        "PiecesIsSpecified": isInt(cargoPcs),
                        "Weight": cargoWeight,
                        "WeightIsSpecified": isInt(cargoWeight),
                        "WeightUnit": cargoWeightUnit,
                        "Volume": cargoVolume,
                        "VolumeIsSpecified": cargoVolumeIsSpecified,
                        "VolumeUnit": cargoVolumeUnit,
                        "CargoDesc": cargoDesc,
                        "PriorityType": cargoPT,
                        "IsSpecialCargo": spCargo,
						"DealCode": dealCode,
                        "Revision": revision,
						"DGAircraftOnly": dgAircraftOnly,
						"DGSHC": dgShcList,
						"DGUNNo": dgUNNo,
						"DGClassDivision": dgClassDivision,
						"DGSubRisk": dgSubRisk,
						"DGPackGroup": dgPackGroup,
						"DGPackInstrction": dgPackInstr,
						"DGQuantity": dgQuantity,
						"DGShipperName": dgShipperName,
						"DGShipperContactNo": dgShipperContactNo
				}

				return returnObj;
			});

            $(id).on("loadBookingData", function (event, bkdData) {
				console.log(bkdData);
				$('#cargoInfo_airline').selectpicker('val', bkdData.Airline);
				$("#cargoInfo_awb_prefix").val(bkdData.AwbPrefix);
				$("#cargoInfo_awb_suffix").val(bkdData.AwbSuffix);
				//$("#cargoInfo_contact").val(bkdData.CusName);

                if (bkdData.PiecesIsSpecified) {
                    $("#cargoInfo_pcs").val(bkdData.Pieces);
                } else {
					$("#cargoInfo_pcs").val("");
				}

                if (bkdData.WeightIsSpecified) {
                    if (!isNaN(parseFloat(bkdData.Weight).toFixed(decimalWeightRoundTo))) {
                        $("#cargoInfo_weight").val(parseFloat(bkdData.Weight).toFixed(decimalWeightRoundTo));
                    } else {
                        $("#cargoInfo_weight").val(bkdData.Weight);
                    }
                } else {
					$("#cargoInfo_weight").val("");
				}

                if (bkdData.WeightCode == 0 || typeof bkdData.WeightCode === 'undefined') {
                    $("#cargoInfo_kg").prop("checked", true);
                } else {
                    $("#cargoInfo_lb").prop("checked", true);
                }

                if (bkdData.VolumeAmountIsSpecified) {
                    if (!isNaN(parseFloat(bkdData.VolumeAmount).toFixed(decimalVolumeRoundToCX))) {
                        $("#cargoInfo_vol").val(parseFloat(bkdData.VolumeAmount).toFixed(decimalVolumeRoundToCX));
                    } else {
                        $("#cargoInfo_vol").val(bkdData.VolumeAmount);
                    }
                } else {
					$("#cargoInfo_vol").val("");
				}

				switch (bkdData.VolumeCode) {
				  case 1:
				    $("#cargoInfo_cf").prop("checked", true);
				    break;
				  case 2:
				    $("#cargoInfo_cc").prop("checked", true);
				    break;
				  case 3:
				    $("#cargoInfo_ci").prop("checked", true);
				    break;
				  default:
				  	$("#cargoInfo_mc").prop("checked", true);
				}
				
				if (typeof bkdData.ManifestDesc !== 'undefined' && bkdData.ManifestDesc != null) {
					var optionList = [];
					var foundInx = 1;
					$("#cargoInfo_good_des option").each(function() {
					   optionList.push($(this).val());
					});
					
					for (var i = 0; i < optionList.length; i++) {
						if (optionList[i].toLowerCase() == bkdData.ManifestDesc.toLowerCase()) {
							foundInx = i + 1;
						}
					}
					
					if (foundInx > 1) {
						//$("#cargoInfo_good_des").val(bkdData.ManifestDesc);
						$("#cargoInfo_good_des :nth-child("+foundInx+")").prop('selected', true);
						$("#cargoInfo_good_detail").hide();
					} else {
						$("#cargoInfo_good_des").val("OTH");
						$("#cargoInfo_good_detail").val(bkdData.ManifestDesc);
						$("#cargoInfo_good_detail").show();
					}
				} else {
					$("#cargoInfo_good_des").val("OTH");
					$("#cargoInfo_good_detail").val(bkdData.ManifestDesc);
					$("#cargoInfo_good_detail").show();
				}
				
				if (typeof bkdData.Cx !== 'undefined' && bkdData.Cx != null) {
					$("#cargoInfo_priority").val(bkdData.Cx.ProductCode);
					$("#cargoInfo_revision").val(bkdData.Cx.Revision);
					$("#cargoInfo_deal_code").val(bkdData.Cx.DealCode);
				}

				//$("#cargoInfo_special_cargo").prop("checked", true);
				
				//load dg mask info
				if (typeof bkdData.DgMask !== 'undefined' && bkdData.DgMask != null && validateJPCity(localStorage.getItem("userCity"))) {
				
					if (bkdData.DgMask.Unnumber1 != "") {
						if (bkdData.DgMask.Cargoaircraftonly == true) {
							$('#cargoInfo_dg_cargo_aircraft').bootstrapToggle('on');
						} else {
							$('#cargoInfo_dg_cargo_aircraft').bootstrapToggle('off');
						}
						
						if (bkdData.DgMask.Shc1 != "") {
							$('#cargoInfo_dg_special_code').tagsinput('add', bkdData.DgMask.Shc1);
						}
						
						if (bkdData.DgMask.Shc2 != "") {
							$('#cargoInfo_dg_special_code').tagsinput('add', bkdData.DgMask.Shc2);
						}
						
						if (bkdData.DgMask.Shc3 != "") {
							$('#cargoInfo_dg_special_code').tagsinput('add', bkdData.DgMask.Shc3);
						}

						if (bkdData.DgMask.Shc4 != "") {
							$('#cargoInfo_dg_special_code').tagsinput('add', bkdData.DgMask.Shc4);
						}
						
						$("#cargoInfo_un_no").val(bkdData.DgMask.Unnumber1);
						$("#cargoInfo_class_division").val(bkdData.DgMask.Classdivision1);
						$("#cargoInfo_sub_risk").val(bkdData.DgMask.Subsidiaryrisk1);
						$("#cargoInfo_packing_grp").val(bkdData.DgMask.Packinggroup1);
						$("#cargoInfo_packing_instr").val(bkdData.DgMask.Packinginstruction1);
						$("#cargoInfo_quantity").val(bkdData.DgMask.Quantity1);
						
						$("#cargoInfo_dg_shipper_contact_name").val(bkdData.DgMask.ShipperContName);
						$("#cargoInfo_dg_shipper_contact_no").val(bkdData.DgMask.ShipperContNo);
						
					}
				}
				
				localStorage.setItem("getAWBSuccess", 1);
				cargoInfoCheckAWBPrefix();
				handleAirlineCodeAndPreffixErr();

				if(_.find([5, 6, 7, 8], function(s) { return s == bkdData.BookingStatus })){
					$("#cargoInfo_deal_code").prop("disabled", true).addClass("no_border");
				}
				//new awb, no warning when changing deal code
				else if (bkdData.BookingStatus != 0){
					showDealCodeWarning = true;
				}

				//From old specialCargo.cshtml
				if (typeof bkdData.ShrCode !== 'undefined' && bkdData.ShrCode != null) {
					for (var i = 0; i < bkdData.ShrCode.length; i++) {
						$('#sc_special_code').tagsinput('add', bkdData.ShrCode[i]);
					}	
				}
				
				if (typeof bkdData.Cx !== 'undefined' && bkdData.Cx != null) {
					if (typeof bkdData.Cx.ProductTempUpper !== 'undefined' && bkdData.Cx.ProductTempUpper != null) {
						if (!isNaN(parseFloat(bkdData.Cx.ProductTempUpper).toFixed(decimalTemperatureRoundTo))) {
							$("#sc_temp_range_end").val(parseFloat(bkdData.Cx.ProductTempUpper).toFixed(decimalTemperatureRoundTo));
						} else {
							$("#sc_temp_range_end").val(bkdData.Cx.ProductTempUpper);
						}
					} else {
						$("#sc_temp_range_end").val("");
					}
					
					if (typeof bkdData.Cx.ProductTempLower !== 'undefined' && bkdData.Cx.ProductTempLower != null) {
						if (!isNaN(parseFloat(bkdData.Cx.ProductTempLower).toFixed(decimalTemperatureRoundTo))) {
							$("#sc_temp_range_start").val(parseFloat(bkdData.Cx.ProductTempLower).toFixed(decimalTemperatureRoundTo));
						} else {
							$("#sc_temp_range_start").val(bkdData.Cx.ProductTempLower);
						}
					} else {
						$("#sc_temp_range_start").val("");
					}
					/*
					if (data.CargoInfo.VolumeUnit == 0) {
						$("#sc_temp_range_c").prop("checked", true);
					} else {
						$("#sc_temp_range_f").prop("checked", true);
					}
					*/
					if (typeof bkdData.Cx.StorageTempUpper !== 'undefined' && bkdData.Cx.StorageTempUpper != null) {
						if (!isNaN(parseFloat(bkdData.Cx.StorageTempUpper).toFixed(decimalTemperatureRoundTo))) {
							$("#sc_store_temp_end").val(parseFloat(bkdData.Cx.StorageTempUpper).toFixed(decimalTemperatureRoundTo));
						} else {
							$("#sc_store_temp_end").val(bkdData.Cx.StorageTempUpper);
						}
					} else {
						$("#sc_store_temp_end").val("");
					}
					if (typeof bkdData.Cx.StorageTempLower !== 'undefined' && bkdData.Cx.StorageTempLower != null) {
						if (!isNaN(parseFloat(bkdData.Cx.StorageTempLower).toFixed(decimalTemperatureRoundTo))) {
							$("#sc_store_temp_start").val(parseFloat(bkdData.Cx.StorageTempLower).toFixed(decimalTemperatureRoundTo));
						} else {
							$("#sc_store_temp_start").val(bkdData.Cx.StorageTempLower);
						}
					} else {
						$("#sc_store_temp_start").val("");
					}

					/*
					if (data.CargoInfo.VolumeUnit == 0) {
						$("#sc_store_temp_c").prop("checked", true);
					} else {
						$("#sc_store_temp_f").prop("checked", true);
					}
					*/
					if (typeof bkdData.Cx.EmergencyTele !== 'undefined' && bkdData.Cx.EmergencyTele != null) {
						$("#sc_emergency_tel").val(bkdData.Cx.EmergencyTele);
					} else {
						$("#sc_emergency_tel").val("");
					}
				}
				//End from old specialCargo.cshtml
			});
			
			$(id).on("getData", function(event, dataID) {
				console.log(dataID);
				
				var rtn = "";
				
				switch(dataID) {
					case "Airline":
						rtn = $("#cargoInfo_airline").val();
						break;
					case "AWBPrefix":
						rtn = $("#cargoInfo_awb_prefix").val();
						break;
					case "AWBSuffix":
						rtn = $("#cargoInfo_awb_suffix").val();
						break;
					case "Contact":
						rtn = $("#cargoInfo_contact").val();
						break;
					case "Pieces":
						rtn = $("#cargoInfo_pcs").val();
						break;
					case "Weight":
						rtn = $("#cargoInfo_weight").val();
						break;
					case "WeightUnit":
						rtn = $('input[name=weight-unit]:checked').val();
						break;
					case "Volume":
						rtn = $("#cargoInfo_vol").val();
						break;
					case "VolumeUnit":
						rtn = $('input[name=vol-unit]:checked').val();
						break;
					case "CargoDesc":
						var cargoDescType = $("#cargoInfo_good_des").val();
						var cargoDescDetail = $("#cargoInfo_good_detail").val();
						if (cargoDescType == "OTH") {
							rtn = cargoDescDetail;
						} else {
							rtn = cargoDescType;
						}
						break;
					case "PriorityType":
						rtn = $("#cargoInfo_priority").val();
						break;
					case "IsSpecialCargo":
						rtn = $('#cargoInfo_special_cargo').prop('checked');
						break;
					case "DealCode":
						rtn = $("#cargoInfo_deal_code").val();
						break;
					//From old specialCargo.cshtml
					case "SHC":
						rtn = $("#sc_special_code").val().toUpperCase();
						break;
					case "PTRFrom":
						rtn = $("#sc_temp_range_start").val();
						break;
					case "PTRTo":
						rtn = $("#sc_temp_range_end").val();
						break;
					case "PTRUnit":
						rtn = $('input[name=product-temp]:checked').val();
						break;	
					case "STRFrom":
						rtn = $("#sc_store_temp_start").val();
						break;
					case "STRTo":
						rtn = $("#sc_store_temp_end").val();
						break;
					case "STRUnit":
						rtn = $('input[name=store-temp]:checked').val();
						break;
					case "EmergencyTel":
						rtn = $('#sc_emergency_tel').val();
						break;
					//End from old specialCargo.cshtml
				}
				
				return rtn;
				
			});
			
			$(id).on("setData", function(event, dataID, value) {
				console.log(dataID);
				console.log(value);
				switch(dataID) {
					case "Airline":
						$("#cargoInfo_airline").val(value);
						break;
					case "AWBPrefix":
						$("#cargoInfo_awb_prefix").val(value);
						break;
					case "AWBSuffix":
						$("#cargoInfo_awb_suffix").val(value);
						break;
					case "Contact":
						$("#cargoInfo_contact").val(value);
						break;
					case "Pieces":
						$("#cargoInfo_pcs").val(value);
						break;
					case "Weight":
						if (!isNaN(parseFloat(value).toFixed(decimalWeightRoundTo))) {
							$("#cargoInfo_weight").val(parseFloat(value).toFixed(decimalWeightRoundTo));
						} else {
							$("#cargoInfo_weight").val(value);
						}
						break;
					case "WeightUnit":
						if (value == 0) {
							$("#cargoInfo_kg").prop("checked", true);
						} else {
							$("#cargoInfo_lb").prop("checked", true);
						}
						break;
					case "Volume":
						if (!isNaN(parseFloat(value).toFixed(decimalVolumeRoundToCX))) {
							$("#cargoInfo_vol").val(parseFloat(value).toFixed(decimalVolumeRoundToCX));
						} else {
							$("#cargoInfo_vol").val(value);
						}
						break;
					case "VolumeUnit":
						switch (value) {
						  case 1:
						    $("#cargoInfo_cf").prop("checked", true);
						    break;
						  case 2:
						    $("#cargoInfo_cc").prop("checked", true);
						    break;
						  case 3:
						    $("#cargoInfo_ci").prop("checked", true);
						    break;
						  default:
						  	$("#cargoInfo_mc").prop("checked", true);
						}
						break;
					case "CargoDesc":
						if ($("#cargoInfo_good_des option[value='"+value+"']").length > 0) {
							console.log(true);
							$("#cargoInfo_good_des").val(value);
							$("#cargoInfo_good_detail").hide();
						} else {
							console.log(true);
							$("#cargoInfo_good_des").val("OTH");
							$("#cargoInfo_good_detail").val(value);
							$("#cargoInfo_good_detail").show();
						}
						break;
					case "PriorityType":
						$("#cargoInfo_priority").val(value);
						break;
					case "IsSpecialCargo":
						if (value.toUpperCase() == 'TRUE') {
							$('#cargoInfo_special_cargo').bootstrapToggle('on');
						} else {
							$('#cargoInfo_special_cargo').bootstrapToggle('off');
						}
						break;
					case "DealCode":
						$("#cargoInfo_deal_code").val(value);
						break;
					//From old specialCargo.cshtml
					case "SHC":
						var shcList = [];
						var showTemp = false;
						var showShipperPrompt = false;
						shcList = value.split(",");
						$('#sc_special_code').tagsinput('removeAll');
						
						showTemp = checkSHCShowTemperatureInput(value);
						showShipperPrompt = checkSHCPromptShipperConsigneeInput(value);
						
						for (var i = 0; i < shcList.length; i++) {
							if (availableSHCTags.indexOf(shcList[i]) > -1) {
								$('#sc_special_code').tagsinput('add', shcList[i]);
							}			
						}
						
						if (showTemp) {
							$("#sc_temp_range_wrapper").show();
							$("#sc_storage_temp_range_wrapper").show();
							$("#sc_emergency_tel_wrapper").show();
							remarkDisableClearOSI();
						} else {
							$("#sc_temp_range_wrapper").hide();
							$("#sc_storage_temp_range_wrapper").hide();
							$("#sc_emergency_tel_wrapper").hide();
							remarkEnableOSI();
						}
						
						if (showShipperPrompt) {
							$("#sc_shipper_prompt").show();
						} else {
							$("#sc_shipper_prompt").hide();
						}
						break;
					case "PTRFrom":
						if (!isNaN(parseFloat(value).toFixed(decimalTemperatureRoundTo))) {
							$("#sc_temp_range_start").val(parseFloat(value).toFixed(decimalTemperatureRoundTo));
						} else {
							$("#sc_temp_range_start").val(value);
						}
						break;
					case "PTRTo":
						if (!isNaN(parseFloat(value).toFixed(decimalTemperatureRoundTo))) {
							$("#sc_temp_range_end").val(parseFloat(value).toFixed(decimalTemperatureRoundTo));
						} else {
							$("#sc_temp_range_end").val(value);
						}
						break;
					case "PTRUnit":
						if (value == 0) {
							$("#sc_temp_range_c").prop("checked", true);
						} else {
							$("#sc_temp_range_f").prop("checked", true);
						}
						break;	
					case "STRFrom":
						if (!isNaN(parseFloat(value).toFixed(decimalTemperatureRoundTo))) {
							$("#sc_store_temp_start").val(parseFloat(value).toFixed(decimalTemperatureRoundTo));
						} else {
							$("#sc_store_temp_start").val(value);
						}
						break;
					case "STRTo":
						if (!isNaN(parseFloat(value).toFixed(decimalTemperatureRoundTo))) {
							$("#sc_store_temp_end").val(parseFloat(value).toFixed(decimalTemperatureRoundTo));
						} else {
							$("#sc_store_temp_end").val(value);
						}
						break;
					case "STRUnit":
						if (value == 0) {
							$("#sc_store_temp_c").prop("checked", true);
						} else {
							$("#sc_store_temp_f").prop("checked", true);
						}
						break;
					case "EmergencyTel":
						$('#sc_emergency_tel').val(value);
						break;
					//End from old speicalCargo.cshtml
				}
				
			});
			
			$(id).on("getTemplateData", function(event) {
				
				var airline = $("#cargoInfo_airline").val();
				var awbPrefix = $("#cargoInfo_awb_prefix").val().toString();
				var awbSuffix = $("#cargoInfo_awb_suffix").val().toString();
				var cargoContact = $("#cargoInfo_contact").val();
				var cargoPcs = $("#cargoInfo_pcs").val().toString();
				var cargoWeight = $("#cargoInfo_weight").val().toString();
				var cargoWeightUnit = $('input[name=weight-unit]:checked').val();
				var cargoVolume = $("#cargoInfo_vol").val().toString();
				var cargoVolumeUnit = $('input[name=vol-unit]:checked').val();
				var cargoDescType = $("#cargoInfo_good_des").val();
				var cargoDescDetail = $("#cargoInfo_good_detail").val();
				var cargoDesc;
				if (cargoDescType == "OTH") {
					cargoDesc = cargoDescDetail;
				} else {
					cargoDesc = cargoDescType;
				}
				var cargoPT = $("#cargoInfo_priority").val();
				var spCargo = $("#cargoInfo_special_cargo").is(':checked');
				var dealCode = $("#cargoInfo_deal_code").val();
				var revision = $("#cargoInfo_revision").val();
			
				var arr = [];
				var obj = new Object();
				obj.ModuleID = blockID;
				obj.DataID = "Airline";
				obj.Content = airline;
				arr.push(obj);
				
				obj = new Object();
				obj.ModuleID = blockID;
				obj.DataID = "Pieces";
				obj.Content = cargoPcs;
				arr.push(obj);
				
				obj = new Object();
				obj.ModuleID = blockID;
				obj.DataID = "Weight";
				obj.Content = cargoWeight;
				arr.push(obj);
				
				obj = new Object();
				obj.ModuleID = blockID;
				obj.DataID = "WeightUnit";
				obj.Content = cargoWeightUnit;
				arr.push(obj);
				
				obj = new Object();
				obj.ModuleID = blockID;
				obj.DataID = "Volume";
				obj.Content = cargoVolume;
				arr.push(obj);
				
				obj = new Object();
				obj.ModuleID = blockID;
				obj.DataID = "VolumeUnit";
				obj.Content = cargoVolumeUnit;
				arr.push(obj);
				
				obj = new Object();
				obj.ModuleID = blockID;
				obj.DataID = "CargoDesc";
				obj.Content = cargoDesc;
				arr.push(obj);
				
				obj = new Object();
				obj.ModuleID = blockID;
				obj.DataID = "PriorityType";
				obj.Content = cargoPT;
				arr.push(obj);
				
				obj = new Object();
				obj.ModuleID = blockID;
				obj.DataID = "IsSpecialCargo";
				obj.Content = spCargo;
				arr.push(obj);

				obj = new Object();
				obj.ModuleID = blockID;
				obj.DataID = "DealCode";
				obj.Content = dealCode;
				arr.push(obj);

				//From old specialCargo.cshtml
				var shc = $("#sc_special_code").val().toUpperCase();
				var tempStart = $("#sc_temp_range_start").val();
				var tempEnd = $("#sc_temp_range_end").val();
				var tempUnit = $('input[name=product-temp]:checked').val();
				var storeTempStart = $("#sc_store_temp_start").val();
				var storeTempEnd = $("#sc_store_temp_end").val();
				var storeTempUnit = $('input[name=store-temp]:checked').val();
				var emergencyTel = $('#sc_emergency_tel').val();
			
				obj.ModuleID = blockID;
				obj.DataID = "SHC";
				obj.Content = shc;
				arr.push(obj);
				
				obj = new Object();
				obj.ModuleID = blockID;
				obj.DataID = "PTRFrom";
				obj.Content = tempStart;
				arr.push(obj);
				
				obj = new Object();
				obj.ModuleID = blockID;
				obj.DataID = "PTRTo";
				obj.Content = tempEnd;
				arr.push(obj);
				
				obj = new Object();
				obj.ModuleID = blockID;
				obj.DataID = "PTRUnit";
				obj.Content = tempUnit;
				arr.push(obj);
				
				obj = new Object();
				obj.ModuleID = blockID;
				obj.DataID = "STRFrom";
				obj.Content = storeTempStart;
				arr.push(obj);
				
				obj = new Object();
				obj.ModuleID = blockID;
				obj.DataID = "STRTo";
				obj.Content = storeTempEnd;
				arr.push(obj);
				
				obj = new Object();
				obj.ModuleID = blockID;
				obj.DataID = "STRUnit";
				obj.Content = storeTempUnit;
				arr.push(obj);
				
				obj = new Object();
				obj.ModuleID = blockID;
				obj.DataID = "EmergencyTel";
				obj.Content = emergencyTel;
				arr.push(obj);
				//End from old speicalCargo.cshtml
				
				return {
					"CargoInfo" : {
						"TDataList" : arr,
					}
				}
				
			});

			$(id).on("refreshPlaceHolder", function(event) {
				$('#cargoInfo_special_cargo').attr("data-on", i18next.t("LHBooking.Yes"));
				$('#cargoInfo_special_cargo').siblings().find('.toggle-on').html(i18next.t("LHBooking.Yes"));
				$('#cargoInfo_special_cargo').attr("data-off", i18next.t("LHBooking.No"));
				$('#cargoInfo_special_cargo').siblings().find('.toggle-off').html(i18next.t("LHBooking.No"));

				$('#cargoInfo_good_detail').attr("placeholder", i18next.t("createBooking.Details"));
			});

			$(id).on("pasteAirline", function(event, airline) {
				$('#cargoInfo_airline').selectpicker('val', airline);
			});
			
			/*
			$(id).on("bindAWBStockLookUpResult", function() {
				console.log("bindAWBStockLookUpResult start");
				
				$("#cargoInfo_awb_result").empty();
				cargoInfoResetLookupFilterBtn();

				localStorage.setItem("AWBStockPageNum", 1);
				
				var lt = [];
				if (localStorage.getItem("cargoInfo_awbstock_list") != null) {
					lt = JSON.parse(localStorage.getItem("cargoInfo_awbstock_list"));
					$("#cargoInfo_awbstock_count").val(lt.length);
					$("#cargoInfo_lookup_btn_select_wrapper").show()
				} else {
					$("#cargoInfo_awbstock_count").val(0);
					$("#cargoInfo_lookup_btn_select_wrapper").hide()
				}
				
				var j = 1;
				for (var i = 0; i < lt.length - 1; i = i + elementPerPage) {
					console.log(lt[i].AWBSuffix);
					var page = j;
					var itemHtml = "<li class='awbstock_extra_row' onclick='filterAWBStockResult("+page+")'>from "+lt[i].AWBPrefix+"-"+lt[i].AWBSuffix.substring(0, 4)+" "+lt[i].AWBSuffix.substring(4, 8)+"</li>"
					$("#cargoInfo_awbstock_range").append(itemHtml);
					j++;
				}
				
				if (lt.length == 0) {
					$("#cargoInfo_show_result").text("No record found");
					$("#cargoInfo_awbstock_load_more").hide();
				} else if (lt.length > elementPerPage) {
					$("#cargoInfo_awbstock_load_more").show();
					$("#cargoInfo_show_result").text(elementPerPage +" of "+lt.length+" results");
				} else {
					$("#cargoInfo_awbstock_load_more").hide();
					$("#cargoInfo_show_result").text(lt.length +" of "+lt.length+" results");
				}
				
				localStorage.setItem("cargoInfo_awbstock_list_staging", JSON.stringify(lt));
				
				content = getAWBStockResultSlot(1);
				
				$("#cargoInfo_awb_result").append(content);
				
			});
			*/
            $('#cargoInfo_airline').on('change', function () {
				console.log( this.value );
				localStorage.setItem("currentAirline", this.value);
				if (localStorage.getItem("getAWBSuccess") != 1) {
					$("#cargoInfo_awb_prefix").val(bkdAirlineDefaultAWBPrefix(this.value));
				}
				getAirlineTemplate(this.value, AfterTemplateChange.NoAction);

				var prefix = $('#cargoInfo_awb_prefix').val();
				var code = $('#cargoInfo_airline').val();
				if($('#cargoInfo_awb_prefix').val().length == 3){
					handleAirlineCodeAndPreffixErr();
				}
			})
			
			$('#cargoInfo_good_des').on('change', function() {
				console.log( this.value );
				if ($(this).val() == "OTH") {
					$("#cargoInfo_good_detail").show();
				} else {
					$("#cargoInfo_good_detail").hide();
				}
			})

			$('#cargoInfo_awb_prefix').on('change', function() {
				if($(this).val().length == 3){
					handleAirlineCodeAndPreffixErr();
				}
			})

			$(".cargoinfo_int_input").keypress(function(e) {
				console.log(e.which);
				if(e.which >= 48 && e.which <= 57 ){
				} else {
					return false;
				}
			});
			
			$(".cargoinfo_dec_input, .cargoinfo_dec_input_weight, .cargoinfo_dec_input_volume").keypress(function(e) {
				console.log(e.which);
				if((e.which >= 48 && e.which <= 57) || e.which == 46 ){
				} else {
					return false;
				}
			});
			
			$(".cargoinfo_dec_input").blur(function(e) {
				if ($(this).val() != "") {
					$(this).val(FormatDecInput($(this).val(), decimalRoundTo));
				}
			});
			
			$(".cargoinfo_dec_input_volume").blur(function(e) {
				if ($(this).val() != "") {
					$(this).val(FormatDecInput($(this).val(), decimalVolumeRoundToCX));
				}
			});
			
			$(".cargoinfo_dec_input_weight").blur(function(e) {
				if ($(this).val() != "") {
					$(this).val(FormatDecInput($(this).val(), decimalWeightRoundTo));
				}
			});
			/*
			$("#cargoInfo_awb_prefix").keyup(function(e) {
				//console.log($(this).val() + String.fromCharCode(e.which));
				//console.log($(this).val());
				if($(this).val().length <= 2 ){
				} else {
					var currentValue = $(this).val();
					$(this).val(currentValue.substring(0, 3));
					//return false;
				}
			});
			
			$("#cargoInfo_awb_suffix").keyup(function(e) {
				if($(this).val().length <= 7){
				} else {
					var currentValue = $(this).val();
					$(this).val(currentValue.substring(0, 8));
					//return false;
				}
			});
			*/

			$("#cargoInfo_awb_prefix").focusout(function(e) {
				airWaybillOnFocusOut();
				cargoInfoCheckAWBPrefix();
			});
			
            $("#cargoInfo_awb_suffix").keyup(function (e) {
            //$("#cargoInfo_awb_suffix").keyup(function(e) {

                if ($("#cargoInfo_awb_suffix").val().length == 8)
                {
				airWaybillOnFocusOut();
                }
			});

			$('#cargoInfo_deal_code').keypress(function(e) {
				console.log(e.which);
				if ((e.which >= 65 && e.which <= 90) || (e.which >= 97 && e.which <= 122) || (e.which >= 48 && e.which <= 57)) {

				} else {
					return false;
				}
			});

			$('#cargoInfo_deal_code').blur(function(e) {
				$(this).val($(this).val().toUpperCase());
			});

			$('input').on('focusin', function(){
				$(this).data('val', $(this).val());
			});

			$('#cargoInfo_deal_code').change(function(e) {
				if(showDealCodeWarning && !dealCodeWarningdisplayed){
					var prev = $(this).data('val');
					var current = $(this).val();
					var $this = this;
					if(prev != current) {
						DialogManager.confirm(undefined, i18next.t("cargoInfo.ConfirmToChangeDealCodeMsg"),
							function() {

							},
							function() {
								$($this).val(prev);
							}
						);
						dealCodeWarningdisplayed = true;
					}
				}
			});

			//From old specialCargo.cshtml
			$('#sc_special_code').on('beforeItemAdd', function(event) {
				// event.item: contains the item
				// event.cancel: set to true to prevent the item getting added
				var currentValue = $("#sc_special_code").val();
				var arr = currentValue.split(",");
				var shcInput = event.item.substring(0, 3).toUpperCase();
				if (currentValue.trim() != "" && arr.length >= shcLengthLimit) {
					event.cancel = true;
				//} else if (availableSHCTags.indexOf(event.item.toUpperCase()) > -1) {
				} else if (availableSHCTags.indexOf(shcInput) > -1) {
					if (event.item != event.item.toUpperCase() || event.item != shcInput) {
						event.cancel = true;
						$(this).tagsinput('add', shcInput);
						//$(this).tagsinput('add', event.item.substring(0, 3).toUpperCase());
					}
				} else if (availableSHCTags.indexOf(event.item.toUpperCase()) == -1) {
					event.cancel = true;
				} else {
					//event.cancel = true;
					//$(this).tagsinput('add', event.item.toUpperCase());
				}
			});
			
			
			$('#sc_special_code').on('itemAdded', function(event) {
				// event.item: contains the item
				console.log(event.item);
				var showTemp = false;
				var showShipperPrompt = false;
                var showNGTT = false;
				var currentValue = $("#sc_special_code").val();
				var arr = currentValue.split(",");
				showTemp = checkSHCShowTemperatureInput(currentValue);
				showShipperPrompt = checkSHCPromptShipperConsigneeInput(currentValue);
                showNGTT = CheckNGTTExpand(true);
				
				if (showTemp) {
					$("#sc_temp_range_wrapper").show();
					$("#sc_storage_temp_range_wrapper").show();
					$("#sc_emergency_tel_wrapper").show();
					remarkDisableClearOSI();
				}
				
				if (showShipperPrompt) {
					$("#sc_shipper_prompt").show();
				}
				
				if (showNGTT)
                {
                    $("#bkd_def_ngtt").show();
				}

                if (event.item == 'ACT') {
                    $('#ngtt_ctTemperature_toggle').bootstrapToggle('on');
                    $('#ngtt_ctTemperature_toggle').bootstrapToggle('disable');
                }
			});
			
			$('#sc_special_code').on('itemRemoved', function(event) {
				// event.item: contains the item
				console.log(event.item);
				var showTemp = false;
				var showShipperPrompt = false;
                var showNGTT = false;
				var currentValue = $("#sc_special_code").val();
				var arr = currentValue.split(",");
				showTemp = checkSHCShowTemperatureInput(currentValue);
				showShipperPrompt = checkSHCPromptShipperConsigneeInput(currentValue);
                showNGTT = CheckNGTTExpand(true);
				
				if (showTemp) {
					$("#sc_temp_range_wrapper").show();
					$("#sc_storage_temp_range_wrapper").show();
					$("#sc_emergency_tel_wrapper").show();
					remarkDisableClearOSI();
				} else {
					$("#sc_temp_range_wrapper").hide();
					$("#sc_storage_temp_range_wrapper").hide();
					$("#sc_emergency_tel_wrapper").hide();
					remarkEnableOSI();
				}
				
				if (showShipperPrompt) {
					$("#sc_shipper_prompt").show();
				} else {
					$("#sc_shipper_prompt").hide();
				}
				
				if (!showNGTT)
                {
                    $("#bkd_def_ngtt").hide();
				}

                if (event.item == 'ACT') {
                    $('#ngtt_ctTemperature_toggle').bootstrapToggle('enable');
                    $('#ngtt_ctTemperature_toggle').bootstrapToggle('off');
                }
			});

			setTimeout(function () {
				$(".SHCodeAC input.form-control.autocomplete.ui-autocomplete-input").keypress(function(e) {
					// event.item: contains the item
					// event.cancel: set to true to prevent the item getting added
					console.log(e.which);
					
					var currentValue = $("#sc_special_code").val();
					var arr = currentValue.split(",");
					if (currentValue.trim() != "" && arr.length >= shcLengthLimit) {
						return false;
					}
					
				});
			}, 2000);

			$(".sc_dec_input").keypress(function(e) {
				console.log(e.which);
				if((e.which >= 48 && e.which <= 57) || e.which == 46 || e.which == 45 ){
				} else {
					return false;
				}
			});
			
			$(".sc_dec_input").blur(function(e) {
				if ($(this).val() != "") {
					$(this).val(FormatDecInput($(this).val(), decimalTemperatureRoundTo));
				}
			});
			
			$(".sc_int_input").keypress(function(e) {
				console.log(e.which);
				if(e.which >= 48 && e.which <= 57 ){
				} else {
					return false;
				}
			});
			//End from old specialCargo.cshtml
			
			//dg mask
			
			$(".filterPanelBtn").click(function (e) {
				e.preventDefault();
				if ($("#dgmask_filter_arrow").attr('class') == "filter_arrow_open") {
					closeDGMaskFilterPanel();
				} else {
					openDGMaskFilterPanel();
				}

			});
			
			function openDGMaskFilterPanel() {
				$("#dgmask_filter_arrow").removeClass("filter_arrow_close").addClass("filter_arrow_open");
				$("#dgMaskPanel").slideDown();
			}

			function closeDGMaskFilterPanel() {
				$("#dgmask_filter_arrow").removeClass("filter_arrow_open").addClass("filter_arrow_close");
				$("#dgMaskPanel").slideUp();
			}
			
			function resetDGMaskFilterPanel() {
				$("#dgmask_filter_arrow").removeClass("filter_arrow_open").addClass("filter_arrow_close");
				$("#dgMaskPanel").hide();
			}
			
			$('#cargoInfo_dg_special_code').on('beforeItemAdd', function(event) {
				// event.item: contains the item
				// event.cancel: set to true to prevent the item getting added
				var currentValue = $("#cargoInfo_dg_special_code").val();
				var arr = currentValue.split(",");
				var shcInput = event.item.substring(0, 3).toUpperCase();
				if (currentValue.trim() != "" && arr.length >= shcLengthLimitDG) {
					event.cancel = true;
				//} else if (availableSHCTags.indexOf(event.item.toUpperCase()) > -1) {
				} else if (availableSHCTags.indexOf(shcInput) > -1) {
					if (event.item != event.item.toUpperCase() || event.item != shcInput) {
						event.cancel = true;
						$(this).tagsinput('add', shcInput);
						//$(this).tagsinput('add', event.item.substring(0, 3).toUpperCase());
					}
				} else if (availableSHCTags.indexOf(event.item.toUpperCase()) == -1) {
					event.cancel = true;
				} else {
					//event.cancel = true;
					//$(this).tagsinput('add', event.item.toUpperCase());
				}
			});
			
			setTimeout(function () {
				$(".SHCodeDG input.form-control.autocomplete.ui-autocomplete-input").keypress(function(e) {
					// event.item: contains the item
					// event.cancel: set to true to prevent the item getting added
					console.log(e.which);
					
					var currentValue = $("#cargoInfo_dg_special_code").val();
					var arr = currentValue.split(",");
					if (currentValue.trim() != "" && arr.length >= shcLengthLimitDG) {
						return false;
					}
					
				});
			}, 2000);
			
		});

		function airWaybillOnFocusOut() {
            console.time("getAWB"); //timeend at singleBooking.cshtml line 749
			if($("#cargoInfo_awb_prefix").val().length == 3 && $("#cargoInfo_awb_suffix").val().length == 8){
					
				$("#cargoInfo_awb_prefix ~ .error_or_msg").hide();
				$("#cargoInfo_awb_prefix").parent().removeClass("error_or");
			
				var awbPrefix = $("#cargoInfo_awb_prefix").val();
				var awbSuffix = $("#cargoInfo_awb_suffix").val();
				var airline = bkdAWBPrefixToAirline(awbPrefix);
				console.log("bkdAWBPrefixToAirline: " + airline);

				if(airline){
					if (!_.includes(airlineList, airline)) {
                       airline = $("#bkd_def_cargoinfo").triggerHandler("getData", 'Airline');
					}
					
					if(!airline){
						alert("Please select an airline first");
						return;
					}

					if (!validateAWBInputField(awbSuffix)) {
						//auto correct suffix
						awbSuffix = awbSuffix.substring(0,7) + awbSuffix.substring(0,7) % 7;
					}

					if (localStorage.getItem("loadAWBno") != airline + awbPrefix + awbSuffix) {
						localStorage.setItem("GetBookingError", 0);
						localStorage.setItem("getAWBSuccess", 0);
						//$('#cargoInfo_airline').selectpicker('val', airline);
						switch (wayToRetrieve) {
							case 0:
								getAWB(airline, awbPrefix, awbSuffix);
								break;
							case 1:
                                startAction(false, i18next.t("common.Loading"), true);
                                setTimeout(function () { getAWBAPI(airline, awbPrefix, awbSuffix) }, 1); //Booking API 
								break;
							default:
                                getAWB(airline, awbPrefix, awbSuffix);
                                break;
                        }


						localStorage.setItem("loadAWBno", airline + awbPrefix + awbSuffix);
					}
				}
				else{
					$("#cargoInfo_awb_prefix ~ .error_or_msg").show();
					$("#cargoInfo_awb_prefix").parent().addClass("error_or");
					localStorage.setItem("getAWBSuccess", 0);
					localStorage.setItem("loadAWBno", airline + awbPrefix + awbSuffix);
				}
			}
		}
		
		function validateAWBInputField(awbSuffix) {
			var isValid = true;
			
			if (awbSuffix.length == 8) {
				var awbSuffixC = awbSuffix.substring(0, 7);
				var awbCheckDigitC = awbSuffix.substring(7, 8);
				if (awbSuffixC % 7 != awbCheckDigitC) {
					isValid = false;
				}
			} else {
				isValid = false;
			}
			
			return isValid;
		}
		
		function setCargoInfoAirlineOption() {
			console.time("setCargoInfoAirlineOption");
			if (typeof airlineList !== 'undefined' && airlineList != null) {
				$('#cargoInfo_airline option').remove();
				//$('#cargoInfo_airline').append('<option data-tokens="">&nbsp;</option>');
				for (var i = 0; i < airlineList.length; i++) {
					$('#cargoInfo_airline').append('<option data-tokens="'+airlineList[i]+'">'+airlineList[i]+'</option>');
				}
				$('#cargoInfo_airline').selectpicker('refresh');
			}
            console.timeEnd("setCargoInfoAirlineOption");
		}
		
		function disableCargoInfoAWBInput() {
			console.log("CargoInfo AWB input field locked");
			$('#cargoInfo_awb_prefix').prop('readonly', true);
			$('#cargoInfo_awb_suffix').prop('readonly', true);
		}
		
		function enableCargoInfoAWBInput() {
			console.log("CargoInfo AWB input field unlocked");
			$('#cargoInfo_awb_prefix').prop('readonly', false);
			$('#cargoInfo_awb_suffix').prop('readonly', false);
		}
		
		// check priority type option
		function cargoInfoCheckUserCity() {
			//alter priority type option if user city is hk
            if (localStorage.getItem("userCity") != null) {

                var vipPTList = "";
                var isVipPT = false;
                if (localStorage.getItem("hasEzyCargoVipPT") != null) {
                    isVipPT = localStorage.getItem("hasEzyCargoVipPT") == "true" ? true : false;
                }

                if (localStorage.getItem("userCity") == "HKG" && !isVipPT) {
                    $("#cargoInfo_priority option[value='PR2']").remove();
                }

                if (localStorage.getItem("userCity") == "HKG") {
                    $("#cargoInfo_priority option[value='PR4']").remove();
                    $("#cargoInfo_priority option[value='PRS']").remove();
                }

                if (validateJPCity(localStorage.getItem("userCity"))) {
                    $("#cargoInfo_dgmask_wrapper").show();
                } else {
                    $("#cargoInfo_dgmask_wrapper").hide();
                }
            }
		}
		
		function cargoInfoCheckAWBPrefix() {
			if ($("#cargoInfo_airline").val() == "CX" && $("#cargoInfo_awb_prefix").val() == "171") {
				$("#cargoInfo_priority option[value='PR2']").remove();
				$("#cargoInfo_priority option[value='PR4']").remove();
				$("#cargoInfo_priority option[value='PRS']").remove();
				$("#cargoInfo_priority option[value='PR1']").remove();
			} else {
				var currentOpt = $('#cargoInfo_priority').val();
				$('#cargoInfo_priority option').remove();
				if (localStorage.getItem("CXPriorityType") != null) {
					var ptList = JSON.parse(localStorage.getItem("CXPriorityType"));
					if (typeof ptList !== 'undefined' && ptList != null) {
						for(var i = 0; i < ptList.length; i++) {
							$('#cargoInfo_priority').append('<option value="'+ptList[i].Value+'">'+ptList[i].Text+'</option>');
						}
					}
				}
				
				if(_.find($('#cargoInfo_priority option'), function(o) { return o.value == currentOpt; })){
					$('#cargoInfo_priority').val(currentOpt);
				}
			}
			
			cargoInfoCheckUserCity();
		}
		
		$('#cargoInfo_special_cargo').change(function(){
			console.log("cargoInfo_special_cargo on change");
			if (this.checked) {
				if (typeof disableReserveSpaceCB === 'function') {
					disableReserveSpaceCB();
				}
			} else {
				if (typeof enableReserveSpaceCB === 'function') {
					enableReserveSpaceCB();
				}
			}
		});

		function onClickAwbLookup() {
			AwbLookupDialog.open({
        		isMulti: false,
        		airline: $('#cargoInfo_airline').val(),
                confirm: function () {
                	var awb = AwbLookupDialog.getSelectedAwbList();
                	if(awb.length > 0){
	                    $('#cargoInfo_awb_prefix').val(awb[0].prefix);
						$('#cargoInfo_awb_suffix').val(awb[0].suffix);

						setTimeout(function(){
							airWaybillOnFocusOut();
						}, 200);
            		}
                }
        	});
		}

		function handleAirlineCodeAndPreffixErr() {
			var prefix = $('#cargoInfo_awb_prefix').val();
			var code = $('#cargoInfo_airline').val();
			
			var msg = i18next.t("cargoInfo.AirlineCodeNotMatch");

			if(prefix && code && !bkdCheckAirlineCodeAndPrefix(code, prefix)){
				Ctrl.warnings.otherWarnings.add(msg);
			} else {
				Ctrl.warnings.otherWarnings.drop(msg);
			}
		}
		
		function weightUnitOnClick(val){
			$("#bkd_def_flight").triggerHandler("handleWeightUnitChange", val);
		}

		function volUnitOnClick(val){
			$("#bkd_def_flight").triggerHandler("handleVolUnitChange", val);
		}
	</script>
</div><div id="bkd_def_routing" class="bkd_block">
    <h3 class="col-xs-12" data-i18n="routing.Routing">Routing</h3>
    <div class="head_hr"></div>
    <div class="consign_info">
        <div class="route_input_wrapper">
            <div class="route_input_row cnt_inline" data-rowid="1">
                <div class="cnt_inline bu_txt chk_location">
                    <label for="routing_route_from_1" data-i18n="routing.From">From</label>
                    <input type="text" value="" placeholder="Port Code" id="routing_route_from_1" class="port_query routing_route" autocomplete="off">
                    <div class="error_or_msg" style="display: none;" data-i18n="routing.InvalidOrigin">Invalid Origin</div>
                </div>
                <div class="cnt_inline">
                	<div class="cnt_inline chk_to"></div>
	                <div class="cnt_inline bu_txt chk_location">
	                    <label for="routing_route_to_1" data-i18n="routing.To">To</label>
	                    <input type="text" value="" placeholder="Port Code" id="routing_route_to_1" class="port_query routing_route" autocomplete="off">
	                    <div class="error_or_msg" style="display: none;" data-i18n="routing.InvalidPort">Invalid Port</div>
	                </div>
	                <div class="cnt_inline bu_txt w48">
	                    <label for="routing_route_airline_1" data-i18n="routing.Airline">Airline</label>
	                    <input type="text" value="" id="routing_route_airline_1" class="flight_num_input">
	                    <div class="error_or_msg" style="display: none;" data-i18n="routing.InvalidAirline">Invalid Airline</div>
	                </div>
                </div>
            </div>
        
    <div class="route_input_row cnt_inline extra_row" data-rowid="2" style="height: 80px;">
        <div class="cnt_inline chk_to"></div>
        <div class="cnt_inline bu_txt chk_location">
            <label for="routing_route_to_2" data-i18n="routing.To">To</label>
            <input type="text" value="" placeholder="Port Code" id="routing_route_to_2" class="port_query routing_route" autocomplete="off">
            <div class="error_or_msg" style="display: none;" data-i18n="routing.InvalidPort">Invalid Port</div>
        </div>
        <div class="cnt_inline bu_txt w48">
            <label for="routing_route_airline_2" data-i18n="routing.Airline">Airline</label>
            <input type="text" value="" id="routing_route_airline_2" class="flight_num_input">
            <div class="error_or_msg" style="display: none;" data-i18n="routing.InvalidAirline">Invalid Airline</div>
        </div>
    </div>

    <div class="route_input_row cnt_inline extra_row" data-rowid="3" style="height: 80px;">
        <div class="cnt_inline chk_to"></div>
        <div class="cnt_inline bu_txt chk_location">
            <label for="routing_route_to_3" data-i18n="routing.To">To</label>
            <input type="text" value="" placeholder="Port Code" id="routing_route_to_3" class="port_query routing_route" autocomplete="off">
            <div class="error_or_msg" style="display: none;" data-i18n="routing.InvalidPort">Invalid Port</div>
        </div>
        <div class="cnt_inline bu_txt w48">
            <label for="routing_route_airline_3" data-i18n="routing.Airline">Airline</label>
            <input type="text" value="" id="routing_route_airline_3" class="flight_num_input">
            <div class="error_or_msg" style="display: none;" data-i18n="routing.InvalidAirline">Invalid Airline</div>
        </div>
    </div>

    <div class="route_input_row cnt_inline extra_row" data-rowid="4" style="height: 80px;">
        <div class="cnt_inline chk_to"></div>
        <div class="cnt_inline bu_txt chk_location">
            <label for="routing_route_to_4" data-i18n="routing.To">To</label>
            <input type="text" value="" placeholder="Port Code" id="routing_route_to_4" class="port_query routing_route" autocomplete="off">
            <div class="error_or_msg" style="display: none;" data-i18n="routing.InvalidPort">Invalid Port</div>
        </div>
        <div class="cnt_inline bu_txt w48">
            <label for="routing_route_airline_4" data-i18n="routing.Airline">Airline</label>
            <input type="text" value="" id="routing_route_airline_4" class="flight_num_input">
            <div class="error_or_msg" style="display: none;" data-i18n="routing.InvalidAirline">Invalid Airline</div>
        </div>
    </div>
</div>
        <div class="act_bu act_add_col add_dest disabled" id="btnAddDest">
            <span data-i18n="routing.AddDest" tabindex="0">Add destination</span>
        </div>
    </div>
</div>

<script id="routing_input_row_temp" type="text/x-template">
    <div class="route_input_row cnt_inline extra_row" data-rowid="%ID%" style="height: 80px;">
        <div class="cnt_inline chk_to"></div>
        <div class="cnt_inline bu_txt chk_location">
            <label for="routing_route_to_%ID%" data-i18n="routing.To">To</label>
            <input type="text" value="" placeholder="Port Code" id="routing_route_to_%ID%" class="port_query routing_route">
            <div class="error_or_msg" style="display: none;" data-i18n="routing.InvalidPort">Invalid Port</div>
        </div>
        <div class="cnt_inline bu_txt w48">
            <label for="routing_route_airline_%ID%" data-i18n="routing.Airline">Airline</label>
            <input type="text" value="" id="routing_route_airline_%ID%" class="flight_num_input">
            <div class="error_or_msg" style="display: none;" data-i18n="routing.InvalidAirline">Invalid Airline</div>
        </div>
    </div>
</script>

<script>
	$(function() {
		var id = "#bkd_def_routing";
		var blockID = "bkd_def_routing";
		
		var numberOfExtraRows = $(".route_input_row.cnt_inline extra_row").length;
		var numberOfRowsTotal = numberOfExtraRows + 1;
		console.log("number of rows: " + numberOfRowsTotal);
		for(i=numberOfRowsTotal; i<4; i++){
			AddDestinationInput();
		}
		
		$(id).on("clear", function(event) {
			//console.log(data);

			//debugger;
			$("#routing_route_from_1").val("");
			$("#routing_route_to_1").val("");
			$("#routing_route_airline_1").val("");
			$("#routing_route_from_1 ~ .error_or_msg").hide();
			$("#routing_route_to_1 ~ .error_or_msg").hide();
			$("#routing_route_airline_1 ~ .error_or_msg").hide();
			$(".route_input_row.extra_row").remove();

			$(id+" .error_or_msg").hide();
			$(id+" .error_or").removeClass("error_or");

		});

		$(id).on("init", function(event, data) {
			console.log(data);
			var currentRowID;
			regPortQueryV2();
			//debugger;

			if (typeof data.RouteInfo !== 'undefined' && data.RouteInfo != null) {
				$("#routing_route_from_1").val(data.RouteInfo.RouteFrom);

				for (var i = 0; i < data.RouteInfo.RouteTo.length; i++) {
					currentRowID = i + 1;

					if (i > 0) {
						AddDestinationInput(currentRowID, i, function(cID, dataRow){
							$("#routing_route_to_" + cID).val(data.RouteInfo.RouteTo[dataRow].RouteTo);
							$("#routing_route_airline_" + cID).val(data.RouteInfo.RouteTo[dataRow].Airline);
						});
					} else {
						$("#routing_route_to_" + currentRowID).val(data.RouteInfo.RouteTo[i].RouteTo);
						$("#routing_route_airline_" + currentRowID).val(data.RouteInfo.RouteTo[i].Airline);
					}
				}
			}

		});

		$(id).on("validate", function() {
			$("#routing_route_from_1 ~ .error_or_msg").text(i18next.t("routing.InvalidOrigin"));																					
			var routeFrom = $("#routing_route_from_1").val();
			var isValid = true;
			if (routeFrom == "" || (routeFrom != "" && !checkPort(routeFrom))) {
				$("#routing_route_from_1 ~ .error_or_msg").show();
				$("#routing_route_from_1").parent().addClass("error_or");
				isValid = false;
			} else {
				$("#routing_route_from_1 ~ .error_or_msg").hide();
				$("#routing_route_from_1").parent().removeClass("error_or");
			}

			$("div[class^='route_input_row']").each(function (i, el) {
				var rowid = $(this).attr("data-rowid");
				var routeTo = $("#routing_route_to_"+rowid).val();
				var airline = $("#routing_route_airline_"+rowid).val();
				$("#routing_route_to_" + rowid + " ~ .error_or_msg").text(i18next.t("routing.InvalidPort"));																							

				if ((rowid == "1" && routeTo == "") || (routeTo != "" && !checkPort(routeTo))) {
					$("#routing_route_to_"+rowid+" ~ .error_or_msg").show();
					$("#routing_route_to_"+rowid).parent().addClass("error_or");
					isValid = false;
				} else {
					$("#routing_route_to_"+rowid+" ~ .error_or_msg").hide();
					$("#routing_route_to_"+rowid).parent().removeClass("error_or");
				}

				if ((rowid == "1" && airline == "") || (airline != "" && airline.length != 2)) {
					$("#routing_route_airline_"+rowid+" ~ .error_or_msg").show();
					$("#routing_route_airline_"+rowid).parent().addClass("error_or");
					isValid = false;
				} else {
					$("#routing_route_airline_"+rowid+" ~ .error_or_msg").hide();
					$("#routing_route_airline_"+rowid).parent().removeClass("error_or");
				}

				if (isValid) {
					if (routeTo != "" && airline == "") {
						$("#routing_route_airline_"+rowid+" ~ .error_or_msg").show();
						$("#routing_route_airline_"+rowid).parent().addClass("error_or");
						isValid = false;
					} else {
						$("#routing_route_to_"+rowid+" ~ .error_or_msg").hide();
						$("#routing_route_to_"+rowid).parent().removeClass("error_or");
					}
				}

				if (isValid) {
					if (routeTo == "" && airline != "") {
						$("#routing_route_to_"+rowid+" ~ .error_or_msg").show();
						$("#routing_route_to_"+rowid).parent().addClass("error_or");
						isValid = false;
					} else {
						$("#routing_route_airline_"+rowid+" ~ .error_or_msg").hide();
						$("#routing_route_airline_"+rowid).parent().removeClass("error_or");
					}
				}

			});

			return isValid;
		});

		$(id).on("submit", function() {

			var routeFrom = $("#routing_route_from_1").val() || "";
			routeFrom = routeFrom.toUpperCase();
			var routeTo = [];
			var locations = [];
			var routeSegments = [];

			$("div[class^='route_input_row']").each(function (i, el) {
				var rowid = $(this).attr("data-rowid");

				if ($("#routing_route_to_"+rowid).val() != "" && $("#routing_route_airline_"+rowid).val() != "") {
					var obj = new Object();
					obj.Seq = rowid;
					obj.RouteTo = $("#routing_route_to_"+rowid).val() || "";
					obj.RouteTo = obj.RouteTo.toUpperCase();
					obj.Airline = $("#routing_route_airline_"+rowid).val() || "";
					obj.Airline = obj.Airline.toUpperCase();
					//console.log("obj.RouteTo: " +obj.RouteTo);
					//console.log("obj.Airline: " +obj.Airline);
					routeTo.push(obj);
				}
			});
	
			//construct route segment
			$('.routing_route').each(function (i, el) {
				if(!!$(el).val()){
					locations.push({
						name: $(el).val().toUpperCase(),
						id: i
					});
				}
			});

			_.forEach(locations, function(location, index) {
				if(index > 0){
					routeSegments.push({
						Seq: index,
						Origin: locations[index - 1].name,
						Destination: location.name,
						Airline: $('#routing_route_airline_' + location.id).val() ? $('#routing_route_airline_' + location.id).val().toUpperCase() : ""
					});
				}
			});

			return {
				"RouteInfo" : {
					"RouteFrom" : routeFrom,
					"RouteTo" : routeTo,
					"RouteSegment" : routeSegments
				}
			};
		});

		$("#btnAddDest").click(function (e) {
			e.preventDefault();
			AddDestinationInput();
		});

		$("#btnAddDest").keypress(function (e) {
			if(e.keyCode == 13){
				AddDestinationInput();
				$(".route_input_wrapper .route_input_row").last().find("input").first().focus();
			}
		});

		$(id).on("loadBookingData", function(event, bkdData) {
			console.log("load Data called");
			console.log(bkdData);
			var currentRowID;
			//var insertRowID;

			if(bkdData.BkdRouteSegment.length > 0){
				var routeSegment = bkdData.BkdRouteSegment;

				_.forEach(bkdData.BkdRouteSegment, function(route, index) {
					if (index > 0) {
						AddDestinationInput(index + 1, index, function(cID, dataRow){
							$("#routing_route_to_" + cID).val(route.Destination);
							$("#routing_route_airline_" + cID).val(route.Airline);
						});
					} else {
						$("#routing_route_from_1").val(route.Origin);
						$("#routing_route_to_1").val(route.Destination);
						$("#routing_route_airline_1").val(route.Airline);
					}
				});
			}
			// this is for old records without information of BkdRouteSegment, this should remove after all records contain information of route segment
			else{
				$("#routing_route_from_1").val(bkdData.Origin);

				for (var i = 0; i < bkdData.FlightDetail.length; i++) {
					currentRowID = i + 1;

					if (i > 0) {
						AddDestinationInput(currentRowID, i, function(cID, dataRow){
							$("#routing_route_to_" + cID).val(bkdData.FlightDetail[dataRow].ArrivalPort);
							$("#routing_route_airline_" + cID).val(bkdData.FlightDetail[dataRow].CarrierCode);
						});
					} else {
						$("#routing_route_to_" + currentRowID).val(bkdData.FlightDetail[i].ArrivalPort);
						$("#routing_route_airline_" + currentRowID).val(bkdData.FlightDetail[i].CarrierCode);
					}
				}
			}
		});

		$(id).on("getData", function(event, dataID) {
			console.log("getdata");
			console.log(dataID);

			var rtn;
			var seq;
			var dataType = dataID.substring(0, dataID.lastIndexOf("_"));
			if (dataType == "") {
				dataType = dataID;
			} else {
				seq = dataID.substring(dataID.lastIndexOf("_")+1);
			}

			switch(dataType) {
				case "From":
					rtn = $("#routing_route_from_1").val().toUpperCase();
					break;
				case "To":
					rtn = $("#routing_route_to_"+seq).val().toUpperCase();
					break;
				case "Airline":
					rtn = $("#routing_route_airline_"+seq).val().toUpperCase();
					break;
			}

			return rtn;

		});

		$(id).on("setData", function(event, dataID, value) {
			console.log("setdata");
			console.log(dataID);
			console.log(value);

			var seq;
			var currentRowID;
			var dataType = dataID.substring(0, dataID.lastIndexOf("_"));
			if (dataType == "") {
				dataType = dataID;
			} else {
				seq = dataID.substring(dataID.lastIndexOf("_")+1);
				currentRowID = getComponentRowID("route_input_row");

				if (seq > currentRowID) {
					var diff = seq - currentRowID;
					for (var i = 0; i < diff; i++) {
						AddDestinationInput();
					}
				}
			}

			switch(dataType) {
				case "From":
					$("#routing_route_from_1").val(value);
					break;
				case "To":
					$("#routing_route_to_"+seq).val(value)
					break;
				case "Airline":
					$("#routing_route_airline_"+seq).val(value);
					break;
			}

		});

		$(id).on("getTemplateData", function(event) {

			var routeFrom = $("#routing_route_from_1").val() || "";
			routeFrom = routeFrom.toUpperCase();
			var arr = [];
			var obj = new Object();
			obj.ModuleID = blockID;
			obj.DataID = "From";
			obj.Content = routeFrom;
			arr.push(obj);

			$("div[class^='route_input_row']").each(function (i, el) {
				//var id = el.id.substring(el.id.indexOf("_")+1);
				var rowid = $(this).attr("data-rowid");

				obj = new Object();
				obj.ModuleID = blockID;
				obj.DataID = "To_"+rowid;
				obj.Content = $("#routing_route_to_"+rowid).val() || "";
				obj.Content = obj.Content.toUpperCase();
				arr.push(obj);

				obj = new Object();
				obj.ModuleID = blockID;
				obj.DataID = "Airline_"+rowid;
				obj.Content = $("#routing_route_airline_"+rowid).val() || "";
				obj.Content = obj.Content.toUpperCase();
				arr.push(obj);

			});

			return {
				"RouteInfo" : {
					"TDataList" : arr,
				}
			}

		});

		$(id).on("addDestinationInput", function(event) {
			AddDestinationInput();
		});

		function AddDestinationInput(cID, dID, callback) {

			var row = $("#routing_input_row_temp").html();

            var currentRowID = getComponentRowID("route_input_row");
			row = row.replaceAll("%ID%", currentRowID + 1);
			if(currentRowID < 4) {
				$(".route_input_wrapper").append(row);
			}
			if (typeof callback === "function" && typeof cID !== 'undefined' && typeof dID !== 'undefined') {
				callback(cID, dID);
			}
			regPortQueryV2();
			if (currentRowID >= 3) {
				$("#btnAddDest").addClass("disabled");
			}

			var rowid = currentRowID + 1;
            $("#routing_route_to_" + rowid).keyup(function () {
                //if ($(this).val().length == 3) {
				if ( typeof CheckNGTTExpand === "function" )
				{
					if (CheckNGTTExpand(false)) {
						$("#bkd_def_ngtt").show();
					}
					else {
						$("#bkd_def_ngtt").hide();
					}
				}
                //}
            });

			refreshModuleTranslation();
        }



		$(id).on("pasteFlightDetailData", function(event, bkdData) {
			var currentRowID;
			var flightDate;
			for (var i = 0; i < bkdData.FlightDetail.length; i++) {

				if (i > 0 && i < bkdData.FlightDetail.length) {
					AddDestinationInput();
				}


				if (i == 0) {
					$("#routing_route_from_1").val(bkdData.FlightDetail[i].DeparturePort);
					$("#routing_route_airline_"+ (i+1)).val(bkdData.FlightDetail[i].FlightNum.substring(0, 2));
				}
				else if (i > 0 && i < bkdData.FlightDetail.length) {
					$("#routing_route_to_"+ i).val(bkdData.FlightDetail[i].DeparturePort);
					$("#routing_route_airline_"+ (i+1)).val(bkdData.FlightDetail[i].FlightNum.substring(0, 2));
				}

				if (i ==  bkdData.FlightDetail.length - 1) {
					$("#routing_route_to_"+ (i+1)).val(bkdData.FlightDetail[i].ArrivalPort);
				}
			}
		});

		$(id).on("refreshPlaceHolder", function(event) {
			$('.routing_route').attr("placeholder", i18next.t("BookingLandingPage.PortCode"));
		});

		$("#routing_route_from_1").keyup(function () {
            //if ($(this).val().length == 3)
            //{
			if ( typeof CheckNGTTExpand === "function" )
			{
				if (CheckNGTTExpand(false))
				{
					$("#bkd_def_ngtt").show();
				}
				else
				{
					$("#bkd_def_ngtt").hide();
				}
			}
            //}
        });

        $("#routing_route_to_1").keyup(function () {
            //if ($(this).val().length == 3) {
			if ( typeof CheckNGTTExpand === "function" )
			{
				if (CheckNGTTExpand(false)) {
					$("#bkd_def_ngtt").show();
				}
				else {
					$("#bkd_def_ngtt").hide();
				}
			}
            //}
        });
	});

</script><div id="bkd_def_flight" class="bkd_block">

	<div class="col-xs-12">
		<h3 class="inline_block" data-i18n="flight.Flights">Flights</h3>
		<a onclick="openFSLb(event)" class="act_bu act_search_flight" data-i18n="flight.SearchFlight">Search Flights</a>
	</div>

	<div class="blkc"></div>
	<div class="consign_info bu_table cx">
		<ol id="flt_order_list" class="add_flights added_list flight_segment_input_wrapper cx">
			<li class="flight_segment_input_row" data-rowid="1">
				<div class="cnt_inline bu_txt w84 mr5">
					<label for="flight_flt_no_1"><span data-i18n="cargoInfo.FlightNo">Flight No.</span>*</label>
					<input type="text" value="" id="flight_flt_no_1" class="flight_num_input">
					<div class="error_or_msg" style="display: none;" data-i18n="flight.Invalid">Invalid</div>
				</div>
				<div class="cnt_inline bu_txt chk_dept">
					<label for="flt_date1"><span data-i18n="flight.Date">Date</span>*</label>
					<div id="datepicker_1" class="input-group date" data-date-format="yyyy-MM-dd" style="margin-bottom: 0px !important;">
                        <!--<input class="form-control" type="text" readonly id="flight_flt_date_1">-->
                        <input class="form-control" type="text" placeholder="YYYY-MM-DD" id="flight_flt_date_1">
						<span class="input-group-addon" style=""><i class="glyphicon glyphicon-calendar"></i></span>
					</div>
					<div class="error_or_msg" style="display: none;" data-i18n="flight.Invalid">Invalid</div>
				</div>
				<div class="cnt_inline bu_txt chk_location text_align_left no_margin top">
					<div class="flight_od top">
						<label for="flight_flt_from_1"><span data-i18n="flight.From">From</span>*</label>
						<input type="text" value="" placeholder="" id="flight_flt_from_1" class="port_query flight_flt" autocomplete="off">
						<div class="error_or_msg" style="display: none;" data-i18n="flight.Invalid">Invalid</div>
					</div>
					<div class="cnt_inline chk_to flight_od_icon"></div>
					<div class="flight_od top">
						<label for="flight_flt_to_1"><span data-i18n="flight.To">To</span>*</label>
						<input type="text" value="" placeholder="" id="flight_flt_to_1" class="port_query flight_flt" autocomplete="off">
						<div class="error_or_msg" style="display: none;" data-i18n="flight.Invalid">Invalid</div>
					</div>
				</div>
                <div class="cnt_inline bu_txt w145 mr4 b878 top" style="width: 115px;">
                    <label for="cx_flight_flt_allt_1" data-i18n="flight.AllotmentID">Allotment ID</label>
                    <input class="bkd_flight_allotment disabled" type="text" value="" id="cx_flight_flt_allt_1">
                    <input id="bkd_flight_allotment_val_1" type="hidden" value="">
                    <label id="bkd_flight_allotment_lbl_1" style="width: 115px; margin-top: 8px;"></label>
                    <div class="error_or_msg" style="display: none;" data-i18n="flight.Invalid">Invalid</div>
                </div>
				<div class="cnt_inline bu_txt w48 b878 mr5 flight_flt_allt_top" style="width: 74px;margin-right:13px">
					<label for="flight_flt_alloc_1"><span data-i18n="flight.AllocCode">Alloc</span>*<a href="https://uat-ezycargo2017.ezbiz.com/en-US/1/Booking/SingleBooking#all_code" class="btn_bu_info" tabindex="-1"></a></label>
					<select class="select_bu" id="flight_flt_alloc_1">
						<option>NN</option>
						<option>CA</option>
						<option disabled="">NA</option>
						<option disabled="">SS</option>
						<option>XX</option>
					</select>
					<input type="hidden" value="" id="flight_flt_alloc_hd_1">
				</div>
				<div class="cnt_inline bu_txt w84 mr5">
					<label for="flight_pcs_1"><span data-i18n="cargoInfo.Pieces">Pieces</span></label>
					<input type="text" value="" id="flight_pcs_1" class="flight_int_input" maxlength="4">
					<div class="error_or_msg" style="display: none;" data-i18n="cargoInfo.InvalidPieces">Invalid Pieces</div>
				</div>
				<div class="cnt_inline bu_txt w84 mr5">
					<label for="flight_weight_1"><span data-i18n="cargoInfo.Weight">Weight</span></label>
					<input type="text" value="" id="flight_weight_1" class="flight_dec_input flight_dec_input_weight" maxlength="7">
					<label class="flight_weight_unit">KG</label>
					<div class="error_or_msg" style="display: none;" data-i18n="cargoInfo.InvalidWeight">Invalid Weight</div>
				</div>
				<div class="cnt_inline bu_txt w84 mr5">
					<label for="flight_vol_1"><span data-i18n="cargoInfo.Volume">Volume</span></label>
					<input type="text" value="" id="flight_vol_1" class="flight_dec_input flight_dec_input_volume" maxlength="9">
					<label class="flight_vol_unit">MC</label>
					<div class="error_or_msg" style="display: none;" data-i18n="cargoInfo.InvalidVolume">Invalid Volume</div>
				</div>
				<div class="act_bu act_add_col btnCheckAvail cnt_inline">
					<span>
						<a onclick="openFSLb(event)" href="https://uat-ezycargo2017.ezbiz.com/en-US/1/Booking/SingleBooking#search_flight" data-i18n="flight.CheckAvail" tabindex="-1">Flight Availability</a>
					</span>
				</div>
			</li>


			<li class="flight_segment_input_row" data-rowid="2">
				<div class="cnt_inline bu_txt w84 mr5">
					<label for="flight_flt_no_2"><span data-i18n="cargoInfo.FlightNo">Flight No.</span>*</label>
					<input type="text" value="" id="flight_flt_no_2" class="flight_num_input">
					<div class="error_or_msg" style="display: none;" data-i18n="flight.Invalid">Invalid</div>
				</div>
				<div class="cnt_inline bu_txt chk_dept">
					<label for="flight_flt_date_2"><span data-i18n="flight.Date">Date</span>*</label>
					<div id="datepicker_2" class="input-group date" data-date-format="yyyy-mm-dd" style="margin-bottom: 0px !important;">
                        <!--<input class="form-control" type="text" readonly id="flight_flt_date_2">-->
                        <input class="form-control" type="text" placeholder="YYYY-MM-DD" id="flight_flt_date_2">
						<span class="input-group-addon" style=""><i class="glyphicon glyphicon-calendar"></i></span>
					</div>
					<div class="error_or_msg" style="display: none;" data-i18n="flight.Invalid">Invalid</div>
				</div>
				<div class="cnt_inline bu_txt chk_location text_align_left no_margin">
					<div class="flight_od top">
						<label for="flight_flt_from_2"><span data-i18n="flight.From">From</span>*</label>
						<input type="text" value="" placeholder="" id="flight_flt_from_2" class="port_query flight_flt" autocomplete="off">
						<div class="error_or_msg" style="display: none;" data-i18n="flight.Invalid">Invalid</div>
					</div>
					<div class="cnt_inline chk_to flight_od_icon2"></div>
					<div class="flight_od top">
						<label for="flight_flt_to_2"><span data-i18n="flight.To">To</span>*</label>
						<input type="text" value="" placeholder="" id="flight_flt_to_2" class="port_query flight_flt" autocomplete="off">
						<div class="error_or_msg" style="display: none;" data-i18n="flight.Invalid">Invalid</div>
					</div>
				</div>
                <div class="cnt_inline bu_txt w145 mr4 b878 flight_flt_allt_top" style="width: 115px;">
                    <label for="cx_flight_flt_allt_2" data-i18n="flight.AllotmentID">Allotment ID</label>
                    <input class="bkd_flight_allotment disabled" type="text" value="" id="cx_flight_flt_allt_2">
                    <input id="bkd_flight_allotment_val_2" type="hidden" value="">
                    <label id="bkd_flight_allotment_lbl_2" style="width: 115px; margin-top: 8px;"></label>
                    <div class="error_or_msg" style="display: none;" data-i18n="flight.Invalid">Invalid</div>
                </div>
				<div class="cnt_inline bu_txt w48 b878 mr5 flight_flt_allt_top" style="width: 74px;margin-right:13px">
					<label for="flight_flt_alloc_2"><span data-i18n="flight.AllocCode">Alloc</span>*<a href="https://uat-ezycargo2017.ezbiz.com/en-US/1/Booking/SingleBooking#all_code" class="btn_bu_info" tabindex="-1"></a></label>
					<select class="select_bu" id="flight_flt_alloc_2">
						<option>NN</option>
						<option>CA</option>
						<option disabled="">NA</option>
						<option disabled="">SS</option>
						<option>XX</option>
					</select>
					<input type="hidden" value="" id="flight_flt_alloc_hd_2">
				</div>
				<div class="cnt_inline bu_txt w84 mr5">
					<label for="flight_pcs_2"><span data-i18n="cargoInfo.Pieces">Pieces</span></label>
					<input type="text" value="" id="flight_pcs_2" class="flight_int_input" maxlength="4">
					<div class="error_or_msg" style="display: none;" data-i18n="cargoInfo.InvalidPieces">Invalid Pieces</div>
				</div>
				<div class="cnt_inline bu_txt w84 mr5">
					<label for="flight_weight_2"><span data-i18n="cargoInfo.Weight">Weight</span></label>
					<input type="text" value="" id="flight_weight_2" class="flight_dec_input flight_dec_input_weight" maxlength="7">
					<label class="flight_weight_unit">KG</label>
					<div class="error_or_msg" style="display: none;" data-i18n="cargoInfo.InvalidWeight">Invalid Weight</div>
				</div>
				<div class="cnt_inline bu_txt w84 mr5">
					<label for="flight_vol_2"><span data-i18n="cargoInfo.Volume">Volume</span></label>
					<input type="text" value="" id="flight_vol_2" class="flight_dec_input flight_dec_input_volume" maxlength="9">
					<label class="flight_vol_unit">MC</label>
					<div class="error_or_msg" style="display: none;" data-i18n="cargoInfo.InvalidVolume">Invalid Volume</div>
				</div>
				<div class="act_bu act_add_col btnCheckAvail cnt_inline">
					<span>
						<a onclick="openFSLb(event)" href="https://uat-ezycargo2017.ezbiz.com/en-US/1/Booking/SingleBooking#search_flight" data-i18n="flight.CheckAvail" tabindex="-1">Flight Availability</a>
					</span>
				</div>
			</li>
			
		</ol>
		<div id="btnAddSegment" class="act_bu act_add_flights"><span data-i18n="flight.AddSegment" tabindex="0">Add segment</span></div>
		<div id="bkd_TW_WarehouseCode" style="padding-top: 12px; display: none;">
			<label for="bkdTWWhsCode" style="padding-right: 12px" data-i18n="flight.WarehouseCode">Warehouse Code</label>
			<select class="select_bu" id="bkdTWWhsCode">
				<option value="" data-i18n="cargoInfo.PleaseSelect">Please select</option>
			</select>
			<div class="error_or_msg" style="display: none;" data-i18n="common.Required">Required</div>
			<!--<input id="bkdTWWhsCode" type="text" style="width: 50px" maxlength="2"></input>-->
		</div>
		<div id="split_book_error_wrapper">
			<ul>
			</ul>
		</div>
		<div id="bkd_auto_allotment" style="margin-top: 20px;">
			<input id="bkdUseAutoAllot" type="checkbox" checked="checked" onclick="javascript: return bkdAutoAllotmentClick(event)">
			<label for="bkdUseAutoAllot" style="vertical-align: text-bottom;" data-i18n="flight.AutoAllocMatching">Automatic Allotment Matching</label>
		</div>
	</div>


</div>

<script id="flt_row_temp" type="text/x-template">
	<div class="trow fa_result_row" style="display: table-row;">
		<div class="tcell col1 colh">
			<b>%ROW_INX%.</b>
		</div>
		<div class="tcell cols">
			<div class="flight_num_l"><span>%FLIGT_NUM%</span></div>
		</div>
		<div class="tcell cols">
			<div class="flight_general">
				<span class="time">%ORIG_T%</span>
				<span>%ORIG%</span>
			</div>
			<div class="flight_general">
				<div class="flight_to">
				</div>
			</div>
		</div>
		<div class="tcell cols">
			<div class="flight_general"><span class="time">%DEST_T%</span><span>%DEST%</span></div>
		</div>
		<div class="tcell colh ccol">
			<div class="flight_general"><span class="mark_booked">
				<a href="javascript:void(0)" onclick="loadFSResultToRow(event, %ROW_INX_RS%); ExpandNGTT();">
				<span class="tick"></span><span data-i18n="flight.Select">Select</span></a></span>
			</div>
		</div>
	</div>
</script>

<script id="flt_row_temp_merged" type="text/x-template">
	<div class="merged trow fa_result_row" style="display: table-row;">
		<div class="ecell col1 colh">

		</div>
		<div class="tcell cols">
			<div class="flight_num_l"><span>%FLIGT_NUM%</span></div>
		</div>
		<div class="tcell cols">
			<div class="flight_general"><span class="time">%ORIG_T%</span><span>%ORIG%</span></div>
			<div class="flight_general"><div class="flight_to"></div></div>
		</div>
		<div class="tcell cols">
			<div class="flight_general"><span class="time">%DEST_T%</span><span>%DEST%</span></div>
		</div>
		<div class="ecell colh ccol">
			<div class="flight_general"><span class="mark_booked">
				<a href="javascript:void(0)" onclick="loadFSResultToRow(event, %ROW_INX_RS%); ExpandNGTT();">
				<span class="tick"></span><span data-i18n="flight.Select">Select</span></a></span>
			</div>
		</div>
	</div>
</script>

<script id="flt_input_row_temp" type="text/x-template">
	<li class="flight_segment_input_row extra_row" data-rowid="%ID%">
		<div class="cnt_inline bu_txt w84 mr5">
			<label for="flight_flt_no_%ID%" ><span data-i18n="cargoInfo.FlightNo">Flight No.</span>*</label>
			<input type="text" value="" id="flight_flt_no_%ID%" class="flight_num_input">
			<div class="error_or_msg" style="display: none;" data-i18n="flight.Invalid">Invalid</div>
		</div>
		<div class="cnt_inline bu_txt chk_dept">
			<div id="datepicker_%ID%" class="input-group date" data-date-format="yyyy-mm-dd" style="margin-bottom: 0px !important;">
                <label for="flt_date_%ID%"><span data-i18n="flight.Date">Date</span>*</label>
                <!--<input class="form-control" type="text" readonly id="flight_flt_date_%ID%">-->
                <input class="form-control" type="text" placeholder="YYYY-MM-DD" id="flight_flt_date_%ID%">
				<span class="input-group-addon" style=""><i class="glyphicon glyphicon-calendar"></i></span>
			</div>
			<div class="error_or_msg" style="display: none;" data-i18n="flight.Invalid">Invalid</div>
		</div>
		<div class="cnt_inline bu_txt chk_location text_align_left no_margin">
			<div class="flight_od top">
				<label for="flight_flt_from_%ID%" ><span data-i18n="flight.From">From</span>*</label>
				<input type="text" value="" placeholder="" id="flight_flt_from_%ID%" class="port_query flight_flt">
				<div class="error_or_msg" style="display: none;" data-i18n="flight.Invalid">Invalid</div>
			</div>
			<div class="cnt_inline chk_to flight_od_icon2"></div>
			<div class="flight_od top">
				<label for="flight_flt_to_%ID%" ><span data-i18n="flight.To">To</span>*</label>
				<input type="text" value="" placeholder="" id="flight_flt_to_%ID%" class="port_query flight_flt">
				<div class="error_or_msg" style="display: none;" data-i18n="flight.Invalid">Invalid</div>
			</div>
		</div>
        <div class="cnt_inline bu_txt w145 mr4 b878 flight_flt_allt_top" style="width: 115px;">
            <label for="cx_flight_flt_allt_%ID%" data-i18n="flight.AllotmentID">Allotment ID</label>
            <input class="bkd_flight_allotment" type="text" value="" id="cx_flight_flt_allt_%ID%">

            <input id="bkd_flight_allotment_val_%ID%" type="hidden" value="">
            <label id="bkd_flight_allotment_lbl_%ID%" style="width: 115px; margin-top: 8px;"></label>
            <div class="error_or_msg" style="display: none;" data-i18n="flight.Invalid">Invalid</div>
        </div>
		<div class="cnt_inline bu_txt w48 b878 mr5 flight_flt_allt_top" style="width: 74px;margin-right:13px">
			<label for="flight_flt_alloc_%ID%"><span data-i18n="flight.AllocCode">Alloc. Code</span>*<a href="#all_code" class="btn_bu_info" tabindex="-1"></a></label>
			<select class="select_bu" id="flight_flt_alloc_%ID%">
				<option>NN</option>
				<option>CA</option>
				<option disabled>NA</option>
				<option disabled>SS</option>
				<option>XX</option>
			</select>
			<input type="hidden" value="" id="flight_flt_alloc_hd_%ID%">
		</div>
		<div class="cnt_inline bu_txt w84 mr5">
			<label for="flight_pcs_%ID%" ><span data-i18n="cargoInfo.Pieces">Pieces</span></label>
			<input type="text" value="" id="flight_pcs_%ID%" class="flight_int_input" maxlength="4">
			<div class="error_or_msg" style="display: none;" data-i18n="cargoInfo.InvalidPieces">Invalid Pieces</div>
		</div>
		<div class="cnt_inline bu_txt w84 mr5">
			<label for="flight_weight_%ID%" ><span data-i18n="cargoInfo.Weight">Weight</span></label>
			<input type="text" value="" id="flight_weight_%ID%" class="flight_dec_input flight_dec_input_weight" maxlength="7">
			<label class="flight_weight_unit"></label>
			<div class="error_or_msg" style="display: none;" data-i18n="cargoInfo.InvalidWeight">Invalid Weight</div>
		</div>
		<div class="cnt_inline bu_txt w84 mr5">
			<label for="flight_vol_%ID%" ><span data-i18n="cargoInfo.Volume">Volume</span></label>
			<input type="text" value="" id="flight_vol_%ID%" class="flight_dec_input flight_dec_input_volume" maxlength="9">
			<label class="flight_vol_unit"></label>
			<div class="error_or_msg" style="display: none;" data-i18n="cargoInfo.InvalidVolume">Invalid Volume</div>
		</div>
		<div class="act_bu act_add_col btnCheckAvail cnt_inline">
			<span>
				<a onclick="openFSLb(event)" href="javascript:void(0)" data-i18n="flight.CheckAvail" tabindex="-1">Check availability</a>
			</span>
		</div>
	</li>
</script>

<script>
	$(function() {
		var id = "#bkd_def_flight";
        var blockID = "bkd_def_flight";
        var allotBkText = "Allotted Booking";

		var splitBookingErrCtrl = new msgCtrl(
			function(){
				_.forEach(splitBookingErrCtrl.get(), function(err) {
					$("#split_book_error_wrapper ul").append('<li class="error_or_msg">'+err+'</li>');
				});
			},
			function(){
				$("#split_book_error_wrapper li").remove();
			}
		);
		
		$(id).on("clear", function(event) {
			//console.log(data);
			
			//debugger;
			
			$("li[class^='flight_segment_input_row']").each(function (i, el) {
				//var id = el.id.substring(el.id.indexOf("_")+1);
				var rowid = $(this).attr("data-rowid");
				//console.log("flightSegment");
				//console.log("rowid: " +rowid);
				//console.log("i: " +i);
				
				$("#flight_flt_no_"+rowid).val("");
				$("#flight_flt_date_"+rowid).val($("#flight_flt_date_"+rowid+" option:first").val());
				$("#flight_flt_from_"+rowid).val("");
				$("#flight_flt_to_"+rowid).val("");
                $("#cx_flight_flt_allt_" + rowid).val("");
				$("#flight_flt_alloc_"+rowid).val($("#flight_flt_alloc_"+rowid+" option:first").val());
				$("#flight_flt_no_"+rowid+" ~ .error_or_msg").hide();
				$("#flight_flt_no_"+rowid).parent().removeClass("error_or");
				$("#datepicker_"+rowid+" ~ .error_or_msg").hide();
				$("#datepicker_"+rowid).parent().removeClass("error_or");
				
				$("#flight_pcs_"+rowid).val("");
				$("#flight_weight_"+rowid).val("");
				$("#flight_vol_"+rowid).val("");
			});
			
			$(".flight_segment_input_row.extra_row").remove();
			
			$(id+" .error_or_msg").hide();
			$(id+" .error_or").removeClass("error_or");
		});
		
		$(id).on("init", function(event, data) {
			console.log(data);
            regSearchFlightElsOnEnter();
			//debugger;				
			
			// TW agent
			$("#bkdTWWhsCode").val("");
			
			if (userCity == "TPE") {
				//bkdCXRegTWWarehouseCode();
				setWarehouseOption();
				$("#bkd_TW_WarehouseCode").css("display", "block");				
			}
			else {
				$("#bkd_TW_WarehouseCode").css("display", "none");
			}
			
			if (typeof data.FlightSegmentInfo !== 'undefined' && data.FlightSegmentInfo != null) {
				if (typeof data.FlightSegmentInfo.FlightSegment !== 'undefined' && data.FlightSegmentInfo.FlightSegment != null) {
					var currentRowID;
					var flightDate;
					for (var i = 0; i < data.FlightSegmentInfo.FlightSegment.length; i++) {
						currentRowID = i + 1;
						
                        if (i > 1) {
                            AddFlightSegmentInput(currentRowID, i, function (cID, dataRow) {
                                $("#flight_flt_no_" + cID).val(data.FlightSegmentInfo.FlightSegment[dataRow].FlightNo);
                                if (data.FlightSegmentInfo.FlightSegment[dataRow].FlightDate != "") {
                                    $("#flight_flt_date_" + cID).datepicker("setDate", (data.FlightSegmentInfo.FlightSegment[dataRow].FlightDate));
                                    //$("#flight_flt_date_" + cID).val(data.FlightSegmentInfo.FlightSegment[dataRow].FlightDate);
                                }
                                $("#flight_flt_from_" + cID).val(data.FlightSegmentInfo.FlightSegment[dataRow].From);
                                $("#flight_flt_to_" + cID).val(data.FlightSegmentInfo.FlightSegment[dataRow].To);
                                //$("#cx_flight_flt_allt_" + cID).val(data.FlightSegmentInfo.FlightSegment[dataRow].AllotmentID);
                                $("#flight_flt_alloc_" + cID).val(data.FlightSegmentInfo.FlightSegment[dataRow].AllocationCode);
                                $("#flight_flt_alloc_hd_" + cID).val(data.FlightSegmentInfo.FlightSegment[dataRow].AllocationCode);

								if(data.FlightSegmentInfo.FlightSegment[dataRow].FlightDetailCx){
									$("#flight_pcs_"+cID).val(data.FlightSegmentInfo.FlightSegment[dataRow].FlightDetailCx.Pieces);
									$("#flight_weight_"+cID).val(data.FlightSegmentInfo.FlightSegment[dataRow].FlightDetailCx.Weight);
									$("#flight_vol_"+cID).val(data.FlightSegmentInfo.FlightSegment[dataRow].FlightDetailCx.Volume);
								}
                            });
                        } else {
                            $("#flight_flt_no_" + currentRowID).val(data.FlightSegmentInfo.FlightSegment[i].FlightNo);
                            if (data.FlightSegmentInfo.FlightSegment[i].FlightDate != "") {
                                $("#flight_flt_date_" + currentRowID).datepicker("setDate", (data.FlightSegmentInfo.FlightSegment[i].FlightDate));
                                //$("#flight_flt_date_" + currentRowID).val(data.FlightSegmentInfo.FlightSegment[i].FlightDate);
                            }
                            $("#flight_flt_from_" + currentRowID).val(data.FlightSegmentInfo.FlightSegment[i].From);
                            $("#flight_flt_to_" + currentRowID).val(data.FlightSegmentInfo.FlightSegment[i].To);
                            //$("#cx_flight_flt_allt_" + currentRowID).val(data.FlightSegmentInfo.FlightSegment[i].AllotmentID);
                            $("#flight_flt_alloc_" + currentRowID).val(data.FlightSegmentInfo.FlightSegment[i].AllocationCode);
                            $("#flight_flt_alloc_hd_" + currentRowID).val(data.FlightSegmentInfo.FlightSegment[i].AllocationCode);
							
							if(data.FlightSegmentInfo.FlightSegment[i].FlightDetailCx){
								$("#flight_pcs_" + currentRowID).val(data.FlightSegmentInfo.FlightSegment[i].FlightDetailCx.Pieces);
								$("#flight_weight_" + currentRowID).val(data.FlightSegmentInfo.FlightSegment[i].FlightDetailCx.Weight);
								$("#flight_vol_" + currentRowID).val(data.FlightSegmentInfo.FlightSegment[i].FlightDetailCx.Volume);
							}
                        }
					}
					
					regPortQueryV2();
				}
			}
			
			// Set Auto Allotment
			bkd_auto_allotment = true;
			bkdToggleAutoAllotment(true);
		});
		
		$(id).on("validate", function () {
			var isValid = true;
			var rowCnt = 0;
			var masterPieces = $('#bkd_def_cargoinfo').triggerHandler("getData", 'Pieces');
			var masterWeight = $('#bkd_def_cargoinfo').triggerHandler("getData", 'Weight');
			var masterVolume = $('#bkd_def_cargoinfo').triggerHandler("getData", 'Volume');
			var weightUnit = $('#bkd_def_cargoinfo').triggerHandler("getData", 'WeightUnit') == 0 ? i18next.t("cargoInfo.KG") : i18next.t("cargoInfo.LB");
			var volUnit = $('#bkd_def_cargoinfo').triggerHandler("getData", 'VolumeUnit') == 0 ? i18next.t("cargoInfo.MC") : i18next.t("cargoInfo.CF");
			var origs = [];
			var dests = [];

			var fromHkgObj = {
				pieces: 0,
				weight: 0,
				volume: 0
			};

			var toHkgObj = {
				pieces: 0,
				weight: 0,
				volume: 0
			};


			$("li[class^='flight_segment_input_row']").each(function (i, el) {
				var rowid = $(this).attr("data-rowid");
				var pieces = $("#flight_pcs_" + rowid).val();
				var weight = $("#flight_weight_" + rowid).val();
				var volume = $("#flight_vol_" + rowid).val();
				var from = $("#flight_flt_from_" + rowid).val();
				var to = $("#flight_flt_to_" + rowid).val();

				if (from && from.toUpperCase() == "HKG") {
					if (StringFormatChecker.checkInteger(true, pieces)) fromHkgObj.pieces += parseInt(pieces);
					if (StringFormatChecker.checkFloat(true, weight)) fromHkgObj.weight += parseFloat(weight);
					if (StringFormatChecker.checkFloat(true, volume)) fromHkgObj.volume += parseFloat(volume);
				}
				else if (to && to.toUpperCase() == "HKG") {
					if (StringFormatChecker.checkInteger(true, pieces)) toHkgObj.pieces += parseInt(pieces);
					if (StringFormatChecker.checkFloat(true, weight)) toHkgObj.weight += parseFloat(weight);
					if (StringFormatChecker.checkFloat(true, volume)) toHkgObj.volume += parseFloat(volume);
				}

				if (from)
					origs.push(from);

				if (to)
					dests.push(to);
			});
            if (!isNaN(parseFloat(fromHkgObj.weight).toFixed(decimalWeightRoundTo))) {
                fromHkgObj.weight = fromHkgObj.weight.toFixed(decimalWeightRoundTo);
            } else { fromHkgObj.weight = fromHkgObj.weight; }
			if (!isNaN(parseFloat(fromHkgObj.volume).toFixed(decimalVolumeRoundToCX))) {
                fromHkgObj.volume = fromHkgObj.volume.toFixed(decimalVolumeRoundToCX);
			} else { fromHkgObj.volume = fromHkgObj.volume; }
            if (!isNaN(parseFloat(toHkgObj.weight).toFixed(decimalWeightRoundTo))) {
                toHkgObj.weight = toHkgObj.weight.toFixed(decimalWeightRoundTo);
            } else { toHkgObj.weight = toHkgObj.weight; }
            if (!isNaN(parseFloat(toHkgObj.volume).toFixed(decimalVolumeRoundToCX))) {
                toHkgObj.volume = toHkgObj.volume.toFixed(decimalVolumeRoundToCX);
            } else { toHkgObj.volume = toHkgObj.volume; }

			//remove all split booking errs
			splitBookingErrCtrl.dropAll();

			$("li[class^='flight_segment_input_row']").each(function (i, el) {
				var isSplitBooking = false;
				var rowid = $(this).attr("data-rowid");
				var flightNo = $("#flight_flt_no_" + rowid).val();
				var flightDate = $("#flight_flt_date_" + rowid).val();
				var from = $("#flight_flt_from_" + rowid).val();
				var to = $("#flight_flt_to_" + rowid).val();
				var allotmentID = $("#cx_flight_flt_allt_" + rowid).val();
				var allocationCode = $("#flight_flt_alloc_" + rowid).val() || $("#flight_flt_alloc_hd_" + rowid).val();

				var pieces = $("#flight_pcs_" + rowid).val();
				var weight = $("#flight_weight_" + rowid).val();
				var volume = $("#flight_vol_" + rowid).val();

				//if (flightNo != "" || from != "" || to != "" || allotmentID != "") {
				if (flightNo != "" || flightDate != "" || from != "" || to != "" || allotmentID != "" || pieces || weight || volume) {
					rowCnt++;

					if (flightNo == "" || !checkFlightNoFormat(flightNo)) {
						$("#flight_flt_no_" + rowid + " ~ .error_or_msg").show();
						$("#flight_flt_no_" + rowid).parent().addClass("error_or");
						isValid = false;
					} else if (flightNo.length < 5) {
						$("#flight_flt_no_" + rowid + " ~ .error_or_msg").show();
						$("#flight_flt_no_" + rowid).parent().addClass("error_or");
						isValid = false;
					} else {
						$("#flight_flt_no_" + rowid + " ~ .error_or_msg").hide();
						$("#flight_flt_no_" + rowid).parent().removeClass("error_or");
					}

					var currentAirline = getData("bkd_def_cargoinfo", "Airline");
					var advBookDay = getAirlineAdvBookDay(currentAirline);
					var currentDate = new Date();
					if (flightDate == "") {
						$("#datepicker_" + rowid + " ~ .error_or_msg").show();
						//$("#datepicker_"+rowid+" ~ .error_or_msg").text("Invalid");
						$("#datepicker_" + rowid).parent().addClass("error_or");
						isValid = false;
					} else if (advBookDay > 0 && currentDate.dateDiff("d", new Date(flightDate)) > advBookDay) {
						$("#datepicker_" + rowid + " ~ .error_or_msg").show();
						$("#datepicker_" + rowid).parent().addClass("error_or");
						$("#datepicker_" + rowid + " ~ .error_or_msg").text(i18next.t("cargoInfo.AdvDateRangeErr").replace("$number$", advBookDay));
						isValid = false;
					} else {
						$("#datepicker_" + rowid + " ~ .error_or_msg").hide();
						$("#datepicker_" + rowid).parent().removeClass("error_or");
					}

					//Origin
					if (!checkPort(from)) {
						$("#flight_flt_from_" + rowid + " ~ .error_or_msg").text(i18next.t("cargoInfo.Invalid"));
						$("#flight_flt_from_" + rowid + " ~ .error_or_msg").show();
						$("#flight_flt_from_" + rowid).parent().addClass("error_or");
						isValid = false;
					} else {
						$("#flight_flt_from_" + rowid + " ~ .error_or_msg").hide();
						$("#flight_flt_from_" + rowid).parent().removeClass("error_or");
					}

					//Destination
					if (!checkPort(to)) {
						$("#flight_flt_to_" + rowid + " ~ .error_or_msg").show();
						$("#flight_flt_to_" + rowid).parent().addClass("error_or");
						isValid = false;
					} else {
						$("#flight_flt_to_" + rowid + " ~ .error_or_msg").hide();
						$("#flight_flt_to_" + rowid).parent().removeClass("error_or");
					}

					//Origin and Destination duplicate check
					if (checkPort(from) && from.toUpperCase() == to.toUpperCase()) {
						$("#flight_flt_from_" + rowid + " ~ .error_or_msg").text(i18next.t('flight.SameODMsg'));
						$("#flight_flt_from_" + rowid + " ~ .error_or_msg").show();

						$("#flight_flt_from_" + rowid).parent().addClass("error_or");
						$("#flight_flt_to_" + rowid).parent().addClass("error_or");
						isValid = false;
					}

					if (allotmentID != "" && $.trim(allotmentID).indexOf(" ") > -1 && allotmentID != allotBkText) {
						$("#cx_flight_flt_allt_" + rowid + " ~ .error_or_msg").show();
						$("#cx_flight_flt_allt_" + rowid).parent().addClass("error_or");
						isValid = false;
					} else {
						$("#cx_flight_flt_allt_" + rowid + " ~ .error_or_msg").hide();
						$("#cx_flight_flt_allt_" + rowid).parent().removeClass("error_or");
					}

					if (_.filter(origs, function (o) { return o == from; }).length > 1 || _.filter(dests, function (d) { return d == to; }).length > 1) {
						isSplitBooking = true;
					}

					if (pieces || weight || volume || isSplitBooking) {
						//pieces

						if (!StringFormatChecker.checkInteger(true, pieces, 1, 9999)) {
							$("#flight_pcs_" + rowid + " ~ .error_or_msg").show();
							$("#flight_pcs_" + rowid).parent().addClass("error_or");
							isValid = false;
						}
						else if (pieces && (from && masterPieces && from.toUpperCase() == "HKG" && parseInt(fromHkgObj.pieces) > parseInt(masterPieces)) ||
							(to && masterPieces && to.toUpperCase() == "HKG" && parseInt(toHkgObj.pieces) > parseInt(masterPieces))) {
							$("#flight_pcs_" + rowid + " ~ .error_or_msg").hide();
							$("#flight_pcs_" + rowid).parent().addClass("error_or");
							splitBookingErrCtrl.add(i18next.t('flight.SegmentPieceExceed').replace("$piece$", masterPieces));
							isValid = false;
						}
						else {
							$("#flight_pcs_" + rowid + " ~ .error_or_msg").hide();
							$("#flight_pcs_" + rowid).parent().removeClass("error_or");
						}

						//weight
						if (!StringFormatChecker.checkFloat(true, weight, 0.1, 9999999, 1)) {
							$("#flight_weight_" + rowid + " ~ .error_or_msg").show();
							$("#flight_weight_" + rowid).parent().addClass("error_or");
							isValid = false;
						}
						else if (weight) {
							var FloatmasterWeight = parseFloat(masterWeight).toFixed(decimalWeightRoundTo);
							if ((from && FloatmasterWeight && from.toUpperCase() == "HKG" && parseFloat(fromHkgObj.weight) > parseFloat(FloatmasterWeight)) ||
								(to && FloatmasterWeight && to.toUpperCase() == "HKG" && parseFloat(toHkgObj.weight) > parseFloat(FloatmasterWeight))) {
								$("#flight_weight_" + rowid + " ~ .error_or_msg").hide();
								$("#flight_weight_" + rowid).parent().addClass("error_or");
								splitBookingErrCtrl.add(i18next.t('flight.SegmentWeightExceed').replace("$weight$", FloatmasterWeight).replace("$weightUnit$", weightUnit));
								isValid = false;
							}
						}
						else {
							$("#flight_weight_" + rowid + " ~ .error_or_msg").hide();
							$("#flight_weight_" + rowid).parent().removeClass("error_or");
						}

						//volume
                       var FloatMasterVolume = parseFloat(masterVolume).toFixed(decimalVolumeRoundToCX);
					 	if(!StringFormatChecker.checkFloat(true, volume, 0.001, 999999999, 3)){
					 		$("#flight_vol_"+rowid+" ~ .error_or_msg").show();
					 		$("#flight_vol_"+rowid).parent().addClass("error_or");
					 		isValid = false;
					 	}
                          else if (volume && (from && FloatMasterVolume && from.toUpperCase() == "HKG" && parseFloat(fromHkgObj.volume) > parseFloat(FloatMasterVolume)) ||
                              (to && FloatMasterVolume && to.toUpperCase() == "HKG" && parseFloat(toHkgObj.volume) > parseFloat(FloatMasterVolume))){
					 		$("#flight_vol_"+rowid+" ~ .error_or_msg").hide();
					 		$("#flight_vol_"+rowid).parent().addClass("error_or");
                              splitBookingErrCtrl.add(i18next.t('flight.SegmentVolExceed').replace("$vol$", FloatMasterVolume).replace("$volUnit$", volUnit));
					 		isValid = false;
					 	}
					 	else{
					 		$("#flight_vol_"+rowid+" ~ .error_or_msg").hide();
					 		$("#flight_vol_"+rowid).parent().removeClass("error_or");
					 	}
					}
					else{
					 	$("#flight_pcs_"+rowid+" ~ .error_or_msg").hide();
					 	$("#flight_pcs_"+rowid).parent().removeClass("error_or");

					 	$("#flight_weight_"+rowid+" ~ .error_or_msg").hide();
					 	$("#flight_weight_"+rowid).parent().removeClass("error_or");

					 	$("#flight_vol_"+rowid+" ~ .error_or_msg").hide();
					 	$("#flight_vol_"+rowid).parent().removeClass("error_or");
					}
				} else {
					$("#flight_flt_no_"+rowid+" ~ .error_or_msg").hide();
					$("#flight_flt_no_"+rowid).parent().removeClass("error_or");
					
					$("#datepicker_"+rowid+" ~ .error_or_msg").hide();
					$("#datepicker_"+rowid).parent().removeClass("error_or");

					$("#flight_flt_from_"+rowid+" ~ .error_or_msg").hide();
					$("#flight_flt_from_"+rowid).parent().removeClass("error_or");
					
					$("#flight_flt_to_"+rowid+" ~ .error_or_msg").hide();
					$("#flight_flt_to_"+rowid).parent().removeClass("error_or");

					$("#flight_pcs_"+rowid+" ~ .error_or_msg").hide();
					$("#flight_pcs_"+rowid).parent().removeClass("error_or");

					$("#flight_weight_"+rowid+" ~ .error_or_msg").hide();
					$("#flight_weight_"+rowid).parent().removeClass("error_or");

					$("#flight_vol_"+rowid+" ~ .error_or_msg").hide();
					$("#flight_vol_"+rowid).parent().removeClass("error_or");
				}
				
			});
				
			if (rowCnt == 0) {
				$("#flight_flt_no_1 ~ .error_or_msg").show();
				$("#flight_flt_no_1").parent().addClass("error_or");

				$("#datepicker_1 ~ .error_or_msg").show();
				$("#datepicker_1").parent().addClass("error_or");

				$("#flight_flt_from_1 ~ .error_or_msg").text(i18next.t("cargoInfo.Invalid"));
				$("#flight_flt_from_1 ~ .error_or_msg").show();
				$("#flight_flt_from_1").parent().addClass("error_or");

				$("#flight_flt_to_1 ~ .error_or_msg").show();
				$("#flight_flt_to_1").parent().addClass("error_or");

				isValid = false;
			}
			
			if (userCity == "TPE") {
				var warehouseCode = $("#bkdTWWhsCode").val();
				
				if (warehouseCode == "") {
					$("#bkdTWWhsCode ~ .error_or_msg").show();
					$("#bkdTWWhsCode").parent().addClass("error_or");
					isValid = false;
				} else {
					$("#bkdTWWhsCode ~ .error_or_msg").hide();
					$("#bkdTWWhsCode").parent().removeClass("error_or");
				}
				
			}
			
			console.log("flight isValid:" + isValid);
			return isValid;
		});
		$(id).on("submit", function() {

			var flightSegment = [];
			var masterPieces = $('#bkd_def_cargoinfo').triggerHandler("getData", 'Pieces');
			var masterWeight = $('#bkd_def_cargoinfo').triggerHandler("getData", 'Weight');
			var masterVolume = $('#bkd_def_cargoinfo').triggerHandler("getData", 'Volume');

			$("li[class^='flight_segment_input_row']").each(function (i, el) {
				//var id = el.id.substring(el.id.indexOf("_")+1);
				var rowid = $(this).attr("data-rowid");
				//console.log("flightSegment");
				//console.log("rowid: " +rowid);
				//console.log("i: " +i);
				
				var obj = new Object();
				obj.Seq = rowid;
				obj.FlightNo = $("#flight_flt_no_"+rowid).val();
				obj.FlightDate = $("#flight_flt_date_"+rowid).val();
				obj.From = $("#flight_flt_from_"+rowid).val();
                obj.To = $("#flight_flt_to_" + rowid).val();
				obj.FlightDetailCx = {
					Pieces: $("#flight_pcs_"+rowid).val() || masterPieces,
				 	Weight: $("#flight_weight_"+rowid).val() || masterWeight,
				 	Volume: $("#flight_vol_"+rowid).val() || masterVolume
				};

                var allotID = "";
                if ($.trim($("#cx_flight_flt_allt_" + rowid).val()) != "" && $.trim($("#cx_flight_flt_allt_" + rowid).val()) != allotBkText) {
                    allotID = $.trim($("#cx_flight_flt_allt_" + rowid).val());
                } else if ($.trim($("#bkd_flight_allotment_val_" + rowid).val()) != "") {
                    allotID = $.trim($("#bkd_flight_allotment_val_" + rowid).val());
                }

                obj.AllotmentID = allotID;
				obj.AllocationCode = $("#flight_flt_alloc_"+rowid).val() || $("#flight_flt_alloc_hd_"+rowid).val();
				if (obj.FlightNo == "" && obj.FlightDate == "" && obj.From == "" && obj.To == "" && obj.AllotmentID == "") {	
				} else {
					flightSegment.push(obj);
				}
				
				
			});

			return { 
				"FlightSegmentInfo" : {
					"FlightSegment" : flightSegment,
					"CxUseAutoAllot": $("#bkdUseAutoAllot").prop("checked"),
					"CxWarehouseCode": $("#bkdTWWhsCode").val()
				}
				
			};
		});
		
		$(id).on("loadBookingData", function(event, bkdData) {
			if (localStorage.getItem("awb_retrieve_count") == 0 && getParameterByName("fs") != null) {
				fsPasteFlightDetail();
            } else {

                if (typeof bkdData !== 'undefined' && bkdData != null) {

                    var hasAllotmentID = false;
                    var isTurnAutoAllotment = true;

                    for (var i = 0; i < bkdData.FlightDetail.length; i++) {
                        if (bkdData.FlightDetail[i].AllotmentId != "") {
                            hasAllotmentID = true;
                        }
                    }

                    if (hasAllotmentID) {
                        $("#bkdUseAutoAllot").prop("checked", false);
                        bkdToggleAutoAllotment(false);
                        isTurnAutoAllotment = false;
                    }

                    if (typeof bkdData.Cx !== 'undefined' && bkdData.Cx != null) {
                        $("#bkdTWWhsCode").val(bkdData.Cx.WarehouseCode);
                    }
                }

				var currentRowID;
				var flightDate;
				
				for (var i = 0; i < bkdData.FlightDetail.length; i++) {
					currentRowID = i + 1;
                    console.log("bkdData.FlightDetail[i]", bkdData.FlightDetail[i]);
                    if (i > 1) {
                        AddFlightSegmentInput(currentRowID, i, function (cID, dataRow) {
                            $("#flight_flt_no_" + cID).val(bkdData.FlightDetail[dataRow].CarrierCode + bkdData.FlightDetail[dataRow].FlightNum);
                            if (typeof bkdData.FlightDetail[dataRow].DepartureDate !== 'undefined' && bkdData.FlightDetail[dataRow].DepartureDate != null) {
                                flightDate = new Date(getAPIDate(bkdData.FlightDetail[dataRow].DepartureDate));
                                flightDateTxt = flightDate.ToString(DateTimeFormat.YearMonthDate);
                            } else {
                                flightDateTxt = "";
                            }
                            $("#flight_flt_date_" + cID).datepicker("setDate", (flightDateTxt));
                            //$("#flight_flt_date_" + cID).val(flightDateTxt);
                            $("#flight_flt_from_" + cID).val(bkdData.FlightDetail[dataRow].DeparturePort);
                            $("#flight_flt_to_" + cID).val(bkdData.FlightDetail[dataRow].ArrivalPort);
                            //$("#cx_flight_flt_allt_" + cID).val(bkdData.FlightDetail[dataRow].AllotmentId);
                            $("#bkd_flight_allotment_val_" + cID).val(bkdData.FlightDetail[dataRow].AllotmentId);
                            if (bkdData.FlightDetail[dataRow].AllotmentId != "") {
                                $("#cx_flight_flt_allt_" + cID).removeClass("disabled");
                                $("#bkd_flight_allotment_lbl_" + cID).addClass("disabled");
                                $("#cx_flight_flt_allt_" + cID).val(allotBkText);
                            } else {
                                if (!isTurnAutoAllotment) {
                                    $("#cx_flight_flt_allt_" + cID).removeClass("disabled");
                                    $("#bkd_flight_allotment_lbl_" + cID).addClass("disabled");
                                }

                            }
                            //$("#flight_flt_alloc_" + cID).val(bkdData.FlightDetail[dataRow].SpaceAllocationCode);
                            if (typeof bkdData.FlightDetail[dataRow].FlightDetailCx !== 'undefined' && bkdData.FlightDetail[dataRow].FlightDetailCx != null) {
                                if (typeof bkdData.FlightDetail[dataRow].FlightDetailCx.FCTLStatus !== 'undefined' && bkdData.FlightDetail[dataRow].FlightDetailCx.FCTLStatus != null) {
                                    $("#flight_flt_alloc_" + cID).val(bkdData.FlightDetail[dataRow].FlightDetailCx.FCTLStatus);
                                    $("#flight_flt_alloc_hd_" + cID).val(bkdData.FlightDetail[dataRow].FlightDetailCx.FCTLStatus);
                                }

								if(bkdData.FlightDetail[i].FlightDetailCx.Pieces)
									$("#flight_pcs_" + currentRowID).val(bkdData.FlightDetail[i].FlightDetailCx.Pieces);
								if(bkdData.FlightDetail[i].FlightDetailCx.Weight)
									$("#flight_weight_" + currentRowID).val(bkdData.FlightDetail[i].FlightDetailCx.Weight);
								if(bkdData.FlightDetail[i].FlightDetailCx.Volume)
									$("#flight_vol_" + currentRowID).val(bkdData.FlightDetail[i].FlightDetailCx.Volume);
                            }
                        });
					} else {
						$("#flight_flt_no_" + currentRowID).val(bkdData.FlightDetail[i].CarrierCode + bkdData.FlightDetail[i].FlightNum);
						if (typeof bkdData.FlightDetail[i].DepartureDate !== 'undefined' && bkdData.FlightDetail[i].DepartureDate != null) {
							flightDate = new Date(getAPIDate(bkdData.FlightDetail[i].DepartureDate));
							flightDateTxt = flightDate.ToString(DateTimeFormat.YearMonthDate);
						} else {
							flightDateTxt = "";
						}
                        $("#flight_flt_date_" + currentRowID).datepicker("setDate", (flightDateTxt));
						//$("#flight_flt_date_" + currentRowID).val(flightDateTxt);
						$("#flight_flt_from_" + currentRowID).val(bkdData.FlightDetail[i].DeparturePort);
						$("#flight_flt_to_" + currentRowID).val(bkdData.FlightDetail[i].ArrivalPort);
						//$("#flight_flt_allt_" + currentRowID).val(bkdData.FlightDetail[i].AllotmentId);
                        $("#bkd_flight_allotment_val_" + currentRowID).val(bkdData.FlightDetail[i].AllotmentId);
                        if (bkdData.FlightDetail[i].AllotmentId != "") {
                            $("#cx_flight_flt_allt_" + currentRowID).removeClass("disabled");
                            $("#bkd_flight_allotment_lbl_" + currentRowID).addClass("disabled");
                            $("#cx_flight_flt_allt_" + currentRowID).val(allotBkText);
                        } else {
                            if (!isTurnAutoAllotment) {
                                $("#cx_flight_flt_allt_" + currentRowID).removeClass("disabled");
                                $("#bkd_flight_allotment_lbl_" + currentRowID).addClass("disabled");
                            }
                        }
						//$("#flight_flt_alloc_" + currentRowID).val(bkdData.FlightDetail[i].SpaceAllocationCode);
						if (typeof bkdData.FlightDetail[i].FlightDetailCx !== 'undefined' && bkdData.FlightDetail[i].FlightDetailCx != null) {
							if (typeof bkdData.FlightDetail[i].FlightDetailCx.FCTLStatus !== 'undefined' && bkdData.FlightDetail[i].FlightDetailCx.FCTLStatus != null) {
								$("#flight_flt_alloc_" + currentRowID).val(bkdData.FlightDetail[i].FlightDetailCx.FCTLStatus);
								$("#flight_flt_alloc_hd_" + currentRowID).val(bkdData.FlightDetail[i].FlightDetailCx.FCTLStatus);
							}

							if(bkdData.FlightDetail[i].FlightDetailCx.Pieces)
								$("#flight_pcs_" + currentRowID).val(bkdData.FlightDetail[i].FlightDetailCx.Pieces);
							if(bkdData.FlightDetail[i].FlightDetailCx.Weight)
								$("#flight_weight_" + currentRowID).val(bkdData.FlightDetail[i].FlightDetailCx.Weight);
							if(bkdData.FlightDetail[i].FlightDetailCx.Volume)
								$("#flight_vol_" + currentRowID).val(bkdData.FlightDetail[i].FlightDetailCx.Volume);
						}	
					}
				}	
            }
				
		});
		
		$(id).on("pasteFlightDetailData", function(event, bkdData) {
			var currentRowID;
			//debugger;
			var flightDate;
			for (var i = 0; i < bkdData.FlightDetail.length; i++) {
				currentRowID = i + 1;
				
				if (i > 1) {
					AddFlightSegmentInput(currentRowID, i, function(cID, dataRow){
						$("#flight_flt_no_" + cID).val(bkdData.FlightDetail[dataRow].FlightNum);
						$("#flight_flt_date_" + cID).val(bkdData.FlightDetail[dataRow].DepartureDate);
						$("#flight_flt_from_" + cID).val(bkdData.FlightDetail[dataRow].DeparturePort);
						$("#flight_flt_to_" + cID).val(bkdData.FlightDetail[dataRow].ArrivalPort);

						if(bkdData.FlightDetail[dataRow].FlightDetailCx){
							$("#flight_pcs_" + cID).val(bkdData.FlightDetail[dataRow].FlightDetailCx.Pieces);
							$("#flight_weight_" + cID).val(bkdData.FlightDetail[dataRow].FlightDetailCx.Weight);
							$("#flight_vol_" + cID).val(bkdData.FlightDetail[dataRow].FlightDetailCx.Volume);
						}
					});
				} else {
					$("#flight_flt_no_" + currentRowID).val(bkdData.FlightDetail[i].FlightNum);
					$("#flight_flt_date_" + currentRowID).val(bkdData.FlightDetail[i].DepartureDate);
					$("#flight_flt_from_" + currentRowID).val(bkdData.FlightDetail[i].DeparturePort);
					$("#flight_flt_to_" + currentRowID).val(bkdData.FlightDetail[i].ArrivalPort);

					if(bkdData.FlightDetail[i].FlightDetailCx){
						$("#flight_pcs_" + currentRowID).val(bkdData.FlightDetail[i].FlightDetailCx.Pieces);
						$("#flight_weight_" + currentRowID).val(bkdData.FlightDetail[i].FlightDetailCx.Weight);
						$("#flight_vol_" + currentRowID).val(bkdData.FlightDetail[i].FlightDetailCx.Volume);
					}
				}
			}					
		});
		/*
		$("#btnCheckAvail").click(function (e) {
			e.preventDefault();
		});
		*/
		$("#btnAddSegment").click(function (e) {
			e.preventDefault();
			AddFlightSegmentInput();
		});

		$("#btnAddSegment").keypress(function (e) {
			if(e.keyCode == 13){
				AddFlightSegmentInput();
				$("#flt_order_list li").last().find("input").first().focus();
			}
		});

		$("#bkdUseAutoAllot").keypress(function (e) {
			if(e.keyCode == 13){
				this.click();
			}
		});
		
		$("#btn_flt_src_close").click(function (e) {
			e.preventDefault();
			lityInstance.close();
		});
		
		$("#flight_flt_date_1").datepicker(getDatePickerOpt());
		
		$("#flight_flt_date_1").blur(function () {
			val = $(this).val();
			val1 = Date.parse(val);
			if (isNaN(val1) == true && val !== '') {
				$(this).datepicker("setDate", new Date());
			}
		});
		
		$("#flight_flt_date_2").datepicker(getDatePickerOpt());
		
		$("#flight_flt_date_2").blur(function () {
			val = $(this).val();
			val1 = Date.parse(val);
			if (isNaN(val1) == true && val !== '') {
				$(this).datepicker("setDate", new Date());
			}
		});
		
		$("#flt_date_src").datepicker(getDatePickerOpt());
		
		$("#flt_date_src").blur(function () {
			val = $(this).val();
			val1 = Date.parse(val);
			if (isNaN(val1) == true && val !== '') {
				$(this).datepicker("setDate", new Date());
			}
		});
		
		$("#btn_fa_src").click(function (e) {
			e.preventDefault();

			var errorMsg = [];
			if (typeof $("#flt_airline_src").val() !== 'undefined' && $("#flt_airline_src").val() != null) {
				if ($("#flt_airline_src").val() == "") {
					errorMsg.push(i18next.t("flight.EnterValidAirline"));
				}
			} else {
				errorMsg.push(i18next.t("flight.EnterValidAirline"));
			}
			
			if (typeof $("#flt_date_src").val() !== 'undefined' && $("#flt_date_src").val() != null) {
				if ($("#flt_date_src").val() == "") {
					errorMsg.push(i18next.t("flight.EnterDateMsg"));
				}
			} else {
				errorMsg.push(i18next.t("flight.EnterDateMsg"));
			}
			
			if (!checkPort($("#flt_from_src").val().trim())) {
				errorMsg.push(i18next.t("cargoInfo.InvalidOrigin"));
			}

			if (!checkPort($("#flt_to_src").val().trim())) {
				errorMsg.push(i18next.t("cargoInfo.InvalidDestination"));
			}

			if(errorMsg.length > 0){
				alert(errorMsg.join("\n"));
			}
			else{
				var airline = $("#flt_airline_src").val().trim().toUpperCase();
				var flightDate = $("#flt_date_src").val().trim();
				var origin = $("#flt_from_src").val().trim().toUpperCase();
				var dest = $("#flt_to_src").val().trim().toUpperCase();
				startFSQuery(airline, flightDate, origin, dest);
			}
			
		});
		
		$(id).on("getData", function(event, dataID) {
			console.log(dataID);
			
			var rtn;
			var seq;
			var dataType = dataID.substring(0, dataID.lastIndexOf("_"));
			if (dataType == "") {
				dataType = dataID;
			} else {
				seq = dataID.substring(dataID.lastIndexOf("_")+1);
			}
			
			switch(dataType) {
				case "FlightNo":
					rtn = $("#flight_flt_no_"+seq).val().toUpperCase();
					break;
				case "Date":
					rtn = $("#flight_flt_date_"+seq).val();
					break;
				case "From":
					rtn = $("#flight_flt_from_"+seq).val().toUpperCase();
					break;
				case "To":
					rtn = $("#flight_flt_to_"+seq).val().toUpperCase();
					break;
				case "AllotmentID":
                    rtn = $("#cx_flight_flt_allt_" + seq).val().toUpperCase();
					break;
				case "AllocationCode":
					rtn = $("#flight_flt_alloc_"+seq).val().toUpperCase();
					break;
				case "AllFlightNo":
					var flightNoList = [];
					$('#flt_order_list .flight_num_input').each(function(index, el){
						if(el.value)
							flightNoList.push(el.value.toUpperCase());
					})
					rtn = flightNoList;
					break;
				case "Pieces":
					rtn = $("#flight_pcs_"+seq).val();
					break;
				case "Weight":
					rtn = $("#flight_weight_"+seq).val();
					break;
				case "Volume":
					rtn = $("#flight_vol_"+seq).val();
					break;
			}
			
			return rtn;
		});
		
		$(id).on("setData", function(event, dataID, value) {
			console.log(dataID);
			console.log(value);
			
			var seq;
			var currentRowID;
			var dataType = dataID.substring(0, dataID.lastIndexOf("_"));
			if (dataType == "") {
				dataType = dataID;
			} else {
				seq = dataID.substring(dataID.lastIndexOf("_")+1);
				currentRowID = getComponentRowID("flight_segment_input_row");
				
				if (seq > currentRowID) {
					//console.log("seq: " + seq);
					//console.log("currentRowID: " + currentRowID);
					var diff = seq - currentRowID;
					for (var i = 0; i < diff; i++) {
						AddFlightSegmentInput();
					}
				}
			}

			switch(dataType) {
				case "FlightNo":
					$("#flight_flt_no_"+seq).val(value);
					break;
				case "Date":
					$("#flight_flt_date_"+seq).val(value);
					break;
				case "From":
					$("#flight_flt_from_"+seq).val(value);
					break;
				case "To":
					$("#flight_flt_to_"+seq).val(value);
					break;
				case "AllotmentID":
                    $("#cx_flight_flt_allt_" + seq).val(value);
					break;
				case "AllocationCode":
					$("#flight_flt_alloc_"+seq).val(value);
					break;
				case "Pieces":
					$("#flight_pcs_"+seq).val(value);
					break;
				case "Weight":
					$("#flight_weight_"+seq).val(value);
					break;
				case "Volume":
					$("#flight_vol_"+seq).val(value);
					break;
			}
		
		});
		
		$(id).on("getTemplateData", function(event) {
		
			var arr = [];
			var obj;
			
			$("li[class^='flight_segment_input_row']").each(function (i, el) {
				//var id = el.id.substring(el.id.indexOf("_")+1);
				var rowid = $(this).attr("data-rowid");
				//console.log("flightSegment");
				//console.log("rowid: " +rowid);
				//console.log("i: " +i);
				
				obj = new Object();
				obj.ModuleID = blockID;
				obj.DataID = "FlightNo_"+rowid;
				obj.Content = $("#flight_flt_no_"+rowid).val() || "";
				obj.Content = obj.Content.toUpperCase();
				arr.push(obj);
				
				obj = new Object();
				obj.ModuleID = blockID;
				obj.DataID = "Date_"+rowid;
				obj.Content = $("#flight_flt_date_"+rowid).val() || "";
				arr.push(obj);
				
				obj = new Object();
				obj.ModuleID = blockID;
				obj.DataID = "From_"+rowid;
				obj.Content = $("#flight_flt_from_"+rowid).val() || "";
				obj.Content = obj.Content.toUpperCase();
				arr.push(obj);
				
				obj = new Object();
				obj.ModuleID = blockID;
				obj.DataID = "To_"+rowid;
				obj.Content = $("#flight_flt_to_"+rowid).val() || "";
				obj.Content = obj.Content.toUpperCase();
				arr.push(obj);
				
				obj = new Object();
				obj.ModuleID = blockID;
				obj.DataID = "AllotmentID_"+rowid;
                obj.Content = $("#cx_flight_flt_allt_" + rowid).val() || "";
				obj.Content = obj.Content.toUpperCase();
				arr.push(obj);
				
				obj = new Object();
				obj.ModuleID = blockID;
				obj.DataID = "AllocationCode_"+rowid;
				obj.Content = $("#flight_flt_alloc_"+rowid).val() || $("#flight_flt_alloc_hd_"+rowid).val() || "";
				obj.Content = obj.Content.toUpperCase();
				arr.push(obj);

				obj = new Object();
				obj.ModuleID = blockID;
				obj.DataID = "Pieces_"+rowid;
                obj.Content = $("#flight_pcs_" + rowid).val() || "";
				arr.push(obj);

				obj = new Object();
				obj.ModuleID = blockID;
				obj.DataID = "Weight_"+rowid;
                obj.Content = $("#flight_weight_" + rowid).val() || "";
				arr.push(obj);

				obj = new Object();
				obj.ModuleID = blockID;
				obj.DataID = "Volume_"+rowid;
                obj.Content = $("#flight_vol_" + rowid).val() || "";
				arr.push(obj);

			});
			
			return {
				"FlightSegmentInfo" : {
					"TDataList" : arr,
				}
			}
			
		});

		$(id).on("refreshPlaceHolder", function(event) {
			$('#search_flight .flight_flt').attr("placeholder", i18next.t("BookingLandingPage.CityNameOrCode"));

			//init weight and volume unit
			var weightUnitVal = $("#bkd_def_cargoinfo").triggerHandler("getData", 'WeightUnit');
			var volUnit = $("#bkd_def_cargoinfo").triggerHandler("getData", 'VolumeUnit');
			
			$(id).triggerHandler("handleWeightUnitChange", weightUnitVal);
			$(id).triggerHandler("handleVolUnitChange", volUnit);
		});

		$(id).on("handleWeightUnitChange", function(event, val) {
			switch(val) {
				case "0":
					$("#flt_order_list .flight_weight_unit").text(i18next.t("cargoInfo.KG"));
					break;
				case "1":
					$("#flt_order_list .flight_weight_unit").text(i18next.t("cargoInfo.LB"));
					break;
				default:
					$("#flt_order_list .flight_weight_unit").text(i18next.t("cargoInfo.KG"));
			}
		});

		$(id).on("handleVolUnitChange", function(event, val) {
			switch(val) {
				case "0":
					$("#flt_order_list .flight_vol_unit").text(i18next.t("cargoInfo.MC"));
					break;
				case "1":
					$("#flt_order_list .flight_vol_unit").text(i18next.t("cargoInfo.CF"));
					break;
				default:
					$("#flt_order_list .flight_vol_unit").text(i18next.t("cargoInfo.MC"));
			}
		});

		$(".flight_int_input").keypress(function (e) {
			console.log(e.which);
			if (e.which >= 48 && e.which <= 57) {
			} else {
				return false;
			}
		});

		$(".flight_dec_input").keypress(function (e) {
			console.log(e.which);
			if ((e.which >= 48 && e.which <= 57) || e.which == 46) {
			} else {
				return false;
			}
		});

		$(".flight_dec_input_volume").blur(function (e) {
			if ($(this).val() != "") {
				$(this).val(FormatDecInput($(this).val(), decimalVolumeRoundToCX));
			}
		});

		$(".flight_dec_input_weight").blur(function (e) {
			if ($(this).val() != "") {
				$(this).val(FormatDecInput($(this).val(), decimalWeightRoundTo));
			}
		});
		
		function AddFlightSegmentInput(cID, dID, callback) {
			//console.log("AddFlightSegmentInput triggered");
			var row = $("#flt_input_row_temp").html();
			
			var currentRowID = getComponentRowID("flight_segment_input_row");
			row = row.replaceAll("%ID%", currentRowID + 1);
			$(".flight_segment_input_wrapper").append(row);
			var newRowID = currentRowID + 1;
			$("#flight_flt_date_" + newRowID).datepicker(getDatePickerOpt());

			$("#flight_flt_date_" + newRowID).blur(function () {
				val = $(this).val();
				val1 = Date.parse(val);
				if (isNaN(val1) == true && val !== '') {
					$(this).datepicker("setDate", new Date());
				}
			});

			if (typeof callback === "function" && typeof cID !== 'undefined' && typeof dID !== 'undefined') {
				callback(cID, dID);
			}

			regPortQueryV2();
			
			if (newRowID >= 10) {
				$("#btnAddSegment").css("display", "none");
			}		
			bkdAutoAllotmentClick();
			refreshModuleTranslation();

			$(".flight_segment_input_row[data-rowid=" + newRowID + "] .flight_int_input").keypress(function(e) {
				console.log(e.which);
				if(e.which >= 48 && e.which <= 57 ){
				} else {
					return false;
				}
			});

			$(".flight_segment_input_row[data-rowid=" + newRowID + "] .flight_dec_input").keypress(function(e) {
				console.log(e.which);
				if((e.which >= 48 && e.which <= 57) || e.which == 46 ){
				} else {
					return false;
				}
			});

			$(".flight_segment_input_row[data-rowid=" + newRowID + "] .flight_dec_input_volume").blur(function(e) {
				if ($(this).val() != "") {
					$(this).val(FormatDecInput($(this).val(), decimalVolumeRoundToCX));
				}
			});
			
			$(".flight_segment_input_row[data-rowid=" + newRowID + "] .flight_dec_input_weight").blur(function(e) {
				if ($(this).val() != "") {
					$(this).val(FormatDecInput($(this).val(), decimalWeightRoundTo));
				}
			});
		}
        
	});	
	
	function InsertFlightSegmentInput(cID, dID, callback) {
		var row = $("#flt_input_row_temp").html();
	
		var newRowID = cID + "a";
		var childIndex = cID -1;
		console.log("childIndex: " + childIndex);
		console.log("cID: " + cID);
		row = row.replaceAll("%ID%", newRowID);
		$("li[class^='flight_segment_input_row']:nth-child("+childIndex+")").after(row);

		$("#flight_flt_date_" + newRowID).datepicker(getDatePickerOpt());

		$("#flight_flt_date_" + newRowID).blur(function () {
			val = $(this).val();
			val1 = Date.parse(val);
			if (isNaN(val1) == true && val !== '') {
				$(this).datepicker("setDate", new Date());
			}
		});

		if (typeof callback === "function" && typeof cID !== 'undefined' && typeof dID !== 'undefined') {
			callback(newRowID, dID);
		}

		regPortQueryV2();
		bkdAutoAllotmentClick();

		$(".flight_segment_input_row[data-rowid=" + newRowID + "] .flight_int_input").keypress(function(e) {
			console.log(e.which);
			if(e.which >= 48 && e.which <= 57 ){
			} else {
				return false;
			}
		});

		$(".flight_segment_input_row[data-rowid=" + newRowID + "] .flight_dec_input").keypress(function(e) {
			console.log(e.which);
			if((e.which >= 48 && e.which <= 57) || e.which == 46 ){
			} else {
				return false;
			}
		});

		$(".flight_segment_input_row[data-rowid=" + newRowID + "] .flight_dec_input_volume").blur(function(e) {
			if ($(this).val() != "") {
				$(this).val(FormatDecInput($(this).val(), decimalVolumeRoundToCX));
			}
		});
		
		$(".flight_segment_input_row[data-rowid=" + newRowID + "] .flight_dec_input_weight").blur(function(e) {
			if ($(this).val() != "") {
				$(this).val(FormatDecInput($(this).val(), decimalWeightRoundTo));
			}
		});
	}
	
	// Allotment
	function bkdAutoAllotmentClick(event) {
		var current = $("#bkdUseAutoAllot").prop('checked');
		bkdToggleAutoAllotment(current);
	}
	
    function bkdToggleAutoAllotment(bkd_cx_using_auto) {
        //debugger;	

        if (bkd_cx_using_auto) {
            $(".bkd_flight_allotment").addClass("disabled");
        }
        else {
            $(".bkd_flight_allotment").removeClass("disabled");
        }

        var i = 1;
        while (true) {
            if ($("#bkd_flight_allotment_val_" + i).length == 0) break;

            if (bkd_cx_using_auto) {
				/*
				if ($("#bkd_flight_allotment_val_" + i).val() != "") {
					$("#bkd_flight_allotment_lbl_" + i).removeClass("disabled");				
				}
				else {
					$("#bkd_flight_allotment_lbl_" + i).addClass("disabled");				
				}
				*/
                $("#bkd_flight_allotment_lbl_" + i).removeClass("disabled");
                $("#bkd_flight_allotment_val_" + i).val("");
                $("#cx_flight_flt_allt_" + i).addClass("disabled");
                $("#cx_flight_flt_allt_" + i).val("");

            } else {
                //$("#bkd_flight_allotment_lbl_" + i).addClass("disabled");

                $("#bkd_flight_allotment_lbl_" + i).addClass("disabled");
                $("#bkd_flight_allotment_val_" + i).val("");
                $("#cx_flight_flt_allt_" + i).removeClass("disabled");
                $("#cx_flight_flt_allt_" + i).val("");
            }

            i++;
        }


    }
	
	function bkdCXRegTWWarehouseCode() {	
		var whCodeList = 		
			[
				{value: "CA - Taiwan Air Cargo Terminal Ltd. - Export", data: "CA"},
				{value: "CE - Taiwan Air Cargo Terminal Ltd. - Express", data: "CE"},
				{value: "CG - Evergreen Air Cargo Services. Corp. - Export", data: "CG"},
				{value: "CH - Ever Terminal Co., Ltd. - Export", data: "CH"},
				{value: "CL - Far Glory Air Cargo Terminal Co., Ltd. - Export", data: "CL"},
				{value: "CR - Evergreen Air Cargo Sevrices. Corp. - Express", data: "CR"},
				{value: "CV - Ever Terminal Co., Ltd. - Express", data: "CV"},
				{value: "DF - DF", data: "DF"}
			];

		$('#bkdTWWhsCode').devbridgeAutocomplete({

			lookup: whCodeList,
			preserveInput: true,
			deferRequestBy: 300,
			minChars: 0,
			autoSelectFirst: true,
			onSelect: function (response) {
				$(this).val(response.data);				
			},
			lookupLimit: 10
		});		
	}
	
	function setWarehouseOption() {
		if (typeof warehouseCX !== 'undefined' && warehouseCX != null) {
			$('#bkdTWWhsCode option').remove();
			for (var i = 0; i < warehouseCX.length; i++) {
				if (warehouseCX[i] == "") {
					$('#bkdTWWhsCode').append('<option value="">&nbsp;</option>');
				} else {
					$('#bkdTWWhsCode').append('<option value="'+warehouseCX[i]+'">'+warehouseCXDesc[i]+'</option>');
				}
			}
		}
	}
	
	function ExpandNGTT()
    {
        if (typeof CheckNGTTExpand === "function") {
            if (CheckNGTTExpand(false)) {
                $("#bkd_def_ngtt").show();
            }
            else {
                $("#bkd_def_ngtt").hide();
            }
        }
    }
	
</script><div id="bkd_def_remarks" class="bkd_block">
	<div class="col-xs-12">
		<h3 class="expandable_title" data-i18n="cargoInfo.Remarks" data-toggle="collapse" href="#remarks_info" tabindex="0">Remarks</h3>
		<span class="collapse_icon">
			<i class="fa fa-arrow-circle-up fa-lg" aria-hidden="true" data-toggle="collapse" href="#remarks_info"></i>
		</span>
	</div>
	<div class="head_hr"></div>
    <div id="remarks_info" class="collapse_wrapper consign_info collapse in">
        <div class="cnt_inline chk_general">
            <label for="remark_osi" data-i18n="remark.OSI">Other Service Information</label>
            <div>
	            <input class="w100" id="remark_osi" maxlength="75" readonly="">
	            <div class="error_or_msg" style="display:none;" data-i18n="cargoInfo.Invalid">Invalid</div>
	        </div>
	        <div>
	            <input class="w100" id="remark_osi2" maxlength="75" style="margin-top: 5px;" readonly="">
	            <div class="error_or_msg" style="display:none;" data-i18n="cargoInfo.Invalid">Invalid</div>
	        </div>
        </div>
        <div class="cnt_inline chk_general">
            <label for="remark_ssi" data-i18n="remark.SSI">Special Service Information</label>
            <div>
	            <input class="w100" id="remark_ssi" maxlength="75">
	            <div class="error_or_msg" style="display:none;" data-i18n="cargoInfo.Invalid">Invalid</div>
	        </div>
	        <div>
	            <input class="w100" id="remark_ssi2" maxlength="75" style="margin-top: 5px;">
	            <div class="error_or_msg" style="display:none;" data-i18n="cargoInfo.Invalid">Invalid</div>
	        </div>
        </div>
    </div>
</div>

<script>
	$(function() {
		var id = "#bkd_def_remarks";
		var blockID = "bkd_def_remarks";

		$(id).on("clear", function(event) {
			//console.log(data);

			//debugger;
			$("#remark_osi").val("");
			$("#remark_ssi").val("");
			$("#remark_osi2").val("");
			$("#remark_ssi2").val("");

			$(id+" .error_or_msg").hide();
			$(id+" .error_or").removeClass("error_or");

		});

		$(id).on("init", function(event, data) {
			console.log(data);
			//debugger;

			if (typeof data.Remark !== 'undefined' && data.Remark != null) {
				$("#remark_osi").val(data.Remark.OtherServiceInfo);
				$("#remark_ssi").val(data.Remark.SpServiceInfo);
				$("#remark_osi2").val(data.Remark.OtherServiceInfo2);
				$("#remark_ssi2").val(data.Remark.SpServiceInfo2);
			}

		});

		$(id).on("validate", function() {
			console.log("OK");

			var isValid = true;

			var osi = $("#remark_osi").val();
			var osi2 = $("#remark_osi2").val();
			var ssi = $("#remark_ssi").val();
			var ssi2 = $("#remark_ssi2").val();

			//75 is for CXWebService only
			if (!StringFormatChecker.checkFormatT(osi, 0, 75)) {
				$("#remark_osi ~ .error_or_msg").show();
				$("#remark_osi").parent().addClass("error_or");
				isValid = false;
			} else {
				$("#remark_osi ~ .error_or_msg").hide();
				$("#remark_osi").parent().removeClass("error_or");
			}

			if (!StringFormatChecker.checkFormatT(osi2, 0, 75)) {
				$("#remark_osi2 ~ .error_or_msg").show();
				$("#remark_osi2").parent().addClass("error_or");
				isValid = false;
			} else {
				$("#remark_osi2 ~ .error_or_msg").hide();
				$("#remark_osi2").parent().removeClass("error_or");
			}

			if (!StringFormatChecker.checkFormatT(ssi, 0, 75)) {
				$("#remark_ssi ~ .error_or_msg").show();
				$("#remark_ssi").parent().addClass("error_or");
				isValid = false;
			} else {
				$("#remark_ssi ~ .error_or_msg").hide();
				$("#remark_ssi").parent().removeClass("error_or");
			}

			if (!StringFormatChecker.checkFormatT(ssi2, 0, 75)) {
				$("#remark_ssi2 ~ .error_or_msg").show();
				$("#remark_ssi2").parent().addClass("error_or");
				isValid = false;
			} else {
				$("#remark_ssi2 ~ .error_or_msg").hide();
				$("#remark_ssi2").parent().removeClass("error_or");
			}

			return isValid;
		});

		$(id).on("submit", function() {

			var osi = $("#remark_osi").val();
			var ssi = $("#remark_ssi").val();
			var osi2 = $("#remark_osi2").val();
			var ssi2 = $("#remark_ssi2").val();

			return {
				"Remark" : {
					"OtherServiceInfo" : osi,
					"OtherServiceInfo2" : osi2,
					"SpServiceInfo" : ssi,
					"SpServiceInfo2" : ssi2
				}
			};
		});

		$(id).on("loadBookingData", function(event, bkdData) {
			//console.log(bkdData);
			//var currentRowID;
			//var insertRowID;
			//debugger;

			if (typeof bkdData.Osi !== 'undefined' && bkdData.Osi != null) {
				if (typeof bkdData.Osi[0] !== 'undefined' && bkdData.Osi[0] != null) {
					$("#remark_osi").val(bkdData.Osi[0]);
				} else {
					$("#remark_osi").val("");
				}

				if (typeof bkdData.Osi[1] !== 'undefined' && bkdData.Osi[1] != null) {
					$("#remark_osi2").val(bkdData.Osi[1]);
				} else {
					$("#remark_osi2").val("");
				}
			}

			if (typeof bkdData.SsrDetail !== 'undefined' && bkdData.SsrDetail != null) {
				if (typeof bkdData.SsrDetail[0] !== 'undefined' && bkdData.SsrDetail[0] != null) {
					$("#remark_ssi").val(bkdData.SsrDetail[0]);
				} else {
					$("#remark_ssi").val("");
				}

				if (typeof bkdData.SsrDetail[1] !== 'undefined' && bkdData.SsrDetail[1] != null) {
					$("#remark_ssi2").val(bkdData.SsrDetail[1]);
				} else {
					$("#remark_ssi2").val("");
				}
			}

		});

		$(id).on("getData", function(event, dataID) {
			console.log(dataID);

			var rtn;

			switch(dataID) {
				case "OSI":
					rtn = $("#remark_osi").val();
					break;
				case "OSI2":
					rtn = $("#remark_osi2").val();
					break;
				case "SSI":
					rtn = $("#remark_ssi").val();
					break;
				case "SSI2":
					rtn = $("#remark_ssi2").val();
					break;
			}

			return rtn;

		});

		$(id).on("setData", function(event, dataID, value) {
			console.log(dataID);
			console.log(value);

			switch(dataID) {
				case "OSI":
					$("#remark_osi").val(value);
					break;
				case "OSI2":
					$("#remark_osi2").val(value);
					break;
				case "SSI":
					$("#remark_ssi").val(value);
					break;
				case "SSI2":
					$("#remark_ssi2").val(value);
					break;
			}

		});

		$(id).on("getTemplateData", function(event) {

			var osi = $("#remark_osi").val();
			var ssi = $("#remark_ssi").val();
			var osi2 = $("#remark_osi2").val();
			var ssi2 = $("#remark_ssi2").val();

			var arr = [];
			var obj = new Object();
			obj.ModuleID = blockID;
			obj.DataID = "OSI";
			obj.Content = osi;
			arr.push(obj);

			obj = new Object();
			obj.ModuleID = blockID;
			obj.DataID = "SSI";
			obj.Content = ssi;
			arr.push(obj);

			var obj = new Object();
			obj.ModuleID = blockID;
			obj.DataID = "OSI2";
			obj.Content = osi2;
			arr.push(obj);

			obj = new Object();
			obj.ModuleID = blockID;
			obj.DataID = "SSI2";
			obj.Content = ssi2;
			arr.push(obj);

			return {
				"Remark" : {
					"TDataList" : arr,
				}
			}

		});

		$(id + ' .collapse_wrapper').on('hidden.bs.collapse', function (e) {
			$(id + " .collapse_icon i").removeClass("fa-arrow-circle-down fa-arrow-circle-up");
			$(id + " .collapse_icon i").addClass("fa-arrow-circle-down");
		})

		$(id + ' .collapse_wrapper').on('shown.bs.collapse', function (e) {
			$(id + " .collapse_icon i").removeClass("fa-arrow-circle-down fa-arrow-circle-up");
			$(id + " .collapse_icon i").addClass("fa-arrow-circle-up");
		})

		$(id).find(".expandable_title").keypress(function (e) {
			if(e.keyCode == 13){
				this.click();
			}
		});
	});

	function remarkEnableOSI() {
		$('#remark_osi').prop('readonly', false);
		$('#remark_osi2').prop('readonly', false);
	}

	function remarkDisableClearOSI() {
		debugger;
		$('#remark_osi').prop('readonly', true);
		$('#remark_osi2').prop('readonly', true);
		$('#remark_osi').val("");
		$('#remark_osi2').val("");
	}
</script><div id="bkd_def_uld" class="bkd_block">
	<div class="col-xs-12">
		<h3 class="expandable_title" data-i18n="uld.ULDInfo" data-toggle="collapse" href="#uld_info" tabindex="0">ULD Information</h3>
		<span class="collapse_icon">
			<i class="fa fa-arrow-circle-down fa-lg" aria-hidden="true" data-toggle="collapse" href="#uld_info"></i>
		</span>
	</div>
	<div class="head_hr"></div>

	<div id="uld_info" class="collapse_wrapper collapse">
		<div class="col-xs-12 col-md-5">
			<div class="blk_gy_line blkl">
				<h4 data-i18n="uld.PalletContainer">Pallet/ Container</h4>
				<div class="blk_pallet">
					<label for="uld_upper_deck_pallet" data-i18n="uld.UpperDeckPallet">Upper Deck Pallet</label>
					<input type="text" id="uld_upper_deck_pallet" class="uld_pallet_input" maxlength="2">
				</div>
				<div class="blk_pallet">
					<label for="uld_lower_deck_pallet" data-i18n="uld.LowerDeckPallet">Lower Deck Pallet</label>
					<input type="text" id="uld_lower_deck_pallet" class="uld_pallet_input" maxlength="2">
				</div>
				<div class="blk_pallet">
					<label for="uld_lower_deck_container" data-i18n="uld.LowerDeckContainer">Lower Deck Container</label>
					<input type="text" id="uld_lower_deck_container" class="uld_pallet_input" maxlength="2">
				</div>
			</div>
		</div>

		<div class="col-xs-12 col-md-5">
			<div class="blk_gy_line blkl">
				<h4 data-i18n="uld.ULDContour">ULD Contour</h4>
				<div class="blk_contour bu_txt">
					<ol class="added_list uld_contour_input_wrapper">
						<li class="uld_contour_input_row" data-rowid="1">
							<select class="select_bu" id="uld_select_type_1">
								<option value="">&nbsp;</option>
								<option value="A2">A2</option>
								<option value="A3">A3</option>
								<option value="H2">H2</option>
								<option value="H3">H3</option>
								<option value="L3">L3</option>
								<option value="Q6">Q6</option>
								<option value="Q7">Q7</option>
								<option value="S6">S6</option>
								<option value="UP">UP</option>
								<option value="W2">W2</option>
								<option value="W3">W3</option>
								<option value="X2">X2</option>
								<option value="X4">X4</option>
								<option value="X6">X6</option>
								<option value="X8">X8</option>
								<option value="ZA">ZA</option>
								<option value="ZB">ZB</option>
								<option value="ZC">ZC</option>
								<option value="C1">C1</option>
								<option value="C2">C2</option>
								<option value="C3">C3</option>
								<option value="J1">J1</option>
								<option value="J2">J2</option>
								<option value="J3">J3</option>
							</select>
							<input id="uld_no_value_1" type="text" placeholder="No. of ULDs" class="uld_int_input" maxlength="2">
							<div class="error_or_msg" style="display: none;">Invalid</div>
						</li>
						<li class="uld_contour_input_row" data-rowid="2">
							<select class="select_bu" id="uld_select_type_2">
								<option value="">&nbsp;</option>
								<option value="A2">A2</option>
								<option value="A3">A3</option>
								<option value="H2">H2</option>
								<option value="H3">H3</option>
								<option value="L3">L3</option>
								<option value="Q6">Q6</option>
								<option value="Q7">Q7</option>
								<option value="S6">S6</option>
								<option value="UP">UP</option>
								<option value="W2">W2</option>
								<option value="W3">W3</option>
								<option value="X2">X2</option>
								<option value="X4">X4</option>
								<option value="X6">X6</option>
								<option value="X8">X8</option>
								<option value="ZA">ZA</option>
								<option value="ZB">ZB</option>
								<option value="ZC">ZC</option>
								<option value="C1">C1</option>
								<option value="C2">C2</option>
								<option value="C3">C3</option>
								<option value="J1">J1</option>
								<option value="J2">J2</option>
								<option value="J3">J3</option>
							</select>
							<input id="uld_no_value_2" type="text" placeholder="No. of ULDs" class="uld_int_input" maxlength="2">
							<div class="error_or_msg" style="display: none;">Invalid</div>
						</li>
						<li class="uld_contour_input_row" data-rowid="3">
							<select class="select_bu" id="uld_select_type_3">
								<option value="">&nbsp;</option>
								<option value="A2">A2</option>
								<option value="A3">A3</option>
								<option value="H2">H2</option>
								<option value="H3">H3</option>
								<option value="L3">L3</option>
								<option value="Q6">Q6</option>
								<option value="Q7">Q7</option>
								<option value="S6">S6</option>
								<option value="UP">UP</option>
								<option value="W2">W2</option>
								<option value="W3">W3</option>
								<option value="X2">X2</option>
								<option value="X4">X4</option>
								<option value="X6">X6</option>
								<option value="X8">X8</option>
								<option value="ZA">ZA</option>
								<option value="ZB">ZB</option>
								<option value="ZC">ZC</option>
								<option value="C1">C1</option>
								<option value="C2">C2</option>
								<option value="C3">C3</option>
								<option value="J1">J1</option>
								<option value="J2">J2</option>
								<option value="J3">J3</option>
							</select>
							<input id="uld_no_value_3" type="text" placeholder="No. of ULDs" class="uld_int_input" maxlength="2">
							<div class="error_or_msg" style="display: none;">Invalid</div>
						</li>
					</ol>
					<a id="btnAddULDIcon" href="javascript:void(0)" class="bu_plus_link" tabindex="-1"><span></span></a>
					<a id="btnAddULD" href="javascript:void(0)" class="bu_plus_link" data-i18n="uld.AddMoreULD">Add more ULD</a>
				</div>
			</div>

			<div class="blkc"></div>
		</div>

		<div class="clearfix"></div>
	</div>
</div>

<script id="uld_input_row_temp" type="text/x-template">
	<li class="uld_contour_input_row extra_row" data-rowid="%ID%">
		<select class="select_bu" id="uld_select_type_%ID%">
			<option value="">&nbsp;</option>
			<option value="A2">A2</option>
			<option value="A3">A3</option>
			<option value="H2">H2</option>
			<option value="H3">H3</option>
			<option value="L3">L3</option>
			<option value="Q6">Q6</option>
			<option value="Q7">Q7</option>
			<option value="S6">S6</option>
			<option value="UP">UP</option>
			<option value="W2">W2</option>
			<option value="W3">W3</option>
			<option value="X2">X2</option>
			<option value="X4">X4</option>
			<option value="X6">X6</option>
			<option value="X8">X8</option>
			<option value="ZA">ZA</option>
			<option value="ZB">ZB</option>
			<option value="ZC">ZC</option>
			<option value="C1">C1</option>
			<option value="C2">C2</option>
			<option value="C3">C3</option>
			<option value="J1">J1</option>
			<option value="J2">J2</option>
			<option value="J3">J3</option>
		</select>
		<input id="uld_no_value_%ID%" type="text" placeholder="No.of ULDs" class="uld_int_input" maxlength="2" />
		<div class="error_or_msg" style="display: none;">Invalid</div>
	</li>
</script>

<script>
	$(function() {
		var id = "#bkd_def_uld";
		var blockID = "bkd_def_uld";
		
		$(id).on("clear", function(event) {
			//console.log(data);
			
			//debugger;
			$("#uld_upper_deck_pallet").val("");
			$("#uld_lower_deck_pallet").val("");
			$("#uld_lower_deck_container").val("");
			
			$("li[class^='uld_contour_input_row']").each(function (i, el) {
				//var id = el.id.substring(el.id.indexOf("_")+1);
				var rowid = $(this).attr("data-rowid");
				//console.log("flightSegment");
				//console.log("rowid: " +rowid);
				//console.log("i: " +i);
				 
				$("#uld_select_type_"+rowid).val("");
				$("#uld_no_value_"+rowid).val("");
				$("#uld_no_value_"+rowid).removeClass("invalid_input_field");
				$("#uld_no_value_"+rowid+" ~ .error_or_msg").hide();
				
			});
			
			$(".uld_contour_input_row.extra_row").remove();
			
			$(id+" .error_or_msg").hide();
			$(id+" .error_or").removeClass("error_or");
		});
		
		$(id).on("init", function(event, data) {
			console.log(data);
			var currentRowID;
			
			if (typeof data.ULDInfo !== 'undefined' && data.ULDInfo != null) {
				$("#uld_upper_deck_pallet").val(data.ULDInfo.UpperDeckPallet);
				$("#uld_lower_deck_pallet").val(data.ULDInfo.LowerDeckPallet);
				$("#uld_lower_deck_container").val(data.ULDInfo.LowerDeckContainer);
				
				if (typeof data.ULDInfo.ULDContour !== 'undefined' && data.ULDInfo.ULDContour != null) {
					for (var i = 0; i < data.ULDInfo.ULDContour.length; i++) {
						currentRowID = i + 1;
						
						if (i > 2) {
							AddULDContourInput(currentRowID, i, function(cID, dataRow){
								$("#uld_select_type_" + cID).val(data.ULDInfo.ULDContour[dataRow].ULDType);
								$("#uld_no_value_" + cID).val(data.ULDInfo.ULDContour[dataRow].ULDVal);
							});
						} else {
							$("#uld_select_type_" + currentRowID).val(data.ULDInfo.ULDContour[i].ULDType);
							$("#uld_no_value_" + currentRowID).val(data.ULDInfo.ULDContour[i].ULDVal);
						}
					}
				}
			}
			
		});
		
		$(id).on("validate", function() {
			console.log("OK");
			
			//var intVad = /^\+?(0|[1-9]\d*)$/;
			//var decVad = /^([1-9]\d*|0\.\d*[1-9]|[1-9]\d*\.\d*[0-9]|0)$/;
			
			var upperDeckPallet = $("#uld_upper_deck_pallet").val();
			var lowerDeckPallet = $("#uld_lower_deck_pallet").val();
			var lowerDeckContainer = $("#uld_lower_deck_container").val();
			var isValid = true;
			var LHContourCodeList = ['C1', 'C2', 'C3', 'J1', 'J2', 'J3'];
			
			if (upperDeckPallet != ""){
			} else {
			}
			
			if (lowerDeckPallet != ""){
			} else {
			}
			
			if (lowerDeckContainer != ""){
			} else {
			}
			
			$("li[class^='uld_contour_input_row']").each(function (i, el) {
				//var id = el.id.substring(el.id.indexOf("_")+1);
				var rowid = $(this).attr("data-rowid");
				//console.log("flightSegment");
				//console.log("rowid: " +rowid);
				//console.log("i: " +i);
				 
				var ULDType = $("#uld_select_type_"+rowid).val();
				var ULDVal = $("#uld_no_value_"+rowid).val();

				$("#uld_no_value_"+rowid+" ~ .error_or_msg").text(i18next.t("uld.Invalid"));
				$("#uld_no_value_"+rowid).removeClass("invalid_input_field");
				$("#uld_select_type_"+rowid).removeClass("invalid_input_field");
				$("#uld_no_value_"+rowid+" ~ .error_or_msg").hide();

				if (ULDType != "") {
					if (ULDVal != "" && !decVad.test(ULDVal)) {
						//$("#uld_no_value_"+rowid).css("background-color", "#ffffcc");
						$("#uld_no_value_"+rowid).addClass("invalid_input_field");
						$("#uld_no_value_"+rowid+" ~ .error_or_msg").show();
						$("#uld_no_value_"+rowid+" ~ .error_or_msg").css("display", "inline");
						isValid = false;
					} else if (ULDVal == "" ){
						$("#uld_no_value_"+rowid).addClass("invalid_input_field");
						$("#uld_no_value_"+rowid+" ~ .error_or_msg").show();
						$("#uld_no_value_"+rowid+" ~ .error_or_msg").css("display", "inline");
						isValid = false;
					} else if(!checkIfLHFlightExist()) {
		    			if(_.find(LHContourCodeList, function(o) { return o == ULDType; })){
		    				$("#uld_no_value_"+rowid+" ~ .error_or_msg").text(i18next.t("uld.InvalidContourCode"));
		    				$("#uld_no_value_"+rowid+" ~ .error_or_msg").show();
		    				$("#uld_select_type_"+rowid).addClass("invalid_input_field");
		    				isValid = false;
		    			}
					}
				} else if (ULDVal != "" ){
					$("#uld_no_value_"+rowid).addClass("invalid_input_field");
					$("#uld_no_value_"+rowid+" ~ .error_or_msg").show();
					$("#uld_no_value_"+rowid+" ~ .error_or_msg").css("display", "inline");
					isValid = false;
				}
				
			});
			
			return isValid;
			//return true;
		});
		$(id).on("submit", function() {
		
			var upperDeckPallet = $("#uld_upper_deck_pallet").val();
			var lowerDeckPallet = $("#uld_lower_deck_pallet").val();
			var lowerDeckContainer = $("#uld_lower_deck_container").val();
			
			var uldList = [];
			
			$("li[class^='uld_contour_input_row']").each(function (i, el) {
				//var id = el.id.substring(el.id.indexOf("_")+1);
				var rowid = $(this).attr("data-rowid");
				//console.log("flightSegment");
				//console.log("rowid: " +rowid);
				//console.log("i: " +i);
				 
				var obj = new Object();
				obj.Seq = rowid;
				obj.ULDType = $("#uld_select_type_"+rowid).val();
				obj.ULDVal = $("#uld_no_value_"+rowid).val().toString();
				
				if (obj.ULDType == "" && obj.ULDVal == "") {
				} else {
					uldList.push(obj);
				}
				
			});
			
			return { 
				"ULDInfo" : {
					"UpperDeckPallet": upperDeckPallet,
					"LowerDeckPallet": lowerDeckPallet,
					"LowerDeckContainer": lowerDeckContainer,
					"ULDContour": uldList
				}
			};
		});
		
		$(id).on("loadBookingData", function(event, bkdData) {
			console.log(bkdData);
			var currentRowID;
			//var insertRowID;
			//debugger;
			
			$("#uld_upper_deck_pallet").val("");
			$("#uld_lower_deck_pallet").val("");
			$("#uld_lower_deck_container").val("");
			
			if (typeof bkdData.FlightDetail !== 'undefined' && bkdData.FlightDetail != null) {
				if (bkdData.FlightDetail.length > 0) {
					if (typeof bkdData.FlightDetail[0].FlightDetailCx !== 'undefined' && bkdData.FlightDetail[0].FlightDetailCx != null) {
						$("#uld_upper_deck_pallet").val(bkdData.FlightDetail[0].FlightDetailCx.UDP);
						$("#uld_lower_deck_pallet").val(bkdData.FlightDetail[0].FlightDetailCx.LDP);
						$("#uld_lower_deck_container").val(bkdData.FlightDetail[0].FlightDetailCx.LDC);
						
						if (typeof bkdData.FlightDetail[0].FlightDetailCx.ContourCodeList !== 'undefined' && bkdData.FlightDetail[0].FlightDetailCx.ContourCodeList != null) {
							for (var i = 0; i < bkdData.FlightDetail[0].FlightDetailCx.ContourCodeList.length; i++) {
								currentRowID = i + 1;
								
								if (i > 2) {
									AddULDContourInput(currentRowID, i, function(cID, dataRow){
										$("#uld_select_type_" + cID).val(bkdData.FlightDetail[0].FlightDetailCx.ContourCodeList[dataRow].Code);
										$("#uld_no_value_" + cID).val(bkdData.FlightDetail[0].FlightDetailCx.ContourCodeList[dataRow].Count);
									});
								} else {
									$("#uld_select_type_" + currentRowID).val(bkdData.FlightDetail[0].FlightDetailCx.ContourCodeList[i].Code);
									$("#uld_no_value_" + currentRowID).val(bkdData.FlightDetail[0].FlightDetailCx.ContourCodeList[i].Count);
								}
							}	
						}
					}
				}
			}
			
			/*
			for (var i = 0; i < bkdData.Uld.length; i++) {
				currentRowID = i + 1;
				
				if (i > 2) {
					AddULDContourInput(currentRowID, i, function(cID, dataRow){
						$("#uld_select_type_" + cID).val(bkdData.Uld[dataRow].UldType);
						if (!isNaN(parseFloat(bkdData.Uld[dataRow].UldWeight).toFixed(decimalWeightRoundTo))) {
							$("#uld_no_value_" + cID).val(parseFloat(bkdData.Uld[dataRow].UldWeight).toFixed(decimalWeightRoundTo));
						} else {
							$("#uld_no_value_" + cID).val(bkdData.Uld[dataRow].UldWeight);
						}
					});
				} else {
					$("#uld_select_type_" + currentRowID).val(bkdData.Uld[i].UldType);
					if (!isNaN(parseFloat(bkdData.Uld[i].UldWeight).toFixed(decimalWeightRoundTo))) {
						$("#uld_no_value_" + currentRowID).val(parseFloat(bkdData.Uld[i].UldWeight).toFixed(decimalWeightRoundTo));
					} else {
						$("#uld_no_value_" + currentRowID).val(bkdData.Uld[i].UldWeight);
					}
				}
			}				
			*/
				
		});
		
		$("#btnAddULD").click(function (e) {
			e.preventDefault();
			AddULDContourInput();
			$(".uld_contour_input_wrapper li").last().find("select").focus();
		});
		
		$(".uld_pallet_input").keypress(function(e) {
			if(e.which >= 48 && e.which <= 57 ){
			} else {
				return false;
			}
		});
		
		$(".uld_int_input").keypress(function(e) {
			console.log(e.which);
			if(e.which >= 48 && e.which <= 57 ){
			} else {
				return false;
			}
		});
		
		$(".uld_dec_input, .uld_dec_input_weight").keypress(function(e) {
			console.log(e.which);
			if((e.which >= 48 && e.which <= 57) || e.which == 46 ){
			} else {
				return false;
			}
		});
		
		$(".uld_dec_input").blur(function(e) {
			if ($(this).val() != "") {
				$(this).val(FormatDecInput($(this).val(), decimalRoundTo));
			}
		});
		
		$(".uld_dec_input_weight").blur(function(e) {
			if ($(this).val() != "") {
				$(this).val(FormatDecInput($(this).val(), decimalWeightRoundTo));
			}
		});
		
		$(id).on("getData", function(event, dataID) {
			console.log(dataID);
			
			var rtn;
			var seq;
			var dataType = dataID.substring(0, dataID.lastIndexOf("_"));
			if (dataType == "") {
				dataType = dataID;
			} else {
				seq = dataID.substring(dataID.lastIndexOf("_")+1);
			}
			
			switch(dataType) {
				case "UPD":
					rtn = $("#uld_upper_deck_pallet").val();
					break;
				case "LDP":
					rtn = $("#uld_lower_deck_pallet").val()
					break;
				case "LDC":
					rtn = $("#uld_lower_deck_container").val();
					break;
				case "ULDType":
					rtn = $("#uld_select_type_"+seq).val();
					break;
				case "ULDWeight":
					rtn = $("#uld_no_value_"+seq).val();
					break;
			}
			
			return rtn;
			
		});
		
		$(id).on("setData", function(event, dataID, value) {
			console.log(dataID);
			console.log(value);
			var seq;
			var currentRowID;
			var dataType = dataID.substring(0, dataID.lastIndexOf("_"));
			if (dataType == "") {
				dataType = dataID;
			} else {
				seq = dataID.substring(dataID.lastIndexOf("_")+1);
				currentRowID = getComponentRowID("uld_contour_input_row");
				
				if (seq > currentRowID) {
					var diff = seq - currentRowID;
					for (var i = 0; i < diff; i++) {
						AddULDContourInput();
					}
				}
			}
			
			switch(dataType) {
				case "UPD":
					$("#uld_upper_deck_pallet").val(value);
					break;
				case "LDP":
					$("#uld_lower_deck_pallet").val(value)
					break;
				case "LDC":
					$("#uld_lower_deck_container").val(value);
					break;
				case "ULDType":
					$("#uld_select_type_"+seq).val(value);
					break;
				case "ULDWeight":
					if (!isNaN(parseFloat(value).toFixed(decimalRoundTo))) {
						$("#uld_no_value_"+seq).val(parseFloat(value).toFixed(decimalRoundTo));
					} else {
						$("#uld_no_value_"+seq).val(value);
					}
					break;
			}
		
		});
		
		$(id).on("getTemplateData", function(event) {
				
			var upperDeckPallet = $("#uld_upper_deck_pallet").val() || "";
			var lowerDeckPallet = $("#uld_lower_deck_pallet").val() || "";
			var lowerDeckContainer = $("#uld_lower_deck_container").val() || "";
			
			var arr = [];
			var obj = new Object();
			obj.ModuleID = blockID;
			obj.DataID = "UPD";
			obj.Content = upperDeckPallet;
			arr.push(obj);
			
			obj = new Object();
			obj.ModuleID = blockID;
			obj.DataID = "LDP";
			obj.Content = lowerDeckPallet;
			arr.push(obj);
			
			obj = new Object();
			obj.ModuleID = blockID;
			obj.DataID = "LDC";
			obj.Content = lowerDeckContainer;
			arr.push(obj);
			
			$("li[class^='uld_contour_input_row']").each(function (i, el) {
				//var id = el.id.substring(el.id.indexOf("_")+1);
				var rowid = $(this).attr("data-rowid");
				
				obj = new Object();
				obj.ModuleID = blockID;
				obj.DataID = "ULDType_"+rowid;
				obj.Content = $("#uld_select_type_"+rowid).val() || "";
				obj.Content = obj.Content.toUpperCase();
				arr.push(obj);
				
				obj = new Object();
				obj.ModuleID = blockID;
				obj.DataID = "ULDWeight_"+rowid;
				obj.Content = $("#uld_no_value_"+rowid).val() || "";
				arr.push(obj);
				
			});
			
			return {
				"ULDInfo" : {
					"TDataList" : arr,
				}
			}
			
		});

		$(id).on("refreshPlaceHolder", function(event) {
			$('.uld_int_input').attr("placeholder", i18next.t("createBooking.NoOfULDs"));
		});

		$(id + ' .collapse_wrapper').on('hidden.bs.collapse', function (e) {
			$(id + " .collapse_icon i").removeClass("fa-arrow-circle-down fa-arrow-circle-up");
			$(id + " .collapse_icon i").addClass("fa-arrow-circle-down");
		})

		$(id + ' .collapse_wrapper').on('shown.bs.collapse', function (e) {
			$(id + " .collapse_icon i").removeClass("fa-arrow-circle-down fa-arrow-circle-up");
			$(id + " .collapse_icon i").addClass("fa-arrow-circle-up");
		})

		$(id).find(".expandable_title").keypress(function (e) {
			if(e.keyCode == 13){
				this.click();
			}
		});

        var bkdMaxULDCount = 4;		

		function AddULDContourInput(cID, dID, callback) {

			var row = $("#uld_input_row_temp").html();
			
            var currentRowID = getComponentRowID("uld_contour_input_row");
            currentRowID++;

            if (currentRowID <= bkdMaxULDCount) {
                row = row.replaceAll("%ID%", currentRowID);
                $(".uld_contour_input_wrapper").append(row);

                if (typeof callback === "function" && typeof cID !== 'undefined' && typeof dID !== 'undefined') {
                    callback(cID, dID);
                }

                $(".uld_dec_input").keypress(function (e) {
                    console.log(e.which);
                    if ((e.which >= 48 && e.which <= 57) || e.which == 46) {
                    } else {
                        return false;
                    }
                });
            }

            if (currentRowID >= bkdMaxULDCount) {
				$("#btnAddULDIcon").css("display", "none");
                $("#btnAddULD").css("display", "none");
            }
            refreshModuleTranslation();
        }

        function checkIfLHFlightExist(){
        	var flightNoList = getData("bkd_def_flight", "AllFlightNo");

        	if(_.find(flightNoList, function(flightNo) { return flightNo.includes("LH"); })){
        		return true;
        	}
        	else{
        		return false;
        	}
        }
	});	
	
</script><div id="bkd_def_dim" class="bkd_block">
	<div class="col-xs-12">
		<h3 class="expandable_title" data-i18n="dimension.Dimension" data-toggle="collapse" href="#dimension_info" tabindex="0">Dimension</h3>
		<span class="collapse_icon">
			<i class="fa fa-arrow-circle-down fa-lg" aria-hidden="true" data-toggle="collapse" href="#dimension_info"></i>
		</span>
	</div>
	<div class="head_hr"></div>

	<div id="dimension_info" class="col-xs-12 collapse_wrapper collapse">
		<div class="blk_gy_line blkl">
			<div class="consign_info">
				
				<ol class="add_flights dimension added_list dimension_input_wrapper" style="display: inline-block; width: auto;">
					<li class="dimension_input_row" data-rowid="1" style="margin-right: 0px;">
						<div class="cnt_inline bu_txt w64 mr20">
							<label for="dimension_length_1" data-i18n="dimension.Length">Length</label>
							<input class="vol_cal_input dimension_int_input" type="text" value="" id="dimension_length_1" maxlength="5">
						</div>
						<div class="cnt_inline bu_txt w64 mr20">
							<label for="dimension_width_1" data-i18n="dimension.Width">Width</label>
							<input class="vol_cal_input dimension_int_input" type="text" value="" id="dimension_width_1" maxlength="5">
						</div>
						<div class="cnt_inline bu_txt w64 mr20">
							<label for="dimension_height_1" data-i18n="dimension.Height">Height</label>
							<input class="vol_cal_input dimension_int_input" type="text" value="" id="dimension_height_1" maxlength="5">
						</div>
						<div class="cnt_inline bu_txt w64 mr20 tbl_switch">
							<label for="cm1" data-i18n="dimension.Unit">Unit</label>
							<fieldset class="switch-toggle-set">
								<div class="switch-toggle switch-candy">
									<input id="dimension_cm_1" name="dimension-unit_1" type="radio" value="0" checked=""><label for="dimension_cm_1" onclick="" data-i18n="dimension.CM">CM</label>
									<input id="dimension_in_1" name="dimension-unit_1" type="radio" value="1"><label for="dimension_in_1" onclick="" data-i18n="dimension.IN">IN</label>
									<a></a>
								</div>
							</fieldset>
						</div>
						<div class="cnt_inline bu_txt w64 mr20">
							<label for="dimension_pcs_1" data-i18n="cargoInfo.Pieces">Pieces</label>
							<input class="vol_cal_input int_input pc_cal dimension_int_input" type="text" value="" id="dimension_pcs_1" maxlength="4">
						</div>
						<div class="cnt_inline bu_txt w64 mr20">
							<label for="dimension_weight_1" data-i18n="dimension.Weight">Weight(KG)</label>
							<input class="weight_cal dimension_dec_input_weight" type="text" value="" id="dimension_weight_1" maxlength="7">
						</div>
						<div class="cnt_inline bu_txt w64 mr20">
							<label for="dimension_vol_1" data-i18n="dimension.Volume">Volume(m)</label>
							<input class="volume_cal bkd_num_input" type="text" value="" id="dimension_vol_1" readonly="readonly">
						</div>
						<span class="rubbish_bin" onclick="ClearRow(this.parentElement)"></span>
					</li>

					<li class="dimension_input_row" data-rowid="2" style="margin-right: 0px;">
						<div class="cnt_inline bu_txt w64 mr20">
							<label for="dimension_length_2" data-i18n="dimension.Length">Length</label>
							<input class="vol_cal_input dimension_int_input" type="text" value="" id="dimension_length_2" maxlength="5">
						</div>
						<div class="cnt_inline bu_txt w64 mr20">
							<label for="dimension_width_2" data-i18n="dimension.Width">Width</label>
							<input class="vol_cal_input dimension_int_input" type="text" value="" id="dimension_width_2" maxlength="5">
						</div>
						<div class="cnt_inline bu_txt w64 mr20">
							<label for="dimension_height_2" data-i18n="dimension.Height">Height</label>
							<input class="vol_cal_input dimension_int_input" type="text" value="" id="dimension_height_2" maxlength="5">
						</div>
						<div class="cnt_inline bu_txt w64 mr20 tbl_switch">
							<label for="dimension_cm_2" data-i18n="dimension.Unit">Unit</label>
							<fieldset class="switch-toggle-set">
								<div class="switch-toggle switch-candy">
									<input id="dimension_cm_2" name="dimension-unit_2" type="radio" value="0" checked=""><label for="dimension_cm_2" onclick="" data-i18n="dimension.CM">CM</label>
									<input id="dimension_in_2" name="dimension-unit_2" type="radio" value="1"><label for="dimension_in_2" onclick="" data-i18n="dimension.IN">IN</label>
									<a></a>
								</div>
							</fieldset>
						</div>
						<div class="cnt_inline bu_txt w64 mr20">
							<label for="dimension_pcs_2" data-i18n="cargoInfo.Pieces">Pieces</label>
							<input class="vol_cal_input int_input pc_cal dimension_int_input" type="text" value="" id="dimension_pcs_2" maxlength="4">
						</div>
						<div class="cnt_inline bu_txt w64 mr20">
							<label for="dimension_weight_2" data-i18n="dimension.Weight">Weight(KG)</label>
							<input class="weight_cal dimension_dec_input_weight" type="text" value="" id="dimension_weight_2" maxlength="7">
						</div>
						<div class="cnt_inline bu_txt w64 mr20">
							<label for="dimension_vol_2" data-i18n="dimension.Volume">Volume(m)</label>
							<input class="volume_cal bkd_num_input" type="text" value="" id="dimension_vol_2" readonly="readonly">
						</div>
						<span class="rubbish_bin" onclick="ClearRow(this.parentElement)"></span>
					</li>

					<li class="dimension_input_row" data-rowid="3" style="margin-right: 0px;">
						<div class="cnt_inline bu_txt w64 mr20">
							<label for="dimension_length_3" data-i18n="dimension.Length">Length</label>
							<input class="vol_cal_input dimension_int_input" type="text" value="" id="dimension_length_3" maxlength="5">
						</div>
						<div class="cnt_inline bu_txt w64 mr20">
							<label for="dimension_width_3" data-i18n="dimension.Width">Width</label>
							<input class="vol_cal_input dimension_int_input" type="text" value="" id="dimension_width_3" maxlength="5">
						</div>
						<div class="cnt_inline bu_txt w64 mr20">
							<label for="dimension_height_3" data-i18n="dimension.Height">Height</label>
							<input class="vol_cal_input dimension_int_input" type="text" value="" id="dimension_height_3" maxlength="5">
						</div>
						<div class="cnt_inline bu_txt w64 mr20 tbl_switch">
							<label for="cm3" data-i18n="dimension.Unit">Unit</label>
							<fieldset class="switch-toggle-set">
								<div class="switch-toggle switch-candy">
									<input id="dimension_cm_3" name="dimension-unit_3" type="radio" value="0" checked=""><label for="dimension_cm_3" onclick="" data-i18n="dimension.CM">CM</label>
									<input id="dimension_in_3" name="dimension-unit_3" type="radio" value="1"><label for="dimension_in_3" onclick="" data-i18n="dimension.IN">IN</label>
									<a></a>
								</div>
							</fieldset>
						</div>
						<div class="cnt_inline bu_txt w64 mr20">
							<label for="dimension_pcs_3" data-i18n="cargoInfo.Pieces">Pieces</label>
							<input class="vol_cal_input int_input pc_cal dimension_int_input" type="text" value="" id="dimension_pcs_3" maxlength="4">
						</div>
						<div class="cnt_inline bu_txt w64 mr20">
							<label for="dimension_weight_3" data-i18n="dimension.Weight">Weight(KG)</label>
							<input class="weight_cal dimension_dec_input_weight" type="text" value="" id="dimension_weight_3" maxlength="7">
						</div>
						<div class="cnt_inline bu_txt w64 mr20">
							<label for="dimension_vol_3" data-i18n="dimension.Volume">Volume(m)</label>
							<input class="volume_cal bkd_num_input" type="text" value="" id="dimension_vol_3" readonly="readonly">
						</div>
						<span class="rubbish_bin" onclick="ClearRow(this.parentElement)"></span>
					</li>
				</ol>
                <div>
                    <a id="btnDimensionAddULDIcon" href="javascript:void(0)" class="bu_plus_link" style="display:inline-block;" tabindex="-1"><span></span></a>
					<a id="btnDimensionAddULD" href="javascript:void(0)" class="bu_plus_link" style="display:inline-block;" data-i18n="cargoInfo.AddMore">Add More</a>
                </div>
				<!-- total value -->
				<div>
					<div style="" class="dimension_total title" data-i18n="dimension.Total">Total:</div>
					<div style="" class="dimension_total"><span data-i18n="cargoInfo.Pieces">Pieces</span><div id="dimension_pc_total">0</div></div>
					<div style="" class="dimension_total"><span data-i18n="dimension.Weight">Weight(KG)</span><div id="dimension_weight_total">0.0</div></div>
					<div style="" class="dimension_total bkd_num_input">
						<span data-i18n="dimension.Volume">Volume(m)</span>
						<div id="dimension_volume_total" class="bkd_num_input">0.000</div>
						<div id="total_in_selected_unit_wrapper">
							<span id="total_in_selected_unit" class="bkd_num_input">0.000</span>
							<span id="selected_unit"> MC</span>
						</div>
					</div>
					<span id="delete_all_btn" class="rubbish_bin" onclick="ClearAllRows($(&#39;.dimension_input_wrapper&#39;))" data-i18n="dimension.DeleteAll">Delete All</span>
				</div>
				
                <div id="dimension_pieces_err" class="error_or_msg" style="display:none;">
                    <span id="dimension_cargo_info_pieces">
                    </span>
                </div>

                <div id="dimension_weight_err" class="error_or_msg" style="display:none;">
                    <span data-i18n="dimension.InvalidWeight">Weight input does not match with Cargo Information</span>
                    <span id="dimension_cargo_info_weight">(NaN KG)</span>
                </div>
			</div>
		</div>
	</div>
</div>

<script id="dimension_input_row_temp" type="text/x-template">
	<li class="dimension_input_row extra_row" data-rowid="%ID%" style="margin-right: 0px;">
		<div class="cnt_inline bu_txt w64 mr20">
			<label for="dimension_length_%ID%" data-i18n="dimension.Length">Length</label>
			<input class="vol_cal_input dimension_int_input" type="text" value="" id="dimension_length_%ID%" maxlength="5">
		</div>
		<div class="cnt_inline bu_txt w64 mr20">
			<label for="dimension_width_%ID%" data-i18n="dimension.Width">Width</label>
			<input class="vol_cal_input dimension_int_input" type="text" value="" id="dimension_width_%ID%" maxlength="5">
		</div>
		<div class="cnt_inline bu_txt w64 mr20">
			<label for="dimension_height_%ID%" data-i18n="dimension.Height">Height</label>
			<input class="vol_cal_input dimension_int_input" type="text" value="" id="dimension_height_%ID%" maxlength="5">
		</div>
		<div class="cnt_inline bu_txt w64 mr20 tbl_switch">
			<label for="dimension_cm_%ID%" data-i18n="dimension.Unit">Unit</label>
			<fieldset class="switch-toggle-set">
				<div class="switch-toggle switch-candy">
					<input id="dimension_cm_%ID%" name="dimension-unit_%ID%" type="radio" value="0" checked><label for="dimension_cm_%ID%" onclick="" data-i18n="dimension.CM">CM</label>
					<input id="dimension_in_%ID%" name="dimension-unit_%ID%" type="radio" value="1"><label for="dimension_in_%ID%" onclick="" data-i18n="dimension.IN">IN</label>
					<a></a>
				</div>
			</fieldset>
		</div>
		<div class="cnt_inline bu_txt w64 mr20">
			<label for="dimension_pcs_%ID%" data-i18n="cargoInfo.Pieces">Pieces</label>
			<input class="vol_cal_input int_input pc_cal dimension_int_input" type="text" value="" id="dimension_pcs_%ID%" maxlength="4">
		</div>
		<div class="cnt_inline bu_txt w64 mr20">
			<label for="dimension_weight_%ID%" data-i18n="dimension.Weight">Weight(KG)</label>
			<input class="weight_cal dimension_dec_input_weight" type="text" value="" id="dimension_weight_%ID%" maxlength="7">
		</div>
		<div class="cnt_inline bu_txt w64 mr20">
			<label for="dimension_vol_%ID%" data-i18n="dimension.Volume">Volume(m)</label>
			<input class="volume_cal bkd_num_input" type="text" value="" id="dimension_vol_%ID%" readonly="readonly">
		</div>
		<span class="rubbish_bin" onclick="ClearRow(this.parentElement)"></span>
	</li>
</script>

<script>
	$(function() {
		var id = "#bkd_def_dim";
		var blockID = "bkd_def_dim";
		
		$(id).on("clear", function(event) {
			//console.log(data);
			
			//debugger;
			
			$("li[class^='dimension_input_row']").each(function (i, el) {
				//var id = el.id.substring(el.id.indexOf("_")+1);
				var rowid = $(this).attr("data-rowid");
				//console.log("flightSegment");
				//console.log("rowid: " +rowid);
				//console.log("i: " +i);
				 
				$("#dimension_length_"+rowid).val("");
				$("#dimension_width_"+rowid).val("");
				$("#dimension_height_"+rowid).val("");
				$("#dimension_cm_" + rowid).prop("checked", true);
				$("#dimension_pcs_"+rowid).val("");
				$("#dimension_weight_"+rowid).val("");
				$("#dimension_vol_"+rowid).val("");
				
				$("#dimension_length_"+rowid).removeClass("invalid_input_field");
				$("#dimension_width_"+rowid).removeClass("invalid_input_field");
				$("#dimension_height_"+rowid).removeClass("invalid_input_field");
				$("#dimension_pcs_"+rowid).removeClass("invalid_input_field");
				$("#dimension_weight_"+rowid).removeClass("invalid_input_field");
				$("#dimension_vol_"+rowid).removeClass("invalid_input_field");
				
			});
			
			$(".dimension_input_row.extra_row").remove();
			
			$(id+" .error_or_msg").hide();
			$(id+" .error_or").removeClass("error_or");
			
		});
		
		$(id).on("init", function(event, data) {
			console.log(data);
			var currentRowID;
			//debugger;
			
			if (typeof data.DimensionInfo !== 'undefined' && data.DimensionInfo != null) {
				if (typeof data.DimensionInfo.Dimension !== 'undefined' && data.DimensionInfo.Dimension != null) {
					for (var i = 0; i < data.DimensionInfo.Dimension.length; i++) {
						currentRowID = i + 1;
						
						if (i > 2) {
							AddDimensionInput(currentRowID, i, function(cID, dataRow){
								$("#dimension_length_" + cID).val(data.DimensionInfo.Dimension[dataRow].Length);
								$("#dimension_width_" + cID).val(data.DimensionInfo.Dimension[dataRow].Width);
								$("#dimension_height_" + cID).val(data.DimensionInfo.Dimension[dataRow].Height);
								if (data.DimensionInfo.Dimension[dataRow].Unit == 0 || typeof data.DimensionInfo.Dimension[dataRow].Unit === 'undefined') {
									$("#dimension_cm_" + cID).prop("checked", true);
								} else {
									$("#dimension_in_" + cID).prop("checked", true);
								}
								$("#dimension_pcs_" + cID).val(data.DimensionInfo.Dimension[dataRow].Pieces);
								if (!isNaN(parseFloat(data.DimensionInfo.Dimension[dataRow].Weight).toFixed(decimalWeightRoundTo))) {
									$("#dimension_weight_" + cID).val(parseFloat(data.DimensionInfo.Dimension[dataRow].Weight).toFixed(decimalWeightRoundTo));
								} else {
									$("#dimension_weight_" + cID).val(data.DimensionInfo.Dimension[dataRow].Weight);
								}
								if (!isNaN(parseFloat(data.DimensionInfo.Dimension[dataRow].Volume).toFixed(decimalVolumeRoundToCX))) {
									$("#dimension_vol_" + cID).val(parseFloat(data.DimensionInfo.Dimension[dataRow].Volume).toFixed(decimalVolumeRoundToCX));
								} else {
									$("#dimension_vol_" + cID).val(data.DimensionInfo.Dimension[dataRow].Volume);
								}
							});
						} else {
							$("#dimension_length_" + currentRowID).val(data.DimensionInfo.Dimension[i].Length);
							$("#dimension_width_" + currentRowID).val(data.DimensionInfo.Dimension[i].Width);
							$("#dimension_height_" + currentRowID).val(data.DimensionInfo.Dimension[i].Height);
							if (data.DimensionInfo.Dimension[i].Unit == 0 || typeof data.DimensionInfo.Dimension[i].Unit === 'undefined') {
								$("#dimension_cm_" + currentRowID).prop("checked", true);
							} else {
								$("#dimension_in_" + currentRowID).prop("checked", true);
							}
							$("#dimension_pcs_" + currentRowID).val(data.DimensionInfo.Dimension[i].Pieces);
							if (!isNaN(parseFloat(data.DimensionInfo.Dimension[i].Weight).toFixed(decimalWeightRoundTo))) {
								$("#dimension_weight_" + currentRowID).val(parseFloat(data.DimensionInfo.Dimension[i].Weight).toFixed(decimalWeightRoundTo));
							} else {
								$("#dimension_weight_" + currentRowID).val(data.DimensionInfo.Dimension[i].Weight);
							}
							if (!isNaN(parseFloat(data.DimensionInfo.Dimension[i].Volume).toFixed(decimalVolumeRoundToCX))) {
								$("#dimension_vol_" + currentRowID).val(parseFloat(data.DimensionInfo.Dimension[i].Volume).toFixed(decimalVolumeRoundToCX));
							} else {
								$("#dimension_vol_" + currentRowID).val(data.DimensionInfo.Dimension[i].Volume);
							}
						}
					}
				
				}
			}
			
			setTimeout(function () { 
				RegDimensionCal(decimalVolumeRoundToCX);
				calculatePieces(true);
				calculateWeight(true);
				calculateTotalVolume(true, decimalVolumeRoundToCX);
			}, 1000);
			
		});
		
		$(id).on("validate", function() {
			console.log("OK");
			//var intVad = /^\+?(0|[1-9]\d*)$/;
			//var decVad = /^([1-9]\d*|0\.\d*[1-9]|[1-9]\d*\.\d*[0-9]|0)$/;
			var isValid = true;
			
			$("li[class^='dimension_input_row']").each(function (i, el) {
				//var id = el.id.substring(el.id.indexOf("_")+1);
				var rowid = $(this).attr("data-rowid");
				//console.log("flightSegment");
				//console.log("rowid: " +rowid);
				//console.log("i: " +i);
				 
				var Length = $("#dimension_length_"+rowid).val();
				var Width = $("#dimension_width_"+rowid).val();
				var Height = $("#dimension_height_"+rowid).val();
				var Unit = $("input[name=dimension-unit_"+rowid+"]:checked").val();
				var Pieces = $("#dimension_pcs_"+rowid).val();
				var Weight = $("#dimension_weight_"+rowid).val();
				var Volume = $("#dimension_vol_"+rowid).val();

				if (Length != "" || Width != "" || Height != "" || Pieces != "" || Weight != "") {
					if (!decVad.test(Length)){
						$("#dimension_length_"+rowid).addClass("invalid_input_field");
						isValid = false;
					} else {
						$("#dimension_length_"+rowid).removeClass("invalid_input_field");
					}
					
					if (!decVad.test(Width)){
						$("#dimension_width_"+rowid).addClass("invalid_input_field");
						isValid = false;
					} else {
						$("#dimension_width_"+rowid).removeClass("invalid_input_field");
					}
					
					if (!decVad.test(Height)){
						$("#dimension_height_"+rowid).addClass("invalid_input_field");
						isValid = false;
					} else {
						$("#dimension_height_"+rowid).removeClass("invalid_input_field");
					}
					
					if (!intVad.test(Pieces) || Pieces == 0){
						$("#dimension_pcs_"+rowid).addClass("invalid_input_field");
						isValid = false;
					} else {
						$("#dimension_pcs_"+rowid).removeClass("invalid_input_field");
					}
					
					if (!decVad.test(Weight)){
						$("#dimension_weight_"+rowid).addClass("invalid_input_field");
						isValid = false;
					} else {
						$("#dimension_weight_"+rowid).removeClass("invalid_input_field");
					}
					/*
					if (!decVad.test(Volume)){
						$("#dimension_vol_"+rowid).addClass("invalid_input_field");
						isValid = false;
					} else {
						$("#dimension_vol_"+rowid).removeClass("invalid_input_field");
					}
					*/
				} else {
					$("#dimension_length_"+rowid).removeClass("invalid_input_field");
					$("#dimension_width_"+rowid).removeClass("invalid_input_field");
					$("#dimension_height_"+rowid).removeClass("invalid_input_field");
					$("#dimension_pcs_"+rowid).removeClass("invalid_input_field");
					$("#dimension_weight_"+rowid).removeClass("invalid_input_field");
					$("#dimension_vol_"+rowid).removeClass("invalid_input_field");
				}
				
			});
			
			/* Removed from validate 
			if (checkPCs) {
				var dimensionPCsTotal = $("#dimension_pc_total").text();
				var cargoInfoPCs = getData("bkd_def_cargoinfo", "Pieces");
				
				if (dimensionPCsTotal != cargoInfoPCs) {
					$("#dimension_pieces_err").show();
					$("#dimension_pc_total").addClass("error_indicator");
					// isValid = false;
				} else {+
					$("#dimension_pc_total").removeClass("error_indicator");
					$("#dimension_pieces_err").hide();
				}
			} */

			if(!(cXbkdDimCheckPcs() && bkdDimCheckWeight())){
				isValid = false;
                $("#bkd_def_dim").addClass('error_tag');
			}
			else {
				$("#bkd_def_dim").removeClass('error_tag');
			}

			updateTotalVolInSelectUnit(decimalVolumeRoundToCX);

			if (isValid) {
				copyDimVolToCargoVol();
			}
			
			return isValid;
			//return true;
		});
		$(id).on("submit", function() {
		
			var dimensionList = [];
			
			$("li[class^='dimension_input_row']").each(function (i, el) {
				//var id = el.id.substring(el.id.indexOf("_")+1);
				var rowid = $(this).attr("data-rowid");
				//console.log("flightSegment");
				//console.log("rowid: " +rowid);
				//console.log("i: " +i);
				 
				var obj = new Object();
				obj.Seq = rowid;
				obj.Length = $("#dimension_length_"+rowid).val().toString();
				obj.Width = $("#dimension_width_"+rowid).val().toString();
				obj.Height = $("#dimension_height_"+rowid).val().toString();
				obj.Unit = $("input[name=dimension-unit_"+rowid+"]:checked").val();
				obj.Pieces = $("#dimension_pcs_"+rowid).val().toString();
				obj.Weight = $("#dimension_weight_"+rowid).val().toString();
				obj.Volume = $("#dimension_vol_"+rowid).val().toString();
				
				if (obj.Length == "" && obj.Width == "" && obj.Height == "" && obj.Pieces == "" && obj.Weight == "" && obj.Volume == "") {
				} else {
					dimensionList.push(obj);
				}
				
			});
			
			return { 
				"DimensionInfo" : {
					"Dimension" : dimensionList
				}
			};
		});
		
		$("#btnDimensionAddULD").click(function (e) {
			e.preventDefault();
			AddDimensionInput();
			$(".dimension_input_wrapper li").last().find("input").first().focus();
		});
		
		$(id).on("loadBookingData", function(event, bkdData) {
			console.log(bkdData);
			var currentRowID;
			//var insertRowID;
			//debugger;
			if (typeof bkdData.DimInfo !== 'undefined' && bkdData.DimInfo != null) {
				for (var i = 0; i < bkdData.DimInfo.length; i++) {
					currentRowID = i + 1;
					
					if (i > 2) {
						AddDimensionInput(currentRowID, i, function(cID, dataRow){
							/*
							if (!isNaN(parseFloat(bkdData.DimInfo[dataRow].DiLength).toFixed(decimalRoundTo))) {
								$("#dimension_length_" + cID).val(parseFloat(bkdData.DimInfo[dataRow].DiLength).toFixed(decimalRoundTo));
							} else {
								$("#dimension_length_" + cID).val(bkdData.DimInfo[dataRow].DiLength);
							}
							if (!isNaN(parseFloat(bkdData.DimInfo[dataRow].DiWidth).toFixed(decimalRoundTo))) {
								$("#dimension_width_" + cID).val(parseFloat(bkdData.DimInfo[dataRow].DiWidth).toFixed(decimalRoundTo));
							} else {
								$("#dimension_width_" + cID).val(bkdData.DimInfo[dataRow].DiWidth);
							}
							if (!isNaN(parseFloat(bkdData.DimInfo[dataRow].DiHeight).toFixed(decimalRoundTo))) {
								$("#dimension_height_" + cID).val(parseFloat(bkdData.DimInfo[dataRow].DiHeight).toFixed(decimalRoundTo));
							} else {
								$("#dimension_height_" + cID).val(bkdData.DimInfo[dataRow].DiHeight);
							}
							*/
							$("#dimension_length_" + cID).val(bkdData.DimInfo[dataRow].DiLength);
							$("#dimension_width_" + cID).val(bkdData.DimInfo[dataRow].DiWidth);
							$("#dimension_height_" + cID).val(bkdData.DimInfo[dataRow].DiHeight);
							if (bkdData.DimInfo[dataRow].DiUnitCode == 0 || typeof bkdData.DimInfo[dataRow].DiUnitCode === 'undefined') {
								$("#dimension_cm_" + cID).prop("checked", true);
							} else {
								$("#dimension_in_" + cID).prop("checked", true);
							}
							$("#dimension_pcs_" + cID).val(bkdData.DimInfo[dataRow].DiPieces);
							if (!isNaN(parseFloat(bkdData.DimInfo[dataRow].DiWeight).toFixed(decimalWeightRoundTo))) {
								$("#dimension_weight_" + cID).val(parseFloat(bkdData.DimInfo[dataRow].DiWeight).toFixed(decimalWeightRoundTo));
							} else {
								$("#dimension_weight_" + cID).val(bkdData.DimInfo[dataRow].DiWeight);
							}
						});
					} else {
						/*
						if (!isNaN(parseFloat(bkdData.DimInfo[i].DiLength).toFixed(decimalRoundTo))) {
							$("#dimension_length_" + currentRowID).val(parseFloat(bkdData.DimInfo[i].DiLength).toFixed(decimalRoundTo));
						} else {
							$("#dimension_length_" + currentRowID).val(bkdData.DimInfo[i].DiLength);
						}
						if (!isNaN(parseFloat(bkdData.DimInfo[i].DiWidth).toFixed(decimalRoundTo))) {
							$("#dimension_width_" + currentRowID).val(parseFloat(bkdData.DimInfo[i].DiWidth).toFixed(decimalRoundTo));
						} else {
							$("#dimension_width_" + currentRowID).val(bkdData.DimInfo[i].DiWidth);
						}
						if (!isNaN(parseFloat(bkdData.DimInfo[i].DiHeight).toFixed(decimalRoundTo))) {
							$("#dimension_height_" + currentRowID).val(parseFloat(bkdData.DimInfo[i].DiHeight).toFixed(decimalRoundTo));
						} else {
							$("#dimension_height_" + currentRowID).val(bkdData.DimInfo[i].DiHeight);
						}
						*/
						$("#dimension_length_" + currentRowID).val(bkdData.DimInfo[i].DiLength);
						$("#dimension_width_" + currentRowID).val(bkdData.DimInfo[i].DiWidth);
						$("#dimension_height_" + currentRowID).val(bkdData.DimInfo[i].DiHeight);
						if (bkdData.DimInfo[i].DiUnitCode == 0 || typeof bkdData.DimInfo[i].DiUnitCode === 'undefined') {
							$("#dimension_cm_" + currentRowID).prop("checked", true);
						} else {
							$("#dimension_in_" + currentRowID).prop("checked", true);
						}
						$("#dimension_pcs_" + currentRowID).val(bkdData.DimInfo[i].DiPieces);
						if (!isNaN(parseFloat(bkdData.DimInfo[i].DiWeight).toFixed(decimalWeightRoundTo))) {
							$("#dimension_weight_" + currentRowID).val(parseFloat(bkdData.DimInfo[i].DiWeight).toFixed(decimalWeightRoundTo));
						} else {
							$("#dimension_weight_" + currentRowID).val(bkdData.DimInfo[i].DiWeight);
						}
					}					
					
					calculateRowVolume(currentRowID, decimalVolumeRoundToCX);
				}
				
			}
			
		});
		
		$(".dimension_int_input").keypress(function(e) {
			console.log(e.which);
			if(e.which >= 48 && e.which <= 57 ){
			} else {
				return false;
			}
		});
		
		$(".dimension_dec_input, .dimension_dec_input_weight").keypress(function(e) {
			console.log(e.which);
			if((e.which >= 48 && e.which <= 57) || e.which == 46 ){
			} else {
				return false;
			}
		});
		
		$(".dimension_dec_input").blur(function(e) {
			if ($(this).val() != "") {
				$(this).val(FormatDecInput($(this).val(), decimalRoundTo));
			}
		});
		
		$(".dimension_dec_input_weight").blur(function(e) {
			if ($(this).val() != "") {
				$(this).val(FormatDecInput($(this).val(), decimalWeightRoundTo));
			}
		});
		
		$(id).on("getData", function(event, dataID) {
			console.log(dataID);
			
			var rtn;
			var seq;
			var dataType = dataID.substring(0, dataID.lastIndexOf("_"));
			if (dataType == "") {
				dataType = dataID;
			} else {
				seq = dataID.substring(dataID.lastIndexOf("_")+1);
			}
			
			switch(dataType) {
				case "Length":
					rtn = $("#dimension_length_"+seq).val();
					break;
				case "Width":
					rtn = $("#dimension_width_"+seq).val()
					break;
				case "Height":
					rtn = $("#dimension_height_"+seq).val();
					break;
				case "Unit":
					rtn = $("input[name=dimension-unit_"+rowid+"]:checked").val();
					break;
				case "Piece":
					rtn = $("#dimension_pcs_"+seq).val();
					break;
				case "Weight":
					rtn = $("#dimension_weight_"+seq).val();
					break;
				case "Volume":
					rtn = $("#dimension_vol_"+seq).val();
					break;
				case "TotalPiece":
					rtn = $("#dimension_pc_total").text();
					break;
				case "TotalWeight":
					rtn = $("#dimension_weight_total").text();
					break;
				case "TotalVolume":
					rtn = $("#dimension_volume_total").text();
					break;
			}
			
			return rtn;
			
		});
		
		$(id).on("setData", function(event, dataID, value) {
			console.log(dataID);
			console.log(value);
			var seq;
			var currentRowID;
			var dataType = dataID.substring(0, dataID.lastIndexOf("_"));
			if (dataType == "") {
				dataType = dataID;
			} else {
				seq = dataID.substring(dataID.lastIndexOf("_")+1);
				currentRowID = getComponentRowID("dimension_input_row");
				
				if (seq > currentRowID) {
					var diff = seq - currentRowID;
					for (var i = 0; i < diff; i++) {
						AddDimensionInput();
					}
				}
			}
			
			switch(dataType) {
				case "Length":
					if (!isNaN(parseFloat(value).toFixed(decimalRoundTo))) {
						$("#dimension_length_"+seq).val(parseFloat(value).toFixed(decimalRoundTo));
					} else {
						$("#dimension_length_"+seq).val(value);
					}
					break;
				case "Width":
					if (!isNaN(parseFloat(value).toFixed(decimalRoundTo))) {
						$("#dimension_width_"+seq).val(parseFloat(value).toFixed(decimalRoundTo));
					} else {
						$("#dimension_width_"+seq).val(value)
					}
					break;
				case "Height":
					if (!isNaN(parseFloat(value).toFixed(decimalRoundTo))) {
						$("#dimension_height_"+seq).val(parseFloat(value).toFixed(decimalRoundTo));
					} else {
						$("#dimension_height_"+seq).val(value);
					}
					break;
				case "Unit":
					if (value == 0) {
						$("#dimension_cm_"+seq).prop("checked", true);
					} else {
						$("#dimension_in_"+seq).prop("checked", true);
					}
					break;
				case "Piece":
					$("#dimension_pcs_"+seq).val(value);
					calculatePieces(true)
					break;
				case "Weight":
					if (!isNaN(parseFloat(value).toFixed(decimalWeightRoundTo))) {
						$("#dimension_weight_"+seq).val(parseFloat(value).toFixed(decimalWeightRoundTo));
					} else {
						$("#dimension_weight_"+seq).val(value);
					}
					calculateWeight(true);
					break;
			}
			
			if (dataType != "Weight" && dataType != "Piece") {
				calculateRowVolume(seq, decimalVolumeRoundToCX);
				calculateTotalVolume(true, decimalVolumeRoundToCX);
			}
		
		});
		
		$(id).on("getTemplateData", function(event) {
		
			var arr = [];
			var obj;
			
			$("li[class^='dimension_input_row']").each(function (i, el) {
				//var id = el.id.substring(el.id.indexOf("_")+1);
				var rowid = $(this).attr("data-rowid");
				//console.log("flightSegment");
				//console.log("rowid: " +rowid);
				//console.log("i: " +i);
				
				obj = new Object();
				obj.ModuleID = blockID;
				obj.DataID = "Length_"+rowid;
				obj.Content = $("#dimension_length_"+rowid).val() || "";
				arr.push(obj);
				
				obj = new Object();
				obj.ModuleID = blockID;
				obj.DataID = "Width_"+rowid;
				obj.Content = $("#dimension_width_"+rowid).val() || "";
				arr.push(obj);
				
				obj = new Object();
				obj.ModuleID = blockID;
				obj.DataID = "Height_"+rowid;
				obj.Content = $("#dimension_height_"+rowid).val() || "";
				arr.push(obj);
				
				obj = new Object();
				obj.ModuleID = blockID;
				obj.DataID = "Unit_"+rowid;
				obj.Content = $("input[name=dimension-unit_"+rowid+"]:checked").val() || "";
				arr.push(obj);
				
				obj = new Object();
				obj.ModuleID = blockID;
				obj.DataID = "Piece_"+rowid;
				obj.Content = $("#dimension_pcs_"+rowid).val() || "";
				arr.push(obj);
				
				obj = new Object();
				obj.ModuleID = blockID;
				obj.DataID = "Weight_"+rowid;
				obj.Content = $("#dimension_weight_"+rowid).val() || "";
				arr.push(obj);

			});
			
			return {
				"DimensionInfo" : {
					"TDataList" : arr,
				}
			}
		});

		$(id + ' .collapse_wrapper').on('hidden.bs.collapse', function (e) {
			$(id + " .collapse_icon i").removeClass("fa-arrow-circle-down fa-arrow-circle-up");
			$(id + " .collapse_icon i").addClass("fa-arrow-circle-down");
		})

		$(id + ' .collapse_wrapper').on('shown.bs.collapse', function (e) {
			$(id + " .collapse_icon i").removeClass("fa-arrow-circle-down fa-arrow-circle-up");
			$(id + " .collapse_icon i").addClass("fa-arrow-circle-up");
		})

		$(id).find(".expandable_title").keypress(function (e) {
			if(e.keyCode == 13){
				this.click();
			}
		});
		
		function AddDimensionInput(cID, dID, callback) {
			
			var row = $("#dimension_input_row_temp").html();
			
            var currentRowID = getComponentRowID("dimension_input_row");
			row = row.replaceAll("%ID%", currentRowID + 1);
			$(".dimension_input_wrapper").append(row);

			if (typeof callback === "function" && typeof cID !== 'undefined' && typeof dID !== 'undefined') {
				callback(cID, dID);
			}

            RegDimensionCal(decimalVolumeRoundToCX);
            refreshModuleTranslation();
        }
	});	
</script><div id="bkd_def_shipperconsignee" class="bkd_block">
	<div class="col-xs-12">
		<h3 class="expandable_title" data-i18n="shipperConsignee.ShipperConsignee" data-toggle="collapse" href="#contact_info" tabindex="0">Shipper &amp; Consignee</h3>
		<span class="collapse_icon">
			<i class="fa fa-arrow-circle-down fa-lg" aria-hidden="true" data-toggle="collapse" href="#contact_info"></i>
		</span>
	</div>
	<div class="head_hr"></div>

	<div id="contact_info" class="collapse_wrapper collapse">
		<div class="col-xs-12 col-md-6">
			<div class="blk_gy_line blkl">
				<h4 class="blk_in" data-i18n="shipperConsignee.Shipper">Shipper</h4>
				<a href="javascript:void(0)" class="search_bu_link" data-i18n="shipperConsignee.AddressBook" onclick="openContactAddressBookSearch(event, 0)" tabindex="-1">Address book</a>
				<div class="blkc"></div>
				<div class="bu_txt shipper_remark_form">
					<div class="w100">
						<label for="contact_shipper_name"><span data-i18n="shipperConsignee.Name">Name</span></label>
						<input class="w100" id="contact_shipper_name" maxlength="35">
						<div class="error_or_msg" style="display:none;" data-i18n="shipperConsignee.Invalid">Invalid</div>
					</div>
					<div class="w100">
						<label for="contact_shipper_address"><span data-i18n="shipperConsignee.Address">Address</span></label>
						<input class="w100" id="contact_shipper_address" maxlength="35">
						<div class="error_or_msg" style="display:none;" data-i18n="shipperConsignee.Invalid">Invalid</div>
					</div>
					<div class="blkl w47 mrp5p">
						<label for="contact_shipper_city"><span data-i18n="shipperConsignee.City">City</span></label>
						<input class="w100" id="contact_shipper_city" maxlength="17">
						<div class="error_or_msg" style="display:none;" data-i18n="shipperConsignee.Invalid">Invalid</div>
					</div>
					<div class="blkl w47">
						<label for="contact_shipper_state" data-i18n="shipperConsignee.State">State</label>
						<input class="w100" id="contact_shipper_state" maxlength="9">
						<div class="error_or_msg" style="display:none;" data-i18n="shipperConsignee.Invalid">Invalid</div>
					</div>
					<div class="blkc"></div>
					<div class="blkl w47 mrp5p">
						<label class="contact_shipper_country"><span data-i18n="shipperConsignee.Country">Country</span></label>
						<input class="w100" id="contact_shipper_country" maxlength="2">
						<div class="error_or_msg" style="display:none;" data-i18n="shipperConsignee.Invalid">Invalid</div>
					</div>
					<div class="blkl w47">
						<label for="contact_shipper_postal" data-i18n="shipperConsignee.PostalCode">Postal Code</label>
						<input class="w100" id="contact_shipper_postal" maxlength="9">
						<div class="error_or_msg" style="display:none;" data-i18n="shipperConsignee.Invalid">Invalid</div>
					</div>
					<div class="blkc"></div>
					<div class="blkl w47 mrp5p">
						<label for="contact_shipper_tel" data-i18n="shipperConsignee.TelNo">Tel. No.</label>
						<input class="w100" id="contact_shipper_tel" maxlength="19">
						<div class="error_or_msg" style="display:none;" data-i18n="shipperConsignee.Invalid">Invalid</div>
					</div>
					<div class="blkl w47">
						<label for="contact_shipper_fax" data-i18n="shipperConsignee.FaxNo">Fax. No.</label>
						<input class="w100" id="contact_shipper_fax" maxlength="19">
						<div class="error_or_msg" style="display:none;" data-i18n="shipperConsignee.Invalid">Invalid</div>
					</div>
					<div class="blkc"></div>
					<a data-toggle="collapse" href="https://uat-ezycargo2017.ezbiz.com/en-US/1/Booking/SingleBooking#collapseAddressBook_shipper" role="button" aria-expanded="false" aria-controls="collapseAddressBook_shipper" class="bu_plus_link btn_addr_add" tabindex="-1"><span></span></a>
					<a data-toggle="collapse" href="https://uat-ezycargo2017.ezbiz.com/en-US/1/Booking/SingleBooking#collapseAddressBook_shipper" role="button" aria-expanded="false" aria-controls="collapseAddressBook_shipper" class="bu_plus_link btn_addr_add" data-i18n="contact.AddToAddressBook" tabindex="-1">Add to address book</a>
					<div class="collapse" id="collapseAddressBook_shipper">
						<div class="cnt_inline bu_txt">
							<input type="text" value="" class="code_02 contact_addressbook_code" id="contact_addressbook_code_ins_shipper" placeholder="Enter code to add..." maxlength="15">
							<span id="contact_addressbook_loading_shipper" class="inline_loading_panel" style="display:none;">&nbsp;</span>
							<a id="contact_btn_addressbook_ins_shipper" href="javascript:void(0)" onclick="addtoAddressBook(0)" data-i18n="common.Add">Add</a>
							<div class="error_or_msg" style="display:none;" data-i18n="shipperConsignee.Invalid">Invalid</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div class="col-xs-12 col-md-6">
			<div class="blk_gy_line blkl">
				<h4 class="blk_in" data-i18n="shipperConsignee.Consignee">Consignee</h4>
				<a href="javascript:void(0)" class="search_bu_link" data-i18n="shipperConsignee.AddressBook" onclick="openContactAddressBookSearch(event, 1)" tabindex="-1">Address book</a>
				<div class="blkc"></div>
				<div class="bu_txt shipper_remark_form">
					<div class="w100">
						<label for="contact_consignee_name"><span data-i18n="shipperConsignee.Name">Name</span></label>
						<input class="w100" id="contact_consignee_name" maxlength="35">
						<div class="error_or_msg" style="display:none;" data-i18n="shipperConsignee.Invalid">Invalid</div>
					</div>
					<div class="w100">
						<label for="contact_consignee_address"><span data-i18n="shipperConsignee.Address">Address</span></label>
						<input class="w100" id="contact_consignee_address" maxlength="35">
						<div class="error_or_msg" style="display:none;" data-i18n="shipperConsignee.Invalid">Invalid</div>
					</div>
					<div class="blkl w47 mrp5p">
						<label for="contact_consignee_city"><span data-i18n="shipperConsignee.City">City</span></label>
						<input class="w100" id="contact_consignee_city" maxlength="17">
						<div class="error_or_msg" style="display:none;" data-i18n="shipperConsignee.Invalid">Invalid</div>
					</div>
					<div class="blkl w47">
						<label for="contact_consignee_state" data-i18n="shipperConsignee.State">State</label>
						<input class="w100" id="contact_consignee_state" maxlength="9">
						<div class="error_or_msg" style="display:none;" data-i18n="shipperConsignee.Invalid">Invalid</div>
					</div>
					<div class="blkc"></div>
					<div class="blkl w47 mrp5p">
						<label for="contact_consignee_country"><span data-i18n="shipperConsignee.Country">Country</span></label>
						<input class="w100" id="contact_consignee_country" maxlength="2">
						<div class="error_or_msg" style="display:none;" data-i18n="shipperConsignee.Invalid">Invalid</div>
					</div>
					<div class="blkl w47">
						<label for="contact_consignee_postal" data-i18n="shipperConsignee.PostalCode">Postal Code</label>
						<input class="w100" id="contact_consignee_postal" maxlength="9">
						<div class="error_or_msg" style="display:none;" data-i18n="shipperConsignee.Invalid">Invalid</div>
					</div>
					<div class="blkc"></div>
					<div class="blkl w47 mrp5p">
						<label for="contact_consignee_tel" data-i18n="shipperConsignee.TelNo">Tel. No.</label>
						<input class="w100" id="contact_consignee_tel" maxlength="19">
						<div class="error_or_msg" style="display:none;" data-i18n="shipperConsignee.Invalid">Invalid</div>
					</div>
					<div class="blkl w47">
						<label for="contact_consignee_fax" data-i18n="shipperConsignee.FaxNo">Fax. No.</label>
						<input class="w100" id="contact_consignee_fax" maxlength="19">
						<div class="error_or_msg" style="display:none;" data-i18n="shipperConsignee.Invalid">Invalid</div>
					</div>
					<div class="blkc"></div>
					<a data-toggle="collapse" href="https://uat-ezycargo2017.ezbiz.com/en-US/1/Booking/SingleBooking#collapseAddressBook_consignee" role="button" aria-expanded="false" aria-controls="collapseAddressBook_consignee" class="bu_plus_link btn_addr_add" tabindex="-1"><span></span></a>
					<a data-toggle="collapse" href="https://uat-ezycargo2017.ezbiz.com/en-US/1/Booking/SingleBooking#collapseAddressBook_consignee" role="button" aria-expanded="false" aria-controls="collapseAddressBook_consignee" class="bu_plus_link btn_addr_add" data-i18n="contact.AddToAddressBook" tabindex="-1">Add to address book</a>
					<div class="collapse" id="collapseAddressBook_consignee">
						<div class="cnt_inline bu_txt">
							<input type="text" value="" class="code_02 contact_addressbook_code" id="contact_addressbook_code_ins_consignee" placeholder="Enter code to add..." maxlength="15">
							<span id="contact_addressbook_loading_consignee" class="inline_loading_panel" style="display:none;">&nbsp;</span>
							<a id="contact_btn_addressbook_ins_consignee" href="javascript:void(0)" onclick="addtoAddressBook(1)" data-i18n="common.Add">Add</a>
							<div class="error_or_msg" style="display:none;" data-i18n="shipperConsignee.Invalid">Invalid</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		
		<div class="blkc"></div>
	</div>
</div>


<script>
	$(function() {
		var id = "#bkd_def_shipperconsignee";
		var blockID = "bkd_def_shipperconsignee";
		var contactLity;

		$(id).on("clear", function(event) {
			//console.log(data);
			
			//debugger;
			$("#contact_shipper_name").val("");
			$("#contact_shipper_address").val("");
			$("#contact_shipper_city").val("");
			$("#contact_shipper_state").val("");
			$("#contact_shipper_country").val("");
			$("#contact_shipper_postal").val("");
			$("#contact_shipper_tel").val("");
			$("#contact_shipper_fax").val("");
			
			$("#contact_consignee_name").val("");
			$("#contact_consignee_address").val("");
			$("#contact_consignee_city").val("");
			$("#contact_consignee_state").val("");
			$("#contact_consignee_country").val("");
			$("#contact_consignee_postal").val("");
			$("#contact_consignee_tel").val("");
			$("#contact_consignee_fax").val("");
			
			$(id+" .error_or_msg").hide();
			$(id+" .error_or").removeClass("error_or");
			
		});
		
		$(id).on("init", function(event, data) {
			console.log(data);
			var currentRowID;

			regContactElsOnEnter();
			//debugger;
			
			if (typeof data.ShipperConsignee !== 'undefined' && data.ShipperConsignee != null) {
				$("#contact_shipper_name").val(data.ShipperConsignee.ShipperName);
				$("#contact_shipper_address").val(data.ShipperConsignee.ShipperAddress);
				$("#contact_shipper_city").val(data.ShipperConsignee.ShipperCity);
				$("#contact_shipper_state").val(data.ShipperConsignee.ShipperState);
				$("#contact_shipper_country").val(data.ShipperConsignee.ShipperCountry);
				$("#contact_shipper_postal").val(data.ShipperConsignee.ShipperPostalCode);
				$("#contact_shipper_tel").val(data.ShipperConsignee.ShipperTel);
				$("#contact_shipper_fax").val(data.ShipperConsignee.ShipperFax);
				
				$("#contact_consignee_name").val(data.ShipperConsignee.ConsignName);
				$("#contact_consignee_address").val(data.ShipperConsignee.ConsignAddress);
				$("#contact_consignee_city").val(data.ShipperConsignee.ConsignCity);
				$("#contact_consignee_state").val(data.ShipperConsignee.ConsignState);
				$("#contact_consignee_country").val(data.ShipperConsignee.ConsignCountry);
				$("#contact_consignee_postal").val(data.ShipperConsignee.ConsignPostalCode);
				$("#contact_consignee_tel").val(data.ShipperConsignee.ConsignTel);
				$("#contact_consignee_fax").val(data.ShipperConsignee.ConsignFax);
			}
				
		});
		
		$(id).on("validate", function() {
			console.log("OK");
			console.log("bkd_def_shipperconsignee");
			var shipperName = $("#contact_shipper_name").val();
			var shipperAddress = $("#contact_shipper_address").val();
			var shipperCity = $("#contact_shipper_city").val();
			var shipperState = $("#contact_shipper_state").val();
			var shipperCountry = $("#contact_shipper_country").val();
			var shipperPostalCode = $("#contact_shipper_postal").val();
			var shipperTel = $("#contact_shipper_tel").val();
			var shipperFax = $("#contact_shipper_fax").val();
			
			var consignName = $("#contact_consignee_name").val();
			var consignAddress = $("#contact_consignee_address").val();
			var consignCity = $("#contact_consignee_city").val();
			var consignState = $("#contact_consignee_state").val();
			var consignCountry = $("#contact_consignee_country").val();
			var consignPostalCode = $("#contact_consignee_postal").val();
			var consignTel = $("#contact_consignee_tel").val();
			var consignFax = $("#contact_consignee_fax").val();
			var isValid = true;

			//shipper info
             if (shipperName != "" || shipperAddress != "" || shipperCity != "" || shipperState != "" || shipperCountry != "" || shipperPostalCode != "" || shipperTel != "" || shipperFax != "") {
				if (!StringFormatChecker.checkFormatF(shipperName, 1, 35)) {
					$("#contact_shipper_name ~ .error_or_msg").show();
					$("#contact_shipper_name").parent().addClass("error_or");
					isValid = false;
				} else {
					$("#contact_shipper_name ~ .error_or_msg").hide();
					$("#contact_shipper_name").parent().removeClass("error_or");
				}
				
				if (!StringFormatChecker.checkFormatF(shipperAddress, 1, 35)) {
					$("#contact_shipper_address ~ .error_or_msg").show();
					$("#contact_shipper_address").parent().addClass("error_or");
					isValid = false;
				} else {
					$("#contact_shipper_address ~ .error_or_msg").hide();
					$("#contact_shipper_address").parent().removeClass("error_or");
				}
				
				if (!StringFormatChecker.checkFormatT(shipperCity, 1, 17)) {
					$("#contact_shipper_city ~ .error_or_msg").show();
					$("#contact_shipper_city").parent().addClass("error_or");
					isValid = false;
				} else {
					$("#contact_shipper_city ~ .error_or_msg").hide();
					$("#contact_shipper_city").parent().removeClass("error_or");
				}

				if (!StringFormatChecker.checkFormatT(shipperState, 0, 9)) {
					$("#contact_shipper_state ~ .error_or_msg").show();
					$("#contact_shipper_state").parent().addClass("error_or");
					isValid = false;
				} else {
					$("#contact_shipper_state ~ .error_or_msg").hide();
					$("#contact_shipper_state").parent().removeClass("error_or");
				}

				if (!StringFormatChecker.checkFormatA(shipperCountry.toUpperCase(), 2, 2)) {
					$("#contact_shipper_country ~ .error_or_msg").show();
					$("#contact_shipper_country").parent().addClass("error_or");
					isValid = false;
				} else {
					$("#contact_shipper_country ~ .error_or_msg").hide();
					$("#contact_shipper_country").parent().removeClass("error_or");
				}

				if (!StringFormatChecker.checkFormatT(shipperPostalCode, 0, 9)) {
					$("#contact_shipper_postal ~ .error_or_msg").show();
					$("#contact_shipper_postal").parent().addClass("error_or");
					isValid = false;
				} else {
					$("#contact_shipper_postal ~ .error_or_msg").hide();
					$("#contact_shipper_postal").parent().removeClass("error_or");
				}
				
				//Tel length is 19 for CX
				if (!StringFormatChecker.checkFormatM(shipperTel, 0, 19)) {
					$("#contact_shipper_tel ~ .error_or_msg").show();
					$("#contact_shipper_tel").parent().addClass("error_or");
					isValid = false;
				} else {
					$("#contact_shipper_tel ~ .error_or_msg").hide();
					$("#contact_shipper_tel").parent().removeClass("error_or");
				}
				
				//Fax length is 19 for CX
				if (!StringFormatChecker.checkFormatM(shipperFax, 0, 19)) {
					$("#contact_shipper_fax ~ .error_or_msg").show();
					$("#contact_shipper_fax").parent().addClass("error_or");
					isValid = false;
				} else {
					$("#contact_shipper_fax ~ .error_or_msg").hide();
					$("#contact_shipper_fax").parent().removeClass("error_or");
				}

			} else {
				$("#contact_shipper_name ~ .error_or_msg").hide();
				$("#contact_shipper_name").parent().removeClass("error_or");
				
				$("#contact_shipper_address ~ .error_or_msg").hide();
				$("#contact_shipper_address").parent().removeClass("error_or");
				
				$("#contact_shipper_city ~ .error_or_msg").hide();
				$("#contact_shipper_city").parent().removeClass("error_or");
				
				$("#contact_shipper_country ~ .error_or_msg").hide();
				$("#contact_shipper_country").parent().removeClass("error_or");
			}
			
			//consignee info
            if (consignName != "" || consignAddress != "" || consignCity != "" || consignState != "" || consignCountry != "" || consignPostalCode != "" || consignTel != "" || consignFax != "") {
				if (!StringFormatChecker.checkFormatF(consignName, 1, 35)) {
					$("#contact_consignee_name ~ .error_or_msg").show();
					$("#contact_consignee_name").parent().addClass("error_or");
					isValid = false;
				} else {
					$("#contact_consignee_name ~ .error_or_msg").hide();
					$("#contact_consignee_name").parent().removeClass("error_or");
				}
				
				if (!StringFormatChecker.checkFormatF(consignAddress, 1, 35)) {
					$("#contact_consignee_address ~ .error_or_msg").show();
					$("#contact_consignee_address").parent().addClass("error_or");
					isValid = false;
				} else {
					$("#contact_consignee_address ~ .error_or_msg").hide();
					$("#contact_consignee_address").parent().removeClass("error_or");
				}
				
				if (!StringFormatChecker.checkFormatT(consignCity, 1, 17)) {
					$("#contact_consignee_city ~ .error_or_msg").show();
					$("#contact_consignee_city").parent().addClass("error_or");
					isValid = false;
				} else {
					$("#contact_consignee_city ~ .error_or_msg").hide();
					$("#contact_consignee_city").parent().removeClass("error_or");
				}

				if (!StringFormatChecker.checkFormatT(consignState, 0, 9)) {
					$("#contact_consignee_state ~ .error_or_msg").show();
					$("#contact_consignee_state").parent().addClass("error_or");
					isValid = false;
				} else {
					$("#contact_consignee_state ~ .error_or_msg").hide();
					$("#contact_consignee_state").parent().removeClass("error_or");
				}

				if (!StringFormatChecker.checkFormatA(consignCountry.toUpperCase(), 2, 2)) {
					$("#contact_consignee_country ~ .error_or_msg").show();
					$("#contact_consignee_country").parent().addClass("error_or");
					isValid = false;
				} else {
					$("#contact_consignee_country ~ .error_or_msg").hide();
					$("#contact_consignee_country").parent().removeClass("error_or");
				}

				if (!StringFormatChecker.checkFormatT(consignPostalCode, 0, 9)) {
					$("#contact_consignee_postal ~ .error_or_msg").show();
					$("#contact_consignee_postal").parent().addClass("error_or");
					isValid = false;
				} else {
					$("#contact_consignee_postal ~ .error_or_msg").hide();
					$("#contact_consignee_postal").parent().removeClass("error_or");
				}
				
				//Tel length is 19 for CX
				if (!StringFormatChecker.checkFormatM(consignTel, 0, 19)) {
					$("#contact_consignee_tel ~ .error_or_msg").show();
					$("#contact_consignee_tel").parent().addClass("error_or");
					isValid = false;
				} else {
					$("#contact_consignee_tel ~ .error_or_msg").hide();
					$("#contact_consignee_tel").parent().removeClass("error_or");
				}
				
				//Fax length is 19 for CX
				if (!StringFormatChecker.checkFormatM(consignFax, 0, 19)) {
					$("#contact_consignee_fax ~ .error_or_msg").show();
					$("#contact_consignee_fax").parent().addClass("error_or");
					isValid = false;
				} else {
					$("#contact_consignee_fax ~ .error_or_msg").hide();
					$("#contact_consignee_fax").parent().removeClass("error_or");
				}

			} else {
				$("#contact_consignee_name ~ .error_or_msg").hide();
				$("#contact_consignee_name").parent().removeClass("error_or");
				
				$("#contact_consignee_address ~ .error_or_msg").hide();
				$("#contact_consignee_address").parent().removeClass("error_or");
				
				$("#contact_consignee_city ~ .error_or_msg").hide();
				$("#contact_consignee_city").parent().removeClass("error_or");
				
				$("#contact_consignee_country ~ .error_or_msg").hide();
				$("#contact_consignee_country").parent().removeClass("error_or");
			}
			
			return isValid;
			//return true;
		});
		$(id).on("submit", function() {
		
			var shipperName = $("#contact_shipper_name").val();
			var shipperAddress = $("#contact_shipper_address").val();
			var shipperCity = $("#contact_shipper_city").val();
			var shipperState = $("#contact_shipper_state").val();
			var shipperCountry = $("#contact_shipper_country").val();
			var shipperPostalCode = $("#contact_shipper_postal").val();
			var shipperTel = $("#contact_shipper_tel").val();
			var shipperFax = $("#contact_shipper_fax").val();
			
			var consignName = $("#contact_consignee_name").val();
			var consignAddress = $("#contact_consignee_address").val();
			var consignCity = $("#contact_consignee_city").val();
			var consignState = $("#contact_consignee_state").val();
			var consignCountry = $("#contact_consignee_country").val();
			var consignPostalCode = $("#contact_consignee_postal").val();
			var consignTel = $("#contact_consignee_tel").val();
			var consignFax = $("#contact_consignee_fax").val();

            if (shipperName == "") {
                shipperAddress = "";
                shipperCity = "";
                shipperState = "";
                shipperCountry = "";
                shipperPostalCode = "";
                shipperTel = "";
                shipperFax = "";
            }

            if (consignName == "") {
                consignAddress = "";
                consignCity = "";
                consignState = "";
                consignCountry = "";
                consignPostalCode = "";
                consignTel = "";
                consignFax = "";
            }

			return { 
				"ShipperConsignee" : {
					"ShipperName" : shipperName,
					"ShipperAddress" : shipperAddress,
					"ShipperCity" : shipperCity,
					"ShipperState" : shipperState,
					"ShipperCountry" : shipperCountry ? shipperCountry.toUpperCase() : "",
					"ShipperPostalCode" : shipperPostalCode,
					"ShipperTel" : shipperTel,
					"ShipperFax" : shipperFax,
					"ConsignName" : consignName,
					"ConsignAddress" : consignAddress,
					"ConsignCity" : consignCity,
					"ConsignState" : consignState,
					"ConsignCountry" : consignCountry? consignCountry.toUpperCase() : "",
					"ConsignPostalCode" : consignPostalCode,
					"ConsignTel" : consignTel,
					"ConsignFax" : consignFax
				}
			};
		});
		
		$(id).on("loadBookingData", function(event, bkdData) {
			//console.log("contact: " + JSON.stringify(bkdData));
			//var currentRowID;
			//var insertRowID;
			//debugger;
			
			if (bkdData.ShipperIsSpecified == true) {
				if (typeof bkdData.Shipper !== 'undefined' && bkdData.Shipper != null) {
					if (typeof bkdData.Shipper.Name !== 'undefined' && bkdData.Shipper.Name != null) {
						$("#contact_shipper_name").val(bkdData.Shipper.Name.join());
					}
					if (typeof bkdData.Shipper.StreetAdd !== 'undefined' && bkdData.Shipper.StreetAdd != null) {
						$("#contact_shipper_address").val(bkdData.Shipper.StreetAdd.join());
					}
					if (typeof bkdData.Shipper.Place !== 'undefined' && bkdData.Shipper.Place != null) {
						$("#contact_shipper_city").val(bkdData.Shipper.Place);
					}
					if (typeof bkdData.Shipper.State !== 'undefined' && bkdData.Shipper.State != null) {
						$("#contact_shipper_state").val(bkdData.Shipper.State);
					}
					if (typeof bkdData.Shipper.CountryCode !== 'undefined' && bkdData.Shipper.CountryCode != null) {
						$("#contact_shipper_country").val(bkdData.Shipper.CountryCode);
					}
					if (typeof bkdData.Shipper.PostCode !== 'undefined' && bkdData.Shipper.PostCode != null) {
						$("#contact_shipper_postal").val(bkdData.Shipper.PostCode);
					}
					if (typeof bkdData.Shipper.ContactDetail !== 'undefined' && bkdData.Shipper.ContactDetail != null) {
						for (var i = 0; i < bkdData.Shipper.ContactDetail.length; i++) {
							if (bkdData.Shipper.ContactDetail[i].ContactDetailType == 0) {
								$("#contact_shipper_tel").val(bkdData.Shipper.ContactDetail[i].ContactNum);
							} else if (bkdData.Shipper.ContactDetail[i].ContactDetailType == 1) {
								$("#contact_shipper_fax").val(bkdData.Shipper.ContactDetail[i].ContactNum);
							}
						}
					}
				}
			} else {
				$("#contact_shipper_name").val("");
				$("#contact_shipper_address").val("");
				$("#contact_shipper_city").val("");
				$("#contact_shipper_state").val("");
				$("#contact_shipper_country").val("");
				$("#contact_shipper_postal").val("");
				$("#contact_shipper_tel").val("");
				$("#contact_shipper_fax").val("");
			}
			
			if (bkdData.ConsigneerIsSpecified == true) {
				if (typeof bkdData.Consignee !== 'undefined' && bkdData.Consignee != null) {
					if (typeof bkdData.Consignee.Name !== 'undefined' && bkdData.Consignee.Name != null) {
						$("#contact_consignee_name").val(bkdData.Consignee.Name.join());
					}
					if (typeof bkdData.Consignee.StreetAdd !== 'undefined' && bkdData.Consignee.StreetAdd != null) {
						$("#contact_consignee_address").val(bkdData.Consignee.StreetAdd.join());
					}
					if (typeof bkdData.Consignee.Place !== 'undefined' && bkdData.Consignee.Place != null) {
						$("#contact_consignee_city").val(bkdData.Consignee.Place);
					}
					if (typeof bkdData.Consignee.State !== 'undefined' && bkdData.Consignee.State != null) {
						$("#contact_consignee_state").val(bkdData.Consignee.State);
					}
					if (typeof bkdData.Consignee.CountryCode !== 'undefined' && bkdData.Consignee.CountryCode != null) {
						$("#contact_consignee_country").val(bkdData.Consignee.CountryCode);
					}
					if (typeof bkdData.Consignee.PostCode !== 'undefined' && bkdData.Consignee.PostCode != null) {
						$("#contact_consignee_postal").val(bkdData.Consignee.PostCode);
					}
					if (typeof bkdData.Consignee.ContactDetail !== 'undefined' && bkdData.Consignee.ContactDetail != null) {
						for (var i = 0; i < bkdData.Consignee.ContactDetail.length; i++) {
							if (bkdData.Consignee.ContactDetail[i].ContactDetailType == 0) {
								$("#contact_consignee_tel").val(bkdData.Consignee.ContactDetail[i].ContactNum);
							} else if (bkdData.Consignee.ContactDetail[i].ContactDetailType == 1) {
								$("#contact_consignee_fax").val(bkdData.Consignee.ContactDetail[i].ContactNum);
							}
						}
					}
				}
			} else {
				$("#contact_consignee_name").val("");
				$("#contact_consignee_address").val("");
				$("#contact_consignee_city").val("");
				$("#contact_consignee_state").val("");
				$("#contact_consignee_country").val("");
				$("#contact_consignee_postal").val("");
				$("#contact_consignee_tel").val("");
				$("#contact_consignee_fax").val("");
			}
				
		});
		
		$(id).on("bindAddressBookSearchResult", function() {
			console.log("bindAddressBookSearchResult start");
			
			//stopAddressBookSearchAction();
			
			$("#contact_addressbook_result .rowwrapper").remove();
			
			var lt = [];
			if (localStorage.getItem("contact_addr_book") != null) {
				lt = JSON.parse(localStorage.getItem("contact_addr_book"));
			}
			
			if (lt.length == 0) {
				showAddressBookError("No Record found.");
			} else {
				hideAddressBookError();
			}
			
			content = getAddressbookResult();
			
			$("#contact_addressbook_result").append(content);
			
		});
		
		$(id).on("getData", function(event, dataID) {
			console.log(dataID);
			
			var rtn;
			
			switch(dataID) {
				case "ShipperName":
					rtn = $("#contact_shipper_name").val();
					break;
				case "ShipperAddress":
					rtn = $("#contact_shipper_address").val();
					break;
				case "ShipperCity":
					rtn = $("#contact_shipper_city").val();
					break;
				case "ShipperState":
					rtn = $("#contact_shipper_state").val();
					break;
				case "ShipperCountry":
					rtn = $("#contact_shipper_country").val();
					break;
				case "ShipperPostalCode":
					rtn = $("#contact_shipper_postal").val();
					break;
				case "ShipperTel":
					rtn = $("#contact_shipper_tel").val();
					break;
				case "ShipperFax":
					rtn = $("#contact_shipper_fax").val();
					break;
				case "ConsignName":
					rtn = $("#contact_consignee_name").val();
					break;
				case "ConsignAddress":
					rtn = $("#contact_consignee_address").val();
					break;
				case "ConsignCity":
					rtn = $("#contact_consignee_city").val();
					break;
				case "ConsignState":
					rtn = $("#contact_consignee_state").val();
					break;
				case "ConsignCountry":
					rtn = $("#contact_consignee_country").val();
					break;
				case "ConsignPostalCode":
					rtn = $("#contact_consignee_postal").val();
					break;
				case "ConsignTel":
					rtn = $("#contact_consignee_tel").val();
					break;
				case "ConsignFax":
					rtn = $("#contact_consignee_fax").val();
					break;
			}
			
			return rtn;
			
		});
		
		$(id).on("setData", function(event, dataID, value) {
			console.log(dataID);
			console.log(value);
			
			switch(dataID) {
				case "ShipperName":
					$("#contact_shipper_name").val(value);
					break;
				case "ShipperAddress":
					$("#contact_shipper_address").val(value);
					break;
				case "ShipperCity":
					$("#contact_shipper_city").val(value);
					break;
				case "ShipperState":
					$("#contact_shipper_state").val(value);
					break;
				case "ShipperCountry":
					$("#contact_shipper_country").val(value);
					break;
				case "ShipperPostalCode":
					$("#contact_shipper_postal").val(value);
					break;
				case "ShipperTel":
					$("#contact_shipper_tel").val(value);
					break;
				case "ShipperFax":
					$("#contact_shipper_fax").val(value);
					break;
				case "ConsignName":
					$("#contact_consignee_name").val(value);
					break;
				case "ConsignAddress":
					$("#contact_consignee_address").val(value);
					break;
				case "ConsignCity":
					$("#contact_consignee_city").val(value);
					break;
				case "ConsignState":
					$("#contact_consignee_state").val(value);
					break;
				case "ConsignCountry":
					$("#contact_consignee_country").val(value);
					break;
				case "ConsignPostalCode":
					$("#contact_consignee_postal").val(value);
					break;
				case "ConsignTel":
					$("#contact_consignee_tel").val(value);
					break;
				case "ConsignFax":
					$("#contact_consignee_fax").val(value);
					break;
			}
		
		});
		
		$(id).on("getTemplateData", function(event) {
				
			var shipperName = $("#contact_shipper_name").val();
			var shipperAddress = $("#contact_shipper_address").val();
			var shipperCity = $("#contact_shipper_city").val();
			var shipperState = $("#contact_shipper_state").val();
			var shipperCountry = $("#contact_shipper_country").val();
			var shipperPostalCode = $("#contact_shipper_postal").val();
			var shipperTel = $("#contact_shipper_tel").val();
			var shipperFax = $("#contact_shipper_fax").val();
			
			var consignName = $("#contact_consignee_name").val();
			var consignAddress = $("#contact_consignee_address").val();
			var consignCity = $("#contact_consignee_city").val();
			var consignState = $("#contact_consignee_state").val();
			var consignCountry = $("#contact_consignee_country").val();
			var consignPostalCode = $("#contact_consignee_postal").val();
			var consignTel = $("#contact_consignee_tel").val();
			var consignFax = $("#contact_consignee_fax").val();
		
			var arr = [];
			var obj = new Object();
			obj.ModuleID = blockID;
			obj.DataID = "ShipperName";
			obj.Content = shipperName;
			arr.push(obj);
			
			obj = new Object();
			obj.ModuleID = blockID;
			obj.DataID = "ShipperAddress";
			obj.Content = shipperAddress;
			arr.push(obj);
			
			obj = new Object();
			obj.ModuleID = blockID;
			obj.DataID = "ShipperCity";
			obj.Content = shipperCity;
			arr.push(obj);
			
			obj = new Object();
			obj.ModuleID = blockID;
			obj.DataID = "ShipperState";
			obj.Content = shipperState;
			arr.push(obj);
			
			obj = new Object();
			obj.ModuleID = blockID;
			obj.DataID = "ShipperCountry";
			obj.Content = shipperCountry;
			arr.push(obj);
			
			obj = new Object();
			obj.ModuleID = blockID;
			obj.DataID = "ShipperPostalCode";
			obj.Content = shipperPostalCode;
			arr.push(obj);
			
			obj = new Object();
			obj.ModuleID = blockID;
			obj.DataID = "ShipperTel";
			obj.Content = shipperTel;
			arr.push(obj);
			
			obj = new Object();
			obj.ModuleID = blockID;
			obj.DataID = "ShipperFax";
			obj.Content = shipperFax;
			arr.push(obj);
			
			obj = new Object();
			obj.ModuleID = blockID;
			obj.DataID = "ConsignName";
			obj.Content = consignName;
			arr.push(obj);
			
			obj = new Object();
			obj.ModuleID = blockID;
			obj.DataID = "ConsignAddress";
			obj.Content = consignAddress;
			arr.push(obj);
			
			obj = new Object();
			obj.ModuleID = blockID;
			obj.DataID = "ConsignCity";
			obj.Content = consignCity;
			arr.push(obj);
			
			obj = new Object();
			obj.ModuleID = blockID;
			obj.DataID = "ConsignState";
			obj.Content = consignState;
			arr.push(obj);
			
			obj = new Object();
			obj.ModuleID = blockID;
			obj.DataID = "ConsignCountry";
			obj.Content = consignCountry;
			arr.push(obj);
			
			obj = new Object();
			obj.ModuleID = blockID;
			obj.DataID = "ConsignPostalCode";
			obj.Content = consignPostalCode;
			arr.push(obj);
			
			obj = new Object();
			obj.ModuleID = blockID;
			obj.DataID = "ConsignTel";
			obj.Content = consignTel;
			arr.push(obj);
			
			obj = new Object();
			obj.ModuleID = blockID;
			obj.DataID = "ConsignFax";
			obj.Content = consignFax;
			arr.push(obj);
			
			return {
				"ShipperConsignee" : {
					"TDataList" : arr,
				}
			}
			
		});

		$(id + ' .collapse_wrapper').on('hidden.bs.collapse', function (e) {
			$(id + " .collapse_icon i").removeClass("fa-arrow-circle-down fa-arrow-circle-up");
			$(id + " .collapse_icon i").addClass("fa-arrow-circle-down");
		})

		$(id + ' .collapse_wrapper').on('shown.bs.collapse', function (e) {
			$(id + " .collapse_icon i").removeClass("fa-arrow-circle-down fa-arrow-circle-up");
			$(id + " .collapse_icon i").addClass("fa-arrow-circle-up");
		})

		$(id).find(".expandable_title").keypress(function (e) {
			if(e.keyCode == 13){
				this.click();
			}
		});
		
	});	
	
	function openContactAddressBookSearch(e, tab) {
		if (typeof e !== 'undefined' && e != null) {
			e.preventDefault();
		}
		resetAddressBookSrc();
		localStorage.setItem("openAddressBookTab", tab);
		contactLity = lity('#contact_addressbook_search');
		getAddressBookSrc(null, defaultAddressBookCount);
	}
	
	function closeContactAddressBookSearch(e) {
		if (typeof e !== 'undefined' && e != null) {
			e.preventDefault();
		}
		localStorage.removeItem("openAddressBookTab");
		contactLity.close();
	}
	
	function getAddressBookSrc(e, count) {
		if (typeof e !== 'undefined' && e != null) {
			e.preventDefault();
		}
		var addrCode = $("#contact_addressbook_code_src").val() || "";
		
		//startAddressBookSearchAction();
		if (typeof count !== 'undefined' && count != null) {
			GetAddressBook(addrCode, count);
		} else {
			GetAddressBook(addrCode);
		}
		
	}
	
	function getAddressbookResult() {
		
		var rtn = "";
		var addressRecordTemp = $("#contact_addressbook_src_temp").html();
		
		var lt = [];
		if (localStorage.getItem("contact_addr_book") != null) {
			lt = JSON.parse(localStorage.getItem("contact_addr_book"));
		}

		for (var i = 0; i < lt.length; i++) {
			var name = lt[i].Name;
			if (lt[i].Name2 != "") {
				name += "," + lt[i].Name2;
			}
			rtn += addressRecordTemp.replaceAll("%ROWID%", i).replace("%ADDRCODE%", lt[i].AddressCode).replace("%NAME%", name).replace("%CITY%", lt[i].City);
		}
		
		return rtn;
	}
	
	function resetAddressBookSrc() {
		$("#contact_addressbook_code_src").val("");
		$("#contact_addressbook_result .rowwrapper").remove();
		
		$("#addressBookResultStatusWrapper .error-box").addClass("disabled");
		hideAddressBookLoading();
		hideAddressBookError();
	}
	
	function bindAddressBookData(e, row) {
		if (typeof e !== 'undefined' && e != null) {
			e.preventDefault();
		}
		var lt = [];
		var tab;
		if (localStorage.getItem("contact_addr_book") != null && localStorage.getItem("openAddressBookTab") != null) {
			lt = JSON.parse(localStorage.getItem("contact_addr_book"));
			tab = localStorage.getItem("openAddressBookTab");
			if (typeof lt[row] !== 'undefined' && lt[row] != null) {
				var name = lt[row].Name || "" ;
				
				var name2 = lt[row].Name2 || "";
				if (name2 != "") {
					name = " " + name2;
				}
				
				var addr1 = lt[row].Address1 || "";
				var addr2 = lt[row].Address2 || "";
				var addr3 = lt[row].Address3 || "";
				var addr = addr1;
				if (addr2 != "") {
					if (addr != "") {
						addr += " " + addr2;
					} else {
						addr = addr2;
					}
				}
				
				if (addr3 != "") {
					if (addr != "") {
						addr += " " + addr3;
					} else {
						addr = addr3;
					}
				}
				
				var city = lt[row].Place || "";
				var state = lt[row].City || "";
				var country = lt[row].CountryCode || "";
				var postalCode = lt[row].PostalCode || "";
				var tel = lt[row].Tel || "";
				var fax = lt[row].Fax || "";
				
				if (tab == 0) {
					$("#contact_shipper_name").val(getFieldMaxlengthVal($("#contact_shipper_name"), name));
					$("#contact_shipper_address").val(getFieldMaxlengthVal($("#contact_shipper_address"), addr));
					$("#contact_shipper_city").val(getFieldMaxlengthVal($("#contact_shipper_city"), city));
					$("#contact_shipper_state").val(getFieldMaxlengthVal($("#contact_shipper_state"), state));
					$("#contact_shipper_country").val(getFieldMaxlengthVal($("#contact_shipper_country"), country));
					$("#contact_shipper_postal").val(getFieldMaxlengthVal($("#contact_shipper_postal"), postalCode));
					$("#contact_shipper_tel").val(getFieldMaxlengthVal($("#contact_shipper_tel"), tel));
					$("#contact_shipper_fax").val(getFieldMaxlengthVal($("#contact_shipper_fax"), fax));
				} else if (tab == 1) {
					$("#contact_consignee_name").val(getFieldMaxlengthVal($("#contact_consignee_name"), name));
					$("#contact_consignee_address").val(getFieldMaxlengthVal($("#contact_consignee_address"), addr));
					$("#contact_consignee_city").val(getFieldMaxlengthVal($("#contact_consignee_city"), city));
					$("#contact_consignee_state").val(getFieldMaxlengthVal($("#contact_consignee_state"), state));
					$("#contact_consignee_country").val(getFieldMaxlengthVal($("#contact_consignee_country"), country));
					$("#contact_consignee_postal").val(getFieldMaxlengthVal($("#contact_consignee_postal"), postalCode));
					$("#contact_consignee_tel").val(getFieldMaxlengthVal($("#contact_consignee_tel"), tel));
					$("#contact_consignee_fax").val(getFieldMaxlengthVal($("#contact_consignee_fax"), fax));
				}
				
			} else {
				alert("Load Address book error occured");
			}
		} else {
			alert("Load Address book error occured");
		}
		
		closeContactAddressBookSearch();
	}
	
	function addtoAddressBook(tab) {
		console.log("addtoAddressBook");
		$("#contact_addressbook_code_ins_shipper ~ .error_or_msg").hide();
		$("#contact_addressbook_code_ins_consignee ~ .error_or_msg").hide();
		var isValid = true;
		var ind;
		var obj;
		if (tab == 0) {
			ind = "shipper";
			var addressCode = $("#contact_addressbook_code_ins_shipper").val();
			var name = $("#contact_shipper_name").val();
			var addr = $("#contact_shipper_address").val();
			var city = $("#contact_shipper_city").val();
			var state = $("#contact_shipper_state").val();
			var country = $("#contact_shipper_country").val();
			var postalCode = $("#contact_shipper_postal").val();
			var tel = $("#contact_shipper_tel").val();
			var fax = $("#contact_shipper_fax").val();
			
		} else if (tab == 1) {
			ind = "consignee";
			var addressCode = $("#contact_addressbook_code_ins_consignee").val();
			var name = $("#contact_consignee_name").val();
			var addr = $("#contact_consignee_address").val();
			var city = $("#contact_consignee_city").val();
			var state = $("#contact_consignee_state").val();
			var country = $("#contact_consignee_country").val();
			var postalCode = $("#contact_consignee_postal").val();
			var tel = $("#contact_consignee_tel").val();
			var fax = $("#contact_consignee_fax").val();		
		} else {
			isValid = false;
		}
		
		if (isValid) {
			obj = new Object();
			obj.AddressCode = addressCode;
			obj.Name = name;
			obj.Address1 = addr;
			obj.Place = city;
			obj.City = state;
			obj.CountryCode = country;
			obj.PostalCode = postalCode;
			obj.Tel = tel;
			obj.Fax = fax;
		}
		
		if (addressCode == "") {
			if (tab == 0) {
				$("#contact_addressbook_code_ins_shipper ~ .error_or_msg").text(i18next.t("contact.AddressCodeRequired"));
				$("#contact_addressbook_code_ins_shipper ~ .error_or_msg").show();
			} else {
				$("#contact_addressbook_code_ins_consignee ~ .error_or_msg").text(i18next.t("contact.AddressCodeRequired"));
				$("#contact_addressbook_code_ins_consignee ~ .error_or_msg").show();
			}
			isValid = false;
		} else if (name == "") {
			if (tab == 0) {
				$("#contact_addressbook_code_ins_shipper ~ .error_or_msg").text(i18next.t("contact.NameRequired"));
				$("#contact_addressbook_code_ins_shipper ~ .error_or_msg").show();
			} else {
				$("#contact_addressbook_code_ins_consignee ~ .error_or_msg").text(i18next.t("contact.NameRequired"));
				$("#contact_addressbook_code_ins_consignee ~ .error_or_msg").show();
			}
			isValid = false;
		} else if (addr == "") {
			if (tab == 0) {
				$("#contact_addressbook_code_ins_shipper ~ .error_or_msg").text(i18next.t("contact.AddressRequired"));
				$("#contact_addressbook_code_ins_shipper ~ .error_or_msg").show();
			} else {
				$("#contact_addressbook_code_ins_consignee ~ .error_or_msg").text(i18next.t("contact.AddressRequired"));
				$("#contact_addressbook_code_ins_consignee ~ .error_or_msg").show();
			}
			isValid = false;
		} else if (city == "") {
			if (tab == 0) {
				$("#contact_addressbook_code_ins_shipper ~ .error_or_msg").text(i18next.t("contact.CityRequired"));
				$("#contact_addressbook_code_ins_shipper ~ .error_or_msg").show();
			} else {
				$("#contact_addressbook_code_ins_consignee ~ .error_or_msg").text(i18next.t("contact.CityRequired"));
				$("#contact_addressbook_code_ins_consignee ~ .error_or_msg").show();
			}
			isValid = false;
		} else if (country == "") {
			if (tab == 0) {
				$("#contact_addressbook_code_ins_shipper ~ .error_or_msg").text(i18next.t("contact.CountryRequired"));
				$("#contact_addressbook_code_ins_shipper ~ .error_or_msg").show();
			} else {
				$("#contact_addressbook_code_ins_consignee ~ .error_or_msg").text(i18next.t("contact.CountryRequired"));
				$("#contact_addressbook_code_ins_consignee ~ .error_or_msg").show();
			}
			isValid = false;
		}
		
		if (isValid) {
			 showAddressBookAddLoading(ind);
			 AddAddressBookContact(obj);
		}
	}

	function getFieldMaxlengthVal($field, val) {
		if ($field.attr('maxlength'))
			return val.substring(0, $field.attr('maxlength'));
		else
			return val;
	}

</script><div id="bkd_def_ngtt" class="bkd_block" style="">
    <div class="col-xs-12">
        <h3 class="expandable_title" data-i18n="ngtt.NGTTInfo" data-toggle="collapse" href="#ngtt_info" tabindex="0" aria-expanded="true">Ultra Track Information</h3>
        <span class="collapse_icon">
            <i class="fa fa-arrow-circle-down fa-lg" aria-hidden="true" data-toggle="collapse" href="#ngtt_info" aria-expanded="true"></i>
        </span>
    </div>
    <div class="head_hr"></div>

    <div id="ngtt_info" class="collapse_wrapper collapse in" aria-expanded="true" style="">
        <div class="col-xs-12 col-md-12" style=" margin-bottom: 10px;">
            <span class="warning" data-i18n="ngtt.ChargingNote">Please note Ultra Track is a charging service</span>
        </div>
        <div class="col-xs-12 col-md-6">
            <div class="blk_gy_line blkl">
                <h4 class="blk_in" data-i18n="ngtt.Product">Product</h4>
                <div class="blkc"></div>
                <div class="bu_txt shipper_remark_form">

                    <div class="w100">
                        <select id="ngtt_product" class="select_bu disable" style="width:40%" disabled=""><option value="PER">PER</option><option value="PIL">PIL</option><option value="VUN">VUN</option><option value="PEF">PEF</option><option value="STP">STP</option><option value="PET">PET</option><option value="AVI">AVI</option><option value="ABC">ABC</option><option value="TRK">TRK</option></select>
                        <div class="error_or_msg" style="display:none;" data-i18n="">Invalid</div>
                    </div>

                </div>
            </div>

            <div class="blk_gy_line blkl">
                <h4 class="blk_in" data-i18n="ngtt.ServiceLevel">Service Level</h4>
                <div class="blkc"></div>

                <div class="blk_pallet">
                    <label for="uld_lower_deck_pallet" style="width:170px;" data-i18n="ngtt.Temperature">Transportation Temperature</label>
                    <select id="ngtt_temperature" class="select_bu disable" style="width:40%" disabled=""><option value="CRT" shc="CRT">CRT (15 to 25C; 59 to 77F)</option><option value="FRO" shc="FRO">FRO (-25 to -15C; -13 to 5F)</option><option value="COL" shc="COL">COL (2 to 8C; 35 to 47F)</option></select>
                </div>

                <div id="ngtt_ctTemperature">
                    <label id="ngtt_ctTemperature_label" for="uld_lower_deck_pallet" data-i18n="ngtt.CtTemperatureLabel">Temperature-Controlled Container?</label>
                    <div class="toggle btn btn-default off bu_toggle" data-toggle="toggle" style="width: 9px; height: 0px;"><input id="ngtt_ctTemperature_toggle" type="checkbox" data-toggle="toggle" data-on="Yes" data-off="No" data-style="bu_toggle"><div class="toggle-group"><label class="btn btn-primary toggle-on">Yes</label><label class="btn btn-default active toggle-off">No</label><span class="toggle-handle btn btn-default"></span></div></div>
                    <div id="ngtt_ctTemperature_option_div" class="blk_pallet" style="margin-top: 5px; display:none;">
                    <label id="ngtt_ctTemperature_option_label" for="uld_lower_deck_pallet" data-i18n="ngtt.CtTemperatureOptionLabel">Product Temperature</label>
                    <select id="ngtt_ctTemperature_option" class="select_bu" style="width:50%"><option value="LOW">-40 to -30C; -40 to -22F</option><option value="FRO">-25 to -15C; -13 to 5F</option><option value="COL">2 to 8C; 35 to 47F</option><option value="RMT">10 to 15C; 50 to 59F</option><option value="ICE">10 to 37C; 50 to 99F</option><option value="CRT">15 to 25C; 59 to 77F</option></select>
                </div>
            </div>
            </div>
            <div class="blk_gy_line blkl">
                <h4 class="blk_in" data-i18n="ngtt.OtherTrackingService">Other Tracking Service</h4>
                <div class="blkc"></div>
                <div class="blk_pallet">
                    <label for="uld_lower_deck_pallet" data-i18n="ngtt.Humidity">Humidity</label>
                    <select id="ngtt_humidity" class="select_bu disable" style="width:40%" disabled=""><option value="">N/A</option></select>
                </div>

                <div class="blk_pallet">
                    <label for="uld_lower_deck_pallet" data-i18n="ngtt.Shock">Shock</label>
                    <select id="ngtt_shock" class="select_bu disable" style="width:40%" disabled=""><option value="">N/A</option></select>
                </div>

                <div class="blk_pallet">
                    <label for="uld_lower_deck_pallet" data-i18n="ngtt.Light">Light</label>
                    <select id="ngtt_light" class="select_bu disable" style="width:40%" disabled=""><option value="">N/A</option></select>
                </div>

            </div>

            <div class="blk_gy_line blkl">
                <h4 class="blk_in" data-i18n="ngtt.DeviceID">Device ID *</h4>
                <div class="blkc"></div>
                <div class="blk_contour bu_txt">

                    <div class="w100">

                        <ol class="added_list device_input_wrapper">
                            <li class="device_input_row" data-rowid="1" style="margin: 0 40px 0 0">
                                <input class="w100" id="ngtt_deviceid_1" placeholder="i.e. 300433" style="width:50%">
                                <div class="error_or_msg" style="display:none;"></div>
                                <!--<div class="error_or_msg" style="display:none;" data-i18n="ngtt.MissingDeviceID">At least one device ID required</div>-->
                            </li>
                        
    <li class="device_input_row extra_row" data-rowid="2" style="margin: 0 40px 0 0">
        <input class="w100" id="ngtt_deviceid_2" style="width:50%" placeholder="i.e. 300433">
        <div class="error_or_msg" style="display:none;" data-i18n="ngtt.InvalidDeviceID">Invalid device ID</div>
    </li>

    <li class="device_input_row extra_row" data-rowid="3" style="margin: 0 40px 0 0">
        <input class="w100" id="ngtt_deviceid_3" style="width:50%" placeholder="i.e. 300433">
        <div class="error_or_msg" style="display:none;" data-i18n="ngtt.InvalidDeviceID">Invalid device ID</div>
    </li>
</ol>

                    </div>

                    <div class="blk_addDevice">
                    <a id="btnAddDeviceIcon" href="javascript:void(0)" class="bu_plus_link" tabindex="-1"><span></span></a>
                    <a id="btnAddDevice" href="javascript:void(0)" class="bu_plus_link" data-i18n="ngtt.AddDeviceID">Add more Device ID</a>
                    </div>

                </div>


            </div>

        </div>

        <div class="col-xs-12 col-md-6">
            <div class="blk_gy_line blkl">
                <h4 class="blk_in" data-i18n="ngtt.ContactPerson">Contact Person</h4>
                <div class="blkc"></div>
                <div class="bu_txt shipper_remark_form">

                    <div class="w100">
                        <input class="w100" id="ngtt_contact" style="width:40%">
                        <div class="error_or_msg" style="display:none;" data-i18n="">Invalid</div>
                    </div>

                </div>
            </div>

            <div class="blk_gy_line blkl">
                <h4 class="blk_in" data-i18n="ngtt.Email">Ultra Track Notification (E-mail Contact)</h4>
                <div class="blkc"></div>
                <div class="blk_contour bu_txt">

                    <div class="w100">
                        <ol class="added_list email_input_wrapper">
                            <li class="email_input_row" data-rowid="1" style="margin: 0 0 0 0">
                                <input class="w100" id="ngtt_email_1" style="width:70%">
                                <div class="error_or_msg" style="display:none;" data-i18n="ngtt.InvalidEmail">Invalid email</div>
                            </li>
                        </ol>
                    </div>

                    <div class="blk_addEmail">
                    <a id="btnAddEmailIcon" href="javascript:void(0)" class="bu_plus_link" tabindex="-1"><span></span></a>
                    <a id="btnAddEmail" href="javascript:void(0)" class="bu_plus_link" data-i18n="ngtt.AddEmail">Add more Email</a>
                    </div>

                </div>


            </div>

            <div class="blk_gy_line blkl">
                <h4 class="blk_in" data-i18n="ngtt.Tel">Ultra Track Notification (Tel. Contact)</h4>
                <div class="blkc"></div>
                <div class="blk_contour bu_txt">

                    <div class="w100">
                        <ol class="added_list tel_input_wrapper">
                            <li class="tel_input_row" data-rowid="1">
                                <input class="w100" id="ngtt_tel_1" style="width:40%">
                                <div class="error_or_msg" style="display:none;" data-i18n="">Invalid</div>
                            </li>
                        </ol>
                    </div>

                    <div class="blk_addTel">
                    <a id="btnAddTelIcon" href="javascript:void(0)" class="bu_plus_link" tabindex="-1"><span></span></a>
                    <a id="btnAddTel" href="javascript:void(0)" class="bu_plus_link" data-i18n="ngtt.AddTel">Add more Tel.</a>
                    </div>

                </div>


            </div>

        </div>

        <div class="blkc"></div>
    </div>

</div>

<script id="device_input_row_temp" type="text/x-template">
    <li class="device_input_row extra_row" data-rowid="%ID%" style="margin: 0 40px 0 0">
        <input class="w100" id="ngtt_deviceid_%ID%" style="width:50%" />
        <div class="error_or_msg" style="display:none;" data-i18n="ngtt.InvalidDeviceID">Invalid device ID</div>
    </li>
</script>

<script id="email_input_row_temp" type="text/x-template">
    <li class="email_input_row extra_row" data-rowid="%ID%" style="margin: 0 0 0 0">
        <input class="w100" id="ngtt_email_%ID%" style="width:70%" />
        <div class="error_or_msg" style="display:none;" data-i18n="ngtt.InvalidEmail">Invalid email</div>
    </li>
</script>

<script id="tel_input_row_temp" type="text/x-template">
    <li class="tel_input_row extra_row" data-rowid="%ID%">
        <input class="w100" id="ngtt_tel_%ID%" style="width:40%" />
        <div class="error_or_msg" style="display:none;" data-i18n="">Invalid tel no.</div>
    </li>
</script>

<script>

    $('#ngtt_ctTemperature_toggle').bootstrapToggle();

    $('#ngtt_ctTemperature_toggle').change(function () {
        if (this.checked) {
            $('#ngtt_ctTemperature_option_div').show();
            $('#ngtt_ctTemperature_option').show();
        } else {
            $('#ngtt_ctTemperature_option_div').hide();
            $('#ngtt_ctTemperature_option').hide();
        }
    });

    $('#ngtt_product').on('change', function () {
        setServiceLevel($(this).val());

        //try to reset temperature code if the existing one still valid
        var shc = $("#sc_special_code").val();
        var shcList = [];

        if (typeof PortList !== 'undefined' && PortList != null && typeof TemperatureList !== 'undefined' && TemperatureList != null)
        {
            if (shc != "") {
                shcList = shc.split(",");
            }

            for (var i = 0; i < shcList.length; i++)
            {
                var mappedtempcode = '';

                for (var j = 0; j < TemperatureList.length; j++) {
                    if (TemperatureList[j].temperatureSHC == shcList[i]) {
                        mappedtempcode = TemperatureList[j].temperatureCode;
                        break;
                    }
                }

                if (mappedtempcode != '') {
                    $('#ngtt_temperature option').each(function () {

                        if (this.value == mappedtempcode) {
                            $('#ngtt_temperature').val(this.value).change();

                            temperatureisexist = true;
                            return false;
                        }
                    });
                }
            }
        }

    });

    $("#btnAddDevice").click(function (e) {
        e.preventDefault();
        AddDeviceInput();
        $(".device_input_wrapper li").last().find("input").focus();
        $(".device_input_wrapper li").last().find("input").attr("placeholder", i18next.t("ngtt.DeviceIDHits"));
    });

    $("#btnAddEmail").click(function (e) {
        e.preventDefault();
        AddEmailInput();
        $(".email_input_wrapper li").last().find("input").focus();
    });

    $("#btnAddTel").click(function (e) {
        e.preventDefault();
        AddTelInput();
        $(".tel_input_wrapper li").last().find("input").focus();
    });

    function AddDeviceInput(cID, dID, callback) {

        var row = $("#device_input_row_temp").html();

        var currentRowID = getComponentRowID("device_input_row");
        currentRowID++;

        row = row.replaceAll("%ID%", currentRowID);
        $(".device_input_wrapper").append(row);

        if (typeof callback === "function" && typeof cID !== 'undefined' && typeof dID !== 'undefined') {
            callback(cID, dID);
        }

        if (currentRowID >= 10) {
            $(".blk_addDevice").hide();
        }
    }

    function AddEmailInput(cID, dID, callback) {

        var row = $("#email_input_row_temp").html();

        var currentRowID = getComponentRowID("email_input_row");
        currentRowID++;

        row = row.replaceAll("%ID%", currentRowID);
        $(".email_input_wrapper").append(row);

        if (typeof callback === "function" && typeof cID !== 'undefined' && typeof dID !== 'undefined') {
            callback(cID, dID);
        }

        if (currentRowID >= 10) {
            $(".blk_addEmail").hide();
        }
    }

    function AddTelInput(cID, dID, callback) {

        var row = $("#tel_input_row_temp").html();

        var currentRowID = getComponentRowID("tel_input_row");
        currentRowID++;

        row = row.replaceAll("%ID%", currentRowID);
        $(".tel_input_wrapper").append(row);

        if (typeof callback === "function" && typeof cID !== 'undefined' && typeof dID !== 'undefined') {
            callback(cID, dID);
        }

        if (currentRowID >= 10) {
            $(".blk_addTel").hide();
        }
    }

    function convertToF(celsius, type) {

        var result = celsius * 9 / 5 + 32;

        switch (type) {
            case "start":
                result = Math.floor(result);
                break;

            case "end":
                result = Math.ceil(result);
                break;
        }

        return result;
    }

    function setServiceLevel(code) {
        $('#ngtt_temperature').children().remove();
        $('#ngtt_humidity').children().remove();
        $('#ngtt_shock').children().remove();
        $('#ngtt_light').children().remove();


        if (typeof ProductServiceLevelCombination !== 'undefined' && ProductServiceLevelCombination != null && typeof TemperatureList !== 'undefined' && TemperatureList != null)
        {
            for (var i = 0; i < ProductServiceLevelCombination.length; i++) {
                if (code == ProductServiceLevelCombination[i].productCode) {
                    //temperature
                    for (var j = 0; j < ProductServiceLevelCombination[i].temperatureCode.length; j++) {

                        var tempCode = ProductServiceLevelCombination[i].temperatureCode[j];

                        for (var k = 0; k < TemperatureList.length; k++) {
                            if (tempCode == TemperatureList[k].temperatureCode) {
                                $('#ngtt_temperature')
                                    .append($("<option></option>")
                                        .attr("value", tempCode)
                                        .attr("shc", TemperatureList[k].temperatureSHC)
                                        .text(tempCode + ' (' + TemperatureList[k].startTemperature + ' to ' + TemperatureList[k].endTemperature + '\u00B0C\; ' + convertToF(TemperatureList[k].startTemperature, 'start') + ' to ' + convertToF(TemperatureList[k].endTemperature, 'end') + '\u00B0F)'));

                                break;
                            }
                        }

                    }
                    document.getElementById("ngtt_temperature").disabled = true;
                    document.getElementById("ngtt_temperature").classList.add("disable");
                    //document.getElementById("ngtt_temperature").setAttribute("style", "background-color: #999;");

                    //humidity
                    if (ProductServiceLevelCombination[i].humidity) {
                        $('#ngtt_humidity')
                            .append($("<option></option>")
                                .attr("value", "Y")
                                .text("Yes"));

                        $('#ngtt_humidity')
                            .append($("<option></option>")
                                .attr("value", "N")
                                .text("No"));
                        document.getElementById("ngtt_humidity").disabled = false;
                        document.getElementById("ngtt_humidity").classList.remove("disable");
                       // document.getElementById("ngtt_humidity").setAttribute("style", "background-color: null;");
                    }
                    else {
                        $('#ngtt_humidity')
                            .append($("<option></option>")
                                .attr("value", "")
                                .text("N/A"));
                        document.getElementById("ngtt_humidity").disabled = true;
                        document.getElementById("ngtt_humidity").classList.add("disable");
                        //document.getElementById("ngtt_humidity").setAttribute("style", "background-color: #999;");
                    }

                    //shock
                    if (ProductServiceLevelCombination[i].shock) {
                        $('#ngtt_shock')
                            .append($("<option></option>")
                                .attr("value", "Y")
                                .text("Yes"));
                        $('#ngtt_shock')
                            .append($("<option></option>")
                                .attr("value", "N")
                                .text("No"));
                        document.getElementById("ngtt_shock").disabled = false;
                        document.getElementById("ngtt_shock").classList.remove("disable");
                        //document.getElementById("ngtt_shock").setAttribute("style", "background-color: null;");
                    }
                    else {
                        $('#ngtt_shock')
                            .append($("<option></option>")
                                .attr("value", "")
                                .text("N/A"));
                        document.getElementById("ngtt_shock").disabled = true;
                        document.getElementById("ngtt_shock").classList.add("disable");
                        //document.getElementById("ngtt_shock").setAttribute("style", "background-color: #999;");
                    }

                    //light
                    if (ProductServiceLevelCombination[i].light) {
                        $('#ngtt_light')
                            .append($("<option></option>")
                                .attr("value", "Y")
                                .text("Yes"));
                        $('#ngtt_light')
                            .append($("<option></option>")
                                .attr("value", "N")
                                .text("No"));
                        document.getElementById("ngtt_light").disabled = false;
                        document.getElementById("ngtt_light").classList.remove("disable");
                       // document.getElementById("ngtt_light").setAttribute("style", "background-color: null;");
                    }
                    else {
                        $('#ngtt_light')
                            .append($("<option></option>")
                                .attr("value", "")
                                .text("N/A"));
                        document.getElementById("ngtt_light").disabled = true;
                        document.getElementById("ngtt_light").classList.add("disable");
                        //document.getElementById("ngtt_light").setAttribute("style", "background-color: #999;");
                    }

                    break;









                }


            }
        }

    }

    function validateEmail(mail)
        {
            if (/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(mail))
            {
                return true;
            }

            return false;
    }

    function validateDeviceID(deviceid)
        {
            //var reg = /^\d+$/;

        //let reg = new RegExp('^[0-9]+$');

        let reg = new RegExp(ngtt_deviceidformat);

            if (reg.test(deviceid))
            {
                if (Number(deviceid) <= 2147483647)
                {
                    return true;
                }
            }

            return false;
        }

    $(function() {
        var id = "#bkd_def_ngtt";
    //	var blockID = "bkd_def_shipperconsignee";
    //	var contactLity;

    //	$(id).on("clear", function(event) {
    //		//console.log(data);

    //		//debugger;
    //		$("#contact_shipper_name").val("");
    //		$("#contact_shipper_address").val("");
    //		$("#contact_shipper_city").val("");
    //		$("#contact_shipper_state").val("");
    //		$("#contact_shipper_country").val("");
    //		$("#contact_shipper_postal").val("");
    //		$("#contact_shipper_tel").val("");
    //		$("#contact_shipper_fax").val("");

    //		$("#contact_consignee_name").val("");
    //		$("#contact_consignee_address").val("");
    //		$("#contact_consignee_city").val("");
    //		$("#contact_consignee_state").val("");
    //		$("#contact_consignee_country").val("");
    //		$("#contact_consignee_postal").val("");
    //		$("#contact_consignee_tel").val("");
    //		$("#contact_consignee_fax").val("");

    //		$(id+" .error_or_msg").hide();
    //		$(id+" .error_or").removeClass("error_or");

    //	});

        $(id).on("init", function (event, data) {
    		//console.log(data);
    		var currentRowID;
    		//regContactElsOnEnter();
    		//debugger;
           
            var productary = [];
            if (typeof localStorage.getItem("NGTTProductList") !== 'undefined' && localStorage.getItem("NGTTProductList") != null) {

                $('#ngtt_product').children().remove();

                productary = JSON.parse(localStorage.getItem("NGTTProductList"));
                for (var i = 0; i < productary.length; i++) {
                    $('#ngtt_product')
                        .append($("<option></option>")
                            .attr("value", productary[i].productCode)
                            .text(productary[i].productCode));

                }
                document.getElementById("ngtt_product").disabled = true;
                document.getElementById("ngtt_product").classList.add("disable");
                //document.getElementById("ngtt_product").setAttribute("style", "background-color: #999;");
                setTimeout(function () {

                    //avoid init again after loadbookingdata
                    if ($("#ngtt_temperature option").length == 0)
                    {
                        setServiceLevel($('#ngtt_product').val());
                    }

                }, 1000);
            }

            if (typeof sessionStorage.getItem("ctTemperatureList") !== 'undefined' && sessionStorage.getItem("ctTemperatureList") != null) {
                console.log("getItem(ctTemperatureList) ");
                ctTemperatureList = JSON.parse(sessionStorage.getItem("ctTemperatureList"));
            }
            //ctTemperature
            console.log("init ctTemperatureList");
            if (typeof ctTemperatureList !== 'undefined' && ctTemperatureList != null) {
                for (var i = 0; i < ctTemperatureList.length; i++) {
                    $('#ngtt_ctTemperature_option')
                        .append($("<option></option>")
                            .attr("value", ctTemperatureList[i].ctTemperatureCode)
                            .text(ctTemperatureList[i].ctStartTemperature + ' to ' + ctTemperatureList[i].ctEndTemperature + '\u00B0C\; ' + convertToF(ctTemperatureList[i].ctStartTemperature, 'start') + ' to ' + convertToF(ctTemperatureList[i].ctEndTemperature, 'end') + '\u00B0F'));
                }
            }

    		//if (typeof data.ShipperConsignee !== 'undefined' && data.ShipperConsignee != null) {
    		//	$("#contact_shipper_name").val(data.ShipperConsignee.ShipperName);
    		//	$("#contact_shipper_address").val(data.ShipperConsignee.ShipperAddress);
    		//	$("#contact_shipper_city").val(data.ShipperConsignee.ShipperCity);
    		//	$("#contact_shipper_state").val(data.ShipperConsignee.ShipperState);
    		//	$("#contact_shipper_country").val(data.ShipperConsignee.ShipperCountry);
    		//	$("#contact_shipper_postal").val(data.ShipperConsignee.ShipperPostalCode);
    		//	$("#contact_shipper_tel").val(data.ShipperConsignee.ShipperTel);
    		//	$("#contact_shipper_fax").val(data.ShipperConsignee.ShipperFax);

    		//	$("#contact_consignee_name").val(data.ShipperConsignee.ConsignName);
    		//	$("#contact_consignee_address").val(data.ShipperConsignee.ConsignAddress);
    		//	$("#contact_consignee_city").val(data.ShipperConsignee.ConsignCity);
    		//	$("#contact_consignee_state").val(data.ShipperConsignee.ConsignState);
    		//	$("#contact_consignee_country").val(data.ShipperConsignee.ConsignCountry);
    		//	$("#contact_consignee_postal").val(data.ShipperConsignee.ConsignPostalCode);
    		//	$("#contact_consignee_tel").val(data.ShipperConsignee.ConsignTel);
    		//	$("#contact_consignee_fax").val(data.ShipperConsignee.ConsignFax);
    		//}

    	});

        $(id).on("refreshPlaceHolder", function (event) {
            $('#ngtt_deviceid_1').attr("placeholder", i18next.t("ngtt.DeviceIDHits"));
        });

        $(id).on("validate", function () {
            console.log("OK");


            //var intVad = /^\+?(0|[1-9]\d*)$/;
            //var decVad = /^([1-9]\d*|0\.\d*[1-9]|[1-9]\d*\.\d*[0-9]|0)$/;
            var isValid = true;
            var missingDeviceID = true;
            var missingEmail = true;
            var missingTel = true;
            var isNGTT = false;
            var odvalid = false;
            var ovalid = false;
            var dvalid = false;

            var shc = $("#sc_special_code").val();

            //check special handling code
            if (shc != "") {
                shcList = shc.split(",");

                if (shcList.length > 0) {
                    if (shcList.indexOf(ngtt_shc) > -1) {
                        isNGTT = true;
                    }
                }
            }


            //if ($('#bkd_def_ngtt').css("display") != 'none')
            if (isNGTT) {
                $("li[class^='device_input_row']").each(function (i, el) {
                    //var id = el.id.substring(el.id.indexOf("_")+1);
                    var rowid = $(this).attr("data-rowid");
                    //console.log("flightSegment");
                    //console.log("rowid: " +rowid);
                    //console.log("i: " +i);

                    var deviceID = $("#ngtt_deviceid_" + rowid).val();

                    //$("#ngtt_deviceid_" + rowid + " ~ .error_or_msg").text(i18next.t("ngtt.MissingDeviceID"));
                    $("#ngtt_deviceid_" + rowid).removeClass("invalid_input_field");
                    $("#ngtt_deviceid_" + rowid + " ~ .error_or_msg").hide();

                    if (deviceID != "") {
                        missingDeviceID = false;
                    }

                });
                //}

            $("li[class^='device_input_row']").each(function (i, el) {
                //var id = el.id.substring(el.id.indexOf("_")+1);
                var rowid = $(this).attr("data-rowid");
                //console.log("flightSegment");
                //console.log("rowid: " +rowid);
                //console.log("i: " +i);

                var deviceid = $("#ngtt_deviceid_" + rowid).val();

                //$("#uld_no_value_" + rowid + " ~ .error_or_msg").text(i18next.t("uld.Invalid"));
                $("#ngtt_deviceid_" + rowid).removeClass("invalid_input_field");
                $("#ngtt_deviceid_" + rowid + " ~ .error_or_msg").hide();

                if (deviceid != "") {
                    if (!validateDeviceID(deviceid)) {
                        $("#ngtt_deviceid_" + rowid).addClass("invalid_input_field");
                            //$("#ngtt_deviceid_" + rowid + " ~ .error_or_msg").text('Invalid deivce ID');
                            $("#ngtt_deviceid_" + rowid + " ~ .error_or_msg").text(i18next.t("ngtt.InvalidDeviceID"));
                        $("#ngtt_deviceid_" + rowid + " ~ .error_or_msg").show();
                        $("#ngtt_deviceid_" + rowid + " ~ .error_or_msg").css("display", "inline");
                        isValid = false;
                    }
                }

            });

            $("li[class^='email_input_row']").each(function (i, el) {

                var rowid = $(this).attr("data-rowid");




                var email = $("#ngtt_email_" + rowid).val();

                //$("#uld_no_value_" + rowid + " ~ .error_or_msg").text(i18next.t("uld.Invalid"));
                $("#ngtt_email_" + rowid).removeClass("invalid_input_field");
                $("#ngtt_email_" + rowid + " ~ .error_or_msg").hide();

                if (email != "") {
                        if (!validateEmail(email)) {

                        $("#ngtt_email_" + rowid).addClass("invalid_input_field");
                        $("#ngtt_email_" + rowid + " ~ .error_or_msg").show();
                        $("#ngtt_email_" + rowid + " ~ .error_or_msg").css("display", "inline");
                        isValid = false;
                    }

                        missingEmail = false;
                    }


                });

                $("li[class^='tel_input_row']").each(function (i, el) {

                    var rowid = $(this).attr("data-rowid");
                    var tel = $("#ngtt_tel_" + rowid).val();

                    $("#ngtt_tel_" + rowid).removeClass("invalid_input_field");
                    $("#ngtt_tel_" + rowid + " ~ .error_or_msg").hide();

                    if (tel != "") {
                        missingTel = false;
                }

            });

                //check rounting
                var routefrom = $("#routing_route_from_1").val();
                var routeto = '';
                var routetoid = 1;

                //only check the last RouteTo
                if (typeof PortList !== 'undefined' && PortList != null) {

                    $("div[class^='route_input_row']").each(function (i, el) {

                        var rowid = $(this).attr("data-rowid");
                        routetoid = rowid;

                        //$("#routing_route_to_" + rowid + " ~ .error_or_msg").text('The Destination is not available for ultra track subscription');
                        $("#routing_route_to_" + rowid + " ~ .error_or_msg").text(i18next.t("ngtt.InvalidDestination"));
                        $("#routing_route_to_" + rowid + " ~ .error_or_msg").hide();
                        $("#routing_route_to_" + rowid).parent().removeClass("error_or");

                        if ($("#routing_route_to_" + rowid).val() != '') {
                            routeto = $("#routing_route_to_" + rowid).val();
                        }

                    });

                    for (var i = 0; i < PortList.length; i++) {
                        if (PortList[i].toUpperCase() == routefrom.toUpperCase()) {

                            ovalid = true;

                            break;
                        }
                    }

                    for (var j = 0; j < PortList.length; j++) {
                        if (PortList[j].toUpperCase() == routeto.toUpperCase()) {
                            dvalid = true;
                            break;
                        }
                    }

                    if (ovalid && dvalid) {
                        odvalid = true;
                    }

                }
            }

            //if ($('#bkd_def_ngtt').css("display") != 'none' && (missingDeviceID || (missingEmail && missingTel)))
            if (isNGTT && (missingDeviceID || (missingEmail && missingTel) || !odvalid))
            {




                isValid = false;

                console.log('destination: ' + ovalid + dvalid);
                console.log('destination2: ' + PortList);

                if (!odvalid) {

                    if (!ovalid) {
                        $("#routing_route_from_1" + " ~ .error_or_msg").text(i18next.t("ngtt.InvalidOrigin"));
                        $("#routing_route_from_1 ~ .error_or_msg").show();
                        $("#routing_route_from_1").parent().addClass("error_or");
                    }

                    if (!dvalid) {
                        $("#routing_route_to_" + routetoid + " ~ .error_or_msg").text(i18next.t("ngtt.InvalidDestination"));
                        $("#routing_route_to_" + routetoid + " ~ .error_or_msg").show();
                        $("#routing_route_to_" + routetoid).parent().addClass("error_or");
                    }
                }
                else if (missingDeviceID) {
                $("#ngtt_deviceid_1").addClass("invalid_input_field");
                    $("#ngtt_deviceid_1" + " ~ .error_or_msg").text(i18next.t("ngtt.DeviceIDRequired"));
                $("#ngtt_deviceid_1" + " ~ .error_or_msg").show();
                $("#ngtt_deviceid_1" + " ~ .error_or_msg").css("display", "inline");
                }
                else if (missingEmail && missingTel) {
                    $("#ngtt_email_1").addClass("invalid_input_field");
                    $("#ngtt_email_1" + " ~ .error_or_msg").text(i18next.t("ngtt.EmailOrTelRequired"));
                    $("#ngtt_email_1" + " ~ .error_or_msg").show();
                    $("#ngtt_email_1" + " ~ .error_or_msg").css("display", "inline");

                    $("#ngtt_tel_1").addClass("invalid_input_field");
                    $("#ngtt_tel_1" + " ~ .error_or_msg").text(i18next.t("ngtt.EmailOrTelRequired"));
                    $("#ngtt_tel_1" + " ~ .error_or_msg").show();
                    $("#ngtt_tel_1" + " ~ .error_or_msg").css("display", "inline");
                }

                var attr = $("#ngtt_info").attr('aria-expanded');

                if (typeof attr == typeof undefined || attr == 'false')
                {
                        $(id).find(".expandable_title").click();
                }

            }

            return isValid;
            //return true;
        });

    $(id).on("submit", function () {

        var ngttProduct = $("#ngtt_product").val();
        var ngttTemperature = $("#ngtt_temperature").val();
        var ngttTemperatureShc = $("#ngtt_temperature :selected").attr('shc')
        var ngttHumidity = $("#ngtt_humidity").val();
        var ngttShock = $("#ngtt_shock").val();
        var ngttLight = $("#ngtt_light").val();
        var ngttContact = $("#ngtt_contact").val();
        var ngttInCooltainer = $("#ngtt_ctTemperature_toggle").is(':checked');
        var ngttCtTemperatureCode = ngttInCooltainer ? $("#ngtt_ctTemperature_option").val() : '';

        var deviceList = [];
        var emailList = [];
        var telList = [];

        $("li[class^='device_input_row']").each(function (i, el) {
            //var id = el.id.substring(el.id.indexOf("_")+1);
            var rowid = $(this).attr("data-rowid");
            //console.log("flightSegment");
            //console.log("rowid: " +rowid);
            //console.log("i: " +i);

            var obj = new Object();
            obj.Seq = rowid;
            obj.DeviceID = $("#ngtt_deviceid_" + rowid).val().toString();

            if (obj.DeviceID == "") {
            } else {
                deviceList.push(obj);
            }

        });

        $("li[class^='email_input_row']").each(function (i, el) {
            var rowid = $(this).attr("data-rowid");

            var obj = new Object();
            obj.Seq = rowid;
            obj.Email = $("#ngtt_email_" + rowid).val().toString();

            if (obj.Email == "") {
            } else {
                emailList.push(obj);
            }

        });

        $("li[class^='tel_input_row']").each(function (i, el) {
            var rowid = $(this).attr("data-rowid");

            var obj = new Object();
            obj.Seq = rowid;
            obj.Tel = $("#ngtt_tel_" + rowid).val().toString();

            if (obj.Tel == "") {
            } else {
                telList.push(obj);
            }

        });

        var ngttStartTemp = '';
        var ngttEndTemp = '';

		if (typeof TemperatureList !== 'undefined' && TemperatureList != null)
        {
			for (var i = 0; i < TemperatureList.length; i++) {
				if (ngttTemperature == TemperatureList[i].temperatureCode) {

					ngttStartTemp = TemperatureList[i].startTemperature;
					ngttEndTemp = TemperatureList[i].endTemperature;
					break;
				}
			}
		}

        var ngttCtStartTemp = 0;
        var ngttCtEndTemp = 0;
        console.log("submit ctTemperatureList");
        if ( ngttInCooltainer && typeof ctTemperatureList !== 'undefined' && ctTemperatureList != null) {
            for (var i = 0; i < ctTemperatureList.length; i++) {
                if (ngttCtTemperatureCode == ctTemperatureList[i].ctTemperatureCode) {

                    ngttCtStartTemp = ctTemperatureList[i].ctStartTemperature;
                    ngttCtEndTemp = ctTemperatureList[i].ctEndTemperature;
                    break;
                }
            }
        }

        return {
            "NGTTInfo": {
                "ProductCode": ngttProduct,
                "TemperatureCode": ngttTemperature,
                "TemperatureShc": ngttTemperatureShc,
                "Humidity": ngttHumidity,
                "Shock": ngttShock,
                "Light": ngttLight,
                "ContactPerson": ngttContact,
                "DeviceList": deviceList,
                "EmailList": emailList,
                "TelList": telList,
                "StartTemp": ngttStartTemp,
                "EndTemp": ngttEndTemp,
                "InCooltainer": ngttInCooltainer,
                "CtTemperatureCode": ngttCtTemperatureCode,
                "CtStartTemperature": ngttCtStartTemp,
                "CtEndTemperature": ngttCtEndTemp
            }
        };
    });

    	$(id).on("loadBookingData", function(event, bkdData) {
            //console.log(bkdData);
            var currentRowID;
            //var insertRowID;
            //debugger;

            //$("#uld_upper_deck_pallet").val("");
            //$("#uld_lower_deck_pallet").val("");
            //$("#uld_lower_deck_container").val("");

            $("#bkd_def_ngtt").hide();

            if (typeof bkdData.Cx !== 'undefined' && bkdData.Cx != null) {
                if (bkdData.Cx.hasOwnProperty('NgttInfo')) {
                    if (typeof bkdData.Cx.NgttInfo !== 'undefined' && bkdData.Cx.NgttInfo != null) {

                        if (bkdData.Cx.NgttInfo.ProductCode != '') {
                            $("#bkd_def_ngtt").show();
                            $('#ngtt_product').val(bkdData.Cx.NgttInfo.ProductCode).change();
                        }

                        if (bkdData.Cx.NgttInfo.ContactPerson != '') {
                            $('#ngtt_contact').val(bkdData.Cx.NgttInfo.ContactPerson);
                        }

                        if (typeof bkdData.Cx.NgttInfo.NgttService !== 'undefined' && bkdData.Cx.NgttInfo.NgttService != null) {
                            if (bkdData.Cx.NgttInfo.NgttService.TempCode != '') {
                                $('#ngtt_temperature').val(bkdData.Cx.NgttInfo.NgttService.TempCode).change();
                            }

                            if (bkdData.Cx.NgttInfo.NgttService.InCooltainer) {
                                $('#ngtt_ctTemperature_toggle').bootstrapToggle('on');
                                $('#ngtt_ctTemperature_option_div').show();
                                $('#ngtt_ctTemperature_option').show();
                                var shc = $("#sc_special_code").val();

                                //check special handling code
                                if (shc != "") {
                                    shcList = shc.split(",");

                                    if (shcList.length > 0) {
                                        if (shcList.indexOf('ACT') > -1) {
                                            $('#ngtt_ctTemperature_toggle').bootstrapToggle('disable');
                                        }
                                    }
                                }
                                if (bkdData.Cx.NgttInfo.NgttService.CtTemperatureCode != '')
                                    $('#ngtt_ctTemperature_option').val(bkdData.Cx.NgttInfo.NgttService.CtTemperatureCode).change();
                            }
                            else {
                                $('#ngtt_ctTemperature_toggle').bootstrapToggle('off');
                                $('#ngtt_ctTemperature_option_div').hide();
                                $('#ngtt_ctTemperature_option').hide();
                            }

                            if (bkdData.Cx.NgttInfo.NgttService.Humidity != null) {

                                if ($("#ngtt_humidity option").length > 1) {

                                    if (bkdData.Cx.NgttInfo.NgttService.Humidity) {
                                        $("#ngtt_humidity").val('Y').change();
                                    }
                                    else {
                                        $("#ngtt_humidity").val('N').change();
                                    }
                                }
                            }

                            if (bkdData.Cx.NgttInfo.NgttService.Shock != null) {
                                if ($("#ngtt_shock option").length > 1) {
                                    if (bkdData.Cx.NgttInfo.NgttService.Shock) {
                                        $("#ngtt_shock").val('Y').change();
                                    }
                                    else {
                                        $("#ngtt_shock").val('N').change();
                                    }
                                }
                            }

                            if (bkdData.Cx.NgttInfo.NgttService.Light != null) {
                                if ($("#ngtt_light option").length > 1) {
                                    if (bkdData.Cx.NgttInfo.NgttService.Light) {
                                        $("#ngtt_light").val('Y').change();
                                    }
                                    else {
                                        $("#ngtt_light").val('N').change();
                                    }
                                }
                            }

                            if (typeof bkdData.Cx.NgttInfo.DeviceIdList !== 'undefined' && bkdData.Cx.NgttInfo.DeviceIdList != null) {
                                for (var i = 0; i < bkdData.Cx.NgttInfo.DeviceIdList.length; i++) {
                                    if (i > 0) {
                                        $("#btnAddDevice").click();
                                    }

                                    var rowId = 1 + i;

                                    $('#ngtt_deviceid_' + rowId).val(bkdData.Cx.NgttInfo.DeviceIdList[i]);

                                }


                            }

                            if (typeof bkdData.Cx.NgttInfo.NgttNotification !== 'undefined' && bkdData.Cx.NgttInfo.NgttNotification != null) {

                                if (typeof bkdData.Cx.NgttInfo.NgttNotification.EmailList !== 'undefined' && bkdData.Cx.NgttInfo.NgttNotification.EmailList != null) {
                                    for (var i = 0; i < bkdData.Cx.NgttInfo.NgttNotification.EmailList.length; i++) {
                                        if (i > 0) {
                                            $("#btnAddEmail").click();
                                        }

                                        var rowId = 1 + i;

                                        $('#ngtt_email_' + rowId).val(bkdData.Cx.NgttInfo.NgttNotification.EmailList[i]);

                                    }
                                }

                                if (typeof bkdData.Cx.NgttInfo.NgttNotification.TelList !== 'undefined' && bkdData.Cx.NgttInfo.NgttNotification.TelList != null) {
                                    for (var i = 0; i < bkdData.Cx.NgttInfo.NgttNotification.TelList.length; i++) {
                                        if (i > 0) {
                                            $("#btnAddTel").click();
                                        }

                                        var rowId = 1 + i;

                                        $('#ngtt_tel_' + rowId).val(bkdData.Cx.NgttInfo.NgttNotification.TelList[i]);

                                    }
                                }


                            }


                        }


                        //    if (bkdData.FlightDetail.length > 0) {
                        //        if (typeof bkdData.FlightDetail[0].FlightDetailCx !== 'undefined' && bkdData.FlightDetail[0].FlightDetailCx != null) {
                        //            $("#uld_upper_deck_pallet").val(bkdData.FlightDetail[0].FlightDetailCx.UDP);
                        //            $("#uld_lower_deck_pallet").val(bkdData.FlightDetail[0].FlightDetailCx.LDP);
                        //            $("#uld_lower_deck_container").val(bkdData.FlightDetail[0].FlightDetailCx.LDC);

                        //            if (typeof bkdData.FlightDetail[0].FlightDetailCx.ContourCodeList !== 'undefined' && bkdData.FlightDetail[0].FlightDetailCx.ContourCodeList != null) {
                        //                for (var i = 0; i < bkdData.FlightDetail[0].FlightDetailCx.ContourCodeList.length; i++) {
                        //                    currentRowID = i + 1;

                        //                    if (i > 2) {
                        //                        AddULDContourInput(currentRowID, i, function (cID, dataRow) {
                        //                            $("#uld_select_type_" + cID).val(bkdData.FlightDetail[0].FlightDetailCx.ContourCodeList[dataRow].Code);
                        //                            $("#uld_no_value_" + cID).val(bkdData.FlightDetail[0].FlightDetailCx.ContourCodeList[dataRow].Count);
                        //                        });
                        //                    } else {
                        //                        $("#uld_select_type_" + currentRowID).val(bkdData.FlightDetail[0].FlightDetailCx.ContourCodeList[i].Code);
                        //                        $("#uld_no_value_" + currentRowID).val(bkdData.FlightDetail[0].FlightDetailCx.ContourCodeList[i].Count);
                        //                    }
                        //                }
                        //            }
                        //        }
                        //    }
                    }
                }
            }
    	});

    //	$(id).on("bindAddressBookSearchResult", function() {
    //		console.log("bindAddressBookSearchResult start");

    //		//stopAddressBookSearchAction();

    //		$("#contact_addressbook_result .rowwrapper").remove();

    //		var lt = [];
    //		if (localStorage.getItem("contact_addr_book") != null) {
    //			lt = JSON.parse(localStorage.getItem("contact_addr_book"));
    //		}

    //		if (lt.length == 0) {
    //			showAddressBookError("No Record found.");
    //		} else {
    //			hideAddressBookError();
    //		}

    //		content = getAddressbookResult();

    //		$("#contact_addressbook_result").append(content);

    //	});

    //	$(id).on("getData", function(event, dataID) {
    //		console.log(dataID);

    //		var rtn;

    //		switch(dataID) {
    //			case "ShipperName":
    //				rtn = $("#contact_shipper_name").val();
    //				break;
    //			case "ShipperAddress":
    //				rtn = $("#contact_shipper_address").val();
    //				break;
    //			case "ShipperCity":
    //				rtn = $("#contact_shipper_city").val();
    //				break;
    //			case "ShipperState":
    //				rtn = $("#contact_shipper_state").val();
    //				break;
    //			case "ShipperCountry":
    //				rtn = $("#contact_shipper_country").val();
    //				break;
    //			case "ShipperPostalCode":
    //				rtn = $("#contact_shipper_postal").val();
    //				break;
    //			case "ShipperTel":
    //				rtn = $("#contact_shipper_tel").val();
    //				break;
    //			case "ShipperFax":
    //				rtn = $("#contact_shipper_fax").val();
    //				break;
    //			case "ConsignName":
    //				rtn = $("#contact_consignee_name").val();
    //				break;
    //			case "ConsignAddress":
    //				rtn = $("#contact_consignee_address").val();
    //				break;
    //			case "ConsignCity":
    //				rtn = $("#contact_consignee_city").val();
    //				break;
    //			case "ConsignState":
    //				rtn = $("#contact_consignee_state").val();
    //				break;
    //			case "ConsignCountry":
    //				rtn = $("#contact_consignee_country").val();
    //				break;
    //			case "ConsignPostalCode":
    //				rtn = $("#contact_consignee_postal").val();
    //				break;
    //			case "ConsignTel":
    //				rtn = $("#contact_consignee_tel").val();
    //				break;
    //			case "ConsignFax":
    //				rtn = $("#contact_consignee_fax").val();
    //				break;
    //		}

    //		return rtn;

    //	});

    //	$(id).on("setData", function(event, dataID, value) {
    //		console.log(dataID);
    //		console.log(value);

    //		switch(dataID) {
    //			case "ShipperName":
    //				$("#contact_shipper_name").val(value);
    //				break;
    //			case "ShipperAddress":
    //				$("#contact_shipper_address").val(value);
    //				break;
    //			case "ShipperCity":
    //				$("#contact_shipper_city").val(value);
    //				break;
    //			case "ShipperState":
    //				$("#contact_shipper_state").val(value);
    //				break;
    //			case "ShipperCountry":
    //				$("#contact_shipper_country").val(value);
    //				break;
    //			case "ShipperPostalCode":
    //				$("#contact_shipper_postal").val(value);
    //				break;
    //			case "ShipperTel":
    //				$("#contact_shipper_tel").val(value);
    //				break;
    //			case "ShipperFax":
    //				$("#contact_shipper_fax").val(value);
    //				break;
    //			case "ConsignName":
    //				$("#contact_consignee_name").val(value);
    //				break;
    //			case "ConsignAddress":
    //				$("#contact_consignee_address").val(value);
    //				break;
    //			case "ConsignCity":
    //				$("#contact_consignee_city").val(value);
    //				break;
    //			case "ConsignState":
    //				$("#contact_consignee_state").val(value);
    //				break;
    //			case "ConsignCountry":
    //				$("#contact_consignee_country").val(value);
    //				break;
    //			case "ConsignPostalCode":
    //				$("#contact_consignee_postal").val(value);
    //				break;
    //			case "ConsignTel":
    //				$("#contact_consignee_tel").val(value);
    //				break;
    //			case "ConsignFax":
    //				$("#contact_consignee_fax").val(value);
    //				break;
    //		}

    //	});

    //	$(id).on("getTemplateData", function(event) {

    //		var shipperName = $("#contact_shipper_name").val();
    //		var shipperAddress = $("#contact_shipper_address").val();
    //		var shipperCity = $("#contact_shipper_city").val();
    //		var shipperState = $("#contact_shipper_state").val();
    //		var shipperCountry = $("#contact_shipper_country").val();
    //		var shipperPostalCode = $("#contact_shipper_postal").val();
    //		var shipperTel = $("#contact_shipper_tel").val();
    //		var shipperFax = $("#contact_shipper_fax").val();

    //		var consignName = $("#contact_consignee_name").val();
    //		var consignAddress = $("#contact_consignee_address").val();
    //		var consignCity = $("#contact_consignee_city").val();
    //		var consignState = $("#contact_consignee_state").val();
    //		var consignCountry = $("#contact_consignee_country").val();
    //		var consignPostalCode = $("#contact_consignee_postal").val();
    //		var consignTel = $("#contact_consignee_tel").val();
    //		var consignFax = $("#contact_consignee_fax").val();

    //		var arr = [];
    //		var obj = new Object();
    //		obj.ModuleID = blockID;
    //		obj.DataID = "ShipperName";
    //		obj.Content = shipperName;
    //		arr.push(obj);

    //		obj = new Object();
    //		obj.ModuleID = blockID;
    //		obj.DataID = "ShipperAddress";
    //		obj.Content = shipperAddress;
    //		arr.push(obj);

    //		obj = new Object();
    //		obj.ModuleID = blockID;
    //		obj.DataID = "ShipperCity";
    //		obj.Content = shipperCity;
    //		arr.push(obj);

    //		obj = new Object();
    //		obj.ModuleID = blockID;
    //		obj.DataID = "ShipperState";
    //		obj.Content = shipperState;
    //		arr.push(obj);

    //		obj = new Object();
    //		obj.ModuleID = blockID;
    //		obj.DataID = "ShipperCountry";
    //		obj.Content = shipperCountry;
    //		arr.push(obj);

    //		obj = new Object();
    //		obj.ModuleID = blockID;
    //		obj.DataID = "ShipperPostalCode";
    //		obj.Content = shipperPostalCode;
    //		arr.push(obj);

    //		obj = new Object();
    //		obj.ModuleID = blockID;
    //		obj.DataID = "ShipperTel";
    //		obj.Content = shipperTel;
    //		arr.push(obj);

    //		obj = new Object();
    //		obj.ModuleID = blockID;
    //		obj.DataID = "ShipperFax";
    //		obj.Content = shipperFax;
    //		arr.push(obj);

    //		obj = new Object();
    //		obj.ModuleID = blockID;
    //		obj.DataID = "ConsignName";
    //		obj.Content = consignName;
    //		arr.push(obj);

    //		obj = new Object();
    //		obj.ModuleID = blockID;
    //		obj.DataID = "ConsignAddress";
    //		obj.Content = consignAddress;
    //		arr.push(obj);

    //		obj = new Object();
    //		obj.ModuleID = blockID;
    //		obj.DataID = "ConsignCity";
    //		obj.Content = consignCity;
    //		arr.push(obj);

    //		obj = new Object();
    //		obj.ModuleID = blockID;
    //		obj.DataID = "ConsignState";
    //		obj.Content = consignState;
    //		arr.push(obj);

    //		obj = new Object();
    //		obj.ModuleID = blockID;
    //		obj.DataID = "ConsignCountry";
    //		obj.Content = consignCountry;
    //		arr.push(obj);

    //		obj = new Object();
    //		obj.ModuleID = blockID;
    //		obj.DataID = "ConsignPostalCode";
    //		obj.Content = consignPostalCode;
    //		arr.push(obj);

    //		obj = new Object();
    //		obj.ModuleID = blockID;
    //		obj.DataID = "ConsignTel";
    //		obj.Content = consignTel;
    //		arr.push(obj);

    //		obj = new Object();
    //		obj.ModuleID = blockID;
    //		obj.DataID = "ConsignFax";
    //		obj.Content = consignFax;
    //		arr.push(obj);

    //		return {
    //			"ShipperConsignee" : {
    //				"TDataList" : arr,
    //			}
    //		}

    //	});

    //	$(id + ' .collapse_wrapper').on('hidden.bs.collapse', function (e) {
    //		$(id + " .collapse_icon i").removeClass("fa-arrow-circle-down fa-arrow-circle-up");
    //		$(id + " .collapse_icon i").addClass("fa-arrow-circle-down");
    //	})

    //	$(id + ' .collapse_wrapper').on('shown.bs.collapse', function (e) {
    //		$(id + " .collapse_icon i").removeClass("fa-arrow-circle-down fa-arrow-circle-up");
    //		$(id + " .collapse_icon i").addClass("fa-arrow-circle-up");
    //	})

    //	$(id).find(".expandable_title").keypress(function (e) {
    //		if(e.keyCode == 13){
    //			this.click();
    //		}
    //	});

    });

    //function openContactAddressBookSearch(e, tab) {
    //	if (typeof e !== 'undefined' && e != null) {
    //		e.preventDefault();
    //	}
    //	resetAddressBookSrc();
    //	localStorage.setItem("openAddressBookTab", tab);
    //	contactLity = lity('#contact_addressbook_search');
    //	getAddressBookSrc(null, defaultAddressBookCount);
    //}

    //function closeContactAddressBookSearch(e) {
    //	if (typeof e !== 'undefined' && e != null) {
    //		e.preventDefault();
    //	}
    //	localStorage.removeItem("openAddressBookTab");
    //	contactLity.close();
    //}

    //function getAddressBookSrc(e, count) {
    //	if (typeof e !== 'undefined' && e != null) {
    //		e.preventDefault();
    //	}
    //	var addrCode = $("#contact_addressbook_code_src").val() || "";

    //	//startAddressBookSearchAction();
    //	if (typeof count !== 'undefined' && count != null) {
    //		GetAddressBook(addrCode, count);
    //	} else {
    //		GetAddressBook(addrCode);
    //	}

    //}

    //function getAddressbookResult() {

    //	var rtn = "";
    //	var addressRecordTemp = $("#contact_addressbook_src_temp").html();

    //	var lt = [];
    //	if (localStorage.getItem("contact_addr_book") != null) {
    //		lt = JSON.parse(localStorage.getItem("contact_addr_book"));
    //	}

    //	for (var i = 0; i < lt.length; i++) {
    //		var name = lt[i].Name;
    //		if (lt[i].Name2 != "") {
    //			name += "," + lt[i].Name2;
    //		}
    //		rtn += addressRecordTemp.replaceAll("%ROWID%", i).replace("%ADDRCODE%", lt[i].AddressCode).replace("%NAME%", name).replace("%CITY%", lt[i].City);
    //	}

    //	return rtn;
    //}

    //function resetAddressBookSrc() {
    //	$("#contact_addressbook_code_src").val("");
    //	$("#contact_addressbook_result .rowwrapper").remove();

    //	$("#addressBookResultStatusWrapper .error-box").addClass("disabled");
    //	hideAddressBookLoading();
    //	hideAddressBookError();
    //}

    //function bindAddressBookData(e, row) {
    //	if (typeof e !== 'undefined' && e != null) {
    //		e.preventDefault();
    //	}
    //	var lt = [];
    //	var tab;
    //	if (localStorage.getItem("contact_addr_book") != null && localStorage.getItem("openAddressBookTab") != null) {
    //		lt = JSON.parse(localStorage.getItem("contact_addr_book"));
    //		tab = localStorage.getItem("openAddressBookTab");
    //		if (typeof lt[row] !== 'undefined' && lt[row] != null) {
    //			var name = lt[row].Name || "" ;

    //			var name2 = lt[row].Name2 || "";
    //			if (name2 != "") {
    //				name = " " + name2;
    //			}

    //			var addr1 = lt[row].Address1 || "";
    //			var addr2 = lt[row].Address2 || "";
    //			var addr3 = lt[row].Address3 || "";
    //			var addr = addr1;
    //			if (addr2 != "") {
    //				if (addr != "") {
    //					addr += " " + addr2;
    //				} else {
    //					addr = addr2;
    //				}
    //			}

    //			if (addr3 != "") {
    //				if (addr != "") {
    //					addr += " " + addr3;
    //				} else {
    //					addr = addr3;
    //				}
    //			}

    //			var city = lt[row].Place || "";
    //			var state = lt[row].City || "";
    //			var country = lt[row].CountryCode || "";
    //			var postalCode = lt[row].PostalCode || "";
    //			var tel = lt[row].Tel || "";
    //			var fax = lt[row].Fax || "";

    //			if (tab == 0) {
    //				$("#contact_shipper_name").val(getFieldMaxlengthVal($("#contact_shipper_name"), name));
    //				$("#contact_shipper_address").val(getFieldMaxlengthVal($("#contact_shipper_address"), addr));
    //				$("#contact_shipper_city").val(getFieldMaxlengthVal($("#contact_shipper_city"), city));
    //				$("#contact_shipper_state").val(getFieldMaxlengthVal($("#contact_shipper_state"), state));
    //				$("#contact_shipper_country").val(getFieldMaxlengthVal($("#contact_shipper_country"), country));
    //				$("#contact_shipper_postal").val(getFieldMaxlengthVal($("#contact_shipper_postal"), postalCode));
    //				$("#contact_shipper_tel").val(getFieldMaxlengthVal($("#contact_shipper_tel"), tel));
    //				$("#contact_shipper_fax").val(getFieldMaxlengthVal($("#contact_shipper_fax"), fax));
    //			} else if (tab == 1) {
    //				$("#contact_consignee_name").val(getFieldMaxlengthVal($("#contact_consignee_name"), name));
    //				$("#contact_consignee_address").val(getFieldMaxlengthVal($("#contact_consignee_address"), addr));
    //				$("#contact_consignee_city").val(getFieldMaxlengthVal($("#contact_consignee_city"), city));
    //				$("#contact_consignee_state").val(getFieldMaxlengthVal($("#contact_consignee_state"), state));
    //				$("#contact_consignee_country").val(getFieldMaxlengthVal($("#contact_consignee_country"), country));
    //				$("#contact_consignee_postal").val(getFieldMaxlengthVal($("#contact_consignee_postal"), postalCode));
    //				$("#contact_consignee_tel").val(getFieldMaxlengthVal($("#contact_consignee_tel"), tel));
    //				$("#contact_consignee_fax").val(getFieldMaxlengthVal($("#contact_consignee_fax"), fax));
    //			}

    //		} else {
    //			alert("Load Address book error occured");
    //		}
    //	} else {
    //		alert("Load Address book error occured");
    //	}

    //	closeContactAddressBookSearch();
    //}

    //function addtoAddressBook(tab) {
    //	console.log("addtoAddressBook");
    //	$("#contact_addressbook_code_ins_shipper ~ .error_or_msg").hide();
    //	$("#contact_addressbook_code_ins_consignee ~ .error_or_msg").hide();
    //	var isValid = true;
    //	var ind;
    //	var obj;
    //	if (tab == 0) {
    //		ind = "shipper";
    //		var addressCode = $("#contact_addressbook_code_ins_shipper").val();
    //		var name = $("#contact_shipper_name").val();
    //		var addr = $("#contact_shipper_address").val();
    //		var city = $("#contact_shipper_city").val();
    //		var state = $("#contact_shipper_state").val();
    //		var country = $("#contact_shipper_country").val();
    //		var postalCode = $("#contact_shipper_postal").val();
    //		var tel = $("#contact_shipper_tel").val();
    //		var fax = $("#contact_shipper_fax").val();

    //	} else if (tab == 1) {
    //		ind = "consignee";
    //		var addressCode = $("#contact_addressbook_code_ins_consignee").val();
    //		var name = $("#contact_consignee_name").val();
    //		var addr = $("#contact_consignee_address").val();
    //		var city = $("#contact_consignee_city").val();
    //		var state = $("#contact_consignee_state").val();
    //		var country = $("#contact_consignee_country").val();
    //		var postalCode = $("#contact_consignee_postal").val();
    //		var tel = $("#contact_consignee_tel").val();
    //		var fax = $("#contact_consignee_fax").val();
    //	} else {
    //		isValid = false;
    //	}

    //	if (isValid) {
    //		obj = new Object();
    //		obj.AddressCode = addressCode;
    //		obj.Name = name;
    //		obj.Address1 = addr;
    //		obj.Place = city;
    //		obj.City = state;
    //		obj.CountryCode = country;
    //		obj.PostalCode = postalCode;
    //		obj.Tel = tel;
    //		obj.Fax = fax;
    //	}

    //	if (addressCode == "") {
    //		if (tab == 0) {
    //			$("#contact_addressbook_code_ins_shipper ~ .error_or_msg").text(i18next.t("contact.AddressCodeRequired"));
    //			$("#contact_addressbook_code_ins_shipper ~ .error_or_msg").show();
    //		} else {
    //			$("#contact_addressbook_code_ins_consignee ~ .error_or_msg").text(i18next.t("contact.AddressCodeRequired"));
    //			$("#contact_addressbook_code_ins_consignee ~ .error_or_msg").show();
    //		}
    //		isValid = false;
    //	} else if (name == "") {
    //		if (tab == 0) {
    //			$("#contact_addressbook_code_ins_shipper ~ .error_or_msg").text(i18next.t("contact.NameRequired"));
    //			$("#contact_addressbook_code_ins_shipper ~ .error_or_msg").show();
    //		} else {
    //			$("#contact_addressbook_code_ins_consignee ~ .error_or_msg").text(i18next.t("contact.NameRequired"));
    //			$("#contact_addressbook_code_ins_consignee ~ .error_or_msg").show();
    //		}
    //		isValid = false;
    //	} else if (addr == "") {
    //		if (tab == 0) {
    //			$("#contact_addressbook_code_ins_shipper ~ .error_or_msg").text(i18next.t("contact.AddressRequired"));
    //			$("#contact_addressbook_code_ins_shipper ~ .error_or_msg").show();
    //		} else {
    //			$("#contact_addressbook_code_ins_consignee ~ .error_or_msg").text(i18next.t("contact.AddressRequired"));
    //			$("#contact_addressbook_code_ins_consignee ~ .error_or_msg").show();
    //		}
    //		isValid = false;
    //	} else if (city == "") {
    //		if (tab == 0) {
    //			$("#contact_addressbook_code_ins_shipper ~ .error_or_msg").text(i18next.t("contact.CityRequired"));
    //			$("#contact_addressbook_code_ins_shipper ~ .error_or_msg").show();
    //		} else {
    //			$("#contact_addressbook_code_ins_consignee ~ .error_or_msg").text(i18next.t("contact.CityRequired"));
    //			$("#contact_addressbook_code_ins_consignee ~ .error_or_msg").show();
    //		}
    //		isValid = false;
    //	} else if (country == "") {
    //		if (tab == 0) {
    //			$("#contact_addressbook_code_ins_shipper ~ .error_or_msg").text(i18next.t("contact.CountryRequired"));
    //			$("#contact_addressbook_code_ins_shipper ~ .error_or_msg").show();
    //		} else {
    //			$("#contact_addressbook_code_ins_consignee ~ .error_or_msg").text(i18next.t("contact.CountryRequired"));
    //			$("#contact_addressbook_code_ins_consignee ~ .error_or_msg").show();
    //		}
    //		isValid = false;
    //	}

    //	if (isValid) {
    //		 showAddressBookAddLoading(ind);
    //		 AddAddressBookContact(obj);
    //	}
    //}

    //function getFieldMaxlengthVal($field, val) {
    //	if ($field.attr('maxlength'))
    //		return val.substring(0, $field.attr('maxlength'));
    //	else
    //		return val;
    //}

</script></li>

                            <li id="tab2" data-content="tab2" class="bkdtabs" style=""></li>

                            <li id="tab3" data-content="tab3" class="bkdtabs" style=""></li>
                        </div>
                    </div> <!-- outer wbg -->
                </ul>
            </div>
        </div>


        <div class="bottom-panel">
            <div class="blk_malign">
                <a class="act_bu act_save_draft" onclick="return submitDraftForm(event);" data-i18n="cargoInfo.SaveDraft" style="display: none;">Save Draft</a>
                
                <a href="javascript:void(0)" class="btn_or_l" id="btn_submit" onclick="return wayToSubmitForm(event);" data-i18n="common.Submit">Submit</a>
                <div class="lbl_date" style="display: none"><b data-i18n="cargoInfo.LastSaved">Last saved:</b> Today 11:30</div>
            </div>
        </div>
    </div>

    <div id="bkd_single_booking_result" style="display: none; min-height: calc(100% - 344px)">
        <input id="bkd_result_airline" type="hidden" value="">
        <input id="bkd_result_awbprefix" type="hidden" value="">
        <input id="bkd_result_awbsuffix" type="hidden" value="">
        <div class="wbg" style="">
            <div class="container wbg" style="">
                <div id="bkd_reply_status_icon" class="blk_success">
                    <div class="blk_msg"><h2 id="bkd_message"></h2><p id="bkd_sub_message" style="display: none">Booking Created: 18 Nov 16:33</p></div>
                    <div class="blkc"></div>
                </div>
                <div class="blk_gy_line just_created">
                    <div class="blk_cnt">
                        <div class="lbl_bookno"><span id="bkd_awb_number">$AWB$</span><span class="act_save"></span></div>
                        <div class="blksent_grp"><div class="lbl_value" id="bkd_orig">$ORIG$</div><div class="flight_to"></div><div class="lbl_value mr40" id="bkd_dest">$DEST$</div></div>
                        <div class="blksent_grp"><div class="lbl_value mr40"><span id="bkd_pcs">176</span><span data-i18n="cargoInfo.pcs">pcs</span></div><div class="lbl_value"><span id="bkd_weight">$WEIGHT$</span><span data-i18n="cargoInfo.kg">kg</span></div></div>
                    </div>
                    <div class="blk_bcnt">
                        <div class="lbl_value created_status" id="bkd_detail_message">$MESSAGE$</div><div class="lbl_remarks" id="bkd_detail_message_time">$TIME$</div>
						<div class="mark_booked">
							<a href="javascript: void(0)" onclick="javascript: bkdGoToBookingDetail(event);" data-i18n="cargoInfo.BookingDetails">Booking Details</a>
						</div>
						<div class="mark_booked flex-container margin-right">
							<a href="javascript: void(0)" onclick="javascript: goToAmendSingleBooking()" data-i18n="cargoInfo.Amend">Amend</a>
						</div>				
                        <div class="blkc"></div>
                    </div>
                </div>
                <div class="blk_btm_success"><a href="javascript: void(0)" class="link_bu_r" onclick="javascript: bkdGoToBookingLog(event);" data-i18n="cargoInfo.AllBookingLogs">All booking logs</a></div>
            </div>
        </div>
    </div>
    <input id="reloadValue" type="text" name="reloadValue" value="" style="display:none;">

    <script>
        //hold document ready before finishing loading of required scripts
        $.holdReady(true);
        Promise.all([
            loadMainScript(),
            InjectionManager.injectScripts(['fs.js', 'addressbook.js', 'dimension_cal.js', 'msgCtrl.js'])
        ]).then(function () {
            //release holding of document ready
            $.holdReady(false);
            $(function () {
                initMsgCtrl();
                resetWarning();

                localStorage.setItem("currentAirline", defaultAirline);
                localStorage.setItem("loadAWBno", "");
                localStorage.setItem("getAWBSuccess", 0);
                localStorage.setItem("GetBookingError", 0);
                localStorage.removeItem("pasteFlightDetailData");
                localStorage.setItem("currentUserID", "ADMIN FNAME,TEST ACCOUNT");
                // reset counting successfully awb retrieve by getawb
                localStorage.setItem("awb_retrieve_count", 0);
                //setDropdownBox();
                //regSHCodeAutoComplete();
                var loadAWB = false;
                if ("" != "" && "" != "") {
                    loadAWB = true;
                }
               // getDefaultOptionalItem(loadAWB);
                //getDefaultOptions(loadAWB)   //202109 comment out when page load

                RegDimensionCal();
                getNGTTProductCode();
                //regPortQuery();

                setData("bkd_def_cargoinfo", "Contact", "ADMIN FNAME,TEST ACCOUNT");

                var d = new Date();
                d = d.getTime();
                if ($('#reloadValue').val().length == 0) {
                    $('#reloadValue').val(d);
                    //$('body').show();
                }
                else {
                    $('#reloadValue').val('');
                    location.reload();
                }

                var loadedAwb = loadAWB;
                var airline = getParameterByName("Airline");
                var awbPrefix = getParameterByName("AWBPrefix");
                var awbSuffix = getParameterByName("AWBSuffix");
                var fs = getParameterByName("fs");
                localStorage.setItem("userCity", userCity.toUpperCase());
                if (airline == null && awbPrefix != null && !loadedAwb) {
                    airline = bkdAWBPrefixToAirline(awbPrefix) || null;
                }

                if (airline != null && awbPrefix != null && awbSuffix != null && !loadedAwb) {

                    switch (wayToRetrieve) {
                        case 0:
                            getAWB(airline, awbPrefix, awbSuffix);
                            break;
                        case 1:
                            startAction(false, i18next.t("common.Loading"), true);
                            setTimeout(function () { getAWBAPI(airline, awbPrefix, awbSuffix) }, 1); //Booking API
                            break;
                        default:
                            getAWB(airline, awbPrefix, awbSuffix);
                            break;
                    }
                } else if (fs != null) {
                    fsPaste(fs);
                }

                // set template data if set template by toolsbox from other page
                if (localStorage.getItem("toolsbox_template_data_to_fill") != null) {
                    var toolsBoxTemplateList = JSON.parse(localStorage.getItem("toolsbox_template_data_to_fill"));
                    getAirlineTemplate(toolsBoxTemplateList[0].Airline, AfterTemplateChange.FillTemplateData);
                    //setTemplateDataAfterNavi();
                }
                refreshModuleTranslation();

                //refresh placeholder text
                $('#singlebook_temp_record_src').attr("placeholder", i18next.t("SelectTemplate.SearchTemplate"));
                regTempElsOnEnter();
                console.timeEnd("default page"); // started from Skin\ToolsBox\ToolsBox\ToolsBox.ascx
            });
        })

        var Ctrl = {
            currentTab: 1
        };
        var defaultAirline = "CX";
        var lityInstance;
        var userCity = "HKG";
        localStorage.setItem("userCity", userCity.toUpperCase());
        var companyID = "GLS";
        localStorage.setItem("companyID", companyID.toUpperCase());
        var hasEzyCargoVIPPriority = "False" == "True" ? true : false;
        localStorage.setItem("hasEzyCargoVipPT", hasEzyCargoVIPPriority);

		var goodReplyMessage = [
			"",
            "CONFIRMED",
            "SUBMITTED",
            "ARRANGED",
            "NN",
            "NA",
            "CA",
            "KK",
            "HK",
            "KL",
            "NS",
            "KC",
            "LA"
		];

		var spaceAllocationCodeDict = [];
		spaceAllocationCodeDict["CA"] = "Booking against allotment";
		spaceAllocationCodeDict["NN"] = "Book not accept alternative";
		spaceAllocationCodeDict["NA"] = "Book accept alternative";
		spaceAllocationCodeDict["XX"] = "Cancel booking";
        spaceAllocationCodeDict["NL"] = "Booking for wait list";
        /*CX shopping button use in UAT only*/
        var windowObjectReference = null;

        function regContactElsOnEnter() {
            if (typeof getAddressBookSrc === "function")
                assignElsOnEnterFunc($("#contact_addressbook_code_src"), getAddressBookSrc);

            if (typeof addtoAddressBook === "function") {
                assignElsOnEnterFunc($("#contact_addressbook_code_ins_shipper"), function () { addtoAddressBook(0) });
                assignElsOnEnterFunc($("#contact_addressbook_code_ins_consignee"), function () { addtoAddressBook(1) });
            }
        }

        function regTempElsOnEnter() {
            assignElsOnEnterFunc($("#singlebook_temp_record_src"), getTemplateRecordSrc);
            assignElsOnEnterFunc($("#singlebook_temp_record_ins"), saveCurrentTemplate);
        }

        function regSearchFlightElsOnEnter() {
            var els = [$("#flt_airline_src")];
            assignElsOnEnterFunc(els, function() { $("#btn_fa_src").trigger("click")});
        }

        function reAttachSearchFlightElsOnEnter() {
            var els = [$("#flt_from_src"), $("#flt_to_src")];
            assignElsOnEnterFunc(els, function() { $("#btn_fa_src").trigger("click") });
        }

        function bkdTimeout() {
            bookingHub.client.error(i18next.t("CreateBooking.TimeoutAlternativeErrorMsg"));
            timeoutHandle = -1;
            showBookingErrorMsg("Get booking error", ["Connection timeout"]);
            localStorage.setItem("GetBookingError", 1);
        }

        function getAWB(airline, awbPrefix, awbSuffix) {
            resetWarning();
            connectHub(function () {
                for (var i = 1; i <= 3; i++) {
                    $("#tab" + i + " > .bkd_block").each(function (i, o) {
                        if ($._data(o, 'events') && $._data(o, 'events').clear != null)
                            $(o).triggerHandler("clear");
                    });
                }
                startAction(false, i18next.t("common.Loading"), true);
                bookingHub.server.getBooking(airline, awbPrefix, awbSuffix);
            });
        }

        //the following function created for Booking dummy API--20200928
        function getAWBAPI(airline, awbPrefix, awbSuffix) {
            console.log("start getAWBAPI");
            resetWarning();
            for (var i = 1; i <= 3; i++) {
                $("#tab" + i + " > .bkd_block").each(function (i, o) {
                    if ($._data(o, 'events') && $._data(o, 'events').clear != null)
                        $(o).triggerHandler("clear");
                });
            }

            var d = {
                "request": {
                    "airline": airline,
                    "awbPrefix": awbPrefix,
                    "awbSuffix": awbSuffix
                }
            }; //create array of objects
            var options = {};
            options.url = RetrieveAPIURL;
            options.type = "POST";
            options.contentType = "application/json; charset=utf-8";
            options.dataType = "json";
            options.data = JSON.stringify(d);
            options.beforeSend = function (xhr, settings) {
                xhr.setRequestHeader('Authorization', 'Bearer ' + getCookie('ApiToken'));
            };
            options.success = function (bkd) {
                console.log(bkd);
                if (typeof bkd.bookings !== 'undefined' && bkd.bookings != null) {
                    if (bkd.bookings.Consignee && bkd.bookings.Consignee.StreetAdd)
                        bkd.bookings.Consignee.StreetAdd = HandleContactAddrNullVal(bkd.bookings.Consignee.StreetAdd);
                    if (bkd.bookings.Shipper && bkd.bookings.Shipper.StreetAdd)
                        bkd.bookings.Shipper.StreetAdd = HandleContactAddrNullVal(bkd.bookings.Shipper.StreetAdd);
                    if (typeof bkd.bookings.Airline !== 'undefined' && bkd.bookings.Airline != null) {
                        if (_.includes(airlineList, bkd.bookings.Airline)) {
                            if (bkd.bookings.FlightDetail != null) {
                                if (bkd.bookings.FlightDetail.length > 0) {
                                    // from Datetime string to timestamp
                                    var currentDateOffset = new Date().getTimezoneOffset() / 60;
                                    for (var i = 0; i < bkd.bookings.FlightDetail.length; i++) {
                                        if (!isNaN(Date.parse(bkd.bookings.FlightDetail[i].DepartureDate))) {
                                            var date = new Date(bkd.bookings.FlightDetail[i].DepartureDate);
                                            date.setHours(date.getHours() - currentDateOffset);// to offset the function getAPIDate
                                            bkd.bookings.FlightDetail[i].DepartureDate = { Seconds: date.getTime() / 1000 };
                                        }
                                        if (!isNaN(Date.parse(bkd.bookings.FlightDetail[i].ArrivalDate))) {
                                            var date = new Date(bkd.bookings.FlightDetail[i].ArrivalDate);
                                            date.setHours(date.getHours() - currentDateOffset);// to offset the function getAPIDate
                                            bkd.bookings.FlightDetail[i].ArrivalDate = { Seconds: date.getTime() / 1000 };
                                        }
                                    }
                                }
                            }
                            localStorage.setItem("booking_data", JSON.stringify(bkd.bookings));
                            if (bkd.message == "WARN_CHINA") {
                                Ctrl.warnings.otherWarnings.add(i18next.t("cargoInfo.ChinaAwbWarn"));
                            }
                        } else {
                            alert("Load booking data failed. Airline data is missing.");
                        }
                        localStorage.setItem("currentAirline", bkd.bookings.Airline);
                    } else {
                        alert("Load booking data failed. Booking data is missing.");
                    }
                }

                if (bkd.response != "1") {
                    var errorMessage = "";
                    for (var i = 0; i < bkd.errors.length; i++) {
                        console.log("Error Message - " + bkd.errors[i].ErrorDescription);
                        if (errorMessage != "") errorMessage += "\n";
                        errorMessage += bkd.errors[i].ErrorCode + " - " + bkd.errors[i].ErrorDescription;
                    }
                    alert(errorMessage);
                    if (errorMessage.indexOf("CSP_WS_00055") > -1) {
                        setTimeout(function () {
                            Ctrl.warnings.otherWarnings.add(errorMessage);
                        }, 1000);
                        localStorage.setItem("getAWBSuccess", 0);
                    } else {
                       // getAirlineTemplateAPI(bkd.bookings.Airline, AfterTemplateChange.SetBookingData);
                        getAirlineTemplate(bkd.bookings.Airline, AfterTemplateChange.SetBookingData);
                    }
                    localStorage.setItem("GetBookingError", 1);
                    stopAction();
                } else {
                  //  getAirlineTemplateAPI(bkd.bookings.Airline, AfterTemplateChange.SetBookingData);
                    getAirlineTemplate(bkd.bookings.Airline, AfterTemplateChange.SetBookingData);
                }

                refreshModuleTranslation();
                console.log("end getAWBAPI");
            };
            options.error = function () {
                console.log("Error while calling the Web API!");
                stopAction();
                DialogManager.alert(i18next.t('common.System'), i18next.t('common.SessionTimeout'));
            };
            $.ajax(options);

        }
		//end getAWBAPI function

        function getAirlineTemplate(airline, afterAction) {
            console.timeEnd("getAWB");
            console.log("getAirlineTemplate, afterAction:", afterAction);
            console.time("getAirlineTemplate");
            console.time("bookingHub:getAirlineTemplate");
            connectHub(function () {
                startAction(true, "Switching Airline Profile", true);
                bookingHub.server.getAirlineTemplates(airline, afterAction);
            });
        }

        function getAirlineTemplateAPI(airline, afterAction) {
            console.timeEnd("getAWB");
            console.time("getAirlineTemplateAPI");
            console.time("API:getAirlineTemplateAPI");

            var templateIDList = [];
            if (typeof sessionStorage.getItem("AirlineDetailList") !== 'undefined' && sessionStorage.getItem("AirlineDetailList") != null) {
                var airlineDetailList = JSON.parse( sessionStorage.getItem("AirlineDetailList"));
                console.log("airlineDetailList", airlineDetailList);
             //   var obj = airlineDetailList.find(o => o.CarrierID === airline);
                var obj;
                for (var i = 0; i < airlineDetailList.length; i++) {
                    if (airlineDetailList[i].CarrierID == airline) {
                        obj = airlineDetailList[i];
                    }
                }
                console.log("obj", obj);
                if (obj != undefined && obj != null) {
                    templateIDList = obj.BookingTemplateID.singleBooking;
                }
            }

            var d = {
                "request": {
                    "airline": airline,
                    "templateIDList": templateIDList
                }
            }; //create array of objects
            var options = {};
            options.url = BookingAPIURL + "renderBookingTemplate";
            options.type = "POST";
            options.contentType = "application/json; charset=utf-8";
            options.dataType = "json";
            options.data = JSON.stringify(d);
            options.beforeSend = function (xhr, settings) {
                xhr.setRequestHeader('Authorization', 'Bearer ' + getCookie('ApiToken'));
            };
            options.success = function (bkd) {
                console.log(bkd);
                var tabs = bkd.objects;
                console.timeEnd("API:getAirlineTemplateAPI");

                stopAction();

                var submitData = prepareSubmitData();

                $("#tab1").html("");
                $("#tab2").html("");
                $("#tab3").html("");
                console.time("Tab1Html");
                // var tab1Html = ""
                for (var i = 0; i < tabs.Tab1.length; i++) {
                    // tab1Html += tabs.Tab1[i];
                    $("#tab1").append(tabs.Tab1[i])

                }
                //  $("#tab1").html(tab1Html);
                console.timeEnd("Tab1Html");

                console.time("tab2Html");
                // var tab2Html = ""
                for (var i = 0; i < tabs.Tab2.length; i++) {
                    // tab2Html += tabs.Tab2[i];
                    $("#tab2").append(tabs.Tab2[i])
                }

                //  $("#tab2").html(tab2Html);
                console.timeEnd("tab2Html");
                console.time("tab3Html");
                //var tab3Html = ""
                for (var i = 0; i < tabs.Tab3.length; i++) {
                    //  tab3Html += tabs.Tab3[i];
                    $("#tab3").append(tabs.Tab3[i])
                }

                //   $("#tab3").html(tab3Html);
                console.timeEnd("tab3Html");

                console.time("triggerHandler: submitData");
                for (var i = 1; i <= 3; i++) {
                    $("#tab" + i + " > .bkd_block").each(function (i, o) {
                        if ($._data(o, 'events') && $._data(o, 'events').init != null)
                            $(o).triggerHandler("init", submitData);
                    });
                }
                console.timeEnd("triggerHandler: submitData");

                $('#cargoInfo_awb_suffix').focus();
                getNGTTProductCode();

                console.time("AfterTemplateChange");
                if (afterAction == AfterTemplateChange.QuickAWBSearch) {
                    if (typeof cargoInfoQuickSearchAWB === "function") {
                        cargoInfoQuickSearchAWB();
                    }
                } else if (afterAction == AfterTemplateChange.FillTemplateData) {
                    if (typeof setTemplateDataAfterNavi === "function") {
                        setTemplateDataAfterNavi();
                    }
                } else if (afterAction == AfterTemplateChange.SetBookingData) {
                    setBookingData();
                    if (localStorage.getItem("awb_retrieve_count") != null) {
                        var awb_s_count = parseInt(localStorage.getItem("awb_retrieve_count"));
                        localStorage.setItem("awb_retrieve_count", awb_s_count + 1);
                    }
                    $('#cargoInfo_pcs').focus();
                } else if (afterAction == AfterTemplateChange.PasteFlightDetailData) {
                    fsPasteFlightDetail();
                }
                if (getData("bkd_def_cargoinfo", "Airline") == "CX" || getData("bkd_def_cargoinfo", "Airline") == "KA" || getData("bkd_def_cargoinfo", "Airline") == "LD" || getData("bkd_def_cargoinfo", "Airline") == "UO") {
                    $(".act_save_draft").hide();
                } else {
                    $(".act_save_draft").show()
                }
                console.timeEnd("AfterTemplateChange");
                refreshModuleTranslation();
                console.timeEnd("getAirlineTemplateAPI");
                console.log("end getAirlineTemplateAPI");
            };
            options.error = function () {
                console.log("Error while calling the Web API!");
                stopAction();
                DialogManager.alert(i18next.t('common.System'), i18next.t('common.SessionTimeout'));
            };
            $.ajax(options);
        }

        function validateTab(e, tabID) {
            var isValid = true;
            for (var i = tabID - 1; i > 0; i = i - 1) {
                $("#tab" + i + " > .bkd_block").each(function (i, o) {
                    if ($._data(o, 'events') && $._data(o, 'events').validate != null)
                        if (!$(o).triggerHandler("validate"))
                            isValid = false;
                });

                if (!isValid)
                    break;
            }
            if (!isValid) {
                e.preventDefault();
                e.stopPropagation();
                console.log(i);

                $("#tab" + i + "btn").click();
                return false;
            }
            return isValid;
        }

		function validateApiCheck(e, tabID){
            var validatePromises = [] ;

            for (var i = tabID - 1; i > 0; i = i - 1) {
                //Server Side Validation
                $("#tab" + i + " > .bkd_block").each(function (blockIdx, o) {
                    if ($._data(o, 'events') && $._data(o, 'events').apiValidate != null)
                        validatePromises.push($(o).triggerHandler("apiValidate"));
                });
            }
            return Promise.all(validatePromises).then(function(p){
                if (p.every((function(x) { return x.isValid === true }))){
                    return true;
                }
                else {
                    e.preventDefault();
                    e.stopPropagation();
                    //Find the first tabID with validation error
                    let tabNo = p.filter(function(x) { return x.isValid == false })[0].tabId;

                    $("#tab" + tabNo + "btn").click();
                    return false;
                }
            });
        }

        function prepareSubmitData() {
            var submitData = {};
            for (var i = 1; i <= 3; i++) {
                $("#tab" + i + " > .bkd_block").each(function (i, o) {
                    if ($._data(o, 'events') && $._data(o, 'events').submit != null)
                        $.extend(submitData, $(o).triggerHandler("submit"));
                });
            }
            return submitData;
        }

        function wayToSubmitForm(e) {
            console.time("submitForm");
			window.location.href="bookingdetail.html"
			/*202109
            var currentAirline = $("#cargoInfo_airline").val();
            console.log("currentAirline", currentAirline);
            console.log("wayToSubmit", wayToSubmit);
            if (wayToSubmit == 1) {
                if (_.find(Constant.cxTemplateAirlines, function (o) { return o == currentAirline; })) {

                    startAction(false, i18next.t("common.Submitting"), true);
                    setTimeout(function () { submitFormAPI(e) }, 1);
                } else {
                    submitForm(e);
                }
            } else {
                submitForm(e);
            }
			*/
        }

        function submitForm(e) {
            if (validateTab(e, 4)) {
				validateApiCheck(e, 4).then(function(isValid){
                    if (isValid){
                submitData = prepareSubmitData();
                connectHub(function () {
                    startAction(false, i18next.t("common.Submitting"), true);
                    bookingHub.server.submit(JSON.stringify(submitData));
                });
            }
            else {
                autoScroll();
            }
				});
			}
			else {
				autoScroll();
			}
        }

        function submitDraftForm(e) {
            submitData = prepareSubmitData();
            if (submitData["CargoInfo"]["AWBPrefix"].length != 3 || submitData["CargoInfo"]["AWBSuffix"].length != 8) {
                alert("Air Waybill Number must be provided to save draft")
                return;
            }

            if (!validateAWBInputField(submitData["CargoInfo"]["AWBSuffix"])) {
                return;
            }
            if (typeof submitData.AgtAcctNo !== "undefined" && !submitData.AgtAcctNo) {
                alert(i18next.t("cargoInfo.LHAcctNoMiss"));
                return;
            }
            connectHub(function () {
                startAction(false, i18next.t("common.Submitting"), true);
                bookingHub.server.submitDraft(JSON.stringify(submitData));
            });
        }

        function submitFormAPI(e) {
            console.log("start createAWBAPI");
            if (validateTab(e, 4)) {
                validateApiCheck(e, 4).then(function (isValid) {
                    if (isValid) {
                        submitData = prepareSubmitData();
                        console.log("submitData", submitData);
                        var d = {
                            "request": {
                                "submitData": submitData
                            },
                            "source": "EzyCargo"
                        }; //create array of objects
                        console.log(d);
                        var options = {};
                        options.url = SubmitAPIURL;
                        options.type = "POST";
                        options.contentType = "application/json; charset=utf-8";
                        options.dataType = "json";
                        options.data = JSON.stringify(d);
                        options.beforeSend = function (xhr, settings) {
                            xhr.setRequestHeader('Authorization', 'Bearer ' + getCookie('ApiToken'));
                        };
                        options.success = function (res) {
                            console.log(res);
                            if (res.Booking != null) {
                                bkd = res.Booking;
                                $("#bkd_result_airline").val(bkd.Airline);
                                $("#bkd_result_awbprefix").val(bkd.AwbPrefix);
                                $("#bkd_result_awbsuffix").val(bkd.AwbSuffix);
                                var message = "";
                                var isError = false;
                                var hasError = false;
                                if (res.Errors != null) {
                                    if (res.Errors.length > 0) {
                                        hasError = true;
                                    }
                                }
                                if (hasError) {
                                    console.log("res.Errors ",res.Errors);
                                    if (res.Errors.length > 0) {
                                        for (var i = 0; i < res.Errors.length; i++) {
                                            if (message != "") message += "<br />";
                                            message += res.Errors[i].ErrorCode + " - " + res.Errors[i].ErrorDescription;
                                        }
                                        console.log("message ", message);
                                        isError = true;
                                        //revision needed handling
                                        if (message.indexOf("CSP_WS_00039") > -1) {
                                            message += "<br />" + i18next.t("cargoInfo.RetrieveAWBMsg");
                                            message = message.replace('$AWB$', "<a id=\"reply_redirect\" href=\"javascript: void(0)\">" + i18next.t("menu.SingleBooking") + "</a>");
                                            console.log("message CSP_WS_00039", message);
                                        }
                                    }
                                }
                                else {
                                    console.log("bkd.Reply ", bkd.Reply);
                                    if (bkd.Reply != null && bkd.Reply.length > 0 && bkd.Reply[0].Ack2 != "") {
                                        message = bkd.Reply[0].Ack2;
                                        isError = true;
                                        console.log("bkd.Reply message ", message);
                                    }
                                    else {
                                        if (bkd.CxIsSpecified) {
                                            var cxGoodReply = true;
                                            var cxGoodMessage = "";
                                            if (typeof bkd.FlightDetail !== 'undefined' && bkd.FlightDetail != null) {
                                                for (var i = 0; i < bkd.FlightDetail.length; i++) {
                                                    if (bkd.FlightDetail[0].FlightDetailCxIsSpecified) {
                                                        if (goodReplyMessage.indexOf(bkd.FlightDetail[i].FlightDetailCx.FCTLStatusX.toUpperCase()) != -1 || goodReplyMessage.indexOf(bkd.FlightDetail[i].FlightDetailCx.FCTLStatus.toUpperCase()) != -1) {
                                                            if (bkd.FlightDetail[i].FlightDetailCx.FCTLStatusX != "") {
                                                                cxGoodMessage = bkd.FlightDetail[i].FlightDetailCx.FCTLStatusX;
                                                            }
                                                        }
                                                        else {
                                                            cxGoodReply = false;
                                                            message = bkd.FlightDetail[i].FlightDetailCx.FCTLStatusX;
                                                            break;
                                                        }
                                                    }
                                                    else {
                                                        if (!goodReplyMessage.indexOf(bkd.FlightDetail[i].SpaceAllocationCode) != -1) {
                                                            headerErrorMessage = spaceAllocationCodeDict[bkd.FlightDetail[i].SpaceAllocationCode];
                                                            headerDisplayError = true;
                                                        }
                                                    }
                                                }
                                                if (cxGoodReply) {
                                                    message = cxGoodMessage;
                                                }
                                            }
                                            if (typeof bkd.Cx !== 'undefined' && bkd.Cx != null) {
                                                if (typeof bkd.Cx.NgttInfo !== 'undefined' && bkd.Cx.NgttInfo != null) {
                                                    if (bkd.Cx.NgttInfo.ProductCode != '') {
                                                        message += '<br> Ultra track is subscribed, should you have any problem, please contact to CX local sales team';
                                                    }
                                                }
                                            }
                                        }
                                        else {
                                            message = "Booking Submitted";
                                        }
                                    }
                                }
                                if (isError) {
                                    $("#bkd_reply_status_icon").addClass("blk_error");
                                    $('#bkd_reply_status_icon #bkd_message').text(i18next.t("cargoInfo.ResubmitMsg"));
                                }
                                else {
                                    $("#bkd_reply_status_icon").removeClass("blk_error");
                                    $('#bkd_reply_status_icon #bkd_message').text(i18next.t("cargoInfo.BookingSubmitted"));
                                }
                                $("#bkd_awb_number").html(bkd.AwbPrefix + "-" + bkd.AwbSuffix);
                                $("#bkd_orig").html(bkd.Origin);
                                $("#bkd_dest").html(bkd.Destination);
                                $("#bkd_pcs").html(bkd.Pieces);
                                $("#bkd_weight").html(bkd.Weight);
                                $("#bkd_detail_message").html(message);
                                $("#bkd_detail_message_time").html(new Date().ToString(DateTimeFormat.Full));
                                $("#bkd_single_booking_result").css("display", "block");
                                $("#bkd_single_booking").css("display", "none");
                                $("#reply_redirect").click(function () {
                                    goToSingleBooking(bkd.Airline, bkd.AwbPrefix, bkd.AwbSuffix);
                                });
                            }
                            refreshModuleTranslation();
                            console.log("end createAWBAPI");
                        };
                        options.error = function () {
                            console.log("Error while calling the Web API!");
                            stopAction();
                            DialogManager.alert(i18next.t('common.System'), i18next.t('common.SessionTimeout'));
                        };
                        $.ajax(options);
                    }
                    else {
                        autoScroll();
                        stopAction();
                    }
                });
            }
            else {
                autoScroll();
                stopAction();
            }

        }

        //function toggleSubmitButton(tabID, doChangeTab) {
        //    debugger;
        //    if (!!!tabID) tabID = 3;

        //    switch (tabID) {
        //        case 1:
        //            $("#btn_continue_tab1").css('display', 'inline-block');
        //            $("#btn_continue_tab2").css('display', 'none');
        //            $('#btn_submit').css('display', 'none');
        //            break;
        //        case 2:
        //            $("#btn_continue_tab1").css('display', 'none');
        //            $("#btn_continue_tab2").css('display', 'inline-block');
        //            $('#btn_submit').css('display', 'none');
        //            break;
        //        case 3:
        //            $("#btn_continue_tab1").css('display', 'none');
        //            $("#btn_continue_tab2").css('display', 'none');
        //            $('#btn_submit').css('display', 'inline-block');
        //            break;
        //    }
        //}

        function toggleFastSubmit(allow) {
            if (allow) {
                //toggleSubmitButton();
                //$("li.dash_2 a").attr("disabled", "disabled");
                //$("li.dash_3 a").attr("disabled", "disabled");
                $("#bkd_def_remarks").hide();
                $("#bkd_def_remarks").triggerHandler("clear");
                $("#bkd_def_uld").hide();
                $("#bkd_def_uld").triggerHandler("clear");
                $("#bkd_def_dim").hide();
                $("#bkd_def_dim").triggerHandler("clear");
                $("#bkd_def_shipperconsignee").hide();
                $("#bkd_def_shipperconsignee").triggerHandler("clear");
            }
            else {
                //toggleSubmitButton(1);
                //$("li.dash_2 a").removeAttr("disabled");
                //$("li.dash_3 a").removeAttr("disabled");
                $("#bkd_def_remarks").show();
                $("#bkd_def_uld").show();
                $("#bkd_def_dim").show();
                $("#bkd_def_shipperconsignee").show();
            }
        }

        //$("#tab1btn").onFirst('click', function (event) {
        //    return changeTab(1, true);
        //});
        //$("#tab2btn").onFirst('click', function (event) {
        //    return changeTab(2, true);
        //});
        //$("#tab3btn").onFirst('click', function (event) {
        //    return changeTab(3, true);
        //});

        //function changeTab(tabID, doChangeTab) {
        //    switch (tabID) {
        //        case 1:
        //            if (doChangeTab && Ctrl.currentTab != tabID) {
        //                Ctrl.currentTab = tabID;

        //                toggleSubmitButton(1);
        //                $("#btn_back").css('display', 'none');

        //                $("li.dash_1 a").addClass("selected");
        //                $("li.dash_2 a").removeClass("selected");
        //                $("li.dash_3 a").removeClass("selected");
        //                $("li[data-content='tab1']").addClass("selected");
        //                $("li[data-content='tab2']").removeClass("selected");
        //                $("li[data-content='tab3']").removeClass("selected");
        //                resetWarning();
        //            }
        //            break;
        //        case 2:
        //            if (!validateTab(event, 2)) return false;

        //            if (doChangeTab && Ctrl.currentTab != tabID) {
        //                Ctrl.currentTab = tabID;

        //                toggleSubmitButton(2);
        //                $("#btn_back").css('display', 'inline-block');
        //                $('#btn_back').attr('to-tab', 1);

        //                $("li.dash_1 a").removeClass("selected");
        //                $("li.dash_2 a").addClass("selected");
        //                $("li.dash_3 a").removeClass("selected");
        //                $("li[data-content='tab1']").removeClass("selected");
        //                $("li[data-content='tab2']").addClass("selected");
        //                $("li[data-content='tab3']").removeClass("selected");
        //                resetWarning();
        //            }
        //            break;
        //        case 3:
        //            if (!validateTab(event, 3)) return false;

        //            if (doChangeTab && Ctrl.currentTab != tabID) {
        //                Ctrl.currentTab = tabID;

        //                toggleSubmitButton(3);
        //                $("#btn_back").css('display', 'inline-block');
        //                $('#btn_back').attr('to-tab', 2);

        //                $("li.dash_1 a").removeClass("selected");
        //                $("li.dash_2 a").removeClass("selected");
        //                $("li.dash_3 a").addClass("selected");
        //                $("li[data-content='tab1']").removeClass("selected");
        //                $("li[data-content='tab2']").removeClass("selected");
        //                $("li[data-content='tab3']").addClass("selected");
        //                resetWarning();
        //            }
        //            break;
        //    }
        //    autoScroll();
        //    return true;
        //}

        //function backTab(toTab) {
        //    changeTab(parseInt(toTab), true);
        //}

        bookingHub.client.submitReply = function (bkd, status, message) {
            stopAction();
            console.log(bkd);
            $("#bkd_result_airline").val(bkd.Airline);
            $("#bkd_result_awbprefix").val(bkd.AwbPrefix);
            $("#bkd_result_awbsuffix").val(bkd.AwbSuffix);
            var isError = false;
            if (message != "" ) {
                isError = true;
                //revision needed handling
                if (message.indexOf("CSP_WS_00039") > -1) {
                    message += "<br />" + i18next.t("cargoInfo.RetrieveAWBMsg");
                    message = message.replace('$AWB$', "<a id=\"reply_redirect\" href=\"javascript: void(0)\">" + i18next.t("menu.SingleBooking") + "</a>");
                }
            }
            else {
                if (bkd.Reply != null && bkd.Reply.length > 0 && bkd.Reply[0].Ack2 != "") {
                    message = bkd.Reply[0].Ack2;
                    isError = true;
                }
                else {
					if (bkd.CxIsSpecified) {
						var cxGoodReply = true;
						var cxGoodMessage = "";
						if (typeof bkd.FlightDetail !== 'undefined' && bkd.FlightDetail != null) {
							for (var i = 0; i < bkd.FlightDetail.length; i++) {
								if (bkd.FlightDetail[0].FlightDetailCxIsSpecified) {
								    if (goodReplyMessage.indexOf(bkd.FlightDetail[i].FlightDetailCx.FCTLStatusX.toUpperCase()) != -1 || goodReplyMessage.indexOf(bkd.FlightDetail[i].FlightDetailCx.FCTLStatus.toUpperCase()) != -1) {
										if (bkd.FlightDetail[i].FlightDetailCx.FCTLStatusX != "") {
											cxGoodMessage = bkd.FlightDetail[i].FlightDetailCx.FCTLStatusX;
										}
									}
									else {
										cxGoodReply = false;
										message = bkd.FlightDetail[i].FlightDetailCx.FCTLStatusX;
										break;
									}
								}
								else {
									if (!goodReplyMessage.indexOf(bkd.FlightDetail[i].SpaceAllocationCode) != -1) {
										headerErrorMessage = spaceAllocationCodeDict[bkd.FlightDetail[i].SpaceAllocationCode];
										headerDisplayError = true;
									}
								}
							}
							if (cxGoodReply) {
								message = cxGoodMessage;
							}
						}

						if (typeof bkd.Cx !== 'undefined' && bkd.Cx != null)
                        {
                            if (typeof bkd.Cx.NgttInfo !== 'undefined' && bkd.Cx.NgttInfo != null)
                            {
                                if (bkd.Cx.NgttInfo.ProductCode != '')
                                {
                                    message += '<br> Ultra track is subscribed, should you have any problem, please contact to CX local sales team';
                                }
                            }
                        }
					}
					else {
						message = "Booking Submitted";
					}
                }
            }
            if (isError) {
                $("#bkd_reply_status_icon").addClass("blk_error");
                $('#bkd_reply_status_icon #bkd_message').text(i18next.t("cargoInfo.ResubmitMsg"));
            }
            else {
                $("#bkd_reply_status_icon").removeClass("blk_error");
                $('#bkd_reply_status_icon #bkd_message').text(i18next.t("cargoInfo.BookingSubmitted"));
            }
            $("#bkd_awb_number").html(bkd.AwbPrefix + "-" + bkd.AwbSuffix);
            $("#bkd_orig").html(bkd.Origin);
            $("#bkd_dest").html(bkd.Destination);
            $("#bkd_pcs").html(bkd.Pieces);
            $("#bkd_weight").html(bkd.Weight);
            $("#bkd_detail_message").html(message);
            $("#bkd_detail_message_time").html(new Date().ToString(DateTimeFormat.Full));
            $("#bkd_single_booking_result").css("display", "block");
            $("#bkd_single_booking").css("display", "none");
            $("#reply_redirect").click(function () {
                goToSingleBooking(bkd.Airline, bkd.AwbPrefix, bkd.AwbSuffix);
            });

            refreshModuleTranslation();
        }

        bookingHub.client.accepted = function (bkd) {
            stopAction();
            console.log(bkd);
            $("#bkd_result_airline").val(bkd.Airline);
            $("#bkd_result_awbprefix").val(bkd.AwbPrefix);
            $("#bkd_result_awbsuffix").val(bkd.AwbSuffix);
            $("#bkd_awb_number").html(bkd.AwbPrefix + "-" + bkd.AwbSuffix);
            $("#bkd_orig").html(bkd.Origin);
            $("#bkd_dest").html(bkd.Destination);
            $("#bkd_pcs").html(bkd.Pieces);
            $("#bkd_weight").html(bkd.Weight);
            $("#bkd_detail_message").html("Booking Submitted");
            $("#bkd_detail_message_time").html(new Date().ToString(DateTimeFormat.Full));
            $("#bkd_single_booking_result").css("display", "block");
            $("#bkd_single_booking").css("display", "none");
            refreshModuleTranslation();
        }

        bookingHub.client.acceptedDraft = function (bkd) {
            stopAction();
            console.log(bkd);
            $("#bkd_result_airline").val(bkd.Airline);
            $("#bkd_result_awbprefix").val(bkd.AwbPrefix);
            $("#bkd_result_awbsuffix").val(bkd.AwbSuffix);
            $("#bkd_awb_number").html(bkd.AwbPrefix + "-" + bkd.AwbSuffix);
            $("#bkd_orig").html(bkd.Origin);
            $("#bkd_dest").html(bkd.Destination);
            $("#bkd_pcs").html(bkd.Pieces);
            $("#bkd_weight").html(bkd.Weight);
            $("#bkd_message").html("Draft Submitted");
            $("#bkd_detail_message").html("Draft Saved");
            $("#bkd_detail_message_time").html(new Date().ToString(DateTimeFormat.Full));
            $("#bkd_single_booking_result").css("display", "block");
            $("#bkd_single_booking").css("display", "none");
            refreshModuleTranslation();
        }

        bookingHub.client.error = function (msg) {
            console.log("Error Message - " + msg);
            alert(msg);
            //var warnings = [];
            if (msg.indexOf("CSP_WS_00055") > 0) {
                setTimeout(function () {
                    //warnings.push(msg);
                    //if (warnings.length > 0) {
                    //    showBookingErrorMsg(i18next.t("cargoInfo.NoteErrMsg"), warnings);
                    //}
                    Ctrl.warnings.otherWarnings.add(msg);
                }, 1000);
            }
            stopAction();
            localStorage.setItem("GetBookingError", 1);
            refreshModuleTranslation();
        }

        bookingHub.client.renderTabs = function (tabs, afterAction) {
            console.timeEnd("bookingHub:getAirlineTemplate");
            console.log("Received Tabs HTMLs");
            stopAction();
            var submitData = prepareSubmitData();

            $("#tab1").html("");
            $("#tab2").html("");
            $("#tab3").html("");
            for (var i = 0; i < tabs.Tab1.length; i++) {
                $("#tab1").append(tabs.Tab1[i])

            }
            for (var i = 0; i < tabs.Tab2.length; i++) {
                $("#tab2").append(tabs.Tab2[i])
            }

            for (var i = 0; i < tabs.Tab3.length; i++) {
                $("#tab3").append(tabs.Tab3[i])
            }


            console.time("triggerHandler: submitData");
            for (var i = 1; i <= 3; i++) {
                $("#tab" + i + " > .bkd_block").each(function (i, o) {
                    if ($._data(o, 'events') && $._data(o, 'events').init != null)
                        $(o).triggerHandler("init", submitData);
                });
            }
            $('#cargoInfo_awb_suffix').focus();
            
            getNGTTProductCode();
            if (afterAction == AfterTemplateChange.QuickAWBSearch) {
                if (typeof cargoInfoQuickSearchAWB === "function") {
                    cargoInfoQuickSearchAWB();
                }
            } else if (afterAction == AfterTemplateChange.FillTemplateData) {
                if (typeof setTemplateDataAfterNavi === "function") {
                    setTemplateDataAfterNavi();
                }
            } else if (afterAction == AfterTemplateChange.SetBookingData) {
                setBookingData();
                if (localStorage.getItem("awb_retrieve_count") != null) {
                    var awb_s_count = parseInt(localStorage.getItem("awb_retrieve_count"));
                    localStorage.setItem("awb_retrieve_count", awb_s_count + 1);
                }
                $('#cargoInfo_pcs').focus();
            } else if (afterAction == AfterTemplateChange.PasteFlightDetailData) {
                fsPasteFlightDetail();
            }
            if (getData("bkd_def_cargoinfo", "Airline") == "CX" || getData("bkd_def_cargoinfo", "Airline") == "KA" || getData("bkd_def_cargoinfo", "Airline") == "LD" || getData("bkd_def_cargoinfo", "Airline") == "UO") {
                $(".act_save_draft").hide();
            } else {
                $(".act_save_draft").show()
            }
            refreshModuleTranslation();
        }

        bookingHub.client.loadBookingData = function (bkd) {
            console.log("Received Booking Data From Server");
            console.log(bkd);
            //Issue #27684, Temp fix for csp reply - consignee and shipper addr "null" value
            if (bkd.Consignee && bkd.Consignee.StreetAdd)
                bkd.Consignee.StreetAdd = HandleContactAddrNullVal(bkd.Consignee.StreetAdd);
            if (bkd.Shipper && bkd.Shipper.StreetAdd)
                bkd.Shipper.StreetAdd = HandleContactAddrNullVal(bkd.Shipper.StreetAdd);

            stopAction();
            if (typeof bkd !== 'undefined' && bkd != null) {
                if (typeof bkd.Airline !== 'undefined' && bkd.Airline != null) {

                    if (_.includes(airlineList, bkd.Airline)) {
                        localStorage.setItem("booking_data", JSON.stringify(bkd))
                        getAirlineTemplate(bkd.Airline, AfterTemplateChange.SetBookingData);
                    } else {
                        alert("Load booking data failed. Airline data is missing.");
                    }
                } else {
                    alert("Load booking data failed. Booking data is missing.");
                }
            }
        }

        function setBookingData() {
            if (localStorage.getItem("booking_data") != null) {
                var bkd = JSON.parse(localStorage.getItem("booking_data"));
                for (var i = 1; i <= 3; i++) {
                    $("#tab" + i + " > .bkd_block").each(function (i, o) {
                        if ($._data(o, 'events') && $._data(o, 'events').loadBookingData != null)
                            $(o).triggerHandler("loadBookingData", bkd);
                    });
                }
                localStorage.removeItem("booking_data");
            }
        }

        /* error msg box */
        function hideBookingErrorMsg() {
            $("#errorWrapper").addClass("disabled");
            $("#errorWrapper .error-box .error-message").text("");
            $("#blk_errorLt li").remove();
        }

        function showBookingErrorMsg(msg, list) {
            $("#errorWrapper").removeClass("disabled");
            if (typeof msg !== 'undefined' && msg != null) {
                $("#errorWrapper .error-box .error-message").text(msg);
            }
            if (typeof list !== 'undefined' && list != null) {
                if (Array.isArray(list)) {
                    for (var i = 0; i < list.length; i++) {
                        $("#blk_errorLt").append("<li>"+list[i]+"</li>");
                    }
                }
            }
        }

        function hideBookingErrorMsgAir() {
            $("#errorWrapper_air").addClass("disabled");
            $("#errorWrapper_air .error-box .error-message").text("");
            $("#blk_errorLt_air li").remove();
        }

        function showBookingErrorMsgAir(msg, list) {
            $("#errorWrapper_air").removeClass("disabled");
            if (typeof msg !== 'undefined' && msg != null) {
                $("#errorWrapper_air .error-box .error-message").text(msg);
            }
            if (typeof list !== 'undefined' && list != null) {
                if (Array.isArray(list)) {
                    for (var i = 0; i < list.length; i++) {
                        $("#blk_errorLt_air").append("<li>" + list[i] + "</li>");
                    }
                }
            }
        }

        /* tag-input */
        var availableSHCTags = [];
        var availableSHCDesc = [];
        var showTempList = ["PES", "ACT"];
        /*
        var SHCodeOptionData = [];
        var SHCodeOptionData = JSON.parse(SHCodeOptionModel);
        for (i = 0; i < SHCodeOptionData.length; i++) {
            availableSHCTags.push(SHCodeOptionData[i]);
        }
        */

        function regSHCodeAutoComplete() {
            getSpecialHandlingCode();
            /*
            $(".SHCodeAC .autocomplete").autocomplete({
                source: availableSHCTags
            });
            */
        }

        function getComponentRowID(com) {
            var rowID = $("."+com).last().attr("data-rowid");
            console.log("getComponentRowID: " + rowID);
            return parseInt(rowID);
        }

        // prevent unexpected page reload when pressing enter key
        $(document).keypress(function(e) {
            if(e.which == 13) {
                e.preventDefault();
                console.log('You pressed enter!');
            }
        });

        //Get Special Handling Code
        function getSpecialHandlingCode() {
            connectHub(function () {
                //startAction(true);
                bookingHub.server.getSpecialHandlingCode();
            });
        }

        bookingHub.client.setSpecialHandling = function (shcList) {
            console.log("Received SHC");
            console.log("shcList: " + shcList);
            availableSHCTags = shcList;
            $(".SHCodeAC .autocomplete").autocomplete({
                source: availableSHCTags,
                select: selectSHCFromAutoComplete
            });

            $(".SHCodeDG .autocomplete").autocomplete({
                source: availableSHCDesc,
                select: selectSHCFromAutoCompleteDG
            });

            /*
            var shcListOpt = [];
            //shcListOpt = shcList.split(",");
            var obj;
            for (var i = 0; i < shcList.length; i++) {
                obj = new Object();
                obj.SHCCode = shcList[i];
                shcListOpt.push(obj);
                //console.log(shcList[i]);
            }

            //availableSHCTags = JSON.parse(data);
            for (var i = 1; i <= 3; i++) {
                $("#tab" + i + " > .bkd_block").each(function (i, o) {
                    if ($._data(o, 'events') && $._data(o, 'events').setSHC != null)
                        //console.log("shcList2: " + shcList);
                        //console.log("shcList2: " + shcListOpt);
                        $(o).triggerHandler("setSHC", JSON.stringify(shcList));
                });
            }
            */
            //stopAction();
        }

        bookingHub.client.displayWarningMessage = function (warning) {
            //debugger;
            var warnings = [];
            // timeout is set for preventing the warning message being cleared before getAWB and getAirlineTemplate
            setTimeout(function () {
                switch (warning) {
                    case "WARN_CHINA":
                        Ctrl.warnings.otherWarnings.add(i18next.t("cargoInfo.ChinaAwbWarn"));
                        break;
                }
                //if (warnings.length > 0){
                //    showBookingErrorMsg(i18next.t("cargoInfo.NoteErrMsg"), warnings);
            }, 1000);

        }

        //Get port info
        function getPortCode(src, callback) {
            connectHub(function () {
                //startAction(true);
                bookingHub.server.getPortInfo(src).done(function (result) {
                    console.log(result);
                    callback(JSON.parse(result));
                    //stopAction();
                });
            });
        }

        function getPortCodeV3(src, callback) {

            if (typeof sessionStorage.getItem("PortList") !== 'undefined' && sessionStorage.getItem("PortList") != null) {

                var arr = JSON.parse(sessionStorage.getItem("PortList"));
                callback(arr.sort(function(a, b){return b.value.indexOf(src) - a.value.indexOf(src) }));

            } else {
                callback([]);
            }
        }

        var portList = null;

        function getPortCodeV4(src, callback) {
            if (portList == null) {
                portList = JSON.parse(sessionStorage.getItem("PortList"))
            }
            src = src.toUpperCase();
            var returnList = JSON.search(portList, "//*[data='" + src + "']");
            returnList = returnList.concat(JSON.search(portList, "//*[contains(value, '" + src + "')]").slice(0,99));
            returnList = removeDuplicates(returnList, "data");
            var o = { suggestions: returnList };
            callback(o);
        }

        function removeDuplicates(originalArray, prop) {
            var newArray = [];
            var lookupObject  = {};
            for(var i in originalArray) {
                if (isNaN(parseInt(i))) continue;
                lookupObject[originalArray[i][prop]] = originalArray[i];
            }
            for(i in lookupObject) {
                newArray.push(lookupObject[i]);
            }
            return newArray;
        }

        function regPortQuery() {

            $('.port_query').devbridgeAutocomplete({
                lookup: function (query, done) {
                    // Do Ajax call or lookup locally, when done,
                    // call the callback and pass your results:
                    getPortCode(query, done);
                },
                preserveInput: true,
                deferRequestBy: 300,
                minChars: 2,
                autoSelectFirst: true,
                onSelect: function (response) {
                    $(this).val(response.data);
                    //alert('You selected: ' + response.value + ', ' + response.data);
                }
            });
        }

        function regPortQueryV2() {
            $('.port_query').devbridgeAutocomplete({
                lookup: function (query, done) {
                    getPortCodeV4(query, done);
                }, //JSON.parse(sessionStorage.getItem("PortList")),
                preserveInput: true,
                deferRequestBy: 200,
                minChars: 2,
                autoSelectFirst: false,
                onSelect: function (response) {
                    $(this).val(response.data);
                    //alert('You selected: ' + response.value + ', ' + response.data);
					if (CheckNGTTExpand(false)) { $("#bkd_def_ngtt").show(); }
                    else { $("#bkd_def_ngtt").hide(); }
                },
                lookupLimit: 10
            });

            bkdPortQueryLimitToChar();
            reAttachSearchFlightElsOnEnter();
        }

        function regPortQueryV3() {

            $('.port_query').devbridgeAutocomplete({

                lookup: function (query, done) {
                    // Do Ajax call or lookup locally, when done,
                    // call the callback and pass your results:
                    getPortCodeV3(query, done);
                },
                preserveInput: true,
                deferRequestBy: 300,
                minChars: 2,
                autoSelectFirst: true,
                onSelect: function (response) {
                    $(this).val(response.data);
                    //alert('You selected: ' + response.value + ', ' + response.data);
                }
            });
        }

        //set good desc dropdown box
        function setGoodsDescDropdownBox() {
            var arr = [];
            //getPriorityType(setPriorityTypeOption);
            if (typeof sessionStorage.getItem("GoodDescList") !== 'undefined' && sessionStorage.getItem("GoodDescList") != null) {
                arr = JSON.parse(sessionStorage.getItem("GoodDescList"));
                setGoodsDescTypeOption(arr);
            } else {
                getDefaultOptionalItem();
            }

        }

        //Get goods desc type info
        function getGoodsDescType(callback) {
            connectHub(function () {
                //startAction(true);
                bookingHub.server.getGoodsDescTypeList().done(function (result) {
                    console.log(result);
                    callback(JSON.parse(result));
                    //stopAction();
                });
            });
        }

        function setGoodsDescTypeOption(arr) {
            if (typeof arr !== 'undefined' && arr != null){
                //$('select#cargoInfo_good_des').children('option:not(:first)').remove();
                $('select#cargoInfo_good_des').children().remove();
                for (var i = 0; i < arr.length; i++) {
                    $("select#cargoInfo_good_des").append( $("<option>")
                        .val(arr[i].Value)
                        .html(arr[i].Desc)
                    );
                }
                $("select#cargoInfo_good_des").val("OTH");
                $("#cargoInfo_good_detail").show();
            }
        }
        //Get priority type info
        function getPriorityType(callback) {
            connectHub(function () {
                //startAction(true);
                bookingHub.server.getPriorityTypeList().done(function (result) {
                    console.log(result);
                    callback(JSON.parse(result));
                    //stopAction();
                });
            });
        }

        function setPriorityTypeOption(arr) {

            if (typeof arr !== 'undefined' && arr != null){
                $('select#cargoInfo_priority').children('option:not(:first)').remove();
                for (var i = 0; i < arr.length; i++) {
                    $("select#cargoInfo_priority").append( $("<option>")
                        .val(arr[i])
                        .html(arr[i])
                    );
                }
            }
        }

        // get default optional item
        function getDefaultOptionalItem(loadAWB) {
            console.log("start getDefaultOptionalItem");
            console.time("getDefaultOptionalItem");
            connectHub(function () {
                //startAction(true);
                console.time("bookingHub:getDefaultOptionalItem");
                bookingHub.server.getDefaultOptionalValue().done(function (result) {
                  //  console.log(result);
                    //callback(JSON.parse(result));
                    //stopAction();
                    var obj = JSON.parse(result);
                  //  console.log(obj);
                    console.timeEnd("bookingHub:getDefaultOptionalItem");
                    // set special handling code
                    if (typeof sessionStorage.getItem("SHCList") !== 'undefined' && sessionStorage.getItem("SHCList") != null) {
                        localStorage.removeItem("SHCList");
                    }

                    if (typeof obj.shcList !== 'undefined' && obj.shcList != null) {
                        sessionStorage.setItem("SHCList", JSON.stringify(obj.shcList));
                        availableSHCTags = obj.shcList;
                        availableSHCDesc = obj.shcDescList;
                        //availableSHCTags = JSON.parse(sessionStorage.getItem("SHCList"));

                        $(".SHCodeAC .autocomplete").autocomplete({
                            source: availableSHCDesc,
                            select: selectSHCFromAutoComplete
                        });

                        $(".SHCodeDG .autocomplete").autocomplete({
                            source: availableSHCDesc,
                            select: selectSHCFromAutoCompleteDG
                        });

                    }
                   // console.log(sessionStorage.getItem("SHCList"));
                    // set goods desc type
                    if (typeof sessionStorage.getItem("GoodDescList") !== 'undefined' && sessionStorage.getItem("GoodDescList") != null) {
                        localStorage.removeItem("GoodDescList");
                    }

                    if (typeof obj.goodsDescType !== 'undefined' && obj.goodsDescType != null) {
                        sessionStorage.setItem("GoodDescList", JSON.stringify(obj.goodsDescType));
                        setGoodsDescTypeOption(obj.goodsDescType);
                    }
                   // console.log(sessionStorage.getItem("GoodDescList"));
                    if (typeof obj.commodityLH !== 'undefined' && obj.commodityLH != null) {
                        sessionStorage.setItem("Commodity_LH", JSON.stringify(obj.commodityLH));
                    }
                    if (typeof obj.uldTypeListLH !== 'undefined' && obj.uldTypeListLH != null) {
                        sessionStorage.setItem("ULDType_LH", JSON.stringify(obj.uldTypeListLH));
                    }
                    if (typeof obj.airlineAdvBookDay !== 'undefined' && obj.airlineAdvBookDay != null) {
                        sessionStorage.setItem("AirlineAdvBookDay", JSON.stringify(obj.airlineAdvBookDay));
                    }

                    if (typeof obj.airlineList !== 'undefined' && obj.airlineList != null) {
                        airlineList = [];

                        if (obj.airlineList.length > 0) {
                            for (var i = 0; i < obj.airlineList.length; i++) {
                                airlineList.push(obj.airlineList[i]);
                            }
                            setCargoInfoAirlineOption();
                            if (localStorage.getItem("pasteFlightDetailData") != null) {
                                var flightData = JSON.parse(localStorage.getItem("pasteFlightDetailData"));
                                $("#bkd_def_cargoinfo").triggerHandler("pasteAirline", flightData.Airline);
                            }

                            if (!loadAWB)
                            {
                                $('#cargoInfo_airline').selectpicker('toggle');
                            }

                        }
                    }

                    // set priority type
                    /*
                    if (typeof localStorage.getItem("PrList") !== 'undefined' && localStorage.getItem("PrList") != null) {
                        localStorage.removeItem("PrList");
                    }

                    if (typeof obj.prList !== 'undefined' && obj.prList != null) {
                        localStorage.setItem("PrList", JSON.stringify(obj.prList));
                        setPriorityTypeOption(obj.prList);
                    }
                    console.log(localStorage.getItem("PrList"));
                    */

                    // set port list
                    if (typeof sessionStorage.getItem("PortList") !== 'undefined' && sessionStorage.getItem("PortList") != null) {
                        localStorage.removeItem("PortList");
                    }

                    if (typeof obj.suggestions !== 'undefined' && obj.suggestions != null) {
                        sessionStorage.setItem("PortList", JSON.stringify(obj.suggestions));
                        regPortQueryV2();
                    }
                    //console.log(sessionStorage.getItem("PortList"));
                    //set Other Booking Prefix Pfl
                    if (typeof sessionStorage.getItem("OtherBookingPrefixPflList") !== 'undefined' && sessionStorage.getItem("OtherBookingPrefixPflList") != null) {
                        localStorage.removeItem("OtherBookingPrefixPflList");
                    }

                    if (typeof obj.otherBookingPrefixPfl !== 'undefined' && obj.otherBookingPrefixPfl != null) {
                        sessionStorage.setItem("OtherBookingPrefixPflList", JSON.stringify(obj.otherBookingPrefixPfl));
                    }
                    if (typeof loadAWB !== 'undefined' && loadAWB != null) {
                        if (loadAWB) {
                            var airline = "";
                            var awbPrefix = "";
                            var awbSuffix = "";

                            if (!!!airline) {
                                airline = bkdAWBPrefixToAirline(awbPrefix);
                            }

                            if (!!airline && !!awbPrefix && !!awbSuffix) {
                                switch (wayToRetrieve) {
                                    case 0:
                                        getAWB(airline, awbPrefix, awbSuffix);
                                        break;
                                    case 1:
                                        getAWBAPI(airline, awbPrefix, awbSuffix); //Booking API
                                        break;
                                    default:
                                        getAWB(airline, awbPrefix, awbSuffix);
                                        break;
                                }
                            }

                        }
                    }
                /*CX shopping button use in UAT only*/
                    if (typeof getCookie("cx_aspshopping_token") != 'undefined') {
                        var cx_aspshopping_token = getCookie("cx_aspshopping_token");
                        if (cx_aspshopping_token != null && cx_aspshopping_token != "") {
                            $("#CXASPShopping").show();
                        } else {
                            $("#CXASPShopping").hide();
                        }
                    }
                    console.timeEnd("getDefaultOptionalItem");
                    console.log("end getDefaultOptionalItem");
                  //  console.timeEnd("default page"); // started from Skin\ToolsBox\ToolsBox\ToolsBox.ascx
                });
            });
        }

        // get default optional item
        function getDefaultOptionalItemAPI(loadAWB) {
            console.log("start getDefaultOptionalItemAPI");
            console.time("getDefaultOptionalItemAPI");
            console.time("API:getDefaultOptionalItemAPI");
            var d = {

            }; //create array of objects
            var options = {};
            options.url = BookingAPIURL + "defaultOptions";
            options.type = "POST";
            options.contentType = "application/json; charset=utf-8";
            options.dataType = "json";
            options.data = JSON.stringify(d);
            options.beforeSend = function (xhr, settings) {
                xhr.setRequestHeader('Authorization', 'Bearer ' + getCookie('ApiToken'));
            };
            options.success = function (response) {
                console.log("getDefaultOptionalItemAPI response:", response);
                var obj = response.options;
                // console.log(JSON.stringify(obj));
                console.timeEnd("API:getDefaultOptionalItemAPI");
                // set special handling code
                if (typeof sessionStorage.getItem("SHCList") !== 'undefined' && sessionStorage.getItem("SHCList") != null) {
                    localStorage.removeItem("SHCList");
                }

                if (typeof obj.shcList !== 'undefined' && obj.shcList != null) {
                    sessionStorage.setItem("SHCList", JSON.stringify(obj.shcList));
                    availableSHCTags = obj.shcList;
                }
                if (typeof sessionStorage.getItem("SHCDescList") !== 'undefined' && sessionStorage.getItem("SHCDescList") != null) {
                    localStorage.removeItem("SHCDescList");
                }
                if (typeof obj.shcDescList !== 'undefined' && obj.shcDescList != null) {
                    sessionStorage.setItem("SHCDescList", JSON.stringify(obj.shcDescList));
                    availableSHCDesc = obj.shcDescList;
                    $(".SHCodeAC .autocomplete").autocomplete({
                        source: availableSHCDesc,
                        select: selectSHCFromAutoComplete
                    });

                    $(".SHCodeDG .autocomplete").autocomplete({
                        source: availableSHCDesc,
                        select: selectSHCFromAutoCompleteDG
                    });
                }

                // set goods desc type
                if (typeof sessionStorage.getItem("GoodDescList") !== 'undefined' && sessionStorage.getItem("GoodDescList") != null) {
                    localStorage.removeItem("GoodDescList");
                }

                if (typeof obj.goodsDescType !== 'undefined' && obj.goodsDescType != null) {
                    sessionStorage.setItem("GoodDescList", JSON.stringify(obj.goodsDescType));
                    setGoodsDescTypeOption(obj.goodsDescType);
                }
                if (typeof sessionStorage.getItem("Commodity_LH") !== 'undefined' && sessionStorage.getItem("Commodity_LH") != null) {
                    localStorage.removeItem("Commodity_LH");
                }
                if (typeof obj.commodityLH !== 'undefined' && obj.commodityLH != null) {
                    sessionStorage.setItem("Commodity_LH", JSON.stringify(obj.commodityLH));
                }
                if (typeof sessionStorage.getItem("ULDType_LH") !== 'undefined' && sessionStorage.getItem("ULDType_LH") != null) {
                    localStorage.removeItem("ULDType_LH");
                }
                if (typeof obj.uldTypeListLH !== 'undefined' && obj.uldTypeListLH != null) {
                    sessionStorage.setItem("ULDType_LH", JSON.stringify(obj.uldTypeListLH));
                }
                if (typeof sessionStorage.getItem("AirlineAdvBookDay") !== 'undefined' && sessionStorage.getItem("AirlineAdvBookDay") != null) {
                    localStorage.removeItem("AirlineAdvBookDay");
                }
                if (typeof obj.airlineAdvBookDay !== 'undefined' && obj.airlineAdvBookDay != null) {
                    sessionStorage.setItem("AirlineAdvBookDay", JSON.stringify(obj.airlineAdvBookDay));
                }

                if (typeof sessionStorage.getItem("AirlinesList") !== 'undefined' && sessionStorage.getItem("AirlinesList") != null) {
                    localStorage.removeItem("AirlinesList");
                }
                if (typeof obj.airlineList !== 'undefined' && obj.airlineList != null) {
                    sessionStorage.setItem("AirlinesList", JSON.stringify(obj.airlineList));
                    airlineList = [];

                    if (obj.airlineList.length > 0) {
                        for (var i = 0; i < obj.airlineList.length; i++) {
                            airlineList.push(obj.airlineList[i]);
                        }
                        setCargoInfoAirlineOption();
                        if (localStorage.getItem("pasteFlightDetailData") != null) {
                            var flightData = JSON.parse(localStorage.getItem("pasteFlightDetailData"));
                            $("#bkd_def_cargoinfo").triggerHandler("pasteAirline", flightData.Airline);
                        }

                        if (!loadAWB) {
                            $('#cargoInfo_airline').selectpicker('toggle');
                        }

                    }
                }

                // set port list
                if (typeof sessionStorage.getItem("PortList") !== 'undefined' && sessionStorage.getItem("PortList") != null) {
                    localStorage.removeItem("PortList");
                }

                if (typeof obj.suggestions !== 'undefined' && obj.suggestions != null) {
                    sessionStorage.setItem("PortList", JSON.stringify(obj.suggestions));
                    regPortQueryV2();
                }
                //set Other Booking Prefix Pfl
                if (typeof sessionStorage.getItem("OtherBookingPrefixPflList") !== 'undefined' && sessionStorage.getItem("OtherBookingPrefixPflList") != null) {
                    localStorage.removeItem("OtherBookingPrefixPflList");
                }

                if (typeof obj.otherBookingPrefixPfl !== 'undefined' && obj.otherBookingPrefixPfl != null) {
                    sessionStorage.setItem("OtherBookingPrefixPflList", JSON.stringify(obj.otherBookingPrefixPfl));
                }

                //set airlineDetail
                if (typeof sessionStorage.getItem("AirlineDetailList") !== 'undefined' && sessionStorage.getItem("AirlineDetailList") != null) {
                    localStorage.removeItem("AirlineDetailList");
                }

                if (typeof obj.airlineDetailList !== 'undefined' && obj.airlineDetailList != null) {
                    sessionStorage.setItem("AirlineDetailList", JSON.stringify(obj.airlineDetailList));
                }

                /*CX shopping button use in UAT only*/
                if (typeof getCookie("cx_aspshopping_token") != 'undefined') {
                    var cx_aspshopping_token = getCookie("cx_aspshopping_token");
                    if (cx_aspshopping_token != null && cx_aspshopping_token != "") {
                        $("#CXASPShopping").show();
                    } else {
                        $("#CXASPShopping").hide();
                    }
                }
                if (typeof loadAWB !== 'undefined' && loadAWB != null) {
                    if (loadAWB) {
                        var airline = "";
                        var awbPrefix = "";
                        var awbSuffix = "";

                        if (!!!airline) {
                            airline = bkdAWBPrefixToAirline(awbPrefix);
                        }

                        if (!!airline && !!awbPrefix && !!awbSuffix) {
                            switch (wayToRetrieve) {
                                case 0:
                                    getAWB(airline, awbPrefix, awbSuffix);
                                    break;
                                case 1:
                                    getAWBAPI(airline, awbPrefix, awbSuffix); //Booking API
                                    break;
                                default:
                                    getAWB(airline, awbPrefix, awbSuffix);
                                    break;
                            }
                        }

                    }
                }

                console.timeEnd("getDefaultOptionalItemAPI");
            };
            options.error = function () {
                console.log("Error while calling the Web API!");
                stopAction();
                DialogManager.alert(i18next.t('common.System'), i18next.t('common.SessionTimeout'));
            };
            $.ajax(options);
        }

        // get default optional item
        function getDefaultOptions(loadAWB) {
            // set special handling code
            console.log("getDefaultOptions");
            console.time("getDefaultOptions");
            if ((typeof sessionStorage.getItem("AirlineDetailList") == 'undefined' || sessionStorage.getItem("AirlineDetailList") == null) &&
                (typeof sessionStorage.getItem("SHCList") == 'undefined' || sessionStorage.getItem("SHCList") == null) &&
               ( typeof sessionStorage.getItem("SHCDescList") == 'undefined' || sessionStorage.getItem("SHCDescList") == null) &&
               ( typeof sessionStorage.getItem("GoodDescList") == 'undefined' || sessionStorage.getItem("GoodDescList") == null) &&
               ( typeof sessionStorage.getItem("Commodity_LH") == 'undefined' || sessionStorage.getItem("Commodity_LH") == null) &&
               ( typeof sessionStorage.getItem("ULDType_LH") == 'undefined' || sessionStorage.getItem("ULDType_LH") == null) &&
               ( typeof sessionStorage.getItem("AirlineAdvBookDay") == 'undefined' || sessionStorage.getItem("AirlineAdvBookDay") == null) &&
               ( typeof sessionStorage.getItem("PortList") == 'undefined' || sessionStorage.getItem("PortList") == null) &&
                (typeof sessionStorage.getItem("OtherBookingPrefixPflList") == 'undefined' || sessionStorage.getItem("OtherBookingPrefixPflList") == null) &&
               ( typeof sessionStorage.getItem("AirlinesList") == 'undefined' || sessionStorage.getItem("AirlinesList") == null)
            ) {
                getDefaultOptionalItemAPI(loadAWB)
            } else {
                //set airlineDetail
                if (typeof sessionStorage.getItem("AirlineDetailList") == 'undefined' || sessionStorage.getItem("AirlineDetailList") == null) {
                    var objairlinedetailslist = postOptionaAPI("airlinedetailslist");
                    console.log("objairlinedetailslist", objairlinedetailslist);
                    sessionStorage.setItem("AirlineDetailList", JSON.stringify(objairlinedetailslist.options));
                }

                if (typeof sessionStorage.getItem("SHCList") == 'undefined' || sessionStorage.getItem("SHCList") == null ||
                    typeof sessionStorage.getItem("SHCDescList") == 'undefined' || sessionStorage.getItem("SHCDescList") == null) {
                    var shcoptions = getOptionaAPI("shcoptions");
                    console.log("shcoptions", shcoptions);
                    if (typeof shcoptions.shcList !== 'undefined' && shcoptions.shcList != null) {
                        sessionStorage.setItem("SHCList", JSON.stringify(shcoptions.shcList));
                        availableSHCTags = shcoptions.shcList;
                    }
                    if (typeof shcoptions.shcDescList !== 'undefined' && shcoptions.shcDescList != null) {
                        sessionStorage.setItem("SHCDescList", JSON.stringify(shcoptions.shcDescList));
                        availableSHCDesc = shcoptions.shcDescList;
                    }

                } else {
                    availableSHCTags = JSON.parse(sessionStorage.getItem("SHCList"));
                    availableSHCDesc = JSON.parse(sessionStorage.getItem("SHCDescList"));
                }
                //   console.log("availableSHCTags", availableSHCTags);
                //  console.log("availableSHCDesc", availableSHCDesc);
                if (typeof availableSHCTags !== 'undefined' && availableSHCTags != null && typeof availableSHCDesc !== 'undefined' && availableSHCDesc != null) {
                    $(".SHCodeAC .autocomplete").autocomplete({
                        source: availableSHCDesc,
                        select: selectSHCFromAutoComplete
                    });

                    $(".SHCodeDG .autocomplete").autocomplete({
                        source: availableSHCDesc,
                        select: selectSHCFromAutoCompleteDG
                    });
                }

                // set goods desc type
                if (typeof sessionStorage.getItem("GoodDescList") == 'undefined' || sessionStorage.getItem("GoodDescList") == null) {
                    var goodsdescOptions = getOptionaAPI("goodsdescOptions");
                    console.log("goodsdescOptions", goodsdescOptions.options);
                    sessionStorage.setItem("GoodDescList", JSON.stringify(goodsdescOptions.options));
                    setGoodsDescTypeOption(goodsdescOptions.options);
                } else {

                    setGoodsDescTypeOption(JSON.parse(sessionStorage.getItem("GoodDescList")));
                }

                if (typeof sessionStorage.getItem("Commodity_LH") == 'undefined' || sessionStorage.getItem("Commodity_LH") == null) {
                    var Commodity_LH = getOptionaAPI("LHCommodityListOptions");
                    console.log("Commodity_LH", Commodity_LH.options);
                    sessionStorage.setItem("Commodity_LH", JSON.stringify(Commodity_LH.options));
                }

                if (typeof sessionStorage.getItem("ULDType_LH") == 'undefined' || sessionStorage.getItem("ULDType_LH") == null) {
                    var ULDType_LH = getOptionaAPI("ULDTypeLHlistOptions");
                    console.log("ULDType_LH", ULDType_LH.options);
                    sessionStorage.setItem("ULDType_LH", JSON.stringify(ULDType_LH.options));
                }
                if (typeof sessionStorage.getItem("AirlineAdvBookDay") == 'undefined' || sessionStorage.getItem("AirlineAdvBookDay") == null) {
                    var AirlineAdvBookDay = getOptionaAPI("airlineAdvBookDaylistOptions");
                    console.log("AirlineAdvBookDay", AirlineAdvBookDay.options);
                    sessionStorage.setItem("AirlineAdvBookDay", JSON.stringify(AirlineAdvBookDay.options));
                }

                // set port list
                if (typeof sessionStorage.getItem("PortList") == 'undefined' || sessionStorage.getItem("PortList") == null) {
                    var PortList = getOptionaAPI("portlistOptions");
                    console.log("PortList", PortList.options);
                    sessionStorage.setItem("PortList", JSON.stringify(PortList.options));
                }
                regPortQueryV2();

                //set Other Booking Prefix Pfl

                if (typeof sessionStorage.getItem("OtherBookingPrefixPflList") == 'undefined' || sessionStorage.getItem("OtherBookingPrefixPflList") == null) {
                    var OtherBookingPrefixPflList = getOptionaAPI("OtherBookingPrefixPfllistOptions");
                    console.log("OtherBookingPrefixPflList", OtherBookingPrefixPflList.options);
                    sessionStorage.setItem("OtherBookingPrefixPflList", JSON.stringify(OtherBookingPrefixPflList.options));
                }
                var List;
                var objairlineList;
                if (typeof sessionStorage.getItem("AirlinesList") == 'undefined' || sessionStorage.getItem("AirlinesList") == null) {
                    List = postOptionaAPI("airlineslist");
                    sessionStorage.setItem("AirlinesList", JSON.stringify(List.options));
                    objairlineList = List.options;
                } else {
                    List = JSON.parse(sessionStorage.getItem("AirlinesList"));
                    objairlineList = List;
                }

                if (typeof objairlineList !== 'undefined' && objairlineList != null) {
                    airlineList = [];

                    if (objairlineList.length > 0) {
                        for (var i = 0; i < objairlineList.length; i++) {
                            airlineList.push(objairlineList[i]);
                        }
                        setCargoInfoAirlineOption();
                        if (localStorage.getItem("pasteFlightDetailData") != null) {
                            var flightData = JSON.parse(localStorage.getItem("pasteFlightDetailData"));
                            $("#bkd_def_cargoinfo").triggerHandler("pasteAirline", flightData.Airline);
                        }

                        if (!loadAWB) {
                            $('#cargoInfo_airline').selectpicker('toggle');
                        }

                    }
                }

                console.time("CXASPShopping");
                /*CX shopping button use in UAT only*/
                if (typeof getCookie("cx_aspshopping_token") != 'undefined') {
                    var cx_aspshopping_token = getCookie("cx_aspshopping_token");
                    if (cx_aspshopping_token != null && cx_aspshopping_token != "") {
                        $("#CXASPShopping").show();
                    } else {
                        $("#CXASPShopping").hide();
                    }
                }
                console.timeEnd("CXASPShopping");

                if (typeof loadAWB !== 'undefined' && loadAWB != null) {
                    if (loadAWB) {
                        var airline = "";
                        var awbPrefix = "";
                        var awbSuffix = "";

                        if (!!!airline) {
                            airline = bkdAWBPrefixToAirline(awbPrefix);
                        }

                        if (!!airline && !!awbPrefix && !!awbSuffix) {
                            console.log("getAWB or getAWBAPI");
                            switch (wayToRetrieve) {
                                case 0:
                                    getAWB(airline, awbPrefix, awbSuffix);
                                    break;
                                case 1:
                                    getAWBAPI(airline, awbPrefix, awbSuffix); //Booking API
                                    break;
                                default:
                                    getAWB(airline, awbPrefix, awbSuffix);
                                    break;
                            }
                        }

                    }
                }
            }
            console.timeEnd("getDefaultOptions");
        }

        // post default optional item
        function postOptionaAPI(path) {
            console.log("start postOptionaAPI", path);
            console.time("postOptionaAPI" + path);
            var d = {
                "request": {
                }
            }; //create array of objects
            var options = {};
            options.url = BookingAPIURL + path;
            options.type = "POST";
            options.contentType = "application/json; charset=utf-8";
            options.dataType = "json";
            options.data = JSON.stringify(d);
            options.beforeSend = function (xhr, settings) {
                xhr.setRequestHeader('Authorization', 'Bearer ' + getCookie('ApiToken'));
            };
            options.success = function (response) {
                console.log("postOptionaAPI " + path + " response:", response);

                console.timeEnd("postOptionaAPI" + path);
                return response;
            };
            options.error = function () {
                console.log("Error while calling the Web API!");
                stopAction();
                DialogManager.alert(i18next.t('common.System'), i18next.t('common.SessionTimeout'));
            };
            var a = $.ajax(options);
            console.log(a);
            if (a.responseText != null || a.responseText != undefined) {
                return JSON.parse(a.responseText);
            }
        }

         // get default optional item
        function getOptionaAPI(path) {
            console.log("start getOptionaAPI", path);
            console.time("getOptionaAPI" + path);
            //console.time("API:getOptionaAPI");
           // var d = {

          //  }; //create array of objects
            var options = {};
            options.url = BookingAPIURL + path;
            options.type = "Get";
            options.contentType = "application/json; charset=utf-8";
            options.dataType = "json";
           // options.data = JSON.stringify(d);
            options.beforeSend = function (xhr, settings) {
                xhr.setRequestHeader('Authorization', 'Bearer ' + getCookie('ApiToken'));
            };
            options.success = function (response) {
                console.log("getOptionaAPI " + path+" response:", response);

                console.timeEnd("getOptionaAPI" + path);
                return response;
            };
            options.error = function () {
                console.log("Error while calling the Web API!");
                stopAction();
                DialogManager.alert(i18next.t('common.System'), i18next.t('common.SessionTimeout'));
            };
            var a = $.ajax(options);
            if (a.responseText != null || a.responseText != undefined) {
                return JSON.parse(a.responseText);
            }
        }


        function gotoMultiAWB(e) {
            e.preventDefault();
            window.location.href="/Booking/MultiBooking";
        }

        function clearTemplateData() {
            for (var i = 1; i <= 3; i++) {
                $("#tab" + i + " > .bkd_block").each(function (i, o) {
                    if ($._data(o, 'events') && $._data(o, 'events').clear != null)
                        $(o).triggerHandler("clear");
                });
            }
        }

        function clearOptionalTemplateData() {
            for (var i = 2; i <= 3; i++) {
                $("#tab" + i + " > .bkd_block").each(function (i, o) {
                    if ($._data(o, 'events') && $._data(o, 'events').clear != null)
                        $(o).triggerHandler("clear");
                });
            }
        }

        function bkdGotoMultiAWB(e) {
            e.preventDefault();
            window.location.href = linkBkdMultiAwb;
        }

        function bkdGotoMultiAirline(e) {
            e.preventDefault();
            window.location.href = linkBkdMultiAirline;
        }

        function bkdGoToBookingLog(e) {
            e.preventDefault();
            window.location.href = linkBkdBookingLog;
        }

        function bkdGoToBookingDetail(e) {
            e.preventDefault();
            window.location.href = linkBkdDetail + bkdQSSingle
                .replace("$AIRLINE$", $("#bkd_result_airline").val())
                .replace("$AWBPREFIX$", $("#bkd_result_awbprefix").val())
                .replace("$AWBSUFFIX$", $("#bkd_result_awbsuffix").val());
        }

        /* Booking data template */
        function saveCurrentTemplate(e) {
            console.log("saveCurrentTemplate");
            if (typeof e !== 'undefined' && e != null && e.preventDefault) {
                e.preventDefault();
            }
            var templateName = $("#singlebook_temp_record_ins").val() || "";
            if (templateName == "") {
                alert("Template Name must be entered");
                return false;
            }

            var obj = new Object();
            obj.TemplateContent = [];
            obj.Airline = "";
            obj.Origin = "";
            obj.Destination = "";
            var rawData = prepareTemplateSaveData();
            console.log(rawData);
            var dataValue = Object.keys(rawData).map(function (e) {
                return rawData[e]
            })
            //var dataValue = Object.values(rawData);
            for (var i = 0; i < dataValue.length; i++) {
                for (var j = 0; j < dataValue[i].TDataList.length; j++) {
                    obj.TemplateContent.push(dataValue[i].TDataList[j]);
                }
            }
            console.log(obj.TemplateContent);
            obj.TemplateName = templateName;
            if (typeof rawData.CargoInfo !== 'undefined' && rawData.CargoInfo != null) {
                if (typeof rawData.CargoInfo.TDataList !== 'undefined' && rawData.CargoInfo.TDataList != null) {
                    for (var i = 0; i < rawData.CargoInfo.TDataList.length; i++) {
                        if (rawData.CargoInfo.TDataList[i].DataID == "Airline") {
                            obj.Airline = rawData.CargoInfo.TDataList[i].Content;
                        }
                    }
                }
            }

            var foundFrom = false;
            var checkTo = false;
            if (typeof rawData.FlightSegmentInfo !== 'undefined' && rawData.FlightSegmentInfo != null) {
                if (typeof rawData.FlightSegmentInfo.TDataList !== 'undefined' && rawData.FlightSegmentInfo.TDataList != null) {
                    for (var i = 0; i < rawData.FlightSegmentInfo.TDataList.length; i++) {
                        var dataID = rawData.FlightSegmentInfo.TDataList[i].DataID
                        var dataType = dataID.substring(0, dataID.lastIndexOf("_"));
                        if (dataType == "") {
                            dataType = dataID;
                        }
                        if (dataType == "From" && foundFrom == false) {
                            obj.Origin = rawData.FlightSegmentInfo.TDataList[i].Content;
                            foundFrom = true;
                        }
                        if (dataType == "From" || dataType == "Date" || dataType == "FlightNo") {
                            if (rawData.FlightSegmentInfo.TDataList[i].Content != "") {
                                checkTo = true;
                            }
                        }
                        if (dataType == "To") {
                            if (checkTo) {
                                obj.Destination = rawData.FlightSegmentInfo.TDataList[i].Content;
                            }
                            checkTo = false;
                        }
                    }
                }
            }
            SaveTemplateRecord(obj);

        }

        function prepareTemplateSaveData() {
            var templateData = {};

            for (var i = 1; i <= 3; i++) {
                $("#tab" + i + " > .bkd_block").each(function (i, o) {
                    if ($._data(o, 'events') && $._data(o, 'events').getTemplateData != null)
                        $.extend(templateData, $(o).triggerHandler("getTemplateData"));
                });
            }
            console.log(templateData);
            return templateData;
        }
        /* end booking data template */

        function testTemplateSave() {
            var obj = new Object();
            obj.TemplateContent = [];
            obj.Airline = "";
            obj.Origin = "";
            obj.Destination = "";
            var rawData = prepareTemplateSaveData();
            console.log(rawData);
            var dataValue = Object.keys(rawData).map(function (e) {
                return rawData[e]
            })
            // not support in IE11
            //var dataEntry = Object.entries(rawData);
            //var dataValue = Object.values(rawData);

            //for (var i = 0; i < rawData)
            for (var i = 0; i < dataValue.length; i++) {
                for (var j = 0; j < dataValue[i].TDataList.length; j++) {
                    obj.TemplateContent.push(dataValue[i].TDataList[j]);
                }
            }
            console.log(obj.TemplateContent);
            obj.TemplateName = "AAA1";
            if (typeof rawData.CargoInfo !== 'undefined' && rawData.CargoInfo != null) {
                if (typeof rawData.CargoInfo.TDataList !== 'undefined' && rawData.CargoInfo.TDataList != null) {
                    for (var i = 0; i < rawData.CargoInfo.TDataList.length; i++) {
                        if (rawData.CargoInfo.TDataList[i].DataID == "Airline") {
                            obj.Airline = rawData.CargoInfo.TDataList[i].Content;
                        }
                    }
                }
            }

            var foundFrom = false;
            var checkTo = false;
            if (typeof rawData.FlightSegmentInfo !== 'undefined' && rawData.FlightSegmentInfo != null) {
                if (typeof rawData.FlightSegmentInfo.TDataList !== 'undefined' && rawData.FlightSegmentInfo.TDataList != null) {
                    for (var i = 0; i < rawData.FlightSegmentInfo.TDataList.length; i++) {
                        var dataID = rawData.FlightSegmentInfo.TDataList[i].DataID
                        var dataType = dataID.substring(0, dataID.lastIndexOf("_"));
                        if (dataType == "") {
                            dataType = dataID;
                        }
                        if (dataType == "From" && foundFrom == false) {
                            obj.Origin = rawData.FlightSegmentInfo.TDataList[i].Content;
                            foundFrom = true;
                        }
                        if (dataType == "From" || dataType == "Date" || dataType == "FlightNo") {
                            if (rawData.FlightSegmentInfo.TDataList[i].Content != "") {
                                checkTo = true;
                            }
                        }
                        if (dataType == "To") {
                            if (checkTo) {
                                obj.Destination = rawData.FlightSegmentInfo.TDataList[i].Content;
                            }
                            checkTo = false;
                        }
                    }
                }
            }

            SaveTemplateRecord(obj);
        }

        function fsPaste(fs) {
            if (fs != null) {
                console.log("fs: " + fs);
                var fsArr = fs.split("|");
                fsArr.pop();
                console.log("fsArr: " + fsArr);
                var fsRefObj = new Object();
                var fsRowCount = 0;
                var fsRefFlightObj = new Object();
                if (fsArr.length > 0 && (fsArr.length - 1) % 4 == 0) {
                    console.log("fsArr.length - 1: " + fsArr.length - 1);
                    fsRefObj.Airline = fsArr[0].toUpperCase();
                    fsRefObj.FlightDetail = [];
                    for (var i = 1; i < fsArr.length; i += 4) {
                        fsRefFlightObj = new Object();
                        fsRefFlightObj.FlightNum = fsArr[i];
                        fsRefFlightObj.DeparturePort = fsArr[i + 1];
                        fsRefFlightObj.ArrivalPort = fsArr[i + 2];
                        fsRefFlightObj.DepartureDate = fsArr[i + 3];
                        fsRefObj.FlightDetail.push(fsRefFlightObj);
                    }
                }
                console.log("fsRefObjArr: " + JSON.stringify(fsRefObj));
                localStorage.setItem("pasteFlightDetailData", JSON.stringify(fsRefObj))
                setData("bkd_def_cargoinfo", "Airline", fsRefObj.Airline);
                setData("bkd_def_cargoinfo", "AWBPrefix", bkdAirlineDefaultAWBPrefix(fsRefObj.Airline));
                getAirlineTemplate(fsRefObj.Airline, AfterTemplateChange.PasteFlightDetailData);
            }

        }

        function fsPasteFlightDetail() {
            if (localStorage.getItem("pasteFlightDetailData") != null) {
                var flightData = JSON.parse(localStorage.getItem("pasteFlightDetailData"));
                $("#bkd_def_flight").triggerHandler("pasteFlightDetailData", flightData);
                $("#bkd_def_routing").triggerHandler("pasteFlightDetailData", flightData);
            }
        }

        function testLH() {
            if (sessionStorage.getItem("Commodity_LH") != null) {
                var lh = JSON.parse(sessionStorage.getItem("Commodity_LH"));
                var obj = lh.filter(function (x) {
                    return x.CommodityGroup == "Aircraft Engine, not restricted (civil)";
                });
                console.log(obj);
            }
        }

        function getLHCommodity() {
            if (sessionStorage.getItem("Commodity_LH") != null) {
                var lh = JSON.parse(sessionStorage.getItem("Commodity_LH"));
                var obj = lh.filter(function (x) {
                    return x.CommodityGroup == "Aircraft Engine, not restricted (civil)";
                });
                console.log(obj);
            }
        }

        function getLHCommodityGroup() {
            if (sessionStorage.getItem("Commodity_LH") != null) {
                var lh = JSON.parse(sessionStorage.getItem("Commodity_LH"));
                var lhCommodityGroupList = [];
                for (var i = 0; i < lh.length; i++) {
                    lhCommodityGroupList.push(lh[i].CommodityGroup);
                }

                console.log(lhCommodityGroupList);
            }
        }

        function testAdvBookDay(airline) {
            if (sessionStorage.getItem("AirlineAdvBookDay") != null) {
                var advDay = JSON.parse(sessionStorage.getItem("AirlineAdvBookDay"));
                var obj = advDay.filter(function (x) {
                    return x.Airline == airline;
                });
                console.log(obj);
            }
        }

		function goToAmendSingleBooking() {
			let airline = $('#bkd_result_airline').val();
			let awbPrefix = $('#bkd_result_awbprefix').val();
			let awbSuffix = $('#bkd_result_awbsuffix').val();
			//console.log('airline: ' + airline);
			//console.log('awbprefix: ' + awbPrefix);
			//console.log('awbsuffix: ' + awbSuffix);
			goToSingleBooking(airline, awbPrefix, awbSuffix);
		}

        function goToSingleBooking(airline, awbPrefix, awbSuffix) {
            var link = linkBkdSingleAwb + bkdQSSingle;
            window.location.href = link.replace("$AIRLINE$", airline).replace("$AWBPREFIX$", awbPrefix).replace("$AWBSUFFIX$", awbSuffix);
        }

        bookingHub.client.receiveLHStockAgtAcctNo = function (acctNo) {
            stopAction();
            $('#bkd_def_cargoinfo').triggerHandler("receiveStockAgtAcctNo", acctNo);
        }

        function cargoInfoQuickSearchAWB() {
            console.log("cargoInfoQuickSearchAWB");
            var airline = $("#cargoInfo_airline").val();
            var awbPrefix = $("#cargoInfo_awb_prefix").val();
            var awbSuffix = $("#cargoInfo_awb_suffix").val();
            localStorage.setItem("GetBookingError", 0);
            localStorage.setItem("getAWBSuccess", 0);
            switch (wayToRetrieve) {
                case 0:
                    getAWB(airline, awbPrefix, awbSuffix);
                    break;
                case 1:
                    getAWBAPI(airline, awbPrefix, awbSuffix); //Booking API
                    break;
                default:
                    getAWB(airline, awbPrefix, awbSuffix);
                    break;
            }
            localStorage.setItem("loadAWBno", airline + awbPrefix + awbSuffix);
        }

        function resetWarning() {
            Ctrl.warnings.inputWarnings.dropAll();
            Ctrl.warnings.otherWarnings.dropAll();
        }

        function initMsgCtrl() {
            Ctrl.warnings = {
                inputWarnings: new msgCtrl(
                    function () {
                        var msg = i18next.t("createBooking.InputError");
                        var list = Ctrl.warnings.inputWarnings.get();
                        $("#errorWrapper_air").removeClass("disabled");
                        if (typeof msg !== 'undefined' && msg != null) {
                            $("#errorWrapper_air .error-box .error-message").text(msg);
                        }
                        if (typeof list !== 'undefined' && list != null) {
                            if (Array.isArray(list)) {
                                for (var i = 0; i < list.length; i++) {
                                    $("#blk_errorLt_air").append("<li>" + list[i] + "</li>");
                                }
                            }
                        }
                    },
                    function () {
                        $("#errorWrapper_air").addClass("disabled");
                        $("#errorWrapper_air .error-box .error-message").text("");
                        $("#blk_errorLt_air li").remove();
                    }
                ),
                otherWarnings: new msgCtrl(
                    function () {
                        var msg = i18next.t("cargoInfo.NoteErrMsg");
                        var list = Ctrl.warnings.otherWarnings.get();
                        $("#errorWrapper").removeClass("disabled");
                        if (typeof msg !== 'undefined' && msg != null) {
                            $("#errorWrapper .error-box .error-message").text(msg);
                        }
                        if (typeof list !== 'undefined' && list != null) {
                            if (Array.isArray(list)) {
                                for (var i = 0; i < list.length; i++) {
                                    $("#blk_errorLt").append("<li>" + list[i] + "</li>");
                                }
                            }
                        }
                    },
                    function () {
                        $("#errorWrapper").addClass("disabled");
                        $("#errorWrapper .error-box .error-message").text("");
                        $("#blk_errorLt li").remove();
                    }
                )
            }
        }

        var tabKeyPressed = false;

        $(document).keydown(function (e) {
            var evtobj = window.event ? event : e;

            if (evtobj.keyCode == 13 && evtobj.ctrlKey && evtobj.altKey && evtobj.shiftKey)
            {
                $("#btn_submit").click();
                return false; //used to avoid firefox redirect event
            }
            else if (evtobj.keyCode == 9)
            {
                tabKeyPressed = true;
            }

        });

        $(document).on("keyup", function () {
            if (tabKeyPressed) {
                var eletop = $(document.activeElement).offset().top - $(document).scrollTop();
                var winheight = $(window).height();

                var bottom = winheight * 0.2;
                var bottomheight = winheight - bottom;

                if (eletop > bottomheight) {
                    window.scrollBy(0, bottom);
                }

                tabKeyPressed = false;
            }
            else
            {
                var evtobj = window.event ? event : e;
                if (evtobj.keyCode == 13 && $(document.activeElement).attr('id') == 'btn_submit') {
                    var isChromium = window.chrome;
                    var winNav = window.navigator;
                    var vendorName = winNav.vendor;
                    var isOpera = typeof window.opr !== "undefined";
                    var isIEedge = winNav.userAgent.indexOf("Edge") > -1;
                    var isIOSChrome = winNav.userAgent.match("CriOS");

                    if (isIOSChrome) {
                        // is Google Chrome on IOS
                    } else if (
                        isChromium !== null &&
                        typeof isChromium !== "undefined" &&
                        vendorName === "Google Inc." &&
                        isOpera === false &&
                        isIEedge === false
                    ) {
                        // is Google Chrome
                    } else {
                        // not Google Chrome
                        $("#btn_submit").click();
                    }
                }
            }
        });

		function CheckNGTTExpand(setproduct)
        {
            var currentAirline = $("#cargoInfo_airline").val();
            var shc = $("#sc_special_code").val();
            var shcList = [];
            var rtn = false;
            if (currentAirline == 'CX' || currentAirline == 'KA' || currentAirline == 'LD' || currentAirline == 'UO')
            {
                if (typeof PortList !== 'undefined' && PortList != null && typeof TemperatureList !== 'undefined' && TemperatureList != null)
                {
                    //check special handling code
                    if (shc != "") {
                        shcList = shc.split(",");
                    }
                    if (shcList.length > 0) {
                        if (shcList.indexOf(ngtt_shc) > -1) {
                            rtn = true;
                            if (setproduct) {
                                //set product and temperature code
                                var productisexist = false;
                                var temperatureisexist = false;

                                for (var i = 0; i < shcList.length; i++) {

                                    if (!productisexist) {
                                        $('#ngtt_product option').each(function () {

                                            if (this.value == shcList[i]) {
                                                $('#ngtt_product').val(this.value).change();
                                                productisexist = true;
                                                return false;
                                            }
                                        });
                                    }

                                    if (!temperatureisexist) {
                                        var mappedtempcode = '';
                                        for (var j = 0; j < TemperatureList.length; j++)
                                        {
                                            if (TemperatureList[j].temperatureSHC == shcList[i])
                                            {
                                                mappedtempcode = TemperatureList[j].temperatureCode;
                                                break;
                                            }
                                        }

                                        if (mappedtempcode != '')
                                        {
                                            $('#ngtt_temperature option').each(function () {

                                                if (this.value == mappedtempcode) {
                                                    $('#ngtt_temperature').val(this.value).change();
                                                    temperatureisexist = true;
                                                    return false;
                                                }
                                            });
                                        }
                                    }
                                    if (productisexist && temperatureisexist) {
                                        break;
                                    }
                                }
                            }
                        }
                    }

                    if (rtn) {
                        //check rounting
                        var odvalid = false;
                        var routefrom = $("#routing_route_from_1").val();
                        var routeto = '';

                        //only check the last RouteTo
                        for (var i = 0; i < PortList.length; i++) {
                            if (PortList[i].toUpperCase() == routefrom.toUpperCase()) {
                                $("div[class^='route_input_row']").each(function (i, el) {
                                    var rowid = $(this).attr("data-rowid");
                                    if ($("#routing_route_to_" + rowid).val() != '') {
                                        routeto = $("#routing_route_to_" + rowid).val();
                                    }
                                });

                                for (var j = 0; j < PortList.length; j++) {
                                    if (PortList[j].toUpperCase() == routeto.toUpperCase()) {
                                        odvalid = true;
                                        break;
                                    }
                                }
                                break;
                            }
                        }

                        //check one of RouteTo is valid
                        //for (var i = 0; i < PortList.length; i++) {
                        //    if (PortList[i] == routefrom) {
                        //        //when origin valid
                        //        $("div[class^='route_input_row']").each(function (i, el) {
                        //            var rowid = $(this).attr("data-rowid");
                        //            var routeTo = $("#routing_route_to_" + rowid).val();

                        //            if (!odvalid) {
                        //                for (var j = 0; j < PortList.length; j++) {
                        //                    if (PortList[j] == routeTo) {
                        //                        odvalid = true;
                        //                        break;
                        //                    }
                        //                }
                        //            }

                        //        });

                        //        break;
                        //    }
                        //}

                        if (!odvalid) {
                            rtn = false;
                        }
                    }
                }
            }
            return rtn;
        }

		var ProductServiceLevelCombination;
        var TemperatureList;
        var ctTemperatureList;
        var PortList;
        var ngtt_shc = "";
        var ngtt_deviceidformat = "";

        function getNGTTProductCode()
        {
            console.log("getNGTTProductCode");
            var partialUrl = 'GetNGTTReferenceInfo';
            var data = {};

            connectHub(function () {
                bookingHub.server.getNGTTSHC().done(function (hubResults) {
                    ngtt_shc = hubResults;
                });
                bookingHub.server.getNGTTDeviceIDFormat().done(function (hubResults) {
                    ngtt_deviceidformat = hubResults;
                });
            });
            //$.ajax({
            //    type: "GET",
            //    dataType: "text",
            //    url: "http://odev201:8014/api/GetNGTTReferenceInfo",
            //    success: function (data) {
            //        var obj = JSON.parse(data);
            //        alert(obj.port[0]);
            //    },
            //    error: function (xhr, status, error) {
            //        alert(error);
            //    }
            //});

            AjaxNGTTRequest.post(partialUrl, data,
                function (result) {

                    setTimeout(function () {
                        //$('#ngtt_product').children().remove();

                        //for (var i = 0; i < result.product.length; i++) {
                        //    $('#ngtt_product')
                        //        .append($("<option></option>")
                        //            .attr("value", result.product[i].productCode)
                        //            .text(result.product[i].productCode));
                        //}
                        console.log("AjaxNGTTRequest result:", result);
                        ProductServiceLevelCombination = result.product;
                        TemperatureList = result.temperature;
                        PortList = result.port;
                       
                        if (typeof sessionStorage.getItem("ctTemperatureList") !== 'undefined' && sessionStorage.getItem("ctTemperatureList") != null) {
                            sessionStorage.removeItem("ctTemperatureList");
                        }
                        if (typeof result.ctTemperature !== 'undefined' && result.ctTemperature != null) {
                            sessionStorage.setItem("ctTemperatureList", JSON.stringify(result.ctTemperature));
                            ctTemperatureList = result.ctTemperature;
                        }
                        //setServiceLevel($('#ngtt_product').val());

                        if (typeof localStorage.getItem("NGTTProductList") !== 'undefined' && localStorage.getItem("NGTTProductList") != null) {
                            localStorage.removeItem("NGTTProductList");
                        }
                        if (typeof result.product !== 'undefined' && result.product != null) {
                            localStorage.setItem("NGTTProductList", JSON.stringify(result.product));
                            //setGoodsDescTypeOption(obj.goodsDescType);
                        }
                    }, 1);
                },
                function (result) {
                    AjaxNGTTRequest.displayAjaxErr(result);
                }
            );
        }

         /*CX shopping button use in UAT only*/
        function openShoppingPage() {
            if (windowObjectReference == null || windowObjectReference.closed)
              /* if the pointer to the window object in memory does not exist
                 or if such pointer exists but the window was closed */ {
                windowObjectReference = window.open("https://uat-ezycargo2017.ezbiz.com/cx-asp-shopping/",
                    "CXASPShoppingWindowName", "menubar,toolbar,resizable,scrollbars,status");
                /* then create it. The new window will be created and
                   will be brought on top of any other window. */
            }
            else {
                windowObjectReference.focus();
                /* else the window reference must exist and the window
                   is not closed; therefore, we can bring it back on top of any other
                   window with the focus() method. There would be no need to re-create
                   the window or to reload the referenced resource. */
            };
        }

    </script>
</div>

</div>



</div><!-- End_Module_398 --></div>
	<div class="clear"></div>
</div>
</div></div>			
</main>
</div>

<!-- Page Content END-->
</form>

<div id="loading" class="container wbg disabled" style="display: block; width: 100%">
    <div class="loading-main">
        <span id="loading_message" data-i18n="common.Loading">Loading...</span>
    </div>
</div>
<div id="loading_partial" class="loading-panel disabled">
	<span id="loading_message_partial" data-i18n="common.LoadingMore">Loading more results. This may take a while...</span>
</div>
<style>
#loading {
	position: fixed;
    margin-top: 240px;
    top: 0px;
    z-index: 999;
}

@media screen and (max-width: 977px)
{
	#loading {
		margin-top: 42px;
	}
}
</style>

<footer class="footer" style="margin-top: 296px;"> 
	<div class="container">
		<div class="blkl">
			<div class="blklogo"><img src="./img/logo_gls.png" title="Global Logistics System (HK)Co.Ltd">
				<span>
					<span></span>
					<span id="footer-year">2021</span>&nbsp;
					<span data-i18n="footer.GLS">Global Logistics System (HK) Co. Ltd</span><br>
					<span data-i18n="footer.Copyright">All rights reserved.</span>
				</span>
			</div>
			<ul class="mainmenu">
				<li><a data-i18n="menu.TrackShipment" href="#">Booking</a></li>
				<li><a data-i18n="menu.FlightAvailability" href="#">Track Shipment</a></li>
			</ul>
			<div class="blkc"></div>
		</div>
		<div class="blkr">
			<img src="./img/icon_gn_phone.png">
			<span data-i18n="footer.Helpdesk">Help desk</span>
			<span>+852 2838 1999  </span><br>
			

<span data-i18n="footer.Language">Languages</span><span class="dot"></span>   
<a id="dnn_GLS_FOOTER_GLS_LANGUAGE_lnk_enUS" class="fglink lang_enUS" href="#">English</a><span class="dot lang_enUS"></span>
<a id="dnn_GLS_FOOTER_GLS_LANGUAGE_lnk_zhHK" class="fglink lang_zhHK" href="#"></a><span class="dot lang_zhHK"></span>
<a id="dnn_GLS_FOOTER_GLS_LANGUAGE_lnk_zhCN" class="fglink lang_zhCN" href="#"></a><span class="dot lang_zhCN"></span>
<a id="dnn_GLS_FOOTER_GLS_LANGUAGE_lnk_jaJP" class="fglink lang_jaJP" href="#"></a><br>
<a id="dnn_GLS_FOOTER_GLS_LANGUAGE_Lnk_deDe" class="fglink" href="#">Deutsche</a><span class="dot"></span>
<a id="dnn_GLS_FOOTER_GLS_LANGUAGE_Lnk_esES" class="fglink" href="#">Espaol</a>	  
		</div>
		<div class="blkr" style="clear: right">
			<span id="classicLink" class="">
				<a id="classicLinkHref_1" href="#" class="btn_classic">
					<span data-i18n="common.EzyCargoClassic" style="font-size:13px">EzyCargo Classic</span>
				</a>
			</span>
		</div>
		<div class="blkc"></div>
	</div>
</footer>

<style>
    .mainmenu li a {
		color: #fff;
		text-decoration: none;
		cursor: pointer;
    }
</style>
	  
<script>

$(document).ready(function(){
    $("#d-off-canvas-trigger").click(function(){
        $(".active_page").toggleClass(function(){
            return "freeze_page";
        });
    });
});
$(document).ready(function() {
    $(window).resize(function() {
		var bodyheight = $(window).height();
		$(".navbar-collapse.collapse").height(bodyheight-105);
    }); 
   
    $("#footer-year").html(new Date().getFullYear());
});

function FootRedirect(subUrl){
	window.location.href = window.location.origin + '/' + i18next.language + subUrl;
}
</script>

<!-- Dialog -->
<div>
	<style>
    .bootstrap_modal {
        z-index: 9991;
    }
	
	.bootstrap_modal .modal-header{
		background: #00AEEB;
		color: white;
		border-top-left-radius: 5px;
		border-top-right-radius: 5px;
	}

    .bootstrap_modal .btn {
        background: #00AEEB;
        padding: 6px 30px;
        color: #FFF;
        font-size: 16px;
        border-radius: 2px;
        font-family: inherit;
    }

    .bootstrap_modal #message {
        white-space: pre-wrap;
    }
</style>

<div id="modal" class="modal bootstrap_modal fade" role="dialog">
    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="title" data-i18n="common.System">common.System</h4>
            </div>
            <div class="modal-body">
                <p id="message"></p>
            </div>
            <div class="modal-footer">
                <button id="btn_confirm" type="button" class="btn btn-default" data-i18n="dialog.Confirm" style="display: none;">Confirm</button>
                <button id="btn_close" type="button" class="btn btn-default" data-i18n="dialog.Close">Close</button>
            </div>
        </div>

    </div>
</div>

<script>
	
    var DialogManager = {

        alert: function (header, msg, close, modalOpts) {
            var dialogManager = this;
			
			var opts = _.merge(this.getDefModalOpts(), modalOpts);
			$("#modal").modal(opts);
			
            if (header)
                $('#modal #title').text(header);

            if (Array.isArray(msg))
                $('#modal #message').text(dialogManager.getMsgFromArray(msg));
            else
                $('#modal #message').text(msg);

            $('#modal #btn_close').click(function () {
                if (typeof close === "function") {
                    close();
                }
                $("#modal").modal('hide');
            });
        },

        confirm: function (header, msg, confirm, close, modalOpts) {
            var dialogManager = this;
			
			var opts = _.merge(this.getDefModalOpts(), modalOpts);
			$("#modal").modal(opts);
			
            if (header)
                $('#modal #title').text(header);

            if (Array.isArray(msg))
                $('#modal #message').text(dialogManager.getMsgFromArray(msg));
            else
                $('#modal #message').text(msg);
				
            $('#modal #btn_confirm').show();

            $('#modal #btn_confirm').click(function () {
                if (typeof confirm === "function") {
                    confirm();
                }
                $("#modal").modal('hide');
            });

            $('#modal #btn_close').click(function () {
                if (typeof close === "function") {
                    close();
                }
                $("#modal").modal('hide');
            });
        },

        reset: function () {
			$("#modal").data('bs.modal', null);
		
            $('#modal #title').text(i18next.t('common.System'));
            $('#modal #message').text('');
            $('#modal #btn_confirm').hide();
			
            $('#modal #btn_confirm').off('click');
            $('#modal #btn_close').off('click');
        },

        getMsgFromArray: function (arr) {
            return arr.join("\n");
        },
		
		getDefModalOpts: function () {
			return {
				backdrop: true,
				show: true,
				keyboard: true
			}
		}
    };

    $(function () {
        DialogManager.reset();
		$('#modal').on('hide.bs.modal', function () {
			DialogManager.reset();
		})

		$(document).on('keydown', function (e) {
			if(!($("#modal").data('bs.modal') || {}).isShown)
				return;
				
			//enter
			if (e.which == 13) {
				$("#btn_confirm").click();
				e.stopPropagation();
			}
			//escape
			else if(e.which == 27){
				$("#btn_close").click();
				e.stopPropagation();
			}
		})
    })
</script>
</div>
        <input name="ScrollTop" type="hidden" id="ScrollTop">
        <input name="__dnnVariable" type="hidden" id="__dnnVariable" autocomplete="off">
</body></html>